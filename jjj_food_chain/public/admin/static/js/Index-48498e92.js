import{h as e,d as a,e as l,x as o,u as i,r as t,c as r,f as d,o as s,g as n,q as p,y as m,v as u,p as c,A as h}from"./element-plus-90e2c6dc.js";import{r as f}from"./request-e2c2136e.js";import{_}from"./_plugin-vue_export-helper-1b428a4d.js";import{o as g,S as b,R as w,a as V,O as x,V as C,ad as v,_ as y,c as j,X as D}from"./@vue-a14816bf.js";import{d as k}from"./index-315e32f5.js";import"./lodash-es-493ac664.js";import"./@vueuse-91cd0e71.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-0e7d7a79.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-63583d02.js";import"./qs-c6aa5595.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./vue-router-cf371e7b.js";import"./pinia-dde4581d.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-i18n-0667e8d8.js";import"./@intlify-2339bc47.js";let S={shopList:(e,a)=>f._post("/admin/shop/index",e,a),addShop:(e,a)=>f._post("/admin/shop/add",e,a),editShop:(e,a)=>f._post("/admin/shop/edit",e,a),updateStatus:(e,a)=>f._post("/admin/shop/updateStatus",e,a),storeEnter:(e,a)=>f._post("/admin/shop/enter",e,a),deleteShop:(e,a)=>f._post("/admin/shop/delete",e,a),updateWxStatus:(e,a)=>f._post("/admin/shop/updateWxStatus",e,a),updateChain:(e,a)=>f._post("/admin/shop/updateChain",e,a)};const U={data(){return{form:{no_expire:!1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l()},trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{this.form.password&&a!==this.form.password?l(new Error("确认密码不一致")):l()},trigger:"blur"}],expire_time_text:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_edit","curModel"],created(){this.dialogVisible=this.open_edit,this.form=this.curModel},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.editShop(l,!0).then((l=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.dialogFormVisible(!0)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},E=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),L=V("p",{class:"gray"},"注：平台后台用户名",-1),W=V("p",{class:"gray"},"注：平台后台用户密码",-1),z={class:"dialog-footer"};const M=_(U,[["render",function(e,n,p,m,u,c){const h=a,f=l,_=o,v=i,y=t,j=r,D=d,k=s;return g(),b(k,{title:"编辑平台",modelValue:u.dialogVisible,"onUpdate:modelValue":n[10]||(n[10]=e=>u.dialogVisible=e),onClose:c.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",z,[x(D,{onClick:c.dialogFormVisible},{default:w((()=>[C("取 消")])),_:1},8,["onClick"]),x(D,{type:"primary",onClick:n[9]||(n[9]=e=>c.addClick()),loading:u.loading},{default:w((()=>[C("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(j,{size:"small",model:u.form,ref:"form",rules:u.rules},{default:w((()=>[E,x(f,{label:"平台名称","label-width":u.formLabelWidth,prop:"app_name"},{default:w((()=>[x(h,{modelValue:u.form.app_name,"onUpdate:modelValue":n[0]||(n[0]=e=>u.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"过期时间","label-width":u.formLabelWidth,prop:"expire_time_text"},{default:w((()=>[x(_,{modelValue:u.form.expire_time_text,"onUpdate:modelValue":n[1]||(n[1]=e=>u.form.expire_time_text=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:u.form.no_expire},null,8,["modelValue","disabled"]),x(v,{modelValue:u.form.no_expire,"onUpdate:modelValue":n[2]||(n[2]=e=>u.form.no_expire=e),class:"pl16"},{default:w((()=>[C("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"平台账户名","label-width":u.formLabelWidth,prop:"user_name"},{default:w((()=>[x(h,{modelValue:u.form.user_name,"onUpdate:modelValue":n[3]||(n[3]=e=>u.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),L])),_:1},8,["label-width"]),x(f,{label:"平台账户密码","label-width":u.formLabelWidth,prop:"password"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password,"onUpdate:modelValue":n[4]||(n[4]=e=>u.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),W])),_:1},8,["label-width"]),x(f,{label:"确认密码","label-width":u.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password_confirm,"onUpdate:modelValue":n[5]||(n[5]=e=>u.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"是否连锁","label-width":u.formLabelWidth,prop:"is_chain"},{default:w((()=>[V("div",null,[x(y,{modelValue:u.form.is_chain,"onUpdate:modelValue":n[6]||(n[6]=e=>u.form.is_chain=e),label:1},{default:w((()=>[C("是")])),_:1},8,["modelValue"]),x(y,{modelValue:u.form.is_chain,"onUpdate:modelValue":n[7]||(n[7]=e=>u.form.is_chain=e),label:0},{default:w((()=>[C("否")])),_:1},8,["modelValue"])])])),_:1},8,["label-width"]),x(f,{label:"微信服务商支付","label-width":u.formLabelWidth,prop:"weixin_service"},{default:w((()=>[x(v,{modelValue:u.form.weixin_service,"onUpdate:modelValue":n[8]||(n[8]=e=>u.form.weixin_service=e)},{default:w((()=>[C("开启")])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]]),$={data(){return{form:{no_expire:!1,expire_time:0,is_chain:1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l(new Error("请输入密码"))},required:!0,trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{a?a!==this.form.password?l(new Error("确认密码不一致")):l():l(new Error("请填写确认密码"))},required:!0,trigger:"blur"}],expire_time:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_add"],created(){this.dialogVisible=this.open_add},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.addShop(l,!0).then((l=>{a.loading=!1,1==l.code&&(e({message:"恭喜你，添加成功",type:"success"}),a.dialogFormVisible(!0))})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},q=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),F=V("p",{class:"gray"},"注：平台后台用户名",-1),Y=V("p",{class:"gray"},"注：平台后台用户密码",-1),A={class:"dialog-footer"};const P={class:"common-level-rail"},N={class:"product-content"},T={class:"table-wrap"},B={class:"pagination"};const G=_({components:{Edit:M,Add:_($,[["render",function(e,n,p,m,u,c){const h=a,f=l,_=o,v=i,y=t,j=r,D=d,k=s;return g(),b(k,{title:"新增平台",modelValue:u.dialogVisible,"onUpdate:modelValue":n[10]||(n[10]=e=>u.dialogVisible=e),onClose:c.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",A,[x(D,{onClick:c.dialogFormVisible},{default:w((()=>[C("取 消")])),_:1},8,["onClick"]),x(D,{type:"primary",onClick:n[9]||(n[9]=e=>c.addClick()),loading:u.loading},{default:w((()=>[C("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(j,{size:"small",model:u.form,ref:"form",rules:u.rules},{default:w((()=>[q,x(f,{label:"平台名称","label-width":u.formLabelWidth,prop:"app_name"},{default:w((()=>[x(h,{modelValue:u.form.app_name,"onUpdate:modelValue":n[0]||(n[0]=e=>u.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"过期时间","label-width":u.formLabelWidth,prop:"expire_time"},{default:w((()=>[x(_,{modelValue:u.form.expire_time,"onUpdate:modelValue":n[1]||(n[1]=e=>u.form.expire_time=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:u.form.no_expire},null,8,["modelValue","disabled"]),x(v,{modelValue:u.form.no_expire,"onUpdate:modelValue":n[2]||(n[2]=e=>u.form.no_expire=e),class:"pl16"},{default:w((()=>[C("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"平台账户名","label-width":u.formLabelWidth,prop:"user_name"},{default:w((()=>[x(h,{modelValue:u.form.user_name,"onUpdate:modelValue":n[3]||(n[3]=e=>u.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),F])),_:1},8,["label-width"]),x(f,{label:"平台账户密码","label-width":u.formLabelWidth,prop:"password"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password,"onUpdate:modelValue":n[4]||(n[4]=e=>u.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),Y])),_:1},8,["label-width"]),x(f,{label:"确认密码","label-width":u.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password_confirm,"onUpdate:modelValue":n[5]||(n[5]=e=>u.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"是否连锁","label-width":u.formLabelWidth,prop:"is_chain"},{default:w((()=>[V("div",null,[x(y,{modelValue:u.form.is_chain,"onUpdate:modelValue":n[6]||(n[6]=e=>u.form.is_chain=e),label:1},{default:w((()=>[C("是")])),_:1},8,["modelValue"]),x(y,{modelValue:u.form.is_chain,"onUpdate:modelValue":n[7]||(n[7]=e=>u.form.is_chain=e),label:0},{default:w((()=>[C("否")])),_:1},8,["modelValue"])])])),_:1},8,["label-width"]),x(f,{label:"微信服务商支付","label-width":u.formLabelWidth,prop:"weixin_service"},{default:w((()=>[x(v,{modelValue:u.form.weixin_service,"onUpdate:modelValue":n[8]||(n[8]=e=>u.form.weixin_service=e)},{default:w((()=>[C("开启")])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]])},data:()=>({loading:!0,tableData:[],pageSize:20,totalDataNumber:0,curPage:1,open_add:!1,open_edit:!1,curModel:{}}),created(){this.getData()},methods:{targetLinkAddress(){let e=window.location.hostname;return"https://".concat(e,"/shop/#/login")},handleCurrentChange(e){let a=this;a.curPage=e,a.loading=!0,a.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData(){let e=this;S.shopList({page:e.curPage,list_rows:e.pageSize},!0).then((a=>{e.loading=!1,e.tableData=a.data.list.data,e.totalDataNumber=a.data.list.total,e.tableData.forEach((function(e){e.status=1===e.status,e.is_recycle=1!==e.is_recycle,e.weixin_service=1===e.weixin_service,e.is_chain=1===e.is_chain}))})).catch((e=>{}))},addClick(){this.open_add=!0},editClick(e){this.open_edit=!0,this.curModel=k(e),this.curModel.is_chain=!0===e.is_chain?1:0,0==this.curModel.expire_time?(this.curModel.expire_time_text="",this.curModel.no_expire=!0):this.curModel.no_expire=!1},closeDialogFunc(e,a){"add"==a&&(this.open_add=e.openDialog,"success"==e.type&&this.getData()),"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},statusChange:function(e,a){let l=this;l.loading=!0,S.updateStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.is_recycle=e})).catch((o=>{l.loading=!1,a.is_recycle=!e}))},wxStatusChange:function(e,a){let l=this;l.loading=!0,S.updateWxStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.weixin_service=e})).catch((o=>{l.loading=!1,a.weixin_service=!e}))},ChainChange:function(e,a){let l=this;l.loading=!0,S.updateChain({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.is_chain=e})).catch((o=>{l.loading=!1,a.is_chain=!e}))},deleteClick(a){let l=this;n.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,S.deleteShop({app_id:a.app_id},!0).then((a=>{l.loading=!1,1==a.code&&(e({message:a.msg,type:"success"}),l.getTableList())})).catch((e=>{l.loading=!1}))})).catch((()=>{}))},storeEnter(e){S.storeEnter({app_id:e},!0).then((e=>{})).catch((e=>{}))}}},[["render",function(e,a,l,o,t,r){const s=d,n=c,f=i,_=h,k=p,S=v("Add"),U=v("Edit"),E=m,L=u;return y((g(),j("div",null,[V("div",P,[x(s,{type:"primary",onClick:r.addClick},{default:w((()=>[C("添加平台")])),_:1},8,["onClick"])]),V("div",N,[V("div",T,[y((g(),b(k,{size:"small",data:t.tableData,style:{width:"100%"},"row-key":"access_id",border:"","default-expand-all":""},{default:w((()=>[x(n,{prop:"app_id",label:"平台ID"}),x(n,{prop:"app_name",label:"平台名称"}),x(n,{prop:"user_name",label:"超管账号"}),x(n,{prop:"status",label:"状态"},{default:w((e=>[x(f,{modelValue:e.row.is_recycle,"onUpdate:modelValue":a=>e.row.is_recycle=a,onChange:a=>r.statusChange(a,e.row)},{default:w((()=>[C("启用 ")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(n,{prop:"weixin_service",label:"微信服务商支付"},{default:w((e=>[x(f,{modelValue:e.row.weixin_service,"onUpdate:modelValue":a=>e.row.weixin_service=a,onChange:a=>r.wxStatusChange(a,e.row)},{default:w((()=>[C(" 启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(n,{prop:"is_chain",label:"连锁店"},{default:w((e=>[x(f,{modelValue:e.row.is_chain,"onUpdate:modelValue":a=>e.row.is_chain=a,onChange:a=>r.ChainChange(a,e.row)},{default:w((()=>[C(" 启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(n,{prop:"expire_time_text",label:"过期时间"}),x(n,{prop:"create_time",label:"添加时间"}),x(n,{label:"操作",width:"150"},{default:w((e=>[x(_,{href:r.targetLinkAddress(),target:"_blank",type:"primary",size:"small"},{default:w((()=>[C("进入商城")])),_:1},8,["href"]),x(_,{class:"ml10",onClick:a=>r.editClick(e.row),type:"primary",size:"small"},{default:w((()=>[C("编辑")])),_:2},1032,["onClick"]),x(_,{class:"ml10",onClick:a=>r.deleteClick(e.row),type:"primary",size:"small"},{default:w((()=>[C("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[L,t.loading]])])]),t.open_add?(g(),b(S,{key:0,open_add:t.open_add,onCloseDialog:a[0]||(a[0]=e=>r.closeDialogFunc(e,"add"))},null,8,["open_add"])):D("",!0),t.open_edit?(g(),b(U,{key:1,open_edit:t.open_edit,curModel:t.curModel,onCloseDialog:a[1]||(a[1]=e=>r.closeDialogFunc(e,"edit"))},null,8,["open_edit","curModel"])):D("",!0),V("div",B,[x(E,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,background:"","current-page":t.curPage,"page-size":t.pageSize,layout:"total, prev, pager, next, jumper",total:t.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),[[L,t.loading]])}]]);export{G as default};
