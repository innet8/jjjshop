import{_ as e}from"./GetCoupon-4cc0a74e.js";import{E as o,g as a,h as l,H as s,i as r,m as t,n as m,o as p,p as d,q as u,r as n,e as i}from"./element-plus-b01b3a31.js";import{P as c}from"./package-c602857d.js";import{_ as f}from"./_plugin-vue_export-helper-1b428a4d.js";import{o as _,c as g,a as b,P as h,S as j,W as y,T as V,Q as v,a8 as k,Y as x}from"./@vue-e72ffbb6.js";import"./coupon-a274fa8f.js";import"./index-e2ae9069.js";import"./vue-router-bf98ca95.js";import"./pinia-72b16af9.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-a8eee860.js";import"./side-channel-052d4c61.js";import"./get-intrinsic-d8eb8ca0.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./has-719bcddc.js";import"./call-bind-2971450c.js";import"./object-inspect-dd55f836.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./@element-plus-4b00147d.js";import"./vue-ueditor-wrap-e5a15ab3.js";import"./vue-i18n-73a1cd16.js";import"./@intlify-28c65249.js";import"./@vueuse-0fb12a45.js";import"./lodash-es-cce4393d.js";import"./async-validator-cf877c1f.js";import"./dayjs-34225b3b.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";const C={components:{GetCoupon:e},data:()=>({form:{coupon:[],is_times:0,times:0,is_grade:0,grade_ids:"",value1:[],name:"",total_num:""},Grade:[],tableData:[],loading:!1,open_add:!1,formRules:{},formLabelWidth:"120px",cprules:{validator:(e,o,a)=>{o>=10||o<=0?a(new Error("1-9")):a()},trigger:"blur"}}),created(){this.getGradeList()},methods:{getGradeList(){let e=this;c.getPackage({0:!0}).then((o=>{e.Grade=o.data.list})).catch((e=>{}))},addCoupon(){this.open_add=!0},closeProductDialogFunc(e){let a=this;if(a.open_add=e.openDialog,"success"==e.type)if(a.form.coupon.length<1)a.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),a.tableData.push({coupon_id:e.params.coupon_id,name:e.params.name,coupon_num:1});else{let l=!0;a.form.coupon.forEach(((o,a)=>{o.coupon_id==e.params.coupon_id&&(l=!1)})),l?(a.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),a.tableData.push({coupon_id:e.params.coupon_id,name:e.params.name,coupon_num:1})):o.error("请勿重复添加")}},delcoupon(e){let o=this,a=o.tableData.indexOf(e);o.tableData.splice(a,1),o.form.coupon.splice(a,1)},onSubmit(){let e=this,a=JSON.parse(JSON.stringify(e.form));e.form.coupon.length<=0&&o.error(" 至少选择一个优惠券"),e.$refs.form.validate((l=>{l&&(a.coupon=JSON.stringify(a.coupon),e.loading=!0,c.savePackage(a,!0).then((l=>{a.coupon=JSON.parse(a.coupon),1==l.code?(o({message:l.msg,type:"success"}),e.$router.push("/plus/package/index")):e.loading=!0})).catch((o=>{e.loading=!0})))}))},gotoBack(){this.$router.back(-1)}}},w={class:"user"},D=b("div",{class:"common-form"},"新增活动",-1),U={class:"product-content"},q=b("div",{class:"common-form"},"券包设置",-1),G=b("div",{class:"common-form"},"购买设置",-1),S=b("div",{class:"common-form"},"发放设置",-1),P={class:"common-button-wrapper"};const $=f(C,[["render",function(o,c,f,C,$,O){const Y=a,J=l,N=s,B=r,E=t,L=m,z=p,F=d,M=u,R=n,W=i,A=e;return _(),g("div",w,[D,b("div",U,[h(W,{ref:"form",model:$.form,"label-position":"top",rules:$.formRules,"label-width":"150px"},{default:j((()=>[h(J,{label:"活动标题",prop:"name",rules:[{required:!0,message:" "}]},{default:j((()=>[h(Y,{type:"text",modelValue:$.form.name,"onUpdate:modelValue":c[0]||(c[0]=e=>$.form.name=e),placeholder:"请输入活动标题",class:"max-w460"},null,8,["modelValue"])])),_:1}),h(J,{label:"活动日期",prop:"value1",rules:[{required:!0,message:" "}]},{default:j((()=>[h(N,{modelValue:$.form.value1,"onUpdate:modelValue":c[1]||(c[1]=e=>$.form.value1=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),q,h(J,{label:"优惠券"},{default:j((()=>[h(B,{type:"primary",onClick:c[2]||(c[2]=e=>O.addCoupon())},{default:j((()=>[y("添加")])),_:1}),h(L,{data:$.tableData,style:{width:"60%"}},{default:j((()=>[h(E,{prop:"coupon_id",label:"优惠券id"}),h(E,{prop:"name",label:"优惠券"}),h(E,{label:"数量"},{default:j((e=>[h(J,{rules:[{required:!0,message:"1-9"},$.cprules],prop:"coupon."+e.$index+".coupon_num"},{default:j((()=>[h(Y,{type:"number",modelValue:$.form.coupon[e.$index].coupon_num,"onUpdate:modelValue":o=>$.form.coupon[e.$index].coupon_num=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["rules","prop"])])),_:1}),h(E,{prop:"address",label:"操作"},{default:j((e=>[h(B,{type:"primary",link:"",size:"small",onClick:o=>O.delcoupon(e.row)},{default:j((()=>[y(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),G,h(J,{label:"购买金额",prop:"money",rules:[{required:!0,message:" "}]},{default:j((()=>[h(Y,{type:"number",modelValue:$.form.money,"onUpdate:modelValue":c[3]||(c[3]=e=>$.form.money=e),class:"max-w460"},{append:j((()=>[y("元")])),_:1},8,["modelValue"])])),_:1}),h(J,{label:"会员购买等级 "},{default:j((()=>[h(F,{modelValue:$.form.is_grade,"onUpdate:modelValue":c[4]||(c[4]=e=>$.form.is_grade=e)},{default:j((()=>[h(z,{label:0},{default:j((()=>[y("不限")])),_:1}),h(z,{label:1},{default:j((()=>[y("指定等级")])),_:1})])),_:1},8,["modelValue"])])),_:1}),$.form.is_grade?(_(),V(J,{key:0,label:"会员等级 "},{default:j((()=>[h(R,{modelValue:$.form.grade_ids,"onUpdate:modelValue":c[5]||(c[5]=e=>$.form.grade_ids=e),multiple:"",placeholder:"请选择"},{default:j((()=>[(_(!0),g(v,null,k($.Grade,((e,o)=>(_(),V(M,{key:o,label:e.name,value:e.grade_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):x("",!0),h(J,{label:"购买次数 "},{default:j((()=>[h(F,{modelValue:$.form.is_times,"onUpdate:modelValue":c[6]||(c[6]=e=>$.form.is_times=e)},{default:j((()=>[h(z,{label:0},{default:j((()=>[y("不限")])),_:1}),h(z,{label:1},{default:j((()=>[y("限购")])),_:1})])),_:1},8,["modelValue"])])),_:1}),$.form.is_times?(_(),V(J,{key:1,label:""},{default:j((()=>[h(Y,{type:"number",modelValue:$.form.times,"onUpdate:modelValue":c[7]||(c[7]=e=>$.form.times=e),class:"max-w460"},{prepend:j((()=>[y("每人限购")])),append:j((()=>[y("次")])),_:1},8,["modelValue"])])),_:1})):x("",!0),S,h(J,{label:"发放数量",prop:"total_num",rules:[{required:!0,message:" "}]},{default:j((()=>[h(Y,{type:"number",modelValue:$.form.total_num,"onUpdate:modelValue":c[8]||(c[8]=e=>$.form.total_num=e),placeholder:"请输入发放数量",class:"max-w460"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),b("div",P,[h(B,{type:"info",onClick:O.gotoBack},{default:j((()=>[y("返回")])),_:1},8,["onClick"]),h(B,{type:"primary",onClick:O.onSubmit,loading:$.loading},{default:j((()=>[y("提交")])),_:1},8,["onClick","loading"])])]),$.open_add?(_(),V(A,{key:0,open_add:$.open_add,onCloseDialog:c[9]||(c[9]=e=>O.closeProductDialogFunc(e))},{default:j((()=>[y("选择优惠券弹出层")])),_:1},8,["open_add"])):x("",!0)])}]]);export{$ as default};
