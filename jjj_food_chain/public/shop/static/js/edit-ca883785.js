import{_ as e}from"./GetCoupon-d7819c8d.js";import{E as a,g as o,h as l,H as t,i as r,m as s,o as m,p as d,q as u,r as p,s as n,e as i}from"./element-plus-33e0d8cc.js";import{P as c}from"./package-dc159826.js";import{f}from"./index-02a28aea.js";import{_}from"./_plugin-vue_export-helper-1b428a4d.js";import{o as g,c as b,a as h,P as j,S as y,W as V,T as v,Q as k,a8 as x,Y as D}from"./@vue-e72ffbb6.js";import"./coupon-6d965e1c.js";import"./@vueuse-0fb12a45.js";import"./lodash-es-cce4393d.js";import"./async-validator-cf877c1f.js";import"./@element-plus-4b00147d.js";import"./dayjs-34225b3b.js";import"./call-bind-2971450c.js";import"./get-intrinsic-d8eb8ca0.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./has-719bcddc.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-bf98ca95.js";import"./pinia-72b16af9.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-a8eee860.js";import"./side-channel-052d4c61.js";import"./object-inspect-dd55f836.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-ueditor-wrap-e5a15ab3.js";import"./vue-i18n-73a1cd16.js";import"./@intlify-28c65249.js";const C={components:{GetCoupon:e},data:()=>({form:{coupon:[],is_times:0,times:0,is_grade:0,grade_ids:"",value1:[],name:"",package_id:0,total_num:"",money:""},Grade:[],tableData:[],loading:!1,open_add:!1,formRules:{},formLabelWidth:"120px",cprules:{validator:(e,a,o)=>{a>=10||a<=0?o(new Error("1-9")):o()},trigger:"blur"}}),created(){this.getData()},methods:{addCoupon(){this.open_add=!0},closeProductDialogFunc(e){let o=this;if(o.open_add=e.openDialog,"success"==e.type)if(o.form.coupon.length<1)o.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),o.tableData.push(e.params);else{let l=!0;o.form.coupon.forEach(((a,o)=>{a.coupon_id==e.params.coupon_id&&(l=!1)})),l?(o.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),o.tableData.push(e.params)):a.error("请勿重复添加")}},getData(){let e=this,a=e.$route.query.package_id;c.getData({id:a},!0).then((a=>{e.form=f(e.form,a.data.data),e.Grade=a.data.list,a.data.data.coupon_list?(e.form.coupon=JSON.parse(e.form.coupon),e.tableData=a.data.data.coupon_list):(e.tableData=[],e.form.coupon=[])})).catch((e=>{}))},delcoupon(e){let a=this,o=a.tableData.indexOf(e);a.tableData.splice(o,1),a.form.coupon.splice(o,1)},onSubmit(){let e=this,o=JSON.parse(JSON.stringify(e.form));e.form.coupon.length<=0&&a.error(" 至少选择一个优惠券"),e.$refs.form.validate((a=>{a&&(o.coupon=JSON.stringify(o.coupon),e.loading=!0,c.EditPackage(o,!0).then((a=>{e.loading=!1,1==a.code?(this.$ElMessage({message:a.msg,type:"success"}),e.$router.push("/plus/package/index")):e.loading=!1})).catch((a=>{e.loading=!1})))}))},gotoBack(){this.$router.back(-1)},max10(e){e.target.value>=10&&(e.target.value=10)}}},w={class:"user"},U=h("div",{class:"common-form"},"新增活动会场",-1),q={class:"product-content"},$=h("div",{class:"common-form"},"礼包设置",-1),S=h("div",{class:"common-form"},"购买设置",-1),E=h("div",{class:"common-form"},"发放设置",-1),G={class:"common-button-wrapper"};const O=_(C,[["render",function(a,c,f,_,C,O){const P=o,Y=l,J=t,N=r,B=s,M=m,z=d,F=u,R=p,W=n,A=i,H=e;return g(),b("div",w,[U,h("div",q,[j(A,{ref:"form",model:C.form,"label-position":"top",rules:C.formRules,"label-width":"150px"},{default:y((()=>[j(Y,{label:"活动标题",prop:"name",rules:[{required:!0,message:" "}]},{default:y((()=>[j(P,{type:"text",modelValue:C.form.name,"onUpdate:modelValue":c[0]||(c[0]=e=>C.form.name=e),placeholder:"请输入活动标题",class:"max-w460"},null,8,["modelValue"])])),_:1}),j(Y,{label:"活动日期",prop:"value1",rules:[{required:!0,message:" "}]},{default:y((()=>[j(J,{modelValue:C.form.value1,"onUpdate:modelValue":c[1]||(c[1]=e=>C.form.value1=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),$,j(Y,{label:"优惠券"},{default:y((()=>[j(N,{type:"primary",onClick:c[2]||(c[2]=e=>O.addCoupon())},{default:y((()=>[V("添加")])),_:1}),j(M,{data:C.tableData,style:{width:"60%"}},{default:y((()=>[j(B,{prop:"coupon_id",label:"优惠券id"}),j(B,{prop:"name",label:"优惠券"}),j(B,{label:"数量"},{default:y((e=>[j(Y,{rules:[{required:!0,message:"1-9"},C.cprules],prop:"coupon."+e.$index+".coupon_num"},{default:y((()=>[j(P,{type:"number",modelValue:C.form.coupon[e.$index].coupon_num,"onUpdate:modelValue":a=>C.form.coupon[e.$index].coupon_num=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["rules","prop"])])),_:1}),j(B,{prop:"address",label:"操作"},{default:y((e=>[j(N,{type:"primary",link:"",size:"small",onClick:a=>O.delcoupon(e.row)},{default:y((()=>[V(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),S,j(Y,{label:"购买金额",prop:"money",rules:[{required:!0,message:" "}]},{default:y((()=>[j(P,{type:"number",modelValue:C.form.money,"onUpdate:modelValue":c[3]||(c[3]=e=>C.form.money=e),class:"max-w460"},{append:y((()=>[V("元")])),_:1},8,["modelValue"])])),_:1}),j(Y,{label:"会员购买等级 "},{default:y((()=>[j(F,{modelValue:C.form.is_grade,"onUpdate:modelValue":c[4]||(c[4]=e=>C.form.is_grade=e)},{default:y((()=>[j(z,{label:0},{default:y((()=>[V("不限")])),_:1}),j(z,{label:1},{default:y((()=>[V("指定等级")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==C.form.is_grade?(g(),v(Y,{key:0,label:"会员等级 "},{default:y((()=>[j(W,{modelValue:C.form.grade_ids,"onUpdate:modelValue":c[5]||(c[5]=e=>C.form.grade_ids=e),multiple:"",placeholder:"请选择"},{default:y((()=>[(g(!0),b(k,null,x(C.Grade,((e,a)=>(g(),v(R,{key:a,label:e.name,value:e.grade_id+""},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):D("",!0),j(Y,{label:"购买次数 "},{default:y((()=>[j(F,{modelValue:C.form.is_times,"onUpdate:modelValue":c[6]||(c[6]=e=>C.form.is_times=e)},{default:y((()=>[j(z,{label:0},{default:y((()=>[V("不限")])),_:1}),j(z,{label:1},{default:y((()=>[V("限购")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==C.form.is_times?(g(),v(Y,{key:1,label:""},{default:y((()=>[j(P,{type:"number",modelValue:C.form.times,"onUpdate:modelValue":c[7]||(c[7]=e=>C.form.times=e),class:"max-w460"},{prepend:y((()=>[V("每人限购")])),append:y((()=>[V("次")])),_:1},8,["modelValue"])])),_:1})):D("",!0),E,j(Y,{label:"发放数量",prop:"total_num",rules:[{required:!0,message:" "}]},{default:y((()=>[j(P,{type:"number",modelValue:C.form.total_num,"onUpdate:modelValue":c[8]||(c[8]=e=>C.form.total_num=e),placeholder:"请输入发放数量",class:"max-w460"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),h("div",G,[j(N,{type:"info",onClick:O.gotoBack},{default:y((()=>[V("返回")])),_:1},8,["onClick"]),j(N,{type:"primary",onClick:O.onSubmit,loading:C.loading},{default:y((()=>[V("提交")])),_:1},8,["onClick","loading"])])]),C.open_add?(g(),v(H,{key:0,open_add:C.open_add,onCloseDialog:c[9]||(c[9]=e=>O.closeProductDialogFunc(e))},{default:y((()=>[V("选择优惠券弹出层")])),_:1},8,["open_add"])):D("",!0)])}]]);export{O as default};
