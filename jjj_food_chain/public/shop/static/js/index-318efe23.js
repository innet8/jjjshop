import{w as e,x as t,h as l,n as o,i as a,g as d,j as i,e as s}from"./element-plus-bf694ad1.js";import{P as n}from"./product-3696d474.js";import u from"./autoTips-2d6e9928.js";import r from"./productList-b15ea4d9.js";import{u as c}from"./index-c77be12f.js";import{_ as m}from"./_plugin-vue_export-helper-1b428a4d.js";import{af as p,o as f,c as _,O as h,R as b,V as g,W as y,a as v,P as k,a7 as V,S as $,X as x,L as j}from"./@vue-b57a05a6.js";import"./lodash-es-234e1c00.js";import"./async-validator-cf877c1f.js";import"./@vueuse-793cab0b.js";import"./@element-plus-ce7ae957.js";import"./dayjs-33a066dd.js";import"./call-bind-912d4e9d.js";import"./get-intrinsic-878e88ff.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-a0a50b12.js";import"./define-data-property-da2cc9a9.js";import"./has-property-descriptors-2aeb73fe.js";import"./gopd-15a2da42.js";import"./@popperjs-b78c3215.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-24c2a4a1.js";import"./pinia-6eed225f.js";import"./axios-b48e0a85.js";import"./qs-49804a56.js";import"./side-channel-7f79a019.js";import"./object-inspect-9ade9731.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-ueditor-wrap-5c153e91.js";import"./vue-i18n-8b8412df.js";import"./@intlify-658c8624.js";const{currency:C}=c(),D={class:"setting"},F={class:"max-w460 color-box"},U={key:0,class:"favorable-list"},w={class:"favorable-list-box"},q={key:0,class:"favorable-box"},S={class:"favorable-box-l"},N={class:"p-unit"},I={key:0,class:"select-list"},M={class:"select-button"},O={class:"select-p"},z={key:0,class:"price-p"},J={key:0,class:"limit-list"},T={class:"limit-product-list"},L={key:0,class:"limit-product-box"},B={class:"limit-product-p"},E={class:"limit-product-p"},P={class:"common-button-wrapper"};const A=m({components:{productList:r,autoTips:u},data:()=>({open_product:!1,currency:C,loading:!1,form:{is_open:"1",tablet_end_time:null,is_buy_continue:"1",is_buffet_discount:"1",add_buffet_discount:[],is_add_clock:"1",add_clock:[],fav:[]},unDelete:!1,unFavDelete:!1,select_list:[],multiple_selection:[],openIndex:0}),mounted(){this.getData()},watch:{"form.add_clock":{handler(e){let t=0;e.map((e=>{"delete"!=e.action&&t++})),this.unDelete=1==t},deep:!0,immediate:!0},"form.add_buffet_discount":{handler(e){let t=0;e.map((e=>{"delete"!=e.action&&t++})),this.unFavDelete=1==t},deep:!0,immediate:!0}},methods:{getData(){let e=this;e.loading=!0,n.getSettingBuffet().then((t=>{e.loading=!1,this.form=t.data.vars.values,this.form.add_clock.map(((e,t)=>{this.form.add_clock[t].action="edit",this.form.add_clock[t].price=Number(e.price)})),this.form.tablet_end_time=Number(this.form.tablet_end_time),this.select_list=[],this.form.add_buffet_discount.map(((e,t)=>{this.select_list.push(e.buffets),this.form.add_buffet_discount[t].buffet_ids=[],this.form.add_buffet_discount[t].action="edit"})),this.select_list.map(((e,t)=>{e.map((e=>{this.form.add_buffet_discount[t].buffet_ids.push(e.id)}))}))})).catch((t=>{e.loading=!1}))},onSubmit(){let e=this,t=JSON.parse(JSON.stringify(e.form)),l=JSON.parse(JSON.stringify(e.form));t.add_buffet_discount=[],l.add_buffet_discount.map((e=>{t.add_buffet_discount.push({id:e.id,name:e.name,discount_type:e.discount_type,discount_ratio:e.discount_ratio,discount_price:e.discount_price,buffet_ids:e.buffet_ids.join(","),action:e.action,sort:e.sort})})),e.$refs.form.validate((l=>{l&&(e.loading=!0,n.setSettingBuffet(t,!0).then((t=>{e.loading=!1,this.$ElMessage({message:$t("保存成功"),type:"success"}),this.getData()})).catch((t=>{e.loading=!1})))}))},add(){this.form.add_clock.push({id:0,name:"",delay_time:null,price:null,action:"add"})},handleChange(){0==this.form.add_clock.length&&this.add()},handleChangeDiscount(){0==this.form.add_buffet_discount.length&&this.addFavorable()},handleDelete(e){let t=0;this.form.add_clock.map((e=>{"delete"!=e.action&&t++})),1!=t&&(0==this.form.add_clock[e].id?this.form.add_clock.splice(e,1):this.form.add_clock[e].action="delete")},selectFavorable(e,t){this.openIndex=t,this.multiple_selection=e.buffet_ids,this.open_product=!0},handleChangeDiscountType(e,t){"1"==e.discount_type?this.$refs.form.validateField("add_buffet_discount[".concat(t,"].discount_ratio")):this.$refs.form.validateField("add_buffet_discount[".concat(t,"].discount_price"))},addFavorable(){this.select_list.unshift([]),this.form.add_buffet_discount.unshift({id:0,name:"",discount_type:1,discount_ratio:null,discount_price:null,buffet_ids:[],action:"add"})},handleDeleteFav(e){let t=0;this.form.add_buffet_discount.map((e=>{"delete"!=e.action&&t++})),1!=t&&(0==this.form.add_buffet_discount[e].id?this.form.add_buffet_discount.splice(e,1):this.form.add_buffet_discount[e].action="delete")},deleteOne(e,t){this.select_list[e].splice(t,1),this.form.add_buffet_discount[e].buffet_ids=[],this.select_list[e].map((t=>{this.form.add_buffet_discount[e].buffet_ids.push(t.id)})),this.$refs.form.validateField("add_buffet_discount[".concat(e,"].buffet_ids"))},closeDialogFunc(e){if(this.open_product=e.openDialog,"submit"==e.type){let t=new Map;[this.select_list[e.index],e.data].flat().forEach((e=>t.set(e.id,e))),this.select_list[e.index]=Array.from(t.values()),this.form.add_buffet_discount[e.index].buffet_ids=[],this.select_list[e.index].map((t=>{this.form.add_buffet_discount[e.index].buffet_ids.push(t.id)})),this.$refs.form.validateField("add_buffet_discount[".concat(e.index,"].buffet_ids"))}}}},[["render",function(n,u,r,c,m,C){const A=e,G=t,R=l,W=o,X=a,H=d,K=p("autoTips"),Q=p("CircleCloseFilled"),Y=i,Z=p("Delete"),ee=s,te=p("productList");return f(),_("div",D,[h(ee,{class:"form-setting",size:"small",ref:"form",model:m.form,"label-position":"top"},{default:b((()=>[h(R,{label:n.$t("自助餐"),rules:[{required:!0,message:""}]},{default:b((()=>[h(G,{modelValue:m.form.is_open,"onUpdate:modelValue":u[0]||(u[0]=e=>m.form.is_open=e)},{default:b((()=>[h(A,{label:"1"},{default:b((()=>[g(y(n.$t("开")),1)])),_:1}),h(A,{label:"0"},{default:b((()=>[g(y(n.$t("关")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),h(R,{label:n.$t("平板结束时间提醒"),prop:"tablet_end_time",rules:[{required:!0,message:n.$t("请输入平板结束时间提醒")}]},{default:b((()=>[v("div",F,[h(W,{controls:!1,min:0,max:999,style:{width:"200px !important"},placeholder:n.$t("请输入平板结束时间提醒"),modelValue:m.form.tablet_end_time,"onUpdate:modelValue":u[1]||(u[1]=e=>m.form.tablet_end_time=e),modelModifiers:{number:!0}},null,8,["placeholder","modelValue"]),g(" "+y(n.$t("分")),1)])])),_:1},8,["label","rules"]),h(R,{label:n.$t("非自助餐商品到时继续选购"),rules:[{required:!0,message:""}]},{default:b((()=>[h(G,{modelValue:m.form.is_buy_continue,"onUpdate:modelValue":u[2]||(u[2]=e=>m.form.is_buy_continue=e)},{default:b((()=>[h(A,{label:"1"},{default:b((()=>[g(y(n.$t("开")),1)])),_:1}),h(A,{label:"0"},{default:b((()=>[g(y(n.$t("关")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),h(R,{label:n.$t("自助餐优惠折扣"),rules:[{required:!0,message:""}]},{default:b((()=>[h(G,{modelValue:m.form.is_buffet_discount,"onUpdate:modelValue":u[3]||(u[3]=e=>m.form.is_buffet_discount=e),onChange:C.handleChangeDiscount},{default:b((()=>[h(A,{label:"1"},{default:b((()=>[g(y(n.$t("开")),1)])),_:1}),h(A,{label:"0"},{default:b((()=>[g(y(n.$t("关")),1)])),_:1})])),_:1},8,["modelValue","onChange"]),"1"==m.form.is_buffet_discount?(f(),_("div",U,[h(X,{type:"primary",onClick:C.addFavorable},{default:b((()=>[g(y(n.$t("添加")),1)])),_:1},8,["onClick"]),v("div",w,[(f(!0),_(k,null,V(m.form.add_buffet_discount,((e,t)=>(f(),_(k,null,["delete"!=e.action?(f(),_("div",q,[v("div",S,[h(R,{label:"",prop:"add_buffet_discount[".concat(t,"].name"),rules:[{required:!0,validator:()=>!!e.name,message:n.$t("请输入优惠名称")}]},{default:b((()=>[h(H,{type:"text",style:{"margin-top":"16px",width:"100%"},modelValue:e.name,"onUpdate:modelValue":t=>e.name=t,placeholder:n.$t("请输入优惠名称")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["prop","rules"]),h(R,{label:"",style:{"margin-bottom":"4px !important"},rules:[{required:!0,message:""}],onChange:l=>C.handleChangeDiscountType(e,t)},{default:b((()=>[h(G,{modelValue:e.discount_type,"onUpdate:modelValue":t=>e.discount_type=t},{default:b((()=>[h(A,{label:1},{default:b((()=>[g(y(n.$t("按比例")),1)])),_:1}),h(A,{label:2},{default:b((()=>[g(y(n.$t("按优惠金额")),1)])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["onChange"]),h(R,{class:"favorable-box-item",label:"",prop:"1"==e.discount_type?"add_buffet_discount[".concat(t,"].discount_ratio"):"add_buffet_discount[".concat(t,"].discount_price"),rules:[{required:!0,validator:()=>!!("1"==e.discount_type?e.discount_ratio:e.discount_price),message:"1"==e.discount_type?n.$t("请输入比例"):n.$t("请输入优惠金额")}]},{default:b((()=>["1"==e.discount_type?(f(),$(W,{key:0,controls:!1,min:0,max:100,style:{width:"100%"},placeholder:n.$t("请输入比例"),modelValue:e.discount_ratio,"onUpdate:modelValue":t=>e.discount_ratio=t,modelModifiers:{number:!0}},null,8,["placeholder","modelValue","onUpdate:modelValue"])):(f(),$(W,{key:1,controls:!1,min:0,max:1e7,style:{width:"100%"},placeholder:n.$t("请输入优惠金额"),modelValue:e.discount_price,"onUpdate:modelValue":t=>e.discount_price=t,modelModifiers:{number:!0}},null,8,["placeholder","modelValue","onUpdate:modelValue"])),v("p",N,y("1"==e.discount_type?"%":m.currency.unit),1)])),_:2},1032,["prop","rules"]),h(R,{label:"",prop:"add_buffet_discount[".concat(t,"].buffet_ids"),rules:[{required:!0,validator:()=>e.buffet_ids.length>0,message:n.$t("请选择自助餐")}]},{default:b((()=>[h(X,{type:"primary",onClick:l=>C.selectFavorable(e,t)},{default:b((()=>[g(y(n.$t("选择自助餐")),1)])),_:2},1032,["onClick"]),m.select_list[t].length>0?(f(),_("div",I,[(f(!0),_(k,null,V(m.select_list[t],((l,o)=>(f(),_("div",M,[v("div",O,[h(K,{content:l.name_text},{default:b((()=>[g(y(l.name_text),1)])),_:2},1032,["content"])]),"1"==e.discount_type?(f(),_("p",z,y((Number(l.price)*Number(e.discount_ratio/100)).toFixed(2)),1)):x("",!0),h(Y,{class:"select-icon",onClick:e=>C.deleteOne(t,o)},{default:b((()=>[h(Q)])),_:2},1032,["onClick"])])))),256))])):x("",!0)])),_:2},1032,["prop","rules"])]),h(Y,{class:j(["delete-icon",m.unFavDelete?"delete-icon-none":""]),onClick:e=>C.handleDeleteFav(t)},{default:b((()=>[h(Z)])),_:2},1032,["class","onClick"])])):x("",!0)],64)))),256))])])):x("",!0)])),_:1},8,["label"]),h(R,{label:n.$t("加钟"),rules:[{required:!0,message:""}]},{default:b((()=>[h(G,{modelValue:m.form.is_add_clock,"onUpdate:modelValue":u[4]||(u[4]=e=>m.form.is_add_clock=e),onChange:C.handleChange},{default:b((()=>[h(A,{label:"1"},{default:b((()=>[g(y(n.$t("开")),1)])),_:1}),h(A,{label:"0"},{default:b((()=>[g(y(n.$t("关")),1)])),_:1})])),_:1},8,["modelValue","onChange"]),1==m.form.is_add_clock?(f(),_("div",J,[h(X,{type:"primary",onClick:C.add},{default:b((()=>[g(y(n.$t("添加")),1)])),_:1},8,["onClick"]),v("div",T,[(f(!0),_(k,null,V(m.form.add_clock,((e,t)=>(f(),_(k,{key:t},["delete"!=e.action?(f(),_("div",L,[h(R,{label:"",prop:"add_clock[".concat(t,"].name"),rules:[{required:!0,validator:()=>!!e.name,message:n.$t("请输入名称")}]},{default:b((()=>[h(H,{type:"text",style:{"margin-top":"16px","min-width":"160px"},modelValue:e.name,"onUpdate:modelValue":t=>e.name=t,placeholder:n.$t("名称")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["prop","rules"]),h(R,{label:"",prop:"add_clock[".concat(t,"].delay_time"),rules:[{required:!0,validator:()=>!!e.delay_time,message:n.$t("请输入时间")}]},{default:b((()=>[h(W,{controls:!1,min:0,max:999,style:{width:"160px !important","margin-top":"16px"},placeholder:n.$t("请输入时间"),modelValue:e.delay_time,"onUpdate:modelValue":t=>e.delay_time=t,modelModifiers:{number:!0}},null,8,["placeholder","modelValue","onUpdate:modelValue"])])),_:2},1032,["prop","rules"]),v("p",B,y(n.$t("分")),1),h(R,{label:"",prop:"add_clock[".concat(t,"].price"),rules:[{required:!0,validator:()=>"object"!=typeof e.price,message:n.$t("请输入价格")}]},{default:b((()=>[h(W,{controls:!1,min:0,max:999,style:{width:"160px !important","margin-top":"16px"},placeholder:n.$t("请输入价格"),modelValue:e.price,"onUpdate:modelValue":t=>e.price=t,modelModifiers:{number:!0}},null,8,["placeholder","modelValue","onUpdate:modelValue"])])),_:2},1032,["prop","rules"]),v("p",E,y(m.currency.unit),1),h(Y,{class:j(["delete-icon",m.unDelete?"delete-icon-none":""]),onClick:e=>C.handleDelete(t)},{default:b((()=>[h(Z)])),_:2},1032,["class","onClick"])])):x("",!0)],64)))),128))])])):x("",!0)])),_:1},8,["label"])])),_:1},8,["model"]),v("div",P,[h(X,{size:"small",onClick:C.getData},{default:b((()=>[g(y(n.$t("重置")),1)])),_:1},8,["onClick"]),h(X,{size:"small",type:"primary",onClick:C.onSubmit,loading:m.loading},{default:b((()=>[g(y(n.$t("保存")),1)])),_:1},8,["onClick","loading"])]),m.open_product?(f(),$(te,{key:0,open_product:m.open_product,openIndex:m.openIndex,multiple_selection:m.multiple_selection,onCloseDialogFunc:u[5]||(u[5]=e=>C.closeDialogFunc(e))},null,8,["open_product","openIndex","multiple_selection"])):x("",!0)])}],["__scopeId","data-v-87d0d21d"]]);export{A as default};
