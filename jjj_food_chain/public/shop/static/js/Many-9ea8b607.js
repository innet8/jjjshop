import{d as e,F as o,g as l,i as a,m as s,h as t,o as p}from"./element-plus-c8084613.js";import{P as r}from"./product-29812be5.js";import{o as i,c as d,a as m,P as n,a7 as c,W as u,O as _,R as h,V as f,_ as g,$ as b,X as V,bm as y,bk as j,an as w,S as k,af as v}from"./@vue-b57a05a6.js";import{_ as G}from"./_plugin-vue_export-helper-1b428a4d.js";import{_ as x}from"./Upload-ba2f1fb2.js";import"./index-cad16880.js";import"./lodash-es-234e1c00.js";import"./async-validator-cf877c1f.js";import"./@vueuse-793cab0b.js";import"./@element-plus-ce7ae957.js";import"./dayjs-33a066dd.js";import"./call-bind-912d4e9d.js";import"./get-intrinsic-878e88ff.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-a0a50b12.js";import"./define-data-property-da2cc9a9.js";import"./has-property-descriptors-2aeb73fe.js";import"./gopd-15a2da42.js";import"./@popperjs-b78c3215.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./file-d5ca0960.js";import"./vue-cropperjs-a45f7801.js";import"./vue-944abb17.js";import"./cropperjs-86d7592f.js";import"./vue-router-24c2a4a1.js";import"./pinia-6eed225f.js";import"./axios-b48e0a85.js";import"./qs-49804a56.js";import"./side-channel-7f79a019.js";import"./object-inspect-9ade9731.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-ueditor-wrap-5c153e91.js";import"./vue-i18n-8b8412df.js";import"./@intlify-658c8624.js";const F={data:()=>({showAddGroupBtn:!0,showAddGroupForm:!1,addGroupFrom:{specName:"",specValue:""},groupLoading:!1}),inject:["form"],created(){this.form.model.spec_many&&this.form.model.spec_many.spec_list.length>0&&this.buildSkulist()},methods:{onToggleAddGroupForm:function(){this.showAddGroupBtn=!this.showAddGroupBtn,this.showAddGroupForm=!this.showAddGroupForm},onSubmitAddGroup:function(){let e=this;if(""===e.addGroupFrom.specName||""===e.addGroupFrom.specValue)return this.$ElMessage("请填写规则名或规则值"),!1;e.groupLoading=!0;let o={spec_name:e.addGroupFrom.specName,spec_value:e.addGroupFrom.specValue};r.addSpec(o,!0).then((o=>{e.groupLoading=!1,e.form.model.spec_many.spec_attr.push({group_id:o.data.spec_id,group_name:e.addGroupFrom.specName,spec_items:[{item_id:o.data.spec_value_id,spec_value:e.addGroupFrom.specValue}],tempValue:"",loading:!1}),e.addGroupFrom.specName="",e.addGroupFrom.specValue="",e.onToggleAddGroupForm(),e.buildSkulist()})).catch((o=>{e.groupLoading=!1}))},onSubmitAddValue:function(e){let o=this;if(!e.hasOwnProperty("tempValue")||""===e.tempValue)return this.$ElMessage("规格值不能为空"),!1;e.loading=!0;let l={spec_id:e.group_id,spec_value:e.tempValue};r.addSpecValue(l,!0).then((l=>{e.loading=!1,e.spec_items.push({item_id:l.data.spec_value_id,spec_value:e.tempValue}),e.tempValue="",o.buildSkulist()})).catch((o=>{e.loading=!1}))},buildSkulist:function(){let e=this,o=e.form.model.spec_many.spec_attr,l=[];for(let t=0;t<o.length;t++)l.push(o[t].spec_items);let a=e.calcDescartes(l),s=[];for(let t=0;t<a.length;t++){let e=[],o=[];Array.isArray(a[t])?e=a[t]:e.push(a[t]);for(let l=0;l<e.length;l++)o.push(e[l].item_id);s.push({product_sku_id:0,spec_sku_id:o.join("_"),rows:e,spec_form:{}})}if(e.form.model.spec_many.spec_list.length>0&&s.length>0)for(let t=0;t<s.length;t++){let o=e.form.model.spec_many.spec_list.filter((function(e){return e.spec_sku_id===s[t].spec_sku_id}));o.length>0&&(s[t].spec_form=o[0].spec_form,s[t].product_sku_id=o[0].product_sku_id)}e.form.model.spec_many.spec_list=s},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,o){let l=[];return e.forEach((function(e){o.forEach((function(o){let a=[].concat(Array.isArray(e)?e:[e]);a.push(o),l.push(a)}))})),l}))},onDeleteGroup:function(o){var l=this;e.confirm("删除后不可恢复，确认删除吗？","提示",{type:"warning"}).then((()=>{l.form.model.spec_many.spec_attr.splice(o,1),l.buildSkulist()}))},onDeleteValue:function(o,l){let a=this;a.form.isSpecLocked?this.$ElMessage({message:"本商品正在参加活动，不能删除规格！",type:"warning"}):e.confirm("删除后不可恢复，确认删除吗？","提示",{type:"warning"}).then((()=>{a.form.model.spec_many.spec_attr[o].spec_items.splice(l,1),a.buildSkulist()}))}}},D=e=>(y("data-v-e69b65f3"),e=e(),j(),e),S={class:"spec-many-type"},z={class:"spec-wrap"},A={class:"spec-hd"},U={class:"input-box"},C=["onClick"],I=[D((()=>m("i",{class:"Delete"},null,-1)))],B={class:"spec-bd"},T={class:"item"},$={class:"item"},E={key:0},L={class:"add-spec mb16"},N={class:"from-box"},q={class:"item"},M=D((()=>m("span",{class:"key"},"规格名：",-1))),P={class:"item"},O=D((()=>m("span",{class:"key"},"规格值：",-1)));const R={class:"mt16"},J=["onClick"];const W=G({components:{Type:G(F,[["render",function(e,s,t,p,r,y){const j=o,w=l,k=a;return i(),d("div",S,[m("div",z,[(i(!0),d(n,null,c(y.form.model.spec_many.spec_attr,((e,o)=>(i(),d("div",{class:"mb16 min-spc",key:e.group_name},[m("div",A,[m("div",U,u(e.group_name),1),m("a",{href:"javascript:void(0);",onClick:e=>y.onDeleteGroup(o)},I,8,C)]),m("div",B,[(i(!0),d(n,null,c(e.spec_items,((e,l)=>(i(),d("div",{class:"item",key:e.spec_value},[_(j,{closable:"",onClose:e=>y.onDeleteValue(o,l)},{default:h((()=>[f(u(e.spec_value),1)])),_:2},1032,["onClose"])])))),128)),m("div",T,[_(w,{size:"small",modelValue:e.tempValue,"onUpdate:modelValue":o=>e.tempValue=o,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),m("div",$,[_(k,{size:"small",onClick:o=>y.onSubmitAddValue(e),loading:e.loading},{default:h((()=>[f("添加")])),_:2},1032,["onClick","loading"])])])])))),128)),y.form.isSpecLocked?V("",!0):(i(),d("div",E,[g(_(k,{size:"small",class:"CirclePlus",onClick:y.onToggleAddGroupForm},{default:h((()=>[f("添加规格")])),_:1},8,["onClick"]),[[b,r.showAddGroupBtn]])])),g(m("div",L,[m("div",N,[m("div",q,[M,_(w,{size:"small",modelValue:r.addGroupFrom.specName,"onUpdate:modelValue":s[0]||(s[0]=e=>r.addGroupFrom.specName=e),placeholder:"请输入规格名称"},null,8,["modelValue"])]),m("div",P,[O,_(w,{size:"small",modelValue:r.addGroupFrom.specValue,"onUpdate:modelValue":s[1]||(s[1]=e=>r.addGroupFrom.specValue=e),placeholder:"请输入规格值"},null,8,["modelValue"])]),_(k,{type:"primary",size:"small",loading:r.groupLoading,onClick:y.onSubmitAddGroup,plain:""},{default:h((()=>[f("确定")])),_:1},8,["loading","onClick"]),_(k,{size:"small",onClick:y.onToggleAddGroupForm},{default:h((()=>[f("取消")])),_:1},8,["onClick"])])],512),[[b,!r.showAddGroupBtn]])])])}],["__scopeId","data-v-e69b65f3"]]),Table:G({components:{Upload:x},data:()=>({batchData:{product_price:"",line_price:"",stock_num:"",product_weight:""},isupload:!1,spec_index:-1}),inject:["form"],created(){},methods:{objectSpanMethod({row:e,column:o,rowIndex:l,columnIndex:a}){var s=this.form.model.spec_many.spec_attr,t=1;if(a<s.length-1){let e=a+1,o=s.length-1;for(var p=e;p<=o;p++)t*=s[p].spec_items.length;return l%t==0?{rowspan:t,colspan:1}:{rowspan:0,colspan:0}}},onSubmitBatchData:function(){var e=this;e.form.model.spec_many.spec_list.forEach((function(o){for(var l in e.batchData)e.batchData.hasOwnProperty(l)&&e.batchData[l]&&(o.spec_form[l]=e.batchData[l])}))},chooseSpecImage:function(e){this.isupload=!0,this.spec_index=e},returnImgsFunc(e){this.isupload=!1,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_id=e[0].file_id,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_path=e[0].file_path}}},[["render",function(e,o,r,b,y,j){const v=l,G=a,F=s,D=t,S=p,z=x,A=w("img-url");return i(),d("div",R,[j.form.model.spec_many&&j.form.model.spec_many.spec_list.length>0?(i(),k(D,{key:0,label:"规格明细："},{default:h((()=>[m("div",null,[f(" 批量设置 "),_(v,{size:"small",modelValue:y.batchData.product_price,"onUpdate:modelValue":o[0]||(o[0]=e=>y.batchData.product_price=e),placeholder:"销售价",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),_(v,{size:"small",modelValue:y.batchData.line_price,"onUpdate:modelValue":o[1]||(o[1]=e=>y.batchData.line_price=e),placeholder:"划线价",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),_(v,{size:"small",modelValue:y.batchData.stock_num,"onUpdate:modelValue":o[2]||(o[2]=e=>y.batchData.stock_num=e),placeholder:"库存",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),_(v,{size:"small",modelValue:y.batchData.product_weight,"onUpdate:modelValue":o[3]||(o[3]=e=>y.batchData.product_weight=e),placeholder:"重量",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),_(G,{size:"small",onClick:j.onSubmitBatchData},{default:h((()=>[f("应用")])),_:1},8,["onClick"])]),m("div",null,[_(S,{size:"",data:j.form.model.spec_many.spec_list,"span-method":j.objectSpanMethod,border:"",style:{width:"100%","margin-top":"20px"}},{default:h((()=>[(i(!0),d(n,null,c(j.form.model.spec_many.spec_attr,((e,o)=>(i(),k(F,{label:e.group_name,key:e.group_name},{default:h((e=>[f(u(e.row.rows[o].spec_value),1)])),_:2},1032,["label"])))),128)),_(F,{label:"规格图片"},{default:h((e=>[g(m("img",{alt:"",width:"35",height:"35",onClick:o=>j.chooseSpecImage(e.$index)},null,8,J),[[A,e.row.spec_form.image_path]])])),_:1}),_(F,{label:"产品编码"},{default:h((e=>[_(D,{label:"",style:{"margin-bottom":"0"}},{default:h((()=>[_(v,{size:"small",prop:"product_no",modelValue:e.row.spec_form.product_no,"onUpdate:modelValue":o=>e.row.spec_form.product_no=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),_(F,{label:"销售价"},{default:h((e=>[_(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_price",style:{"margin-bottom":"0"}},{default:h((()=>[_(v,{size:"small",prop:"product_price",modelValue:e.row.spec_form.product_price,"onUpdate:modelValue":o=>e.row.spec_form.product_price=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),_(F,{label:"划线价"},{default:h((e=>[_(D,{label:"",style:{"margin-bottom":"0"}},{default:h((()=>[_(v,{size:"small",prop:"line_price",modelValue:e.row.spec_form.line_price,"onUpdate:modelValue":o=>e.row.spec_form.line_price=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),_(F,{label:"库存"},{default:h((e=>[_(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.stock_num",style:{"margin-bottom":"0"}},{default:h((()=>[_(v,{size:"small",prop:"stock_num",modelValue:e.row.spec_form.stock_num,"onUpdate:modelValue":o=>e.row.spec_form.stock_num=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),_(F,{label:"重量(kg)"},{default:h((e=>[_(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_weight",style:{"margin-bottom":"0"}},{default:h((()=>[_(v,{size:"small",prop:"product_weight",modelValue:e.row.spec_form.product_weight,"onUpdate:modelValue":o=>e.row.spec_form.product_weight=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1})])),_:1},8,["data","span-method"])])])),_:1})):V("",!0),y.isupload?(i(),k(z,{key:1,isupload:y.isupload,onReturnImgs:j.returnImgsFunc},{default:h((()=>[f("上传图片")])),_:1},8,["isupload","onReturnImgs"])):V("",!0)])}]])}},[["render",function(e,o,l,a,s,t){const p=v("Type"),r=v("Table");return i(),d("div",null,[_(p),_(r)])}]]);export{W as default};
