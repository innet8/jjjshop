import{_ as e}from"./GetCoupon-5ba5bcb9.js";import{E as a,g as o,h as l,H as t,i as r,m as s,o as d,w as p,x as m,p as u,q as i,e as n}from"./element-plus-bf694ad1.js";import{P as c}from"./package-32360145.js";import{f}from"./index-aac1ab8a.js";import{_}from"./_plugin-vue_export-helper-1b428a4d.js";import{o as g,c as b,a as h,O as j,R as y,V,S as v,P as k,a7 as x,X as D}from"./@vue-b57a05a6.js";import"./coupon-b8cd5c40.js";import"./lodash-es-234e1c00.js";import"./async-validator-cf877c1f.js";import"./@vueuse-793cab0b.js";import"./@element-plus-ce7ae957.js";import"./dayjs-33a066dd.js";import"./call-bind-912d4e9d.js";import"./get-intrinsic-878e88ff.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-a0a50b12.js";import"./define-data-property-da2cc9a9.js";import"./has-property-descriptors-2aeb73fe.js";import"./gopd-15a2da42.js";import"./@popperjs-b78c3215.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-24c2a4a1.js";import"./pinia-6eed225f.js";import"./axios-b48e0a85.js";import"./qs-49804a56.js";import"./side-channel-7f79a019.js";import"./object-inspect-9ade9731.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-ueditor-wrap-5c153e91.js";import"./vue-i18n-8b8412df.js";import"./@intlify-658c8624.js";const w={components:{GetCoupon:e},data:()=>({form:{coupon:[],is_times:0,times:0,is_grade:0,grade_ids:"",value1:[],name:"",package_id:0,total_num:"",money:""},Grade:[],tableData:[],loading:!1,open_add:!1,formRules:{},formLabelWidth:"120px",cprules:{validator:(e,a,o)=>{a>=10||a<=0?o(new Error("1-9")):o()},trigger:"blur"}}),created(){this.getData()},methods:{addCoupon(){this.open_add=!0},closeProductDialogFunc(e){let o=this;if(o.open_add=e.openDialog,"success"==e.type)if(o.form.coupon.length<1)o.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),o.tableData.push(e.params);else{let l=!0;o.form.coupon.forEach(((a,o)=>{a.coupon_id==e.params.coupon_id&&(l=!1)})),l?(o.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),o.tableData.push(e.params)):a.error("请勿重复添加")}},getData(){let e=this,a=e.$route.query.package_id;c.getData({id:a},!0).then((a=>{e.form=f(e.form,a.data.data),e.Grade=a.data.list,a.data.data.coupon_list?(e.form.coupon=JSON.parse(e.form.coupon),e.tableData=a.data.data.coupon_list):(e.tableData=[],e.form.coupon=[])})).catch((e=>{}))},delcoupon(e){let a=this,o=a.tableData.indexOf(e);a.tableData.splice(o,1),a.form.coupon.splice(o,1)},onSubmit(){let e=this,o=JSON.parse(JSON.stringify(e.form));e.form.coupon.length<=0&&a.error(" 至少选择一个优惠券"),e.$refs.form.validate((a=>{a&&(o.coupon=JSON.stringify(o.coupon),e.loading=!0,c.EditPackage(o,!0).then((a=>{e.loading=!1,1==a.code?(this.$ElMessage({message:a.msg,type:"success"}),e.$router.push("/plus/package/index")):e.loading=!1})).catch((a=>{e.loading=!1})))}))},gotoBack(){this.$router.back(-1)},max10(e){e.target.value>=10&&(e.target.value=10)}}},C={class:"user"},U=h("div",{class:"common-form"},"新增活动会场",-1),q={class:"product-content"},$=h("div",{class:"common-form"},"礼包设置",-1),S=h("div",{class:"common-form"},"购买设置",-1),G=h("div",{class:"common-form"},"发放设置",-1),O={class:"common-button-wrapper"};const E=_(w,[["render",function(a,c,f,_,w,E){const J=o,P=l,N=t,Y=r,z=s,B=d,M=p,R=m,F=u,H=i,I=n,L=e;return g(),b("div",C,[U,h("div",q,[j(I,{ref:"form",model:w.form,"label-position":"top",rules:w.formRules,"label-width":"150px"},{default:y((()=>[j(P,{label:"活动标题",prop:"name",rules:[{required:!0,message:" "}]},{default:y((()=>[j(J,{type:"text",modelValue:w.form.name,"onUpdate:modelValue":c[0]||(c[0]=e=>w.form.name=e),placeholder:"请输入活动标题",class:"max-w460"},null,8,["modelValue"])])),_:1}),j(P,{label:"活动日期",prop:"value1",rules:[{required:!0,message:" "}]},{default:y((()=>[j(N,{modelValue:w.form.value1,"onUpdate:modelValue":c[1]||(c[1]=e=>w.form.value1=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),$,j(P,{label:"优惠券"},{default:y((()=>[j(Y,{type:"primary",onClick:c[2]||(c[2]=e=>E.addCoupon())},{default:y((()=>[V("添加")])),_:1}),j(B,{data:w.tableData,style:{width:"60%"}},{default:y((()=>[j(z,{prop:"coupon_id",label:"优惠券id"}),j(z,{prop:"name",label:"优惠券"}),j(z,{label:"数量"},{default:y((e=>[j(P,{rules:[{required:!0,message:"1-9"},w.cprules],prop:"coupon."+e.$index+".coupon_num"},{default:y((()=>[j(J,{type:"number",modelValue:w.form.coupon[e.$index].coupon_num,"onUpdate:modelValue":a=>w.form.coupon[e.$index].coupon_num=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["rules","prop"])])),_:1}),j(z,{prop:"address",label:"操作"},{default:y((e=>[j(Y,{type:"primary",link:"",size:"small",onClick:a=>E.delcoupon(e.row)},{default:y((()=>[V(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),S,j(P,{label:"购买金额",prop:"money",rules:[{required:!0,message:" "}]},{default:y((()=>[j(J,{type:"number",modelValue:w.form.money,"onUpdate:modelValue":c[3]||(c[3]=e=>w.form.money=e),class:"max-w460"},{append:y((()=>[V("元")])),_:1},8,["modelValue"])])),_:1}),j(P,{label:"会员购买等级 "},{default:y((()=>[j(R,{modelValue:w.form.is_grade,"onUpdate:modelValue":c[4]||(c[4]=e=>w.form.is_grade=e)},{default:y((()=>[j(M,{label:0},{default:y((()=>[V("不限")])),_:1}),j(M,{label:1},{default:y((()=>[V("指定等级")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==w.form.is_grade?(g(),v(P,{key:0,label:"会员等级 "},{default:y((()=>[j(H,{modelValue:w.form.grade_ids,"onUpdate:modelValue":c[5]||(c[5]=e=>w.form.grade_ids=e),multiple:"",placeholder:"请选择"},{default:y((()=>[(g(!0),b(k,null,x(w.Grade,((e,a)=>(g(),v(F,{key:a,label:e.name,value:e.grade_id+""},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):D("",!0),j(P,{label:"购买次数 "},{default:y((()=>[j(R,{modelValue:w.form.is_times,"onUpdate:modelValue":c[6]||(c[6]=e=>w.form.is_times=e)},{default:y((()=>[j(M,{label:0},{default:y((()=>[V("不限")])),_:1}),j(M,{label:1},{default:y((()=>[V("限购")])),_:1})])),_:1},8,["modelValue"])])),_:1}),1==w.form.is_times?(g(),v(P,{key:1,label:""},{default:y((()=>[j(J,{type:"number",modelValue:w.form.times,"onUpdate:modelValue":c[7]||(c[7]=e=>w.form.times=e),class:"max-w460"},{prepend:y((()=>[V("每人限购")])),append:y((()=>[V("次")])),_:1},8,["modelValue"])])),_:1})):D("",!0),G,j(P,{label:"发放数量",prop:"total_num",rules:[{required:!0,message:" "}]},{default:y((()=>[j(J,{type:"number",modelValue:w.form.total_num,"onUpdate:modelValue":c[8]||(c[8]=e=>w.form.total_num=e),placeholder:"请输入发放数量",class:"max-w460"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),h("div",O,[j(Y,{onClick:E.gotoBack},{default:y((()=>[V("返回")])),_:1},8,["onClick"]),j(Y,{type:"primary",onClick:E.onSubmit,loading:w.loading},{default:y((()=>[V("提交")])),_:1},8,["onClick","loading"])])]),w.open_add?(g(),v(L,{key:0,open_add:w.open_add,onCloseDialog:c[9]||(c[9]=e=>E.closeProductDialogFunc(e))},{default:y((()=>[V("选择优惠券弹出层")])),_:1},8,["open_add"])):D("",!0)])}]]);export{E as default};
