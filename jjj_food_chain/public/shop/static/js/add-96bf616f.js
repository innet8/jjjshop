import{_ as e}from"./GetCoupon-cc1cc4c3.js";import{E as o,g as a,h as l,H as s,i as t,m as r,o as p,w as m,x as d,p as u,q as n,e as i}from"./element-plus-bf694ad1.js";import{P as c}from"./package-da93380a.js";import{_ as f}from"./_plugin-vue_export-helper-1b428a4d.js";import{o as _,c as g,a as b,O as h,R as j,V as y,S as V,P as v,a7 as k,X as x}from"./@vue-b57a05a6.js";import"./coupon-b8de2a56.js";import"./index-c15a8a65.js";import"./vue-router-24c2a4a1.js";import"./pinia-6eed225f.js";import"./axios-b48e0a85.js";import"./qs-49804a56.js";import"./call-bind-912d4e9d.js";import"./get-intrinsic-878e88ff.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-a0a50b12.js";import"./define-data-property-da2cc9a9.js";import"./has-property-descriptors-2aeb73fe.js";import"./gopd-15a2da42.js";import"./side-channel-7f79a019.js";import"./object-inspect-9ade9731.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./@element-plus-ce7ae957.js";import"./vue-ueditor-wrap-5c153e91.js";import"./vue-i18n-8b8412df.js";import"./@intlify-658c8624.js";import"./lodash-es-234e1c00.js";import"./async-validator-cf877c1f.js";import"./@vueuse-793cab0b.js";import"./dayjs-33a066dd.js";import"./@popperjs-b78c3215.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";const w={components:{GetCoupon:e},data:()=>({form:{coupon:[],is_times:0,times:0,is_grade:0,grade_ids:"",value1:[],name:"",total_num:""},Grade:[],tableData:[],loading:!1,open_add:!1,formRules:{},formLabelWidth:"120px",cprules:{validator:(e,o,a)=>{o>=10||o<=0?a(new Error("1-9")):a()},trigger:"blur"}}),created(){this.getGradeList()},methods:{getGradeList(){let e=this;c.getPackage({0:!0}).then((o=>{e.Grade=o.data.list})).catch((e=>{}))},addCoupon(){this.open_add=!0},closeProductDialogFunc(e){let a=this;if(a.open_add=e.openDialog,"success"==e.type)if(a.form.coupon.length<1)a.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),a.tableData.push({coupon_id:e.params.coupon_id,name:e.params.name,coupon_num:1});else{let l=!0;a.form.coupon.forEach(((o,a)=>{o.coupon_id==e.params.coupon_id&&(l=!1)})),l?(a.form.coupon.push({coupon_id:e.params.coupon_id,coupon_num:1}),a.tableData.push({coupon_id:e.params.coupon_id,name:e.params.name,coupon_num:1})):o.error("请勿重复添加")}},delcoupon(e){let o=this,a=o.tableData.indexOf(e);o.tableData.splice(a,1),o.form.coupon.splice(a,1)},onSubmit(){let e=this,a=JSON.parse(JSON.stringify(e.form));e.form.coupon.length<=0&&o.error(" 至少选择一个优惠券"),e.$refs.form.validate((o=>{o&&(a.coupon=JSON.stringify(a.coupon),e.loading=!0,c.savePackage(a,!0).then((o=>{a.coupon=JSON.parse(a.coupon),1==o.code?(this.$ElMessage({message:o.msg,type:"success"}),e.$router.push("/plus/package/index")):e.loading=!0})).catch((o=>{e.loading=!0})))}))},gotoBack(){this.$router.back(-1)}}},C={class:"user"},D=b("div",{class:"common-form"},"新增活动",-1),U={class:"product-content"},q=b("div",{class:"common-form"},"券包设置",-1),G=b("div",{class:"common-form"},"购买设置",-1),S=b("div",{class:"common-form"},"发放设置",-1),$={class:"common-button-wrapper"};const O=f(w,[["render",function(o,c,f,w,O,P){const J=a,E=l,N=s,Y=t,z=r,B=p,L=m,M=d,R=u,F=n,H=i,I=e;return _(),g("div",C,[D,b("div",U,[h(H,{ref:"form",model:O.form,"label-position":"top",rules:O.formRules,"label-width":"150px"},{default:j((()=>[h(E,{label:"活动标题",prop:"name",rules:[{required:!0,message:" "}]},{default:j((()=>[h(J,{type:"text",modelValue:O.form.name,"onUpdate:modelValue":c[0]||(c[0]=e=>O.form.name=e),placeholder:"请输入活动标题",class:"max-w460"},null,8,["modelValue"])])),_:1}),h(E,{label:"活动日期",prop:"value1",rules:[{required:!0,message:" "}]},{default:j((()=>[h(N,{modelValue:O.form.value1,"onUpdate:modelValue":c[1]||(c[1]=e=>O.form.value1=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),q,h(E,{label:"优惠券"},{default:j((()=>[h(Y,{type:"primary",onClick:c[2]||(c[2]=e=>P.addCoupon())},{default:j((()=>[y("添加")])),_:1}),h(B,{data:O.tableData,style:{width:"60%"}},{default:j((()=>[h(z,{prop:"coupon_id",label:"优惠券id"}),h(z,{prop:"name",label:"优惠券"}),h(z,{label:"数量"},{default:j((e=>[h(E,{rules:[{required:!0,message:"1-9"},O.cprules],prop:"coupon."+e.$index+".coupon_num"},{default:j((()=>[h(J,{type:"number",modelValue:O.form.coupon[e.$index].coupon_num,"onUpdate:modelValue":o=>O.form.coupon[e.$index].coupon_num=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["rules","prop"])])),_:1}),h(z,{prop:"address",label:"操作"},{default:j((e=>[h(Y,{type:"primary",link:"",size:"small",onClick:o=>P.delcoupon(e.row)},{default:j((()=>[y(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),G,h(E,{label:"购买金额",prop:"money",rules:[{required:!0,message:" "}]},{default:j((()=>[h(J,{type:"number",modelValue:O.form.money,"onUpdate:modelValue":c[3]||(c[3]=e=>O.form.money=e),class:"max-w460"},{append:j((()=>[y("元")])),_:1},8,["modelValue"])])),_:1}),h(E,{label:"会员购买等级 "},{default:j((()=>[h(M,{modelValue:O.form.is_grade,"onUpdate:modelValue":c[4]||(c[4]=e=>O.form.is_grade=e)},{default:j((()=>[h(L,{label:0},{default:j((()=>[y("不限")])),_:1}),h(L,{label:1},{default:j((()=>[y("指定等级")])),_:1})])),_:1},8,["modelValue"])])),_:1}),O.form.is_grade?(_(),V(E,{key:0,label:"会员等级 "},{default:j((()=>[h(F,{modelValue:O.form.grade_ids,"onUpdate:modelValue":c[5]||(c[5]=e=>O.form.grade_ids=e),multiple:"",placeholder:"请选择"},{default:j((()=>[(_(!0),g(v,null,k(O.Grade,((e,o)=>(_(),V(R,{key:o,label:e.name,value:e.grade_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):x("",!0),h(E,{label:"购买次数 "},{default:j((()=>[h(M,{modelValue:O.form.is_times,"onUpdate:modelValue":c[6]||(c[6]=e=>O.form.is_times=e)},{default:j((()=>[h(L,{label:0},{default:j((()=>[y("不限")])),_:1}),h(L,{label:1},{default:j((()=>[y("限购")])),_:1})])),_:1},8,["modelValue"])])),_:1}),O.form.is_times?(_(),V(E,{key:1,label:""},{default:j((()=>[h(J,{type:"number",modelValue:O.form.times,"onUpdate:modelValue":c[7]||(c[7]=e=>O.form.times=e),class:"max-w460"},{prepend:j((()=>[y("每人限购")])),append:j((()=>[y("次")])),_:1},8,["modelValue"])])),_:1})):x("",!0),S,h(E,{label:"发放数量",prop:"total_num",rules:[{required:!0,message:" "}]},{default:j((()=>[h(J,{type:"number",modelValue:O.form.total_num,"onUpdate:modelValue":c[8]||(c[8]=e=>O.form.total_num=e),placeholder:"请输入发放数量",class:"max-w460"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),b("div",$,[h(Y,{onClick:P.gotoBack},{default:j((()=>[y("返回")])),_:1},8,["onClick"]),h(Y,{type:"primary",onClick:P.onSubmit,loading:O.loading},{default:j((()=>[y("提交")])),_:1},8,["onClick","loading"])])]),O.open_add?(_(),V(I,{key:0,open_add:O.open_add,onCloseDialog:c[9]||(c[9]=e=>P.closeProductDialogFunc(e))},{default:j((()=>[y("选择优惠券弹出层")])),_:1},8,["open_add"])):x("",!0)])}]]);export{O as default};
