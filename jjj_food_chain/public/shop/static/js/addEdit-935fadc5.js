import{g as t,h as e,n as i,w as l,x as s,i as o,j as a,e as r,u as m}from"./element-plus-bf694ad1.js";import{P as d}from"./product-fe2f0844.js";import{l as u}from"./index-43419204.js";import p from"./autoTips-2d6e9928.js";import c from"./productList-177f7191.js";import{_}from"./_plugin-vue_export-helper-1b428a4d.js";import{af as n,o as f,S as h,R as b,a as g,O as y,V as $,W as j,c as V,P as v,a7 as x,X as k}from"./@vue-b57a05a6.js";import"./lodash-es-234e1c00.js";import"./async-validator-cf877c1f.js";import"./@vueuse-793cab0b.js";import"./@element-plus-ce7ae957.js";import"./dayjs-33a066dd.js";import"./call-bind-912d4e9d.js";import"./get-intrinsic-878e88ff.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-a0a50b12.js";import"./define-data-property-da2cc9a9.js";import"./has-property-descriptors-2aeb73fe.js";import"./gopd-15a2da42.js";import"./@popperjs-b78c3215.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-24c2a4a1.js";import"./pinia-6eed225f.js";import"./axios-b48e0a85.js";import"./qs-49804a56.js";import"./side-channel-7f79a019.js";import"./object-inspect-9ade9731.js";import"./pinia-plugin-persistedstate-35ef556e.js";import"./vue-ueditor-wrap-5c153e91.js";import"./vue-i18n-8b8412df.js";import"./@intlify-658c8624.js";const D=JSON.stringify(u().languageData),C=u().languageList,N={components:{productList:c,autoTips:p},data:()=>({languageList:C,dialogVisible:!1,loading:!1,open_product:!1,form:{name:JSON.parse(D),sort:null,price:null,is_time_limit:1,time_limit:null,status:1,is_comb:1,buy_limit_status:0,buy_limit_products:[],product_ids:""},formRules:{price:[{required:!0,message:$t("请输入价格"),trigger:"blur"}],sort:[{required:!0,message:$t("排序不能为空")},{type:"number",message:$t("排序必须为数字")}],time:[{required:!0,message:$t("请输入用餐时间"),trigger:"blur"}]},select_list:[],limit_list:[],multiple_selection:[],limit_ids:"",selectType:""}),props:{open_dialog:{type:Boolean,default:!1},title:{default:""},editData:{default:""}},created(){if(this.dialogVisible=this.open_dialog,this.editData){let t=JSON.parse(JSON.stringify(this.editData));this.form.id=t.id,this.form.name=JSON.parse(t.name),this.form.sort=Number(t.sort),t.time_limit>0?this.form.is_time_limit=1:this.form.is_time_limit=0,this.form.time_limit=Number(t.time_limit),this.form.status=t.status,this.form.is_comb=t.is_comb,this.select_list=t.buffetProducts,this.form.price=Number(t.price),this.form.product_ids=[],this.select_list.map(((t,e)=>{this.select_list[e].product_name_text=t.product.product_name_text,this.form.product_ids.push(t.product_id)})),this.form.buy_limit_status=t.buy_limit_status,this.limit_ids=this.form.product_ids.join(","),this.limit_list=t.buffetLimitProducts,this.form.buy_limit_products=[],this.limit_list.map((t=>{this.form.buy_limit_products.push({name:t.product.product_name_text,product_id:t.product_id,limit_num:t.limit_num})}))}},methods:{submit(){let t=this;t.$refs.form.validate((e=>{var i,l;if(e)if(this.editData){let e=JSON.parse(JSON.stringify(t.form));e.name=JSON.stringify(e.name),e.buffet_id=e.id,e.product_ids=e.product_ids.join(","),e.buy_limit_products=((null==(i=t.form)?void 0:i.buy_limit_products)||[]).map((t=>({product_id:t.product_id,limit_num:t.limit_num}))),t.loading=!0,d.editBuffet(e,!0).then((e=>{t.loading=!1,this.$ElMessage({message:$t("操作成功"),type:"success"}),t.dialogFormVisible(!0)})).catch((e=>{t.loading=!1}))}else{let e=JSON.parse(JSON.stringify(t.form));e.name=JSON.stringify(e.name),e.product_ids=e.product_ids.join(","),e.buy_limit_products=((null==(l=t.form)?void 0:l.buy_limit_products)||[]).map((t=>({product_id:t.product_id,limit_num:t.limit_num}))),t.loading=!0,d.addBuffet(e,!0).then((e=>{t.loading=!1,this.$ElMessage({message:$t("添加成功"),type:"success"}),t.dialogFormVisible(!0)})).catch((e=>{t.loading=!1}))}}))},selectList(t){"select"==t&&(this.selectType=t,this.multiple_selection=this.select_list),"limit"==t&&(this.selectType=t,this.multiple_selection=this.limit_list,this.limit_ids=this.form.product_ids.join(",")),this.open_product=!0},closeDialogFunc(t){if(this.open_product=t.openDialog,"select"==t.type){let e=new Map;[this.select_list,t.data].flat().forEach((t=>e.set(t.product_id,t))),this.select_list=Array.from(e.values()),this.form.product_ids=[],this.select_list.map((t=>{this.form.product_ids.push(t.product_id)})),this.$refs.form.validateField("product_ids"),this.limit_ids=this.form.product_ids.join(",")}if("limit"==t.type){let e=new Map;[this.limit_list,t.data].flat().forEach((t=>e.set(t.product_id,t))),this.limit_list=Array.from(e.values());let i=[];this.form.buy_limit_products.map((t=>{i.push(t.product_id)})),this.limit_list.map((t=>{i.includes(t.product_id)||this.form.buy_limit_products.push({name:t.product_name_text,product_id:t.product_id,limit_num:null})})),this.$refs.form.validateField("buy_limit_products")}},deleteOne(t,e){this.select_list.splice(t,1),this.form.product_ids=[],this.select_list.map((t=>{this.form.product_ids.push(t.product_id)})),this.limit_ids=this.form.product_ids.join(","),this.form.buy_limit_products.map(((t,i)=>{e==t.product_id&&this.handleDelete(i)})),this.$refs.form.validateField("product_ids")},handleDelete(t){this.form.buy_limit_products.splice(t,1),this.limit_list.splice(t,1),this.$refs.form.validateField("buy_limit_products")},dialogFormVisible(t){t?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},O={key:0,class:"select-list"},U={class:"select-button"},q={class:"select-p"},F={key:0,class:"limit-list"},J={class:"limit-product"},S={class:"limit-product-list"},L={class:"limit-product-box"},T={class:"dialog-footer"};const M=_(N,[["render",function(d,u,p,c,_,D){const C=t,N=e,M=i,w=l,B=s,z=o,E=n("autoTips"),P=n("CircleCloseFilled"),R=a,A=n("Delete"),I=r,G=n("productList"),W=m;return f(),h(W,{title:p.title,modelValue:_.dialogVisible,"onUpdate:modelValue":u[10]||(u[10]=t=>_.dialogVisible=t),onClose:D.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:b((()=>[g("div",T,[y(z,{onClick:D.dialogFormVisible},{default:b((()=>[$(j(d.$t("取消")),1)])),_:1},8,["onClick"]),y(z,{type:"primary",onClick:D.submit,loading:_.loading},{default:b((()=>[$(j(d.$t("确定")),1)])),_:1},8,["onClick","loading"])])])),default:b((()=>[y(I,{size:"small",model:_.form,"label-position":"top",rules:_.formRules,ref:"form"},{default:b((()=>[(f(!0),V(v,null,x(_.languageList,((t,e)=>(f(),h(N,{key:e,label:d.$t("自助餐名称")+"(".concat(t.value,")"),prop:"name.".concat([t.key]),rules:[{required:!0,message:d.$t("请输入自助餐名称")}]},{default:b((()=>[y(C,{type:"text",modelValue:_.form.name[t.key],"onUpdate:modelValue":e=>_.form.name[t.key]=e,placeholder:d.$t("请输入自助餐名称"),maxlength:50},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop","rules"])))),128)),y(N,{label:d.$t("排序"),prop:"sort"},{default:b((()=>[y(M,{controls:!1,min:0,max:999,placeholder:d.$t("接近0，排序等级越高"),modelValue:_.form.sort,"onUpdate:modelValue":u[0]||(u[0]=t=>_.form.sort=t),modelModifiers:{number:!0}},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),y(N,{label:d.$t("价格"),prop:"price"},{default:b((()=>[y(M,{controls:!1,min:0,max:1e6,placeholder:d.$t("请输入价格"),modelValue:_.form.price,"onUpdate:modelValue":u[1]||(u[1]=t=>_.form.price=t),modelModifiers:{number:!0}},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),y(N,{label:d.$t("限制用餐时间"),prop:"is_time_limit",rules:[{required:!0,message:""}]},{default:b((()=>[y(B,{modelValue:_.form.is_time_limit,"onUpdate:modelValue":u[2]||(u[2]=t=>_.form.is_time_limit=t)},{default:b((()=>[y(w,{label:0},{default:b((()=>[$(j(d.$t("不限制")),1)])),_:1}),y(w,{label:1},{default:b((()=>[$(j(d.$t("限制")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),1==_.form.is_time_limit?(f(),h(N,{key:0,label:d.$t(""),class:"display-none",prop:"time_limit",rules:[{required:!0,message:d.$t("请输入用餐时间")}]},{default:b((()=>[y(M,{controls:!1,min:0,max:999,placeholder:d.$t("请输入用餐时间"),modelValue:_.form.time_limit,"onUpdate:modelValue":u[3]||(u[3]=t=>_.form.time_limit=t),modelModifiers:{number:!0}},null,8,["placeholder","modelValue"]),$(" "+j(d.$t("分")),1)])),_:1},8,["label","rules"])):k("",!0),y(N,{label:d.$t("状态"),prop:"status",rules:[{required:!0,message:""}]},{default:b((()=>[y(B,{modelValue:_.form.status,"onUpdate:modelValue":u[4]||(u[4]=t=>_.form.status=t)},{default:b((()=>[y(w,{label:1},{default:b((()=>[$(j(d.$t("开启")),1)])),_:1}),y(w,{label:0},{default:b((()=>[$(j(d.$t("关闭")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),y(N,{label:d.$t("组合"),prop:"is_comb",rules:[{required:!0,message:""}]},{default:b((()=>[y(B,{modelValue:_.form.is_comb,"onUpdate:modelValue":u[5]||(u[5]=t=>_.form.is_comb=t)},{default:b((()=>[y(w,{label:1},{default:b((()=>[$(j(d.$t("开启")),1)])),_:1}),y(w,{label:0},{default:b((()=>[$(j(d.$t("关闭")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),y(N,{label:d.$t("商品"),prop:"product_ids",rules:[{required:!0,validator:()=>_.form.product_ids.length>0,message:d.$t("请选中商品")}]},{default:b((()=>[y(z,{type:"primary",onClick:u[6]||(u[6]=t=>D.selectList("select"))},{default:b((()=>[$(j(d.$t("选中商品")),1)])),_:1}),_.select_list.length>0?(f(),V("div",O,[(f(!0),V(v,null,x(_.select_list,((t,e)=>(f(),V("div",U,[g("div",q,[y(E,{content:t.product_name_text},{default:b((()=>[$(j(t.product_name_text),1)])),_:2},1032,["content"])]),y(R,{class:"select-icon",onClick:i=>D.deleteOne(e,t.product_id)},{default:b((()=>[y(P)])),_:2},1032,["onClick"])])))),256))])):k("",!0)])),_:1},8,["label","rules"]),y(N,{label:d.$t("限购"),prop:"buy_limit_products",rules:[{required:!0,validator:()=>0!=_.form.buy_limit_products.length||1!=_.form.buy_limit_status,message:d.$t("请选中商品")}]},{default:b((()=>[y(B,{modelValue:_.form.buy_limit_status,"onUpdate:modelValue":u[7]||(u[7]=t=>_.form.buy_limit_status=t)},{default:b((()=>[y(w,{label:1},{default:b((()=>[$(j(d.$t("开启")),1)])),_:1}),y(w,{label:0},{default:b((()=>[$(j(d.$t("关闭")),1)])),_:1})])),_:1},8,["modelValue"]),1==_.form.buy_limit_status?(f(),V("div",F,[y(z,{type:"primary",onClick:u[8]||(u[8]=t=>D.selectList("limit")),disabled:!_.limit_ids},{default:b((()=>[$(j(d.$t("选中商品")),1)])),_:1},8,["disabled"]),g("div",J,[(f(!0),V(v,null,x(_.form.buy_limit_products,((t,e)=>(f(),V("div",S,[g("div",L,[y(C,{type:"text",modelValue:t.name,"onUpdate:modelValue":e=>t.name=e,readonly:""},null,8,["modelValue","onUpdate:modelValue"]),y(N,{label:"",style:{"margin-top":"16px"},prop:"item.limit_num",rules:[{required:!0,validator:()=>!!t.limit_num,message:d.$t("请输入限购数量")}]},{default:b((()=>[y(M,{controls:!1,min:0,max:999,style:{width:"200px !important"},placeholder:d.$t("请输入限购数量"),modelValue:t.limit_num,"onUpdate:modelValue":e=>t.limit_num=e,modelModifiers:{number:!0}},null,8,["placeholder","modelValue","onUpdate:modelValue"])])),_:2},1032,["rules"]),y(R,{class:"delete-icon",onClick:t=>D.handleDelete(e)},{default:b((()=>[y(A)])),_:2},1032,["onClick"])])])))),256))])])):k("",!0)])),_:1},8,["label","rules"])])),_:1},8,["model","rules"]),_.open_product?(f(),h(G,{key:0,open_product:_.open_product,limit_ids:_.limit_ids,selectType:_.selectType,multiple_selection:_.multiple_selection,onCloseDialogFunc:u[9]||(u[9]=t=>D.closeDialogFunc(t))},null,8,["open_product","limit_ids","selectType","multiple_selection"])):k("",!0)])),_:1},8,["title","modelValue","onClose"])}],["__scopeId","data-v-934fc749"]]);export{M as default};
