import{_ as e,q as t,a as s,o as a,c as d,w as i,b as l,f as r,r as o,F as c,d as n,e as u,n as _,j as p,g as f,S as h,t as y,l as m,D as g,i as b,h as k,k as x}from"./index-1a637619.js";const D=e({components:{Adress:e({data:()=>({listData:[],isLoading:!0,storeList:[],longitude:"",latitude:"",selectedId:-1,Visible:!1,urls:""}),props:["isAddress","store_id","chooseSotr"],watch:{isAddress(e){this.Visible=e,e&&(this.isWeixin()&&(this.urls=window.location.href),this.selectedId=this.$props.store_id,this.getData(!0),this.isWeixin()||this.getLocation())}},methods:{onAuthorize(){let e=this;uni.openSetting({success(t){t.authSetting["scope.userLocation"]&&(console.log("授权成功"),e.isAuthor=!0,setTimeout((()=>{e.getLocation((e=>{}))}),1e3))}})},getLocation(e){let a=this;t({type:"wgs84",success(e){a.longitude=e.longitude,a.latitude=e.latitude,a.getData(!1)},fail(){s({title:"获取定位失败，请点击右下角按钮打开定位权限",duration:2e3,icon:"none"}),a.isAuthor=!1}})},getWxLocation(e,t){let s=this;var a=require("jweixin-module");a.config(JSON.parse(e)),a.ready((function(e){a.getLocation({type:"wgs84",success:function(e){s.longitude=e.longitude,s.latitude=e.latitude,s.getData(!1)}})})),a.error((function(e){console.log(e)}))},getData(e){let t=this;t.isLoading=!0,t._get("supplier.Index/storeList",{longitude:t.longitude,latitude:t.latitude,shop_supplier_id:t.$props.chooseSotr,url:t.urls},(function(s){t.isLoading=!1,t.storeList=s.data.list,e&&t.isWeixin()&&t.getWxLocation(s.data.signPackage)}))},onSelectedStore(e){this.selectedId=e,this.$fire.fire("selectStoreId",e),this.$emit("close",e)}}},[["render",function(e,t,s,m,g,b){const k=p,x=f,D=h;return a(),d(x,{class:_(g.Visible?"address-distr_open":"address-distr_close")},{default:i((()=>[l(x,{class:"address-list bg-white"},{default:i((()=>[l(D,{"scroll-y":"true",class:"specs mt20",style:{"max-height":"600rpx"}},{default:i((()=>[(a(!0),r(c,null,o(g.storeList,((e,t)=>(a(),d(x,{class:"address p30 d-s-c border-b-e",key:t},{default:i((()=>[l(x,{class:"info flex-1",onClick:t=>b.onSelectedStore(e)},{default:i((()=>[l(x,{class:"user f34"},{default:i((()=>[l(k,null,{default:i((()=>[n(y(e.name),1)])),_:2},1024)])),_:2},1024),l(x,{class:"pt10 user f30 gray6"},{default:i((()=>[l(k,null,{default:i((()=>[n(y(e.link_phone),1)])),_:2},1024)])),_:2},1024),l(x,{class:"pt10 f24 gray6"},{default:i((()=>[l(k,null,{default:i((()=>[n(y(e.address),1)])),_:2},1024)])),_:2},1024),l(x,null,{default:i((()=>[l(k,{class:"iconfont icon-dingwei"})])),_:1}),e.store_id==g.selectedId?(a(),d(x,{key:0,class:"shop-item__right"},{default:i((()=>[l(k,{class:"iconfont icon-iconfontduihaocopy"})])),_:1})):u("",!0)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),g.isLoading||g.storeList.length?u("",!0):(a(),d(x,{key:0},{default:i((()=>[l(x,{class:"yoshop-notcont"},{default:i((()=>[l(k,{class:"iconfont icon-wushuju"}),l(k,{class:"cont"},{default:i((()=>[n("亲，暂无自提门店哦")])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-e6725de2"]])},data:()=>({loading:!0,options:{},indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,tab_type:0,product_id:"",product_num:"",ProductData:[],OrderData:[],exist_address:!1,Address:{region:[]},extract_store:{},last_extract:{},product_sku_id:0,delivery:0,store_id:1,coupon_id:0,is_use_points:0,linkman:"",phone:"",remark:"",pay_type:20,isCoupon:!1,coupon_list:{},couponList:[],delivery_set:[],coupon_num:0,temlIds:[],showAlipay:!1,takeout_address:{},isTimer:!1,mealtime:"",wmtime:"",estitime:"",is_pack:1,dinner_type:10,cart_type:0,store_set:[],table_id:0,min_money:0,isAddress:!1,shop_supplier_id:0}),onLoad(e){let t=this;t.options=e,t.$fire.on("selectStoreId",(function(e){t.extract_store=e,t.shop_supplier_id=e.shop_supplier_id}))},onShow(){this.$fire.on("takeout",(function(e){self.takeout_address=e,self.orderType="takeout"})),this.getData()},methods:{hasType(e){return-1!=this.delivery_set.indexOf(e)},payTypeFunc(e){this.pay_type=e},onShowPoints:function(e){let t=this;1==e.target.value?t.is_use_points=1:t.is_use_points=0,t.getData()},getData(){let e=this;m({title:"加载中"});let t={delivery:e.delivery||0,shop_supplier_id:e.shop_supplier_id,pay_source:e.getPlatform()};"points"==e.options.order_type&&e._get("plus.points.order/buy",Object.assign({},t,{product_id:e.options.product_id,total_num:e.options.product_num}),(function(t){!function(t){e.OrderData=t.data.order,e.temlIds=t.data.template_arr,e.exist_address=e.OrderData.exist_address,e.Address=e.OrderData.address,e.last_extract=e.OrderData.last_extract,e.delivery_set=e.OrderData.delivery_set,-1==e.delivery_set.indexOf(e.delivery)&&("10"==e.delivery_set[0]?e.tabFunc(0,!0):e.tabFunc(1,!0)),"20"==e.OrderData.delivery&&(e.tab_type=1),0==e.OrderData.order_pay_price&&(e.pay_type=10),!e.isWeixin()&&t.data.h5_alipay&&(e.showAlipay=!0),e.loading=!1}(t)}))},tabFunc(e,t){this.tab_type=e,0==e?this.delivery=10:1==e&&(this.delivery=20),t||this.getData()},SubmitOrder(){let e=this;if(10==e.delivery&&!e.Address)return e.showError("请添加配送地址"),!1;if(20==e.delivery&&0==e.shop_supplier_id)return e.showError("请选择自提点"),!1;m({title:"加载中",mask:!0});let t={delivery:e.delivery,shop_supplier_id:e.shop_supplier_id,pay_source:e.getPlatform()};t=Object.assign(t,{product_id:e.options.product_id,total_num:e.options.product_num});e.subMessage(e.temlIds,(function(){e._post("plus.points.order/buy",t,(function(t){let s="/pages/order/cashier?order_type=20&order_id="+t.data.order_id;e.gotoPage(s,"reLaunch")}))}))},timepick(){this.isTimer=!0},closetimer(e){""!=e&&(this.wmtime=e,this.mealtime=e),this.isTimer=!1},packTypeFunc(e){this.is_pack=e},closeAdress(){this.isAddress=!1},addAddress(){let e=-1;this.extract_store.store_id&&(e=this.extract_store.store_id),this.store_id=e,this.isAddress=!0}}},[["render",function(e,t,s,h,m,D){const v=p,A=f,w=b,O=k,L=x("Adress");return a(),d(A,{"data-theme":e.theme(),class:_(e.theme()||"")},{default:i((()=>[m.loading?u("",!0):(a(),d(A,{key:0,class:"wrap"},{default:i((()=>[l(A,{class:"right"},{default:i((()=>[(a(!0),r(c,null,o(m.delivery_set,((e,s)=>(a(),r(c,{key:e},["10"==e?(a(),d(A,{key:0,class:_(["takeout",0==m.tab_type?"active":""]),onClick:t[0]||(t[0]=e=>D.tabFunc(0))},{default:i((()=>[l(v,null,{default:i((()=>[n("快递配送")])),_:1})])),_:1},8,["class"])):u("",!0)],64)))),128)),(a(!0),r(c,null,o(m.delivery_set,((e,s)=>(a(),r(c,{key:e},["20"==e?(a(),d(A,{key:0,class:_(["dinein",1==m.tab_type?"active":""]),onClick:t[1]||(t[1]=e=>D.tabFunc(1))},{default:i((()=>[l(v,null,{default:i((()=>[n("门店自取")])),_:1})])),_:1},8,["class"])):u("",!0)],64)))),128))])),_:1}),l(A,{class:"header"},{default:i((()=>[l(A,{class:"headr_top"},{default:i((()=>[1!=m.tab_type?(a(),d(A,{key:0,class:"flex-1",style:{width:"100%"}},{default:i((()=>[l(A,{class:"left overflow-hidden"},{default:i((()=>[l(A,{class:"overflow-hidden f28 fb w-b-a",style:{width:"600rpx"},onClick:t[2]||(t[2]=t=>e.gotoPage("/pages/user/address/address"))},{default:i((()=>[null!=m.Address?(a(),r(c,{key:0},[n(y(m.Address.detail+m.Address.address+" "+m.Address.name+" "+m.Address.phone),1)],64)):(a(),r(c,{key:1},[n(" 请选择配送地址 ")],64))])),_:1})])),_:1})])),_:1})):u("",!0),1==m.tab_type?(a(),d(A,{key:1,class:"header_bottom"},{default:i((()=>[m.extract_store.shop_supplier_id?u("",!0):(a(),d(A,{key:0,class:"d-b-c pr20 bg-white",onClick:t[3]||(t[3]=e=>D.addAddress())},{default:i((()=>[l(A,{class:"add-address d-s-c"},{default:i((()=>[l(A,{class:"icon-box mr10"},{default:i((()=>[l(v,{class:"icon iconfont icon-dizhi1"})])),_:1}),l(v,null,{default:i((()=>[n("请选择自提点")])),_:1})])),_:1})])),_:1})),m.extract_store.shop_supplier_id?(a(),d(A,{key:1,class:"d-b-c pr20 bg-white",onClick:t[4]||(t[4]=e=>D.addAddress())},{default:i((()=>[l(A,{class:"address-defalut-wrap"},{default:i((()=>[l(A,{class:"address"},{default:i((()=>[l(v,{class:"fb gray3"},{default:i((()=>[n(y(m.extract_store.name),1)])),_:1}),l(A,{class:"icon-box"})])),_:1}),l(A,{class:"user"},{default:i((()=>[l(v,{class:"name"},{default:i((()=>[n(y(m.extract_store.address),1)])),_:1}),l(v,{class:"tel"},{default:i((()=>[n(y(m.extract_store.link_phone),1)])),_:1})])),_:1})])),_:1}),l(A,null,{default:i((()=>[g("i",{class:"iconfont icon-jiantou"})])),_:1})])),_:1})):u("",!0)])),_:1})):u("",!0)])),_:1})])),_:1}),l(A,{class:"vender"},{default:i((()=>[l(A,{class:"list"},{default:i((()=>[l(A,{class:"item d-b-c"},{default:i((()=>[l(A,{class:"info d-s-s"},{default:i((()=>[l(A,{class:"cover"},{default:i((()=>[l(w,{src:m.OrderData.file_path,mode:"aspectFill"},null,8,["src"])])),_:1}),l(A,null,{default:i((()=>[l(A,{class:"title f30 fb mb16"},{default:i((()=>[n(y(m.OrderData.product_name),1)])),_:1})])),_:1})])),_:1}),l(A,{class:"",style:{height:"148rpx"}},{default:i((()=>[l(A,{class:"f32 order_item mb16"},{default:i((()=>[n("¥"+y(m.OrderData.product_price),1)])),_:1}),l(A,{class:"f22 order_item"},{default:i((()=>[n("×"+y(m.OrderData.total_num),1)])),_:1})])),_:1})])),_:1})])),_:1}),l(A,{class:"other_box"},{default:i((()=>[l(A,{class:"item"},{default:i((()=>[l(v,{class:"key"},{default:i((()=>[n("商品小计：")])),_:1}),l(v,{class:"f32"},{default:i((()=>[n("￥"+y(m.OrderData.total_price),1)])),_:1})])),_:1}),1!=m.tab_type&&0!=m.OrderData.express_price?(a(),d(A,{key:0,class:"item"},{default:i((()=>[l(v,{class:"key"},{default:i((()=>[n("配送费用：")])),_:1}),l(v,{class:"f32"},{default:i((()=>[n("￥"+y(m.OrderData.express_price),1)])),_:1})])),_:1})):u("",!0)])),_:1}),l(A,{class:"total-box"},{default:i((()=>[n(" 共"+y(m.OrderData.total_num)+"件商品 小计 ",1),l(v,{class:"f32 fb ml15"},{default:i((()=>[n("￥"+y(m.OrderData.order_pay_price),1)])),_:1})])),_:1})])),_:1}),l(A,{class:"foot-pay-btns"},{default:i((()=>[l(A,{class:"price"},{default:i((()=>[l(v,{class:"num"},{default:i((()=>[n(y(m.OrderData.total_points),1)])),_:1}),n("积分 "),m.OrderData.order_pay_price>0?(a(),r(c,{key:0},[n(" + ¥ "),l(v,{class:"num"},{default:i((()=>[n(y(m.OrderData.order_pay_price),1)])),_:1})],64)):u("",!0)])),_:1}),l(O,{type:"primary",onClick:D.SubmitOrder},{default:i((()=>[n("提交订单")])),_:1},8,["onClick"])])),_:1})])),_:1})),l(L,{isAddress:m.isAddress,store_id:m.store_id,onClose:D.closeAdress},null,8,["isAddress","store_id","onClose"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-e24457a3"]]);export{D as default};
