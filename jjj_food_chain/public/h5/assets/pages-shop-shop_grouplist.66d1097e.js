import{_ as t,m as e,l as s,s as a,p as o,q as l,a as i,B as d,Q as n,o as c,c as r,w as u,n as g,g as f,b as _,f as h,r as p,F as m,d as y,v as w,j as L,k as b,S as x,t as k,e as S}from"./index-1a637619.js";import{u as D}from"./uni-load-more.934e6c66.js";const v=t({components:{uniLoadMore:D},data:()=>({distance:"",loading:!0,storeList:[],longitude:"",latitude:"",selectedId:{region:{city:"",store_id:-1,distance_unit:"",log:{file_path:""}},store_name:""},store_name:"",list_rows:10,last_page:0,page:1,no_more:!1,scrollviewHigh:0,longitude:"",latitude:"",dinner_type:""}),computed:{loadingType(){return this.loading?1:0!=this.storeList.length&&this.no_more?2:0}},onLoad(t){this.group_id=t.group_id},onShow(){this.restoreData(),this.getcityData()},mounted(){this.selectedId=e("selectedId")?e("selectedId"):0,this.init()},methods:{getcityData(){let t=this;if(t.isWeixin()){let l=e("sign");l?t.getWxLocation(l):(s({title:"加载中"}),t._post("index/index",{url:window.location.href},(function(e){a("sign",e.data.signPackage),l=e.data.signPackage,o(),t.getWxLocation(l)})))}else t.getLocation()},onAuthorize(){let t=this;uni.openSetting({success(e){e.authSetting["scope.userLocation"]&&(t.isAuthor=!0,setTimeout((()=>{t.getLocation((t=>{}))}),1e3))}})},getLocation(t){let e=this;l({type:"wgs84",success(t){e.longitude=t.longitude,e.latitude=t.latitude,e.getData()},fail(t){e.getData(),i({title:"获取定位失败，请点击右下角按钮打开定位权限",duration:2e3,icon:"none"})}})},isShopid:t=>e("selectedId")==t,getWxLocation(t,e){let s=this;var a=require("jweixin-module");a.config(JSON.parse(t)),a.ready((function(t){a.getLocation({type:"wgs84",success:function(t){s.longitude=t.longitude,s.latitude=t.latitude,s.getData()},fail(t){s.getData()}})})),a.error((function(t){console.log(t)}))},init(){let t=this;d({success(e){t.scrollviewHigh=e.windowHeight}})},restoreData(){this.storeList=[],this.search="",this.no_more=!1,this.page=1},scrolltolowerFunc(){let t=this;if(t.bottomRefresh=!0,t.page++,t.loading=!0,t.page>t.last_page)return t.loading=!1,void(t.no_more=!0);t.getData()},getData(){let t=this;t.loading=!0,s({title:"加载中"}),t._get("plus.group.Group/supplierList",{group_id:t.group_id,longitude:t.longitude||0,latitude:t.latitude||0},(function(e){o(),t.loading=!1,t.storeList=t.storeList.concat(e.data.list.data),t.last_page=e.data.list.last_page,e.data.list.last_page<=1&&(t.no_more=!0)}))},chooseLocation(){let t=this;n({success:function(e){console.log("位置名称："+e.name),console.log("详细地址："+e.address),console.log("纬度："+e.latitude),console.log("经度："+e.longitude),t.longitude=e.longitude,t.latitude=e.latitude,t.getrecord(),t.getData()}})},search(){let t=this;t.loading=!0,t._get("store.store/lists",{store_name:t.store_name,longitude:t.longitude,latitude:t.latitude},(function(e){t.loading=!1,t.storeList=e.data.list}))},onSelectedStore(t,e){let s=this;s.selectedId=t,a("selectedId",s.selectedId),s.$fire.fire("selectShop",!0),e&&history.go(-1)},getrecord(){let t=this,e=t.selectedId.store_id;t._post("user.storelog/record",{store_id:e,longitude:t.longitude,latitude:t.latitude},(function(e){t.distance=e.data.detail.distance_unit}))},addSotre(t){let e=t.store_id;this._post("user.storelog/add",{store_id:e},(function(t){}))}}},[["render",function(t,e,s,a,o,l){const i=f,d=L,n=b("uni-load-more"),D=x;return c(),r(i,{"data-theme":t.theme(),class:g(t.theme()||"")},{default:u((()=>[_(D,{"scroll-y":"true",class:"scroll-Y",style:w("height:"+o.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:l.scrolltolowerFunc},{default:u((()=>[_(i,{class:"address-list"},{default:u((()=>[(c(!0),h(m,null,p(o.storeList,((e,s)=>(c(),r(i,{class:"address pt26 p-0-26 bg-white",key:s},{default:u((()=>[_(i,{class:"info flex-1"},{default:u((()=>[_(i,{class:"user f34 d-b-c"},{default:u((()=>[_(i,{class:"d-s-c"},{default:u((()=>[_(i,{class:"f32 fb gray3"},{default:u((()=>[y(k(e.name),1)])),_:2},1024)])),_:2},1024),_(i,{class:"distance"},{default:u((()=>[_(d,null,{default:u((()=>[y("距离:"+k(e.distance),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(i,{class:"d-b-c"},{default:u((()=>[_(i,{class:"text-ellipsis f22 gray6"},{default:u((()=>[y(k(e.address),1)])),_:2},1024),e.delivery_time.length>0?(c(),r(i,{key:0,class:"text-ellipsis f22 gray6"},{default:u((()=>[_(d,{class:"icon iconfont icon-time",style:{color:"#333333","font-size":"22rpx","margin-right":"15rpx"}}),_(d,null,{default:u((()=>[y(k(e.delivery_time[0]+"-"+e.delivery_time[1]),1)])),_:2},1024)])),_:2},1024)):S("",!0)])),_:2},1024),_(i,{class:"mt16 mb30 d-b-c"},{default:u((()=>[_(i),_(i,null,{default:u((()=>[0==e.status?(c(),r(d,{key:0,class:"shop_status theme-borderbtn"},{default:u((()=>[y("营业中")])),_:1})):(c(),r(d,{key:1,class:"shop_status theme-borderbtn"},{default:u((()=>[y("暂停营业")])),_:1}))])),_:2},1024)])),_:2},1024)])),_:2},1024),_(i,{class:"info-right d-b-c"},{default:u((()=>[_(i,{class:"d-b-c gray3 ww100"},{default:u((()=>[_(i,{class:"d-s-c",onClick:s=>t.callPhone(e.link_phone)},{default:u((()=>[_(i,{class:"icon iconfont icon-002dianhua"}),_(d,{class:"f26 fb ml18"},{default:u((()=>[y("咨询服务方")])),_:1})])),_:2},1032,["onClick"]),_(i,{class:"ml25 d-s-c",onClick:s=>t.openmap(e.latitude,e.longitude)},{default:u((()=>[_(i,{class:"icon iconfont icon-fasong"}),_(d,{class:"f26 fb ml18"},{default:u((()=>[y("导航去这里")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0!=o.storeList.length||o.loading?(c(),r(n,{key:1,loadingType:l.loadingType},null,8,["loadingType"])):(c(),r(i,{key:0,class:"d-c-c p30"},{default:u((()=>[_(d,{class:"iconfont icon-wushuju"}),_(d,{class:"cont"},{default:u((()=>[y("亲，暂无相关记录哦")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-15c70d45"]]);export{v as default};
