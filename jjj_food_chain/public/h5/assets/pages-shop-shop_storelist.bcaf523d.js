import{_ as e,m as t,l as s,s as l,p as o,q as a,a as i,B as n,Q as d,o as c,c as r,w as u,n as g,g as _,b as f,f as h,r as p,F as m,d as y,v as w,j as L,k,S as b,t as S,e as x,C as v}from"./index-1a637619.js";import{u as D}from"./uni-load-more.934e6c66.js";const I=e({components:{uniLoadMore:D},data:()=>({distance:"",loading:!0,storeList:[],longitude:"",latitude:"",selectedId:{region:{city:"",store_id:-1,distance_unit:"",log:{file_path:""}},store_name:""},store_name:"",list_rows:10,last_page:0,page:1,no_more:!1,scrollviewHigh:0,longitude:"",latitude:"",dinner_type:""}),computed:{loadingType(){return this.loading?1:0!=this.storeList.length&&this.no_more?2:0}},onLoad(e){this.dinner_type=e.dinner_type},onShow(){this.restoreData(),this.getcityData()},mounted(){this.selectedId=t("selectedId")?t("selectedId"):0,this.init()},methods:{getcityData(){let e=this;if(e.isWeixin()){let a=t("sign");a?e.getWxLocation(a):(s({title:"加载中"}),e._post("index/index",{url:window.location.href},(function(t){l("sign",t.data.signPackage),a=t.data.signPackage,o(),e.getWxLocation(a)})))}else e.getLocation()},onAuthorize(){let e=this;uni.openSetting({success(t){t.authSetting["scope.userLocation"]&&(e.isAuthor=!0,setTimeout((()=>{e.getLocation((e=>{}))}),1e3))}})},getLocation(e){let t=this;a({type:"wgs84",success(e){t.longitude=e.longitude,t.latitude=e.latitude,t.getData()},fail(e){t.getData(),i({title:"获取定位失败，请点击右下角按钮打开定位权限",duration:2e3,icon:"none"})}})},isShopid:e=>t("selectedId")==e,getWxLocation(e,t){let s=this;var l=require("jweixin-module");l.config(JSON.parse(e)),l.ready((function(e){l.getLocation({type:"wgs84",success:function(e){s.longitude=e.longitude,s.latitude=e.latitude,s.getData()},fail(e){s.getData()}})})),l.error((function(e){console.log(e)}))},init(){let e=this;n({success(t){e.scrollviewHigh=t.windowHeight}})},restoreData(){this.storeList=[],this.search="",this.no_more=!1,this.page=1},scrolltolowerFunc(){let e=this;if(e.bottomRefresh=!0,e.page++,e.loading=!0,e.page>e.last_page)return e.loading=!1,void(e.no_more=!0);e.getData()},getData(){let e=this;e.loading=!0,s({title:"加载中"}),e._get("supplier.index/deliveryList",{type:e.dinner_type,longitude:e.longitude||0,latitude:e.latitude||0},(function(t){o(),e.loading=!1,e.storeList=e.storeList.concat(t.data.list.data),e.last_page=t.data.list.last_page,t.data.list.last_page<=1&&(e.no_more=!0)}))},chooseLocation(){let e=this;d({success:function(t){console.log("位置名称："+t.name),console.log("详细地址："+t.address),console.log("纬度："+t.latitude),console.log("经度："+t.longitude),e.longitude=t.longitude,e.latitude=t.latitude,e.getrecord(),e.getData()}})},search(){let e=this;e.loading=!0,e._get("store.store/lists",{store_name:e.store_name,longitude:e.longitude,latitude:e.latitude},(function(t){e.loading=!1,e.storeList=t.data.list}))},onSelectedStore(e,t){let s=this;s.selectedId=e,l("selectedId",s.selectedId),s.$fire.fire("selectShop",!0),t&&history.go(-1)},getrecord(){let e=this,t=e.selectedId.store_id;e._post("user.storelog/record",{store_id:t,longitude:e.longitude,latitude:e.latitude},(function(t){e.distance=t.data.detail.distance_unit}))},addSotre(e){let t=e.store_id;this._post("user.storelog/add",{store_id:t},(function(e){}))}}},[["render",function(e,t,s,l,o,a){const i=_,n=L,d=k("uni-load-more"),D=b;return c(),r(i,{"data-theme":e.theme(),class:g(e.theme()||"")},{default:u((()=>[f(D,{"scroll-y":"true",class:"scroll-Y",style:w("height:"+o.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:a.scrolltolowerFunc},{default:u((()=>[f(i,{class:"address-list"},{default:u((()=>[(c(!0),h(m,null,p(o.storeList,((t,s)=>(c(),r(i,{class:g(["address pt26 p-0-26 bg-white",a.isShopid(t.shop_supplier_id)?"active":""]),onClick:e=>a.onSelectedStore(t.shop_supplier_id),key:s},{default:u((()=>[f(i,{class:"info flex-1"},{default:u((()=>[f(i,{class:"user f34 d-b-c"},{default:u((()=>[f(i,{class:"d-s-c"},{default:u((()=>[f(i,{class:g(t.shop_supplier_id!=o.selectedId?"select-id":"select-id icon iconfont icon-tijiaochenggong")},null,8,["class"]),f(i,{class:"f32 fb gray3"},{default:u((()=>[y(S(t.name),1)])),_:2},1024)])),_:2},1024),f(i,{class:"distance"},{default:u((()=>[f(n,null,{default:u((()=>[y("距离:"+S(t.distance),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(i,{class:"d-b-c"},{default:u((()=>[f(i,{class:"text-ellipsis f22 gray6"},{default:u((()=>[y(S(t.address),1)])),_:2},1024),t.delivery_time.length>0?(c(),r(i,{key:0,class:"text-ellipsis f22 gray6"},{default:u((()=>[f(n,{class:"icon iconfont icon-time",style:{color:"#333333","font-size":"22rpx","margin-right":"15rpx"}}),f(n,null,{default:u((()=>[y(S(t.delivery_time[0]+"-"+t.delivery_time[1]),1)])),_:2},1024)])),_:2},1024)):x("",!0)])),_:2},1024),f(i,{class:"mt16 mb30 d-b-c"},{default:u((()=>[f(i),f(i,null,{default:u((()=>[0==t.status?(c(),r(n,{key:0,class:"shop_status theme-borderbtn"},{default:u((()=>[y("营业中")])),_:1})):(c(),r(n,{key:1,class:"shop_status theme-borderbtn"},{default:u((()=>[y("暂停营业")])),_:1}))])),_:2},1024)])),_:2},1024)])),_:2},1024),f(i,{class:"info-right d-b-c"},{default:u((()=>[f(i,{class:"d-s-c gray3"},{default:u((()=>[f(i,{class:"d-s-c",onClick:s=>e.callPhone(t.link_phone)},{default:u((()=>[f(i,{class:"icon iconfont icon-002dianhua"}),f(n,{class:"f26 fb ml18"},{default:u((()=>[y("咨询服务方")])),_:1})])),_:2},1032,["onClick"]),f(i,{class:"ml25 d-s-c",onClick:s=>e.openmap(t.latitude,t.longitude)},{default:u((()=>[f(i,{class:"icon iconfont icon-fasong"}),f(n,{class:"f26 fb ml18"},{default:u((()=>[y("导航去这里")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),f(i,{class:"f26 gray3 theme-btn",onClick:v((e=>a.onSelectedStore(t.shop_supplier_id,!0)),["stop"])},{default:u((()=>[y("去下单 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick","class"])))),128)),0!=o.storeList.length||o.loading?(c(),r(d,{key:1,loadingType:a.loadingType},null,8,["loadingType"])):(c(),r(i,{key:0,class:"d-c-c p30"},{default:u((()=>[f(n,{class:"iconfont icon-wushuju"}),f(n,{class:"cont"},{default:u((()=>[y("亲，暂无相关记录哦")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-ec3be0d0"]]);export{I as default};
