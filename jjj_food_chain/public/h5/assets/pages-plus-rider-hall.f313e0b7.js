import{_ as e,B as t,M as s,a6 as a,l,p as r,G as o,a as i,o as d,c as n,w as c,n as h,g,b as _,d as u,v as f,f as p,r as m,F as y,j as k,S as b,k as v,t as R,C as L,e as w,i as D}from"./index-1a637619.js";import{u as C}from"./uni-load-more.934e6c66.js";const x=e({components:{uniLoadMore:C},data:()=>({dataList:[],take_fee:"",loadding:!0,no_more:!1,page:1,last_page:0,type:0,scrollviewHigh:0,phoneHeight:0,_freshing:!1,triggered:!1}),computed:{loadingType(){return this.loadding?1:0!=this.dataList.length&&this.no_more?2:0}},onLoad(){this._freshing=!1,this.triggered=!0,this.restoreData(),this.getData()},mounted(){this.init()},methods:{restoreData(){this.dataList=[],this.page=1,this.no_more=!1,this.loadding=!0},istype(e){e==this.type||this.loadding||(this.type=e,this.restoreData(),this.getData())},init(){let e=this;t({success(t){e.phoneHeight=t.windowHeight,s().select(".header").boundingClientRect((t=>{let s=e.phoneHeight-t.height;e.scrollviewHigh=s})).exec()}})},callPhone(e){e+="",console.log(e),a({phoneNumber:e,success(e){console.log(e)},fail(e){console.log(e)}})},scrolltolowerFunc(){let e=this;e.no_more||(e.page++,e.page<=e.last_page?e.getData():e.no_more=!0)},onPulling(e){},onRefresh(){console.log("onRefresh"),this._freshing||(this._freshing=!0,this.restoreData(),this.getData())},onRestore(){console.log("onRestore"),this.triggered="restore"},onAbort(){console.log("onAbort")},getData(){0==this.type?this.getLists():1==this.type&&this.getDriver()},getDriver(){let e=this;l({title:"加载中"}),e._post("plus.driver.TakeOrder/driverList",{type:1},(function(t){e.last_page=t.data.list.last_page,t.data.list.last_page<=1?e.no_more=!0:e.no_more=!1,e.take_fee=t.data.take_fee,e.dataList=e.dataList.concat(t.data.list.data),r(),e.loadding=!1,e.triggered=!1,e._freshing=!1,console.log("over")}))},getLists(){let e=this;l({title:"加载中"}),e._post("plus.driver.TakeOrder/lists",{},(function(t){e.last_page=t.data.list.last_page,t.data.list.last_page<=1?e.no_more=!0:e.no_more=!1,e.take_fee=t.data.take_fee,e.dataList=e.dataList.concat(t.data.list.data),r(),e.triggered=!1,e._freshing=!1,e.loadding=!1,console.log("over")}))},receiveOrder(e){let t=this;l({title:"加载中"}),t._post("plus.driver.TakeOrder/receiveOrder",{order_id:e.order_id},(function(s){o({content:s.msg,complete(){let s=t.dataList.indexOf(e);t.dataList.splice(s,1)}}),r(),t.loadding=!1}))},orderReceipt(e){let t=this;o({title:"提示",content:"您确定送达了吗?",success:function(s){s.confirm?(l({title:"正在处理"}),t._post("user.order/receipt",{order_id:e},(function(e){r(),i({title:"已确认送达",duration:2e3,icon:"success"}),t.restoreData(),t.getData()}))):i({title:"取消送达",duration:1e3,icon:"none"})}})}}},[["render",function(e,t,s,a,l,r){const o=k,i=g,C=D,x=b,T=v("uni-load-more");return d(),n(i,{class:h(["",e.theme()||""]),"data-theme":e.theme()},{default:c((()=>[_(i,{class:"header"},{default:c((()=>[_(i,{class:"tc flex-1",onClick:t[0]||(t[0]=e=>r.istype(0))},{default:c((()=>[_(o,{class:h(0==l.type?"header_item active":"header_item")},{default:c((()=>[u("待接单")])),_:1},8,["class"])])),_:1}),_(i,{class:"tc flex-1",onClick:t[1]||(t[1]=e=>r.istype(1))},{default:c((()=>[_(o,{class:h(1==l.type?"header_item active":"header_item")},{default:c((()=>[u("今日接单")])),_:1},8,["class"])])),_:1})])),_:1}),_(i,null,{default:c((()=>[_(x,{"scroll-y":"true",class:"scroll-Y",style:f("height:"+l.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:r.scrolltolowerFunc,"refresher-enabled":"true",onRefresherrefresh:r.onRefresh,onRefresherrestore:r.onRestore,"refresher-triggered":l.triggered,"refresher-threshold":50,onRefresherabort:r.onAbort,onRefresherpulling:r.onPulling,"refresher-background":"#f2f2f2"},{default:c((()=>[_(i,{class:"hall_list"},{default:c((()=>[(d(!0),p(y,null,m(l.dataList,((t,s)=>(d(),n(i,{class:"hall_item p30",key:s,onClick:s=>e.gotoPage("/pages/plus/rider/order/order?order_id="+t.order_id+"&type="+l.type)},{default:c((()=>[_(i,{class:"d-b-c mb-20"},{default:c((()=>[_(i,null,{default:c((()=>[u(R(t.create_time),1)])),_:2},1024),_(i,{class:"f26"},{default:c((()=>[u("配送费用: "),_(o,{class:"red"},{default:c((()=>[u(R(t.take_fee)+"元",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(i,{class:"d-b-c"},{default:c((()=>[_(x,{class:"scroll_x","scroll-x":"true"},{default:c((()=>[_(i,{class:"d-s-c"},{default:c((()=>[(d(!0),p(y,null,m(t.product,((e,t)=>(d(),n(i,{class:"produc_imgs",key:t},{default:c((()=>[_(C,{class:"product_img",src:e.image.file_path,mode:"scaleToFill"},null,8,["src"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),0==l.type?(d(),n(i,{key:0,class:"mid_btn",onClick:L((e=>r.receiveOrder(t)),["stop"])},{default:c((()=>[u("接单")])),_:2},1032,["onClick"])):w("",!0),1==l.type&&10==t.receipt_status.value?(d(),n(i,{key:1,class:"mid_btn",onClick:L((e=>r.orderReceipt(t.order_id)),["stop"])},{default:c((()=>[u("确认送达")])),_:2},1032,["onClick"])):w("",!0),1==l.type&&20==t.receipt_status.value?(d(),n(i,{key:2,class:"mid_btn btn_close"},{default:c((()=>[u("已送达")])),_:1})):w("",!0)])),_:2},1024),_(i,{class:"ww100 tr f26"},{default:c((()=>[_(o,{class:"icon iconfont icon-002dianhua mr10",onClick:L((e=>r.callPhone(t.address.phone)),["stop"])},null,8,["onClick"]),u("客户期望送达时间："),_(o,{class:"blue"},{default:c((()=>[u(R(t.mealtime),1)])),_:2},1024)])),_:2},1024),_(i,{class:"d-b-c f26 pt10"},{default:c((()=>[_(i,{class:"address_text f26"},{default:c((()=>[u("送货地址："+R(t.address.detail+t.address.address),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0!=l.dataList.length||l.loadding?(d(),n(T,{key:1,loadingType:r.loadingType},null,8,["loadingType"])):(d(),n(i,{key:0,class:"d-c-c p30"},{default:c((()=>[_(o,{class:"iconfont icon-wushuju"}),_(o,{class:"cont"},{default:c((()=>[u("亲，已经没有更多了")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower","onRefresherrefresh","onRefresherrestore","refresher-triggered","onRefresherabort","onRefresherpulling"])])),_:1})])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-eaf6199b"]]);export{x as default};
