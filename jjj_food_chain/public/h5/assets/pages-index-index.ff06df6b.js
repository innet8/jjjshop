import{_ as t,s as e,a,o as s,c as o,w as i,b as n,n as l,d as u,t as d,e as c,f as p,r as h,F as r,i as f,g as m,h as _,j as g,k as y,u as x,l as k,m as w,p as b,q as P,v as S,x as C}from"./index-1a637619.js";import{_ as L}from"./diy.d90b6496.js";import{r as D}from"./uni-app.es.041617b8.js";import{P as j}from"./uni-popup.bcc5e38f.js";import"./bg-invite.4f84fba2.js";/* empty css                                                                  */const v=t({components:{diy:L,Homepush:t({components:{Popup:j},data:()=>({isPopup:!1,type:0,width:600,height:800,backgroundColor:"none",boxShadow:"none",form:{},coupon:[]}),props:["homepush_data"],created(){},mounted(){this.setData()},methods:{setData(){this.isPopup=!0,this.form=this.homepush_data,console.log(this.form),this.type=this.homepush_data.type,this.coupon=this.homepush_data.coupon},hidePopupFunc(t){e("homepush_name",this.homepush_data.name),this.isPopup=!1},gotoLink(t){this.hidePopupFunc(),this.gotoPage(t)},getCoupon(){let t=this,e=[];t.coupon.forEach((t=>{e.push(t.coupon_id)})),t._get("user.coupon/receiveList",{coupon_ids:JSON.stringify(e)},(function(e){a({title:"领取成功",icon:"success",mask:!0,duration:2e3}),t.hidePopupFunc()}))}}},[["render",function(t,e,a,x,k,w){const b=f,P=m,S=_,C=g,L=y("Popup");return s(),o(P,{class:"home-push-wrap"},{default:i((()=>[n(L,{show:k.isPopup,width:k.width,height:k.height,backgroundColor:k.backgroundColor,boxShadow:k.boxShadow,padding:0,onHidePopup:w.hidePopupFunc},{default:i((()=>[n(P,{class:l(["home-push",1==k.type||3==k.type?"home-push-bg":""])},{default:i((()=>[1==k.type?(s(),o(P,{key:0,class:"image-text"},{default:i((()=>[n(P,{class:"pic"},{default:i((()=>[n(b,{src:k.form.file_path,mode:"aspectFill"},null,8,["src"])])),_:1}),n(P,{class:"title"},{default:i((()=>[u(d(k.form.title),1)])),_:1}),n(P,{class:"des"},{default:i((()=>[u(d(k.form.remark),1)])),_:1}),n(P,{class:"btns"},{default:i((()=>[n(S,{type:"primary",onClick:e[0]||(e[0]=t=>w.gotoLink(k.form.link.url))},{default:i((()=>[u(d(k.form.des),1)])),_:1})])),_:1})])),_:1})):c("",!0),2==k.type?(s(),o(P,{key:1,class:"image-only",onClick:e[1]||(e[1]=t=>w.gotoLink(k.form.link.url))},{default:i((()=>[n(P,{class:"pic"},{default:i((()=>[n(b,{src:k.form.file_path,mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1})):c("",!0),3==k.type?(s(),o(P,{key:2,class:"cuopon"},{default:i((()=>[null!=k.form.file_path&&""!=k.form.file_path?(s(),o(P,{key:0,class:"cuopon-title d-c-c"},{default:i((()=>[n(b,{src:k.form.file_path,mode:"aspectFill"},null,8,["src"])])),_:1})):c("",!0),n(P,{class:"list"},{default:i((()=>[(s(!0),p(r,null,h(k.coupon,((t,e)=>(s(),o(P,{class:"item",key:e},{default:i((()=>[n(P,{class:"info"},{default:i((()=>[n(P,{class:"num"},{default:i((()=>[n(C,{class:"f30"},{default:i((()=>[u(d(t.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(P,{class:"explan"},{default:i((()=>[n(C,{class:"name"},{default:i((()=>[u(d(t.type),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),n(P,{class:"btns"},{default:i((()=>[n(S,{type:"primary",onClick:e[2]||(e[2]=t=>w.getCoupon())},{default:i((()=>[u("立即领取")])),_:1})])),_:1})])),_:1})):c("",!0)])),_:1},8,["class"]),n(P,{class:"close-btns",onClick:e[3]||(e[3]=t=>w.hidePopupFunc(!0))},{default:i((()=>[n(C,{class:"icon iconfont icon-guanbi"})])),_:1})])),_:1},8,["show","width","height","backgroundColor","boxShadow","onHidePopup"])])),_:1})}],["__scopeId","data-v-278fda06"]])},data:()=>({user:"",loadding:!0,listData:[],urldata:"",longitude:0,latitude:0,delivery_set:[],items:[],is_collection:!1,is_follow:"0",is_homepush:!1,homepush_data:{}}),mounted(){this.isWeixin()&&(this.urldata=window.location.href),this.getcityData(),this.getData()},onLoad(t){let a=x.getSceneData(t),s=t.shop_supplier_id?t.shop_supplier_id:a.sid;s&&e("selectedId",s)},onShow(){this.$nextTick((()=>{this.$refs.diyRef.getUserInfo()}))},methods:{getData(){let t=this;k({title:"加载中"}),t._post("index/index",{url:t.urldata,longitude:t.longitude||"0",latitude:t.latitude||"0"},(function(a){e("sign",a.data.signPackage),""==w("selectedId")&&e("selectedId",a.data.supplier?a.data.supplier.shop_supplier_id:0),t.items=a.data.data.items,t.user=a.data.user;let s=w("homepush_name");a.data.data.setting.homepush.is_open&&s!=a.data.data.setting.homepush.name&&(t.homepush_data=a.data.data.setting.homepush,t.is_homepush=!0),""!=t.urldata&&(t.jweixin=t.configWxScan(a.data.signPackage)),b()}))},scanQrcode:function(){let t=this;this.isWeixin()?t.jweixin.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(t){window.location.href=t.resultStr},error:function(t){a({title:"扫码失败，请重试"})}}):console.log("H5暂只支持公众号扫码")},onShareAppMessage(){return{title:this.page.params.share_title,path:"/pages/index/index?"+this.getShareUrlParams()}},getcityData(){let t=this;if(t.isWeixin()){let a=w("sign");a?t.getWxLocation(a):(k({title:"加载中"}),t._post("index/index",{url:window.location.href},(function(s){e("sign",s.data.signPackage),a=s.data.signPackage,b(),t.getWxLocation(a)})))}else t.getLocation()},onAuthorize(){let t=this;uni.openSetting({success(e){e.authSetting["scope.userLocation"]&&(t.isAuthor=!0,setTimeout((()=>{t.getLocation((t=>{}))}),1e3))}})},getLocation(t){let e=this;P({type:"wgs84",success(t){e.longitude=t.longitude,e.latitude=t.latitude,e.getData()},fail(t){e.longitude=0,e.latitude=0,a({title:"获取定位失败，请点击右下角按钮打开定位权限",duration:2e3,icon:"none"}),e.getData()}})},getWxLocation(t,e){let a=this;var s=require("jweixin-module");s.config(JSON.parse(t)),s.ready((function(t){s.getLocation({type:"wgs84",success:function(t){a.longitude=t.longitude,a.latitude=t.latitude,a.getData()},fail(t){a.longitude=0,a.latitude=0,a.getData()}})})),s.error((function(t){console.log(t)}))}}},[["render",function(t,e,a,d,p,h){const r=D(C("diy"),L),f=g,x=m,k=_,w=y("Homepush");return s(),o(x,{"data-theme":t.theme(),class:l(t.theme()||"")},{default:i((()=>[n(r,{style:{position:"relative"},diyItems:p.items,onScanQrcode:h.scanQrcode,ref:"diyRef"},null,8,["diyItems","onScanQrcode"]),p.is_collection?(s(),o(x,{key:0,class:"collection-box",style:S("top:"+(t.topBarTop()+t.topBarHeight()+10)+"px;")},{default:i((()=>[n(x,{class:"inner"},{default:i((()=>[n(f,null,{default:i((()=>[u("点击“")])),_:1}),n(f,{class:"point"},{default:i((()=>[u(".")])),_:1}),n(f,{class:"point point-big"},{default:i((()=>[u(".")])),_:1}),n(f,{class:"point"},{default:i((()=>[u(".")])),_:1}),n(f,null,{default:i((()=>[u("”添加到我的小程序，\\n微信首页下拉即可快速访问店铺")])),_:1})])),_:1}),n(k,{type:"primary",class:"close-btn",onClick:e[0]||(e[0]=t=>p.is_collection=!1)},{default:i((()=>[u("x")])),_:1})])),_:1},8,["style"])):c("",!0),p.is_homepush?(s(),o(w,{key:1,homepush_data:p.homepush_data},null,8,["homepush_data"])):c("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-fda4cc04"]]);export{v as default};
