import{r as e,o as a,i as l,a as t,b as s,c as u,d as i,e as o,g as n,u as c,f as v,h as d,w as r,j as f,k as _,l as b,m as p,n as m,s as h,p as y,q as g,t as w,v as x,x as C,y as k,F as T,z as F,A as I,$ as E,B as $,C as j,D as B,E as D,G as L,H as O,I as P,J as R,K as S,L as U,M as q,N as z,O as A,P as G,S as H,Q as J,R as K,T as M,U as N,V as Q,W as V,X as W}from"./index-6faaf734.js";import{D as X,v as Y,_ as Z,a as ee}from"./verify.6d9c56aa.js";import{_ as ae,u as le,g as te,b as se,t as ue,a as ie,c as oe,d as ne}from"./ti-layout-table-list.0eff0c0d.js";const ce=ae({__name:"index",setup(ae){le();const ce=e(!1),ve=e(0),de=e(!0),re=e(!1),fe=e=>{ve.value=e.detail.current,_e(aa.value,ve.value)},_e=(e,a)=>{const l=e[a];"video"==B(l.real_name)?setTimeout((()=>{pe.value=l,be.value=!0,de.value=!1,re.value=!0}),50):re.value=!1},be=e(!1),pe=e(),me=()=>{be.value=!1,de.value=!0,ve.value==aa.value.length-1?(ve.value=0,_e(aa.value,ve.value)):ve.value+=1},he=()=>{re.value?(be.value=!1,de.value=!1):de.value=!1},ye=()=>{re.value?(be.value=!0,de.value=!0):de.value=!0};e(!1);const ge=()=>{Xe()},we=()=>{s({url:"/pages/index/index"})},xe=e(),Ce=e("");e([]);const ke=e(),Te=e(!1),Fe=e({ip:"",port:"",device_id:""}),Ie=()=>{const e=_();Fe.value.ip=(null==e?void 0:e.ip)||b()||"127.0.0.1",Fe.value.port=(null==e?void 0:e.port)||"8080"},Ee=e=>{Fe.value.ip=e},$e=e=>{Fe.value.port=e},je=async()=>{var e;const a={...Fe.value};if(a.ip)if(a.port)try{const l=await L(O(`${null==a?void 0:a.ip}:${a.port}`));P(a),R(l.data.app_id),S(l.data.shop_supplier_id),y(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Te.value=!0}),150)}catch(l){D({title:E("绑定失败"),icon:"none"})}else D({title:E("請輸入連接埠"),icon:"none"});else D({title:E("請輸入伺服器位址"),icon:"none"})},Be=e=>{Te.value=!1,e&&(ke.value=e,Ce.value=e.table_no)},De=()=>{Ie(),Ce.value=p().table_no,ke.value=p()},Le=async()=>{var e;const a={...Fe.value};if(a.ip)if(a.port)try{const l=await L(O(`${null==a?void 0:a.ip}:${a.port}`));if(!ke.value)return void D({title:E("請查找桌位"),icon:"none"});P(a),R(l.data.app_id),S(l.data.shop_supplier_id),y(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Oe()}),150)}catch(l){D({title:E("绑定失败"),icon:"none"})}else D({title:E("請輸入連接埠"),icon:"none"});else D({title:E("請輸入伺服器位址"),icon:"none"})},Oe=async()=>{if(g()===ke.value.table_id)return D({title:E("绑定成功"),icon:"none"}),xe.value=!1,void ye();try{const e=await se({table_id:ke.value.table_id,old_table_id:g()});U(ke.value),ea.value.table_no=ke.value.table_no,la(),D({title:e.msg,icon:"none"}),xe.value=!1}catch(e){}finally{ye()}},Pe=e(),Re=async()=>{if(1===ea.value.is_call_service||1===ea.value.is_customer_order)try{const e=await te({table_id:g()});1===parseInt(e.data.tablet.is_customer_order)?10===e.data.status?Ue():(q(!0),s({url:"/pages/index/opentable-index"})):Pe.value.tiCallClick("1")}catch(e){}},Se=e(!1),Ue=()=>{Se.value=!0,he()},qe=(e,a)=>{e?Me(e,a):D({title:E("請輸入人數"),icon:"none"})},ze=()=>{Se.value=!1,ye()},Ae=e(!1),Ge=e(!1),He=e(),Je=e(null),Ke=e({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),Me=(e,a)=>{if(Ke.value.meal_num=e,Ke.value.is_buffet=a?1:0,a)return Ve();Ne(e,a)},Ne=async(e,a)=>{Ke.value.table_id=g(),Ke.value.meal_num=e,Ke.value.is_buffet=a?1:0;try{await ue(Ke.value);q(!0),s({url:"/pages/index/opentable-index"})}catch(l){}},Qe=e=>{if(!(Ke.value.buffet_ids.length>0&&Je.value!=e.is_comb))if(Je.value=e.is_comb,0==Je.value)Ke.value.buffet_ids=Ke.value.buffet_ids[0]!=e.id?[e.id]:[];else{const a=Ke.value.buffet_ids.indexOf(e.id);if(a>-1)Ke.value.buffet_ids.splice(a,1);else{if(Ke.value.buffet_ids.length>=2)return D({title:E("该类型套餐最多能选择{count}个",{count:2}),icon:"none"});Ke.value.buffet_ids.push(e.id)}}},Ve=()=>{ie().then((e=>{He.value=e.data,He.value&&He.value[0]&&Qe(He.value[0]),Ae.value=!0}))},We=e(!1),Xe=()=>{We.value=!0,he()},Ye=async e=>{if(e)try{await Y({password:e});xe.value=!0,ke.value=p(),Ce.value=ke.value.table_no,Ze()}catch(a){}else D({title:E("請輸入密碼"),icon:"none"})},Ze=()=>{(()=>{We.value=!1;const e=setTimeout((()=>{xe.value?he():ye(),clearTimeout(e)}),300)})()},ea=e({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),aa=e([]),la=async()=>{var e,a,l,t,s,u,i;if(p()){ce.value=!0;try{const o=await m();h(o),ea.value.name=o.data.name,ea.value.logo=o.data.logo,ea.value.is_call_service=parseInt(null==(a=null==(e=null==o?void 0:o.data)?void 0:e.tablet)?void 0:a.is_call_service),ea.value.is_customer_order=parseInt(null==(t=null==(l=null==o?void 0:o.data)?void 0:l.tablet)?void 0:t.is_customer_order),y(null==(s=o.data)?void 0:s.currency),aa.value=(null==(i=null==(u=o.data)?void 0:u.tablet)?void 0:i.carousel)||[],aa.value.length>0&&_e(aa.value,0),ce.value=!1}catch(o){ce.value=!1}finally{ce.value=!1}}};return a((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),u((()=>{l()&&!t()&&(la(),(async()=>{try{const e=await te({table_id:g()});ea.value.table_no=e.data.table_no}catch(e){}})())})),i((()=>{var e;null==(e=Pe.value)||e.showBuffet(!1,0)})),o((()=>{var e;null==(e=Pe.value)||e.showBuffet(!0,0)})),Ie(),n({success:e=>{Fe.value.device_id=e.deviceId}}),(e,a)=>{const s=z(A("ti-layout-head"),Z),u=w,i=G,o=H,n=J,_=K,b=M,p=z(A("ti-input"),oe),m=z(A("ti-layout-table-list"),ne),h=z(A("ti-modal"),ee),y=N;return c(l)()&&!c(t)()?(v(),d(u,{key:0,class:"ti-page",onClick:a[5]||(a[5]=e=>c(j)())},{default:r((()=>[x(u,null,{default:r((()=>[ce.value?f("",!0):(v(),d(s,{key:0,ref_key:"refCallServer",ref:Pe,onDoubleLogo:ge,onRefresh:we,is_call_service:ea.value.is_call_service},null,8,["is_call_service"]))])),_:1}),ce.value?f("",!0):(v(),d(u,{key:0,class:"ti-page-content"},{default:r((()=>[x(u,{class:"ti-page-left"},{default:r((()=>[be.value?f("",!0):(v(),d(n,{key:0,onChange:fe,class:"ti-swiper",current:ve.value,autoplay:de.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:r((()=>[(v(!0),C(T,null,k(aa.value,((e,a)=>(v(),d(o,{class:"ti-swiper-item",key:a},{default:r((()=>["image"===c(B)(e.real_name)?(v(),d(i,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):f("",!0),"video"===c(B)(e.real_name)?(v(),d(i,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):f("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),be.value?(v(),d(n,{key:1,class:"ti-swiper"},{default:r((()=>[x(o,{class:"ti-swiper-item"},{default:r((()=>{var e;return[x(_,{onEnded:me,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=pe.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):f("",!0)])),_:1}),x(u,{class:"ti-page-right"},{default:r((()=>[x(u,{class:"ti-store-box"},{default:r((()=>[x(u,{class:"ti-store-item"},{default:r((()=>[x(i,{class:"ti-store-logo",src:ea.value.logo},null,8,["src"]),x(b,{class:"ti-store-name"},{default:r((()=>[F(I(ea.value.name),1)])),_:1})])),_:1}),x(u,{class:"ti-table-item"},{default:r((()=>[x(u,{class:"ti-table-number"},{default:r((()=>[F(I(c(E)("當前桌號："))+I(ea.value.table_no),1)])),_:1}),x(u,{class:"ti-table-button",onClick:Re},{default:r((()=>[x(b,{class:"ti-table-button-text"},{default:r((()=>[F(I(c(E)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),x(X,{show:Se.value,title:"["+ea.value.table_no+"]"+c(E)("就餐人数"),placeholder:c(E)("請輸入人數"),onExit:ze,onConfirm:qe},null,8,["show","title","placeholder"]),x(X,{show:We.value,title:c(E)("密碼"),password:!0,placeholder:c(E)("請輸入密碼"),onExit:Ze,onConfirm:Ye},null,8,["show","title","placeholder"])])),_:1})),x(h,{show:xe.value,title:c(E)("設置"),cancelText:c(E)("重置"),confirmText:c(E)("確定"),onCancel:De,onConfirm:Le},{content:r((()=>[x(u,{class:"ti-item-input"},{default:r((()=>[x(u,{class:"ti-label-box"},{default:r((()=>[x(u,{class:"ti-label-left"},{default:r((()=>[x(b,{class:"ti-label-server"},{default:r((()=>[F(I(c(E)("服務器連接地址")),1)])),_:1})])),_:1}),x(u,{class:"ti-label-right",onClick:je},{default:r((()=>[x(b,{class:"ti-label-table"},{default:r((()=>[F(I(Ce.value?c(E)("已選 : ")+c($)(Ce.value,19):c(E)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),x(u,{class:"ti-input-box"},{default:r((()=>[x(p,{type:"text",onInput:Ee,value:Fe.value.ip,placeholder:c(E)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),x(u,{class:"ti-colon"},{default:r((()=>[F(":")])),_:1}),x(u,{class:"ti-input-port"},{default:r((()=>[x(p,{type:"number",onInput:$e,value:Fe.value.port,placeholder:c(E)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),x(m,{show:Te.value,"onUpdate:show":a[0]||(a[0]=e=>Te.value=e),onConfirm:Be},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),x(h,{class:"ti-dialog-buffet",show:Ae.value,title:c(E)("自助餐"),onCancel:a[1]||(a[1]=e=>Ae.value=!1),onConfirm:a[2]||(a[2]=e=>(Ae.value=!1,Ge.value=!0))},{content:r((()=>[x(u,{class:"ti-dialog-content"},{default:r((()=>[x(y,{class:"ti-buffet-scroll","scroll-y":""},{default:r((()=>[x(u,{class:"ti-buffet-list"},{default:r((()=>[(v(!0),C(T,null,k(He.value,(e=>(v(),d(u,{key:e.id,class:Q(["ti-buffet-item",{active:Ke.value.buffet_ids.includes(e.id),disabled:Ke.value.buffet_ids.length>0&&Je.value!=e.is_comb}]),onClick:a=>Qe(e)},{default:r((()=>[x(u,{class:"ti-buffet-name"},{default:r((()=>[F(I(e.name_text||e.name),1)])),_:2},1024),x(u,null,{default:r((()=>[x(b,{class:"ti-buffet-price"},{default:r((()=>[F(I(c(V)(e.price)),1)])),_:2},1024),x(b,{class:"ti-buffet-subPrice"},{default:r((()=>[F(I(c(W)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),x(h,{class:"ti-dialog-buffet",show:Ge.value,title:c(E)("提示"),onCancel:a[3]||(a[3]=e=>Ge.value=!1),onConfirm:a[4]||(a[4]=e=>Ne(Ke.value.meal_num,Ke.value.is_buffet))},{content:r((()=>[x(u,{class:"ti-dialog-content"},{default:r((()=>[x(y,{class:"ti-buffet-scroll","scroll-y":""},{default:r((()=>[x(u,{class:"ti-buffet-message"},{default:r((()=>[x(u,{class:"ti-buffet-case"}),x(u,{class:"ti-buffet-text"},{default:r((()=>[F(I(c(E)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),x(u,{class:"ti-buffet-message"},{default:r((()=>[x(u,{class:"ti-buffet-case"}),x(u,{class:"ti-buffet-text"},{default:r((()=>[F(I(c(E)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),x(u,{class:"ti-buffet-message"},{default:r((()=>[x(u,{class:"ti-buffet-case"}),x(u,{class:"ti-buffet-text"},{default:r((()=>[F(I(c(E)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),x(u,{class:"ti-buffet-message"},{default:r((()=>[x(u,{class:"ti-buffet-case"}),x(u,{class:"ti-buffet-text"},{default:r((()=>[F(I(c(E)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),x(u,{class:"ti-buffet-tips"},{default:r((()=>[F(I(c(E)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):f("",!0)}}},[["__scopeId","data-v-5baead92"]]);export{ce as default};
