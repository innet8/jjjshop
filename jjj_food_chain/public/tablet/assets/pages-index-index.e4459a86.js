import{r as a,o as e,i as l,a as t,b as s,c as i,g as u,u as o,d as n,e as c,w as r,f as v,h as d,j as _,k as p,l as f,m,n as b,F as h,p as y,t as w,$ as g,s as x,q as k,v as C,x as F,y as T,z as I,A as j,B as E,S as $,C as N,D,E as B}from"./index-82b9d182.js";import{D as S,v as q,_ as z,a as A}from"./verify.1e3257ad.js";import{_ as L,u as R,g as U,a as G,b as H,s as J,c as K,d as M,e as O,f as P,h as Q,v as V,i as W,j as X,k as Y,t as Z,l as aa,m as ea}from"./baseinfo.fc287b05.js";const la=L({__name:"index",setup(L){R();const la=a(!1),ta=a(0),sa=a(!0),ia=a(!1),ua=a=>{ta.value=a.detail.current,oa(Ga.value,ta.value)},oa=(a,e)=>{const l=a[e];"video"==Q(l.real_name)?setTimeout((()=>{ca.value=l,na.value=!0,sa.value=!1,ia.value=!0}),50):ia.value=!1},na=a(!1),ca=a(),ra=()=>{na.value=!1,sa.value=!0,ta.value==Ga.value.length-1?(ta.value=0,oa(Ga.value,ta.value)):ta.value+=1},va=()=>{ia.value?(na.value=!1,sa.value=!1):sa.value=!1},da=()=>{ia.value?(na.value=!0,sa.value=!0):sa.value=!0};a(!1);const _a=()=>{Aa()},pa=()=>{s({url:"/pages/index/index"})},fa=a(),ma=a("");a([]);const ba=a(),ha=a(!1),ya=a({ip:"",port:"",device_id:""}),wa=()=>{const a=U();ya.value.ip=(null==a?void 0:a.ip)||G()||"127.0.0.1",ya.value.port=(null==a?void 0:a.port)||"8080"},ga=a=>{ya.value.ip=a},xa=a=>{ya.value.port=a},ka=async()=>{var a;const e={...ya.value};if(e.ip)if(e.port)try{const l=await V(W(`${null==e?void 0:e.ip}:${e.port}`));X(e),k(l.data.app_id),C(l.data.shop_supplier_id),K(null==(a=l.data)?void 0:a.currency),setTimeout((()=>{ha.value=!0}),150)}catch(l){x({title:g("绑定失败"),icon:"none"})}else x({title:g("請輸入連接埠"),icon:"none"});else x({title:g("請輸入伺服器位址"),icon:"none"})},Ca=a=>{ha.value=!1,a&&(ba.value=a,ma.value=a.table_no)},Fa=()=>{wa(),ma.value=d().table_no,ba.value=d()},Ta=async()=>{var a;const e={...ya.value};if(e.ip)if(e.port)try{const l=await V(W(`${null==e?void 0:e.ip}:${e.port}`));if(!ba.value)return void x({title:g("請查找桌位"),icon:"none"});X(e),k(l.data.app_id),C(l.data.shop_supplier_id),K(null==(a=l.data)?void 0:a.currency),setTimeout((()=>{Ia()}),150)}catch(l){x({title:g("绑定失败"),icon:"none"})}else x({title:g("請輸入連接埠"),icon:"none"});else x({title:g("請輸入伺服器位址"),icon:"none"})},Ia=async()=>{if(_()===ba.value.table_id)return x({title:g("绑定成功"),icon:"none"}),fa.value=!1,void da();try{const a=await Y({table_id:ba.value.table_id,old_table_id:_()});F(ba.value),Ha(),x({title:a.msg,icon:"none"}),fa.value=!1}catch(a){}finally{da()}},ja=a(),Ea=async()=>{if(1===Ua.value.is_call_service||1===Ua.value.is_customer_order)try{const a=await M({table_id:_()});1===parseInt(a.data.tablet.is_customer_order)?10===a.data.status?Na():(T(!0),s({url:"/pages/index/opentable-index"})):ja.value.tiCallClick("1")}catch(a){}},$a=a(!1),Na=()=>{$a.value=!0,va()},Da=a=>{a?qa(a):x({title:g("請輸入人數"),icon:"none"})},Ba=()=>{$a.value=!1,da()},Sa=a({table_id:"",meal_num:""}),qa=async a=>{Sa.value.table_id=_(),Sa.value.meal_num=a;try{await Z(Sa.value);T(!0),s({url:"/pages/index/opentable-index"})}catch(e){}},za=a(!1),Aa=()=>{za.value=!0,va()},La=async a=>{if(a)try{await q({password:a});fa.value=!0,ba.value=d(),ma.value=ba.value.table_no,Ra()}catch(e){}else x({title:g("請輸入密碼"),icon:"none"})},Ra=()=>{(()=>{za.value=!1;const a=setTimeout((()=>{fa.value?va():da(),clearTimeout(a)}),300)})()},Ua=a({name:"",logo:"",tableNo:"",is_call_service:1,is_customer_order:1}),Ga=a([]),Ha=async()=>{var a,e,l,t,s,i,u;if(d()){la.value=!0;try{const o=await H();J(o),Ua.value.name=o.data.name,Ua.value.logo=o.data.logo,Ua.value.is_call_service=parseInt(null==(e=null==(a=null==o?void 0:o.data)?void 0:a.tablet)?void 0:e.is_call_service),Ua.value.is_customer_order=parseInt(null==(t=null==(l=null==o?void 0:o.data)?void 0:l.tablet)?void 0:t.is_customer_order),K(null==(s=o.data)?void 0:s.currency),Ga.value=(null==(u=null==(i=o.data)?void 0:i.tablet)?void 0:u.carousel)||[],Ga.value.length>0&&oa(Ga.value,0),la.value=!1}catch(o){la.value=!1}finally{la.value=!1}}};return e((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),i((()=>{l()&&!t()&&(Ha(),(async()=>{try{const a=await M({table_id:_()});Ua.value.tableNo=a.data.table_no}catch(a){}})())})),wa(),u({success:a=>{ya.value.device_id=a.deviceId}}),(a,e)=>{const s=I(j("ti-layout-head"),z),i=p,u=E,d=$,_=N,x=D,k=B,C=I(j("ti-input"),aa),F=I(j("ti-modal"),A),T=I(j("ti-layout-table-list"),ea);return o(l)()&&!o(t)()?(n(),c(i,{key:0,class:"ti-page",onClick:e[1]||(e[1]=a=>o(P)())},{default:r((()=>[f(i,null,{default:r((()=>[la.value?v("",!0):(n(),c(s,{key:0,ref_key:"refCallServer",ref:ja,onDoubleLogo:_a,onRefresh:pa,is_call_service:Ua.value.is_call_service},null,8,["is_call_service"]))])),_:1}),la.value?v("",!0):(n(),c(i,{key:0,class:"ti-page-content"},{default:r((()=>[f(i,{class:"ti-page-left"},{default:r((()=>[na.value?v("",!0):(n(),c(_,{key:0,onChange:ua,class:"ti-swiper",current:ta.value,autoplay:sa.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:r((()=>[(n(!0),m(h,null,b(Ga.value,((a,e)=>(n(),c(d,{class:"ti-swiper-item",key:e},{default:r((()=>["image"===o(Q)(a.real_name)?(n(),c(u,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:a.file_path},null,8,["src"])):v("",!0),"video"===o(Q)(a.real_name)?(n(),c(u,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):v("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),na.value?(n(),c(_,{key:1,class:"ti-swiper"},{default:r((()=>[f(d,{class:"ti-swiper-item"},{default:r((()=>{var a;return[f(x,{onEnded:ra,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(a=ca.value)?void 0:a.file_path},null,8,["src"])]})),_:1})])),_:1})):v("",!0)])),_:1}),f(i,{class:"ti-page-right"},{default:r((()=>[f(i,{class:"ti-store-box"},{default:r((()=>[f(i,{class:"ti-store-item"},{default:r((()=>[f(u,{class:"ti-store-logo",src:Ua.value.logo},null,8,["src"]),f(k,{class:"ti-store-name"},{default:r((()=>[y(w(Ua.value.name),1)])),_:1})])),_:1}),f(i,{class:"ti-table-item"},{default:r((()=>[f(i,{class:"ti-table-number"},{default:r((()=>[y(w(o(g)("當前桌號："))+w(Ua.value.tableNo),1)])),_:1}),f(i,{class:"ti-table-button",onClick:Ea},{default:r((()=>[f(k,{class:"ti-table-button-text"},{default:r((()=>[y(w(o(g)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),f(S,{show:$a.value,title:"["+Ua.value.tableNo+"]"+o(g)("就餐人数"),placeholder:o(g)("請輸入人數"),onExit:Ba,onConfirm:Da},null,8,["show","title","placeholder"]),f(S,{show:za.value,title:o(g)("密碼"),password:!0,placeholder:o(g)("請輸入密碼"),onExit:Ra,onConfirm:La},null,8,["show","title","placeholder"])])),_:1})),f(F,{show:fa.value,title:o(g)("設置"),cancelText:o(g)("重置"),confirmText:o(g)("確定"),onCancel:Fa,onConfirm:Ta},{content:r((()=>[f(i,{class:"ti-item-input"},{default:r((()=>[f(i,{class:"ti-label-box"},{default:r((()=>[f(i,{class:"ti-label-left"},{default:r((()=>[f(k,{class:"ti-label-server"},{default:r((()=>[y(w(o(g)("服務器連接地址")),1)])),_:1})])),_:1}),f(i,{class:"ti-label-right",onClick:ka},{default:r((()=>[f(k,{class:"ti-label-table"},{default:r((()=>[y(w(ma.value?o(g)("已選 : ")+o(O)(ma.value,19):o(g)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),f(i,{class:"ti-input-box"},{default:r((()=>[f(C,{type:"text",onInput:ga,value:ya.value.ip,placeholder:o(g)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),f(i,{class:"ti-colon"},{default:r((()=>[y(":")])),_:1}),f(i,{class:"ti-input-port"},{default:r((()=>[f(C,{type:"number",onInput:xa,value:ya.value.port,placeholder:o(g)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),f(T,{show:ha.value,"onUpdate:show":e[0]||(e[0]=a=>ha.value=a),onConfirm:Ca},null,8,["show"])])),_:1})):v("",!0)}}},[["__scopeId","data-v-d6b1c9f4"]]);export{la as default};
