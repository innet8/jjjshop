import{r as e,o as a,i as l,a as t,b as s,c as u,g as i,u as o,d as n,e as c,w as v,f as d,h as r,j as f,k as _,l as b,m as p,n as m,p as h,F as y,q as g,t as w,$ as x,s as C,v as k,x as F,y as T,z as I,A as j,B as E,C as $,D,E as B,S,G as q,H as z,I as A,J as G,K as H}from"./index-ee424dcb.js";import{D as J,v as K,_ as L,a as O}from"./verify.0f880a5e.js";import{_ as P,u as R,g as U,a as M,s as N,b as Q,c as V,d as W,e as X,f as Y,v as Z,h as ee,t as ae,i as le,j as te,k as se,l as ue,m as ie}from"./baseinfo.fd096d53.js";const oe=P({__name:"index",setup(P){R();const oe=e(!1),ne=e(0),ce=e(!0),ve=e(!1),de=e=>{ne.value=e.detail.current,re(Ze.value,ne.value)},re=(e,a)=>{const l=e[a];"video"==Y(l.real_name)?setTimeout((()=>{_e.value=l,fe.value=!0,ce.value=!1,ve.value=!0}),50):ve.value=!1},fe=e(!1),_e=e(),be=()=>{fe.value=!1,ce.value=!0,ne.value==Ze.value.length-1?(ne.value=0,re(Ze.value,ne.value)):ne.value+=1},pe=()=>{ve.value?(fe.value=!1,ce.value=!1):ce.value=!1},me=()=>{ve.value?(fe.value=!0,ce.value=!0):ce.value=!0};e(!1);const he=()=>{Ve()},ye=()=>{s({url:"/pages/index/index"})},ge=e(),we=e("");e([]);const xe=e(),Ce=e(!1),ke=e({ip:"",port:"",device_id:""}),Fe=()=>{const e=r();ke.value.ip=(null==e?void 0:e.ip)||U()||"127.0.0.1",ke.value.port=(null==e?void 0:e.port)||"8080"},Te=e=>{ke.value.ip=e},Ie=e=>{ke.value.port=e},je=async()=>{var e;const a={...ke.value};if(a.ip)if(a.port)try{const l=await Z(k(`${null==a?void 0:a.ip}:${a.port}`));F(a),T(l.data.app_id),I(l.data.shop_supplier_id),Q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Ce.value=!0}),150)}catch(l){C({title:x("绑定失败"),icon:"none"})}else C({title:x("請輸入連接埠"),icon:"none"});else C({title:x("請輸入伺服器位址"),icon:"none"})},Ee=e=>{Ce.value=!1,e&&(xe.value=e,we.value=e.table_no)},$e=()=>{Fe(),we.value=f().table_no,xe.value=f()},De=async()=>{var e;const a={...ke.value};if(a.ip)if(a.port)try{const l=await Z(k(`${null==a?void 0:a.ip}:${a.port}`));if(!xe.value)return void C({title:x("請查找桌位"),icon:"none"});F(a),T(l.data.app_id),I(l.data.shop_supplier_id),Q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Be()}),150)}catch(l){C({title:x("绑定失败"),icon:"none"})}else C({title:x("請輸入連接埠"),icon:"none"});else C({title:x("請輸入伺服器位址"),icon:"none"})},Be=async()=>{if(_()===xe.value.table_id)return C({title:x("绑定成功"),icon:"none"}),ge.value=!1,void me();try{const e=await ee({table_id:xe.value.table_id,old_table_id:_()});j(xe.value),Ye.value.table_no=xe.value.table_no,ea(),C({title:e.msg,icon:"none"}),ge.value=!1}catch(e){}finally{me()}},Se=e(),qe=async()=>{if(1===Ye.value.is_call_service||1===Ye.value.is_customer_order)try{const e=await V({table_id:_()});1===parseInt(e.data.tablet.is_customer_order)?10===e.data.status?Ae():(E(!0),s({url:"/pages/index/opentable-index"})):Se.value.tiCallClick("1")}catch(e){}},ze=e(!1),Ae=()=>{ze.value=!0,pe()},Ge=(e,a)=>{e?Re(e,a):C({title:x("請輸入人數"),icon:"none"})},He=()=>{ze.value=!1,me()},Je=e(!1),Ke=e(!1),Le=e(),Oe=e(null),Pe=e({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),Re=(e,a)=>{if(Pe.value.meal_num=e,Pe.value.is_buffet=a?1:0,a)return Ne();Ue(e,a)},Ue=async(e,a)=>{Pe.value.table_id=_(),Pe.value.meal_num=e,Pe.value.is_buffet=a?1:0;try{await ae(Pe.value);E(!0),s({url:"/pages/index/opentable-index"})}catch(l){}},Me=e=>{if(!(Pe.value.buffet_ids.length>0&&Oe.value!=e.is_comb))if(Oe.value=e.is_comb,0==Oe.value)Pe.value.buffet_ids=Pe.value.buffet_ids[0]!=e.id?[e.id]:[];else{const a=Pe.value.buffet_ids.indexOf(e.id);if(a>-1)Pe.value.buffet_ids.splice(a,1);else{if(Pe.value.buffet_ids.length>=2)return C({title:x("该类型套餐最多能选择{count}个",{count:2}),icon:"none"});Pe.value.buffet_ids.push(e.id)}}},Ne=()=>{le().then((e=>{Le.value=e.data,Le.value&&Le.value[0]&&Me(Le.value[0]),Je.value=!0}))},Qe=e(!1),Ve=()=>{Qe.value=!0,pe()},We=async e=>{if(e)try{await K({password:e});ge.value=!0,xe.value=f(),we.value=xe.value.table_no,Xe()}catch(a){}else C({title:x("請輸入密碼"),icon:"none"})},Xe=()=>{(()=>{Qe.value=!1;const e=setTimeout((()=>{ge.value?pe():me(),clearTimeout(e)}),300)})()},Ye=e({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),Ze=e([]),ea=async()=>{var e,a,l,t,s,u,i;if(f()){oe.value=!0;try{const o=await M();N(o),Ye.value.name=o.data.name,Ye.value.logo=o.data.logo,Ye.value.is_call_service=parseInt(null==(a=null==(e=null==o?void 0:o.data)?void 0:e.tablet)?void 0:a.is_call_service),Ye.value.is_customer_order=parseInt(null==(t=null==(l=null==o?void 0:o.data)?void 0:l.tablet)?void 0:t.is_customer_order),Q(null==(s=o.data)?void 0:s.currency),Ze.value=(null==(i=null==(u=o.data)?void 0:u.tablet)?void 0:i.carousel)||[],Ze.value.length>0&&re(Ze.value,0),oe.value=!1}catch(o){oe.value=!1}finally{oe.value=!1}}};return a((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),u((()=>{l()&&!t()&&(ea(),(async()=>{try{const e=await V({table_id:_()});Ye.value.table_no=e.data.table_no}catch(e){}})())})),Fe(),i({success:e=>{ke.value.device_id=e.deviceId}}),(e,a)=>{const s=$(D("ti-layout-head"),L),u=b,i=B,r=S,f=q,_=z,C=A,k=$(D("ti-input"),te),F=$(D("ti-layout-table-list"),se),T=$(D("ti-modal"),O),I=G;return o(l)()&&!o(t)()?(n(),c(u,{key:0,class:"ti-page",onClick:a[5]||(a[5]=e=>o(X)())},{default:v((()=>[p(u,null,{default:v((()=>[oe.value?d("",!0):(n(),c(s,{key:0,ref_key:"refCallServer",ref:Se,onDoubleLogo:he,onRefresh:ye,is_call_service:Ye.value.is_call_service},null,8,["is_call_service"]))])),_:1}),oe.value?d("",!0):(n(),c(u,{key:0,class:"ti-page-content"},{default:v((()=>[p(u,{class:"ti-page-left"},{default:v((()=>[fe.value?d("",!0):(n(),c(f,{key:0,onChange:de,class:"ti-swiper",current:ne.value,autoplay:ce.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:v((()=>[(n(!0),m(y,null,h(Ze.value,((e,a)=>(n(),c(r,{class:"ti-swiper-item",key:a},{default:v((()=>["image"===o(Y)(e.real_name)?(n(),c(i,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):d("",!0),"video"===o(Y)(e.real_name)?(n(),c(i,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):d("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),fe.value?(n(),c(f,{key:1,class:"ti-swiper"},{default:v((()=>[p(r,{class:"ti-swiper-item"},{default:v((()=>{var e;return[p(_,{onEnded:be,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=_e.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):d("",!0)])),_:1}),p(u,{class:"ti-page-right"},{default:v((()=>[p(u,{class:"ti-store-box"},{default:v((()=>[p(u,{class:"ti-store-item"},{default:v((()=>[p(i,{class:"ti-store-logo",src:Ye.value.logo},null,8,["src"]),p(C,{class:"ti-store-name"},{default:v((()=>[g(w(Ye.value.name),1)])),_:1})])),_:1}),p(u,{class:"ti-table-item"},{default:v((()=>[p(u,{class:"ti-table-number"},{default:v((()=>[g(w(o(x)("當前桌號："))+w(Ye.value.table_no),1)])),_:1}),p(u,{class:"ti-table-button",onClick:qe},{default:v((()=>[p(C,{class:"ti-table-button-text"},{default:v((()=>[g(w(o(x)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),p(J,{show:ze.value,title:"["+Ye.value.table_no+"]"+o(x)("就餐人数"),placeholder:o(x)("請輸入人數"),onExit:He,onConfirm:Ge},null,8,["show","title","placeholder"]),p(J,{show:Qe.value,title:o(x)("密碼"),password:!0,placeholder:o(x)("請輸入密碼"),onExit:Xe,onConfirm:We},null,8,["show","title","placeholder"])])),_:1})),p(T,{show:ge.value,title:o(x)("設置"),cancelText:o(x)("重置"),confirmText:o(x)("確定"),onCancel:$e,onConfirm:De},{content:v((()=>[p(u,{class:"ti-item-input"},{default:v((()=>[p(u,{class:"ti-label-box"},{default:v((()=>[p(u,{class:"ti-label-left"},{default:v((()=>[p(C,{class:"ti-label-server"},{default:v((()=>[g(w(o(x)("服務器連接地址")),1)])),_:1})])),_:1}),p(u,{class:"ti-label-right",onClick:je},{default:v((()=>[p(C,{class:"ti-label-table"},{default:v((()=>[g(w(we.value?o(x)("已選 : ")+o(W)(we.value,19):o(x)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),p(u,{class:"ti-input-box"},{default:v((()=>[p(k,{type:"text",onInput:Te,value:ke.value.ip,placeholder:o(x)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),p(u,{class:"ti-colon"},{default:v((()=>[g(":")])),_:1}),p(u,{class:"ti-input-port"},{default:v((()=>[p(k,{type:"number",onInput:Ie,value:ke.value.port,placeholder:o(x)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),p(F,{show:Ce.value,"onUpdate:show":a[0]||(a[0]=e=>Ce.value=e),onConfirm:Ee},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),p(T,{class:"ti-dialog-buffet",show:Je.value,title:o(x)("自助餐"),onCancel:a[1]||(a[1]=e=>Je.value=!1),onConfirm:a[2]||(a[2]=e=>(Je.value=!1,Ke.value=!0))},{content:v((()=>[p(u,{class:"ti-dialog-content"},{default:v((()=>[p(I,{class:"ti-buffet-scroll","scroll-y":""},{default:v((()=>[p(u,{class:"ti-buffet-list"},{default:v((()=>[(n(!0),m(y,null,h(Le.value,(e=>(n(),c(u,{key:e.id,class:H(["ti-buffet-item",{active:Pe.value.buffet_ids.includes(e.id),disabled:Pe.value.buffet_ids.length>0&&Oe.value!=e.is_comb}]),onClick:a=>Me(e)},{default:v((()=>[p(u,{class:"ti-buffet-name"},{default:v((()=>[g(w(e.name_text||e.name),1)])),_:2},1024),p(u,null,{default:v((()=>[p(C,{class:"ti-buffet-price"},{default:v((()=>[g(w(o(ue)(e.price)),1)])),_:2},1024),p(C,{class:"ti-buffet-subPrice"},{default:v((()=>[g(w(o(ie)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),p(T,{class:"ti-dialog-buffet",show:Ke.value,title:o(x)("提示"),onCancel:a[3]||(a[3]=e=>Ke.value=!1),onConfirm:a[4]||(a[4]=e=>Ue(Pe.value.meal_num,Pe.value.is_buffet))},{content:v((()=>[p(u,{class:"ti-dialog-content"},{default:v((()=>[p(I,{class:"ti-buffet-scroll","scroll-y":""},{default:v((()=>[p(u,{class:"ti-buffet-message"},{default:v((()=>[p(u,{class:"ti-buffet-case"}),p(u,{class:"ti-buffet-text"},{default:v((()=>[g(w(o(x)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),p(u,{class:"ti-buffet-message"},{default:v((()=>[p(u,{class:"ti-buffet-case"}),p(u,{class:"ti-buffet-text"},{default:v((()=>[g(w(o(x)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),p(u,{class:"ti-buffet-message"},{default:v((()=>[p(u,{class:"ti-buffet-case"}),p(u,{class:"ti-buffet-text"},{default:v((()=>[g(w(o(x)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),p(u,{class:"ti-buffet-message"},{default:v((()=>[p(u,{class:"ti-buffet-case"}),p(u,{class:"ti-buffet-text"},{default:v((()=>[g(w(o(x)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),p(u,{class:"ti-buffet-tips"},{default:v((()=>[g(w(o(x)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):d("",!0)}}},[["__scopeId","data-v-acbb28dc"]]);export{oe as default};
