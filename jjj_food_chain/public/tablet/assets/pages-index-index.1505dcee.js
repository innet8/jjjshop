import{u as e,a,s as l,r as t,o as s,i as u,b as i,c as o,d as n,e as c,f as r,g as f,h as v,j as d,k as _,w as b,l as p,m,n as h,p as y,q as g,t as w,v as x,x as C,y as k,z as T,F as I,A as F,B as E,$,C as j,D as B,E as U,G as D,H as A,I as L,J as O,K as P,L as R,M as S,N as q,O as z,P as G,Q as H,R as J,S as K,T as M,U as N,V as Q,W as V,X as W,Y as X,Z as Y,_ as Z,a0 as ee,a1 as ae,a2 as le}from"./index-a5eaf4b9.js";import{D as te,v as se,_ as ue,a as ie}from"./verify.443d0c85.js";import{_ as oe,u as ne,a as ce,b as re}from"./ti-layout-table-list.36a270fb.js";const fe=oe({__name:"index",setup(oe){const fe=e(),ve=a(),{userInfo:de}=l(fe),{tableInfo:_e}=l(ve);ne();const{getUserInfo:be,setUserInfo:pe}=e(),{getTableInfoAsync:me}=a();be(),me();const he=t(!1),ye=t(0),ge=t(!0),we=t(!1),xe=e=>{var a,l;ye.value=e.detail.current,Ce(null==(l=null==(a=de.value)?void 0:a.tablet)?void 0:l.carousel,ye.value)},Ce=(e,a)=>{const l=e[a];"video"==U(l.real_name)?setTimeout((()=>{Te.value=l,ke.value=!0,ge.value=!1,we.value=!0}),50):we.value=!1},ke=t(!1),Te=t(),Ie=()=>{var e,a,l,t;ke.value=!1,ge.value=!0,ye.value==(null==(a=null==(e=de.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(ye.value=0,Ce(null==(t=null==(l=de.value)?void 0:l.tablet)?void 0:t.carousel,ye.value)):ye.value+=1},Fe=()=>{we.value?(ke.value=!1,ge.value=!1):ge.value=!1},Ee=()=>{we.value?(ke.value=!0,ge.value=!0):ge.value=!0};t(!1);const $e=()=>{oa()},je=()=>{o({url:"/pages/index/index"})},Be=t(),Ue=t("");t([]);const De=t(),Ae=t(!1),Le=t({ip:"",port:"",device_id:""}),Oe=()=>{const e=m();Le.value.ip=(null==e?void 0:e.ip)||h()||"127.0.0.1",Le.value.port=(null==e?void 0:e.port)||"8080"},Pe=e=>{Le.value.ip=e},Re=e=>{Le.value.port=e},Se=async()=>{var e;const a={...Le.value};if(a.ip)if(a.port)try{const l=await A(L(`${null==a?void 0:a.ip}:${a.port}`));O(a),P(l.data.app_id),R(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Ae.value=!0}),150)}catch(l){D({title:$("绑定失败"),icon:"none"})}else D({title:$("請輸入連接埠"),icon:"none"});else D({title:$("請輸入伺服器位址"),icon:"none"})},qe=e=>{Ae.value=!1,e&&(De.value=e,Ue.value=e.table_no)},ze=()=>{Oe(),Ue.value=y().table_no,De.value=y()},Ge=async()=>{var e;const a={...Le.value};if(a.ip)if(a.port)try{const l=await A(L(`${null==a?void 0:a.ip}:${a.port}`));if(!De.value)return void D({title:$("請查找桌位"),icon:"none"});O(a),P(l.data.app_id),R(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{He()}),150)}catch(l){D({title:$("绑定失败"),icon:"none"})}else D({title:$("請輸入連接埠"),icon:"none"});else D({title:$("請輸入伺服器位址"),icon:"none"})},He=async()=>{if(w()===De.value.table_id)return D({title:$("绑定成功"),icon:"none"}),Be.value=!1,void Ee();try{const e=await q({table_id:De.value.table_id,old_table_id:w()});z(De.value),be(),me(),D({title:e.msg,icon:"none"}),Be.value=!1}catch(e){}finally{Ee()}},Je=t(),Ke=t(!1),Me=async()=>{var e,a;if(1===parseInt(null==(e=null==de?void 0:de.value)?void 0:e.tablet.is_customer_order)){be();try{const e=await g({table_id:w()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)Ve();else{if(1==(null==(a=e.data.order)?void 0:a.is_buffet))return Ke.value=!0,void(Ze.value=!0);Ne()}else Je.value.tiCallClick("1")}catch(l){}}},Ne=()=>{G(!0),o({url:"/pages/index/opentable-index"})},Qe=t(!1),Ve=()=>{Qe.value=!0,Fe()},We=(e,a)=>{e?ta(e,a):D({title:$("請輸入人數"),icon:"none"})},Xe=()=>{Qe.value=!1,Ee()},Ye=t(!1),Ze=t(!1),ea=t(),aa=t(null),la=t({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),ta=(e,a)=>{if(la.value.meal_num=e,la.value.is_buffet=a?1:0,a)return ua();sa(e,a)},sa=async(e,a)=>{if(1!=Ke.value){la.value.table_id=w(),la.value.meal_num=e,la.value.is_buffet=a?1:0;try{await H(la.value);Ne()}catch(l){}}else Ne()},ua=()=>{J().then((e=>{ea.value=e.data,Ye.value=!0}))},ia=t(!1),oa=()=>{ia.value=!0,Fe()},na=async e=>{if(e)try{await se({password:e});Be.value=!0,De.value=y(),Ue.value=De.value.table_no,ca()}catch(a){}else D({title:$("請輸入密碼"),icon:"none"})},ca=()=>{(()=>{ia.value=!1;const e=setTimeout((()=>{Be.value?Fe():Ee(),clearTimeout(e)}),300)})()},ra=t({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1});t([]);return s((()=>{u()&&i()&&o({url:"/pages/index/opentable-index"})})),n((()=>{u()&&!i()&&((async()=>{y()&&be()})(),(async()=>{try{const e=await g({table_id:w()});ra.value.table_no=e.data.table_no}catch(e){}})())})),c((()=>{var e;null==(e=Je.value)||e.showBuffet(!1,0)})),r((()=>{var e;null==(e=Je.value)||e.showBuffet(!0,0)})),Oe(),f({success:e=>{Le.value.device_id=e.deviceId}}),(e,a)=>{const l=K(M("ti-layout-head"),ue),t=x,s=N,o=Q,n=V,c=W,r=X,f=K(M("ti-input"),ce),m=K(M("ti-layout-table-list"),re),h=K(M("ti-modal"),ie),y=Y;return v(u)()&&!v(i)()?(d(),_(t,{key:0,class:"ti-page",onClick:a[5]||(a[5]=e=>v(B)())},{default:b((()=>[C(t,null,{default:b((()=>{var e;return[he.value?p("",!0):(d(),_(l,{key:0,ref_key:"refCallServer",ref:Je,onDoubleLogo:$e,onRefresh:je,is_call_service:null==(e=v(de))?void 0:e.tablet.is_call_service},null,8,["is_call_service"]))]})),_:1}),he.value?p("",!0):(d(),_(t,{key:0,class:"ti-page-content"},{default:b((()=>{var e;return[C(t,{class:"ti-page-left"},{default:b((()=>[ke.value?p("",!0):(d(),_(n,{key:0,onChange:xe,class:"ti-swiper",current:ye.value,autoplay:ge.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:b((()=>{var e,a;return[(d(!0),k(I,null,T(null==(a=null==(e=v(de))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(d(),_(o,{class:"ti-swiper-item",key:a},{default:b((()=>["image"===v(U)(e.real_name)?(d(),_(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):p("",!0),"video"===v(U)(e.real_name)?(d(),_(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):p("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),ke.value?(d(),_(n,{key:1,class:"ti-swiper"},{default:b((()=>[C(o,{class:"ti-swiper-item"},{default:b((()=>{var e;return[C(c,{onEnded:Ie,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=Te.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):p("",!0)])),_:1}),C(t,{class:"ti-page-right"},{default:b((()=>[C(t,{class:"ti-store-box"},{default:b((()=>[C(t,{class:"ti-store-item"},{default:b((()=>{var e;return[C(s,{class:"ti-store-logo",src:null==(e=v(de))?void 0:e.logo},null,8,["src"]),C(r,{class:"ti-store-name"},{default:b((()=>{var e;return[F(E(null==(e=v(de))?void 0:e.name),1)]})),_:1})]})),_:1}),C(t,{class:"ti-table-item"},{default:b((()=>[C(t,{class:"ti-table-number"},{default:b((()=>{var e;return[F(E(v($)("當前桌號："))+E(null==(e=v(_e))?void 0:e.table_no),1)]})),_:1}),C(t,{class:"ti-table-button",onClick:Me},{default:b((()=>[C(r,{class:"ti-table-button-text"},{default:b((()=>[F(E(v($)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),C(te,{show:Qe.value,title:"["+(null==(e=v(_e))?void 0:e.table_no)+"]"+v($)("就餐人数"),placeholder:v($)("請輸入人數"),onExit:Xe,onConfirm:We},null,8,["show","title","placeholder"]),C(te,{show:ia.value,title:v($)("密碼"),password:!0,placeholder:v($)("請輸入密碼"),onExit:ca,onConfirm:na},null,8,["show","title","placeholder"])]})),_:1})),C(h,{show:Be.value,title:v($)("設置"),cancelText:v($)("重置"),confirmText:v($)("確定"),onCancel:ze,onConfirm:Ge},{content:b((()=>[C(t,{class:"ti-item-input"},{default:b((()=>[C(t,{class:"ti-label-box"},{default:b((()=>[C(t,{class:"ti-label-left"},{default:b((()=>[C(r,{class:"ti-label-server"},{default:b((()=>[F(E(v($)("服務器連接地址")),1)])),_:1})])),_:1}),C(t,{class:"ti-label-right",onClick:Se},{default:b((()=>[C(r,{class:"ti-label-table"},{default:b((()=>[F(E(Ue.value?v($)("已選 : ")+v(j)(Ue.value,19):v($)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),C(t,{class:"ti-input-box"},{default:b((()=>[C(f,{type:"text",onInput:Pe,value:Le.value.ip,placeholder:v($)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),C(t,{class:"ti-colon"},{default:b((()=>[F(":")])),_:1}),C(t,{class:"ti-input-port"},{default:b((()=>[C(f,{type:"number",onInput:Re,value:Le.value.port,placeholder:v($)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),C(m,{show:Ae.value,"onUpdate:show":a[0]||(a[0]=e=>Ae.value=e),onConfirm:qe},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),C(h,{class:"ti-dialog-buffet",show:Ye.value,title:v($)("自助餐"),onCancel:a[1]||(a[1]=e=>(la.value.buffet_ids=[],Ye.value=!1)),onConfirm:a[2]||(a[2]=e=>(Ye.value=!1,Ze.value=!0))},{content:b((()=>[C(t,{class:"ti-dialog-content"},{default:b((()=>[C(y,{class:"ti-buffet-scroll","scroll-y":""},{default:b((()=>[C(t,{class:"ti-buffet-list"},{default:b((()=>[(d(!0),k(I,null,T(ea.value,(e=>(d(),_(t,{key:e.id,class:Z(["ti-buffet-item",{active:la.value.buffet_ids.includes(e.id),disabled:la.value.buffet_ids.length>0&&aa.value!=e.is_comb}]),onClick:a=>(e=>{if(!(la.value.buffet_ids.length>0&&aa.value!=e.is_comb))if(aa.value=e.is_comb,0==aa.value)la.value.buffet_ids=la.value.buffet_ids[0]!=e.id?[e.id]:[];else{const a=la.value.buffet_ids.indexOf(e.id);if(a>-1)la.value.buffet_ids.splice(a,1);else{if(la.value.buffet_ids.length>=2)return D({title:le("最多只能选择{count}个",{count:2}),icon:"none"});la.value.buffet_ids.push(e.id)}}})(e)},{default:b((()=>[C(t,{class:"ti-buffet-name"},{default:b((()=>[F(E(e.name_text||e.name),1)])),_:2},1024),C(t,null,{default:b((()=>[C(r,{class:"ti-buffet-price"},{default:b((()=>[F(E(v(ee)(e.price)),1)])),_:2},1024),C(r,{class:"ti-buffet-subPrice"},{default:b((()=>[F(E(v(ae)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),C(h,{class:"ti-dialog-buffet",show:Ze.value,title:v($)("提示"),onCancel:a[3]||(a[3]=e=>(Ze.value=!1,Ke.value=!1)),onConfirm:a[4]||(a[4]=e=>sa(la.value.meal_num,la.value.is_buffet))},{content:b((()=>[C(t,{class:"ti-dialog-content"},{default:b((()=>[C(y,{class:"ti-buffet-scroll","scroll-y":""},{default:b((()=>[C(t,{class:"ti-buffet-message"},{default:b((()=>[C(t,{class:"ti-buffet-case"}),C(t,{class:"ti-buffet-text"},{default:b((()=>[F(E(v($)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),C(t,{class:"ti-buffet-message"},{default:b((()=>[C(t,{class:"ti-buffet-case"}),C(t,{class:"ti-buffet-text"},{default:b((()=>[F(E(v($)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),C(t,{class:"ti-buffet-message"},{default:b((()=>[C(t,{class:"ti-buffet-case"}),C(t,{class:"ti-buffet-text"},{default:b((()=>[F(E(v($)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),C(t,{class:"ti-buffet-message"},{default:b((()=>[C(t,{class:"ti-buffet-case"}),C(t,{class:"ti-buffet-text"},{default:b((()=>[F(E(v($)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),C(t,{class:"ti-buffet-tips"},{default:b((()=>[F(E(v($)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):p("",!0)}}},[["__scopeId","data-v-f57ad525"]]);export{fe as default};
