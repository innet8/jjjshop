import{u as e,a as l,s as a,r as t,o as s,i,b as u,c as n,d as o,e as c,g as r,f as d,h as f,j as v,w as _,k as b,l as p,m,n as h,p as y,q as g,t as w,v as x,x as C,y as k,F as T,z as I,A as F,$ as E,B as $,C as j,D as U,E as B,G as D,H as A,I as L,J as O,K as P,L as R,M as S,N as q,O as z,P as G,Q as H,R as J,S as K,T as M,U as N,V as Q,W as V,X as W,Y as X,Z as Y,_ as Z,a0 as ee,a1 as le}from"./index-672cef7c.js";import{D as ae,v as te,_ as se,a as ie}from"./verify.93dced36.js";import{_ as ue,u as ne,a as oe,b as ce}from"./ti-layout-table-list.b289929a.js";const re=ue({__name:"index",setup(ue){const re=e(),de=l(),{userInfo:fe}=a(re),{tableInfo:ve}=a(de);ne();const{getUserInfo:_e,setUserInfo:be}=e(),{getTableInfoAsync:pe}=l();_e(),pe();const me=t(!1),he=t(0),ye=t(!0),ge=t(!1),we=e=>{var l,a;he.value=e.detail.current,xe(null==(a=null==(l=fe.value)?void 0:l.tablet)?void 0:a.carousel,he.value)},xe=(e,l)=>{const a=e[l];"video"==U(a.real_name)?setTimeout((()=>{ke.value=a,Ce.value=!0,ye.value=!1,ge.value=!0}),50):ge.value=!1},Ce=t(!1),ke=t(),Te=()=>{var e,l,a,t;Ce.value=!1,ye.value=!0,he.value==(null==(l=null==(e=fe.value)?void 0:e.tablet)?void 0:l.carousel.length)-1?(he.value=0,xe(null==(t=null==(a=fe.value)?void 0:a.tablet)?void 0:t.carousel,he.value)):he.value+=1};t(!1);const Ie=()=>{sl()},Fe=()=>{n({url:"/pages/index/index"})},Ee=t(),$e=t("");t([]);const je=t(),Ue=t(!1),Be=t({ip:"",port:"",device_id:""}),De=()=>{const e=p();Be.value.ip=(null==e?void 0:e.ip)||m()||"127.0.0.1",Be.value.port=(null==e?void 0:e.port)||"8080"},Ae=e=>{Be.value.ip=e},Le=e=>{Be.value.port=e},Oe=async()=>{var e;const l={...Be.value};if(l.ip)if(l.port)try{const a=await D(A(`${null==l?void 0:l.ip}:${l.port}`));L(l),O(a.data.app_id),P(a.data.shop_supplier_id),R(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{Ue.value=!0}),150)}catch(a){B({title:E("绑定失败"),icon:"none"})}else B({title:E("請輸入連接埠"),icon:"none"});else B({title:E("請輸入伺服器位址"),icon:"none"})},Pe=e=>{Ue.value=!1,e&&(je.value=e,$e.value=e.table_no)},Re=()=>{De(),$e.value=h().table_no,je.value=h()},Se=async()=>{var e;const l={...Be.value};if(l.ip)if(l.port)try{const a=await D(A(`${null==l?void 0:l.ip}:${l.port}`));if(!je.value)return void B({title:E("請查找桌位"),icon:"none"});L(l),O(a.data.app_id),P(a.data.shop_supplier_id),R(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{qe()}),150)}catch(a){B({title:E("绑定失败"),icon:"none"})}else B({title:E("請輸入連接埠"),icon:"none"});else B({title:E("請輸入伺服器位址"),icon:"none"})},qe=async()=>{if(g()===je.value.table_id)return B({title:E("绑定成功"),icon:"none"}),void(Ee.value=!1);try{const e=await S({table_id:je.value.table_id,old_table_id:g()});q(je.value),_e(),pe(),B({title:e.msg,icon:"none"}),Ee.value=!1}catch(e){}},ze=t(),Ge=t(!1),He=async()=>{var e,l,a,t;if(1===parseInt(null==(e=null==fe?void 0:fe.value)?void 0:e.tablet.is_customer_order)){_e();try{const e=await y({table_id:g()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)Me();else{if(1==(null==(a=e.data.order)?void 0:a.is_buffet))return Ge.value=!0,void(We.value=!0);Je()}else null==(t=ze.value)||t.tiCallClick("1")}catch(s){}}else null==(l=ze.value)||l.tiCallClick("1")},Je=()=>{z(!0),n({url:"/pages/index/opentable-index"})},Ke=t(!1),Me=()=>{Ke.value=!0},Ne=(e,l)=>{e?el(e,l):B({title:E("請輸入人數"),icon:"none"})},Qe=()=>{Ke.value=!1},Ve=t(!1),We=t(!1),Xe=t(),Ye=t(null),Ze=t({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),el=(e,l)=>{if(Ze.value.meal_num=e,Ze.value.is_buffet=l?1:0,l)return al();ll(e,l)},ll=async(e,l)=>{if(1!=Ge.value){Ze.value.table_id=g(),Ze.value.meal_num=e,Ze.value.is_buffet=l?1:0;try{await G(Ze.value);Je()}catch(a){}}else Je()},al=()=>{H().then((e=>{Xe.value=e.data,Ve.value=!0}))},tl=t(!1),sl=()=>{tl.value=!0},il=async e=>{if(e)try{await te({password:e});Ee.value=!0,je.value=h(),$e.value=je.value.table_no,ul()}catch(l){}else B({title:E("請輸入密碼"),icon:"none"})},ul=()=>{(()=>{tl.value=!1;const e=setTimeout((()=>{Ee.value,clearTimeout(e)}),300)})()},nl=t({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1});t([]);return s((()=>{i()&&u()&&n({url:"/pages/index/opentable-index"})})),o((()=>{i()&&!u()&&((async()=>{h()&&_e()})(),(async()=>{try{const e=await y({table_id:g()});nl.value.table_no=e.data.table_no}catch(e){}})())})),c((()=>{var e;null==(e=ze.value)||e.showBuffet(!1,0)})),De(),r({success:e=>{Be.value.device_id=e.deviceId}}),(e,l)=>{const a=J(K("ti-layout-head"),se),t=w,s=M,n=N,o=Q,c=V,r=W,p=J(K("ti-input"),oe),m=J(K("ti-layout-table-list"),ce),h=J(K("ti-modal"),ie),y=X;return d(i)()&&!d(u)()?(f(),v(t,{key:0,class:"ti-page",onClick:l[5]||(l[5]=e=>d(j)())},{default:_((()=>[x(t,null,{default:_((()=>{var e,l;return[me.value?b("",!0):(f(),v(a,{key:0,ref_key:"refCallServer",ref:ze,onDoubleLogo:Ie,onRefresh:Fe,is_call_service:null==(l=null==(e=d(fe))?void 0:e.tablet)?void 0:l.is_call_service},null,8,["is_call_service"]))]})),_:1}),me.value?b("",!0):(f(),v(t,{key:0,class:"ti-page-content"},{default:_((()=>{var e;return[x(t,{class:"ti-page-left"},{default:_((()=>[Ce.value?b("",!0):(f(),v(o,{key:0,onChange:we,class:"ti-swiper",current:he.value,autoplay:ye.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:_((()=>{var e,l;return[(f(!0),C(T,null,k(null==(l=null==(e=d(fe))?void 0:e.tablet)?void 0:l.carousel,((e,l)=>(f(),v(n,{class:"ti-swiper-item",key:l},{default:_((()=>["image"===d(U)(e.real_name)?(f(),v(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):b("",!0),"video"===d(U)(e.real_name)?(f(),v(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):b("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),Ce.value?(f(),v(o,{key:1,class:"ti-swiper"},{default:_((()=>[x(n,{class:"ti-swiper-item"},{default:_((()=>{var e;return[x(c,{onEnded:Te,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ke.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):b("",!0)])),_:1}),x(t,{class:"ti-page-right"},{default:_((()=>[x(t,{class:"ti-store-box"},{default:_((()=>[x(t,{class:"ti-store-item"},{default:_((()=>{var e;return[x(s,{class:"ti-store-logo",src:null==(e=d(fe))?void 0:e.logo},null,8,["src"]),x(r,{class:"ti-store-name"},{default:_((()=>{var e;return[I(F(null==(e=d(fe))?void 0:e.name),1)]})),_:1})]})),_:1}),x(t,{class:"ti-table-item"},{default:_((()=>[x(t,{class:"ti-table-number"},{default:_((()=>{var e;return[I(F(d(E)("當前桌號："))+F(null==(e=d(ve))?void 0:e.table_no),1)]})),_:1}),x(t,{class:"ti-table-button",onClick:He},{default:_((()=>[x(r,{class:"ti-table-button-text"},{default:_((()=>[I(F(d(E)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),x(ae,{show:Ke.value,title:"["+(null==(e=d(ve))?void 0:e.table_no)+"]"+d(E)("就餐人数"),placeholder:d(E)("請輸入人數"),onExit:Qe,onConfirm:Ne},null,8,["show","title","placeholder"]),x(ae,{show:tl.value,title:d(E)("密碼"),password:!0,placeholder:d(E)("請輸入密碼"),onExit:ul,onConfirm:il},null,8,["show","title","placeholder"])]})),_:1})),x(h,{show:Ee.value,title:d(E)("設置"),cancelText:d(E)("重置"),confirmText:d(E)("確定"),onCancel:Re,onConfirm:Se},{content:_((()=>[x(t,{class:"ti-item-input"},{default:_((()=>[x(t,{class:"ti-label-box"},{default:_((()=>[x(t,{class:"ti-label-left"},{default:_((()=>[x(r,{class:"ti-label-server"},{default:_((()=>[I(F(d(E)("服務器連接地址")),1)])),_:1})])),_:1}),x(t,{class:"ti-label-right",onClick:Oe},{default:_((()=>[x(r,{class:"ti-label-table"},{default:_((()=>[I(F($e.value?d(E)("已選 : ")+d($)($e.value,19):d(E)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-input-box"},{default:_((()=>[x(p,{type:"text",onInput:Ae,value:Be.value.ip,placeholder:d(E)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),x(t,{class:"ti-colon"},{default:_((()=>[I(":")])),_:1}),x(t,{class:"ti-input-port"},{default:_((()=>[x(p,{type:"number",onInput:Le,value:Be.value.port,placeholder:d(E)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),x(m,{show:Ue.value,"onUpdate:show":l[0]||(l[0]=e=>Ue.value=e),onConfirm:Pe},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),x(h,{class:"ti-dialog-buffet",show:Ve.value,title:d(E)("自助餐"),onCancel:l[1]||(l[1]=e=>(Ze.value.buffet_ids=[],Ve.value=!1)),onConfirm:l[2]||(l[2]=e=>{0!=Ze.value.buffet_ids.length?(Ve.value=!1,We.value=!0):B({title:E("请选择自助餐"),icon:"none"})})},{content:_((()=>[x(t,{class:"ti-dialog-content"},{default:_((()=>[x(y,{class:"ti-buffet-scroll","scroll-y":""},{default:_((()=>[x(t,{class:"ti-buffet-list"},{default:_((()=>[(f(!0),C(T,null,k(Xe.value,(e=>(f(),v(t,{key:e.id,class:Y(["ti-buffet-item",{active:Ze.value.buffet_ids.includes(e.id),disabled:Ze.value.buffet_ids.length>0&&Ye.value!=e.is_comb}]),onClick:l=>(e=>{if(!(Ze.value.buffet_ids.length>0&&Ye.value!=e.is_comb))if(Ye.value=e.is_comb,0==Ye.value)Ze.value.buffet_ids=Ze.value.buffet_ids[0]!=e.id?[e.id]:[];else{const l=Ze.value.buffet_ids.indexOf(e.id);if(l>-1)Ze.value.buffet_ids.splice(l,1);else{if(Ze.value.buffet_ids.length>=2)return B({title:le("最多只能选择{count}个",{count:2}),icon:"none"});Ze.value.buffet_ids.push(e.id)}}})(e)},{default:_((()=>[x(t,{class:"ti-buffet-name"},{default:_((()=>[I(F(e.name_text||e.name),1)])),_:2},1024),x(t,null,{default:_((()=>[x(r,{class:"ti-buffet-price"},{default:_((()=>[I(F(d(Z)(e.price)),1)])),_:2},1024),x(r,{class:"ti-buffet-subPrice"},{default:_((()=>[I(F(d(ee)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),x(h,{class:"ti-dialog-buffet",show:We.value,title:d(E)("提示"),onCancel:l[3]||(l[3]=e=>(We.value=!1,void(Ge.value=!1))),onConfirm:l[4]||(l[4]=e=>ll(Ze.value.meal_num,Ze.value.is_buffet))},{content:_((()=>[x(t,{class:"ti-dialog-content"},{default:_((()=>[x(y,{class:"ti-buffet-scroll","scroll-y":""},{default:_((()=>[x(t,{class:"ti-buffet-message"},{default:_((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:_((()=>[I(F(d(E)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:_((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:_((()=>[I(F(d(E)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:_((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:_((()=>[I(F(d(E)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:_((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:_((()=>[I(F(d(E)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-tips"},{default:_((()=>[I(F(d(E)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):b("",!0)}}},[["__scopeId","data-v-c635d358"]]);export{re as default};
