import{r as e,o as a,i as l,a as t,b as s,c as i,g as o,u,d as n,e as c,w as r,f as d,h as v,j as p,k as _,l as f,m,F as h,n as b,t as y,$ as w,s as g,p as x,q as T,v as k,x as C,y as F,z as I,A as E,B as j,S as $,C as N,D,E as S}from"./index-0dc108c6.js";import{D as B,v as q,_ as z,a as A}from"./verify.9a7b5af5.js";import{_ as L,g as M,a as R,b as U,s as G,c as H,d as J,e as K,v as O,f as P,h as Q,i as V,j as W,t as X,k as Y,l as Z}from"./baseinfo.5bc917b3.js";const ee=L({__name:"index",setup(L){const ee=e(0),ae=e(!0),le=e=>{ee.value=e.detail.current,te(Be.value,ee.value)},te=(e,a)=>{const l=e[a];"video"==K(l.real_name)&&setTimeout((()=>{ie.value=l,se.value=!0,ae.value=!1}),50)},se=e(!1),ie=e(),oe=()=>{se.value=!1,ae.value=!0,ee.value==Be.value.length-1?(ee.value=0,te(Be.value,ee.value)):ee.value+=1};e(!1);const ue=()=>{$e()},ne=()=>{s({url:"/pages/index/index"})},ce=e(),re=e("");e([]);const de=e(),ve=e(!1),pe=e({ip:"",port:"",device_id:""}),_e=e=>{pe.value.ip=e},fe=e=>{pe.value.port=e},me=async()=>{var e;const a={...pe.value};if(a.ip)if(a.port)try{const l=await O(P(`${null==a?void 0:a.ip}:${a.port}`));Q(a),x(l.data.app_id),T(l.data.shop_supplier_id),G(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{ve.value=!0}),150)}catch(l){g({title:w("绑定失败"),icon:"none"})}else g({title:w("請輸入連接埠"),icon:"none"});else g({title:w("請輸入伺服器位址"),icon:"none"})},he=e=>{ve.value=!1,e&&(de.value=e,re.value=e.table_no)},be=()=>{pe.value.ip="",pe.value.port="",re.value="",de.value=""},ye=async()=>{var e;const a={...pe.value};if(a.ip)if(a.port)if(de.value)try{const l=await O(P(`${null==a?void 0:a.ip}:${a.port}`));Q(a),x(l.data.app_id),T(l.data.shop_supplier_id),G(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{we()}),150)}catch(l){g({title:w("绑定失败"),icon:"none"})}else g({title:w("請查找桌位"),icon:"none"});else g({title:w("請輸入連接埠"),icon:"none"});else g({title:w("請輸入伺服器位址"),icon:"none"})},we=async()=>{if(k()===de.value.table_id)return g({title:w("绑定成功"),icon:"none"}),void(ce.value=!1);try{const e=await V({table_id:de.value.table_id,old_table_id:k()});C(de.value),qe(),g({title:e.msg,icon:"none"}),ce.value=!1}catch(e){}},ge=e(),xe=async()=>{if(1===Se.value.is_call_service||1===Se.value.is_customer_order)try{const e=await W({table_id:k()});1===parseInt(e.data.tablet.is_customer_order)?10===e.data.status?ke():(F(!0),s({url:"/pages/index/opentable-index"})):ge.value.tiCallClick("1")}catch(e){}},Te=e(!1),ke=()=>{Te.value=!0},Ce=e=>{e?Ee(e):g({title:w("請輸入人數"),icon:"none"})},Fe=()=>{Te.value=!1},Ie=e({table_id:"",meal_num:""}),Ee=async e=>{Ie.value.table_id=k(),Ie.value.meal_num=e;try{await X(Ie.value);F(!0),s({url:"/pages/index/opentable-index"})}catch(a){}},je=e(!1),$e=()=>{je.value=!0},Ne=async e=>{if(e)try{await q({password:e});ce.value=!0,de.value=v(),re.value=de.value.table_no,De()}catch(a){}else g({title:w("請輸入密碼"),icon:"none"})},De=()=>{je.value=!1},Se=e({name:"",logo:"",tableNo:"",is_call_service:1,is_customer_order:1}),Be=e([]),qe=async()=>{var e,a,l,t,s,i,o;try{const u=await U();Se.value.name=u.data.name,Se.value.logo=u.data.logo,Se.value.tableNo=v().table_no,Se.value.is_call_service=parseInt(null==(a=null==(e=null==u?void 0:u.data)?void 0:e.tablet)?void 0:a.is_call_service),Se.value.is_customer_order=parseInt(null==(t=null==(l=null==u?void 0:u.data)?void 0:l.tablet)?void 0:t.is_customer_order),G(null==(s=u.data)?void 0:s.currency),Be.value=(null==(o=null==(i=u.data)?void 0:i.tablet)?void 0:o.carousel)||[],Be.value.length>0&&te(Be.value,0)}catch(u){}};return a((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),i((()=>{l()&&!t()&&qe()})),(()=>{const e=M();pe.value.ip=(null==e?void 0:e.ip)||R()||"127.0.0.1",pe.value.port=(null==e?void 0:e.port)||"8080"})(),o({success:e=>{pe.value.device_id=e.deviceId}}),(e,a)=>{const s=I(E("ti-layout-head"),z),i=p,o=j,v=$,g=N,x=D,T=S,k=I(E("ti-input"),Y),C=I(E("ti-modal"),A),F=I(E("ti-layout-table-list"),Z);return u(l)()&&!u(t)()?(n(),c(i,{key:0,class:"ti-page",onClick:a[1]||(a[1]=e=>u(J)())},{default:r((()=>[_(i,null,{default:r((()=>[_(s,{ref_key:"refCallServer",ref:ge,onDoubleLogo:ue,onRefresh:ne,is_call_service:Se.value.is_call_service},null,8,["is_call_service"])])),_:1}),_(i,{class:"ti-page-content"},{default:r((()=>[_(i,{class:"ti-page-left"},{default:r((()=>[se.value?d("",!0):(n(),c(g,{key:0,onChange:le,class:"ti-swiper",current:ee.value,autoplay:ae.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:r((()=>[(n(!0),f(h,null,m(Be.value,((e,a)=>(n(),c(v,{class:"ti-swiper-item",key:a},{default:r((()=>["image"===u(K)(e.real_name)?(n(),c(o,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):d("",!0),"video"===u(K)(e.real_name)?(n(),c(o,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):d("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),se.value?(n(),c(g,{key:1,class:"ti-swiper"},{default:r((()=>[_(v,{class:"ti-swiper-item"},{default:r((()=>[_(x,{onEnded:oe,class:"ti-swiper-item-video",autoplay:!0,src:ie.value.file_path},null,8,["src"])])),_:1})])),_:1})):d("",!0)])),_:1}),_(i,{class:"ti-page-right",onTouchstart:e.handleTouchStart,onTouchmove:e.handleTouchMove,onTouchend:e.handleTouchEnd,controls:""},{default:r((()=>[_(i,{class:"ti-store-box"},{default:r((()=>[_(i,{class:"ti-store-item"},{default:r((()=>[_(o,{class:"ti-store-logo",src:Se.value.logo},null,8,["src"]),_(T,{class:"ti-store-name"},{default:r((()=>[b(y(Se.value.name),1)])),_:1})])),_:1}),_(i,{class:"ti-table-item"},{default:r((()=>[_(i,{class:"ti-table-number"},{default:r((()=>[b(y(u(w)("當前桌號："))+y(Se.value.tableNo),1)])),_:1}),_(i,{class:"ti-table-button",onClick:xe},{default:r((()=>[_(T,{class:"ti-table-button-text"},{default:r((()=>[b(y(u(w)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onTouchstart","onTouchmove","onTouchend"]),_(B,{show:Te.value,title:"["+Se.value.tableNo+"]"+u(w)("就餐人数"),placeholder:u(w)("請輸入人數"),onExit:Fe,onConfirm:Ce},null,8,["show","title","placeholder"]),_(B,{show:je.value,title:u(w)("密碼"),password:!0,placeholder:u(w)("請輸入密碼"),onExit:De,onConfirm:Ne},null,8,["show","title","placeholder"])])),_:1}),_(C,{show:ce.value,title:u(w)("設置"),cancelText:u(w)("重置"),confirmText:u(w)("確定"),onCancel:be,onConfirm:ye},{content:r((()=>[_(i,{class:"ti-item-input"},{default:r((()=>[_(i,{class:"ti-label-box"},{default:r((()=>[_(i,{class:"ti-label-left"},{default:r((()=>[_(T,{class:"ti-label-server"},{default:r((()=>[b(y(u(w)("服務器連接地址")),1)])),_:1})])),_:1}),_(i,{class:"ti-label-right",onClick:me},{default:r((()=>[_(T,{class:"ti-label-table"},{default:r((()=>[b(y(re.value?u(w)("已選 : ")+u(H)(re.value,12):u(w)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),_(i,{class:"ti-input-box"},{default:r((()=>[_(k,{type:"text",onInput:_e,value:pe.value.ip,placeholder:u(w)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),_(i,{class:"ti-colon"},{default:r((()=>[b(":")])),_:1}),_(i,{class:"ti-input-port"},{default:r((()=>[_(k,{type:"number",onInput:fe,value:pe.value.port,placeholder:u(w)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),_(F,{show:ve.value,"onUpdate:show":a[0]||(a[0]=e=>ve.value=e),onConfirm:he},null,8,["show"])])),_:1})):d("",!0)}}},[["__scopeId","data-v-294396cd"]]);export{ee as default};
