import{r as e,I as t,J as l,K as a,d as u,e as s,w as i,j as c,k as o,F as d,l as n,L as r,m as v,t as _,D as p,h as f,M as h,N as m,$ as y,O as g,u as b,P as x,y as k,z as w,f as A,Q as C,q as I,R as P,s as T,A as S,H as K,T as N,o as j,b as L,n as U,p as R,v as D,x as O,g as E}from"./index-1d8e19e1.js";import{a as B,b as F,D as Q,v as H,_ as J}from"./verify.5de910d5.js";import{$ as Y,_ as V,l as W,m as q,n as G,j as M,o as z,p as X,g as $,c as Z,v as ee,d as te,e as le,a as ae,h as ue,i as se}from"./baseinfo.6d8ec5a9.js";const ie=V({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null}},emits:["update:menuId"],setup(m,{emit:y}){const g=m,b=e(0),x=e(0),k=e([]);t((()=>g.list),(async e=>{if(await l(),!e||0==e.length)return;const t=a().in(this);if(e.map(((e,l)=>{t.select(`#scroll-item-${l}`).boundingClientRect((e=>{if(!e)return;const t=k.value;t[l]=e.width+10,k.value=t})).exec()})),g.menuId>0){const e=g.list.findIndex((e=>e.category_id==g.menuId));e>-1&&w(e)}}),{deep:!0,immediate:!0});const w=e=>{x.value=e,b.value=k.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(k.value[e]+100),y("update:menuId",g.list[e].category_id)};return(e,t)=>{const l=p,a=f,m=h;return u(),s(m,{class:"ti-dish-menu","scroll-left":b.value,"scroll-x":"","enable-flex":"","scroll-with-animation":""},{default:i((()=>[c(a,{class:"ti-menu-content"},{default:i((()=>[(u(!0),o(d,null,n(g.list,((t,o)=>(u(),s(a,{key:o,class:r(["ti-menu-item",{active:o==x.value}]),id:`scroll-item-${o}`,onClick:e=>w(o)},{default:i((()=>[c(l,{class:"ti-menu-title"},{default:i((()=>[v(_(0===o?e.$t(t.name_text):t.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"])}}},[["__scopeId","data-v-440ee506"]]),ce=V({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId"],setup(l,{emit:a}){const p=e([]),h=e(0),x=e(0),k=m((()=>{let e=(p.value.find((e=>e.category_id==h.value))||{}).child||[];return e&&e.length>0&&(e=[{name_text:y("全部"),category_id:0}].concat(e)),e})),w=m((()=>p.value.find((e=>e.category_id==h.value)))),A=m((()=>k.value.find((e=>e.category_id==x.value))));t((()=>h.value),(()=>{var e;k&&k.length>0&&(x.value=k.value[0].category_id),a("update:isSpecial",null==(e=w.value)?void 0:e.is_special),a("update:categoryId",h.value)}));const C=async e=>{try{const t=await function(e){return Y("product.category/index",{isLoading:e})}(e);t.data.list&&(p.value=[{name_text:y("全部"),category_id:0}].concat(t.data.list),h.value=p.value[0].category_id)}catch(t){}};return C(!0),g("closeShowLanguage",(e=>{e.isSelectLanguage&&setTimeout((()=>{C(!1)}),500)})),(e,t)=>{const l=f;return u(),s(l,{class:"ti-category-box"},{default:i((()=>[c(ie,{list:p.value,menuId:h.value,"onUpdate:menuId":t[0]||(t[0]=e=>h.value=e)},null,8,["list","menuId"]),c(l,{class:"ti-dish-secondary"},{default:i((()=>[(u(!0),o(d,null,n(b(k),((e,t)=>(u(),s(l,{key:t,class:r([{active:e.category_id==x.value},"ti-secondary-item"]),onClick:t=>{return l=e.category_id,x.value=l,a("update:isSpecial",null==(u=A.value)?void 0:u.is_special),void a("update:categoryId",x.value>0?x.value:h.value);var l,u}},{default:i((()=>[v(_(0===t?b(y)(e.name_text):e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-ac8ba858"]]);function oe(e,t){return Y("order.Order/getUnSendKitchen",e,{isLoading:t})}function de(e){return Y("order.Order/sendKitchen",e)}const ne=V({__name:"goods-detail",props:{show:{type:Boolean,default:!1},productId:{type:Number,default:null}},emits:["update:show","success"],setup(l,{emit:a}){const m=l,g=e({}),K=e(!1),N=e(!1),j=e({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed:[],bag_price:0,delivery:x()?30:40,describe:null});t((()=>m.show),(()=>{m.show&&L()}));const L=async()=>{var e,t,l,a,u,s,i,c,o,d;if(!K.value||m.productId)try{K.value=!0;const n=await(d=m.productId,Y("product.product/detail",{product_id:d}));g.value=n.data,j.value.product_id=null==(e=g.value)?void 0:e.product_id,j.value.price=null==(t=g.value)?void 0:t.product_price,j.value.product_price=null==(l=g.value)?void 0:l.product_price,(null==(a=g.value)?void 0:a.sku)&&(null==(u=g.value)?void 0:u.sku.length)>0&&(j.value.product_sku_id=null==(s=g.value)?void 0:s.sku[0].product_sku_id),(null==(i=g.value)?void 0:i.product_attr)&&(null==(c=g.value)?void 0:c.product_attr.length)>0&&(null==(o=g.value)||o.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?j.value.attr[t]=0:j.value.attr[t]=null}))),j.value.feed&&j.value.feed.length>0&&(j.value.feed=[])}catch(n){}finally{K.value=!1}},U=async()=>{var e,t,l,u,s,i,c,o,d;if(N.value)return;const n={...j.value};n.attr=n.attr.join(","),n.feed=n.feed.join(",");let r=[];(null==(e=g.value)?void 0:e.sku)&&(null==(t=g.value)?void 0:t.sku.length)>0&&r.push(null==(l=g.value)?void 0:l.sku.find((e=>e.product_sku_id==j.value.product_sku_id)).spec_name_text),(null==(u=g.value)?void 0:u.product_attr)&&(null==(s=g.value)?void 0:s.product_attr.length)&&(null==(i=g.value)||i.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0&&(null==e?void 0:e.attribute_value[j.value.attr[t]])&&r.push(null==e?void 0:e.attribute_value[j.value.attr[t]])}))),(null==(c=g.value)?void 0:c.product_feed)&&(null==(o=g.value)?void 0:o.product_feed.length)>0&&(null==(d=g.value)||d.product_feed.map(((e,t)=>{R(t)&&(r.push(e.feed_name_text),n.price=G(n.price,null==e?void 0:e.price))}))),n.describe=r.join(";"),n.delivery=x()?30:40,n.order_id=C(),n.table_id=I();try{N.value=!0;const e=await function(e){return Y("order.Order/add",e)}(n);1==e.code&&(P(e.data.order_id),T({title:e.msg,icon:"none"}),a("update:show",!1),setTimeout((()=>{a("success")}),100))}catch(v){}finally{N.value=!1}},R=e=>j.value.feed.indexOf(e)>-1,D=(e,t)=>j.value.attr[e]==t;return(e,t)=>{const l=S,x=f,C=p,I=h,P=k(w("ti-modal"),B);return u(),s(P,{show:m.show,title:b(y)("商品詳情"),cancelText:b(y)("取消"),confirmText:b(y)("確定"),confirmLoading:N.value,onCancel:t[0]||(t[0]=e=>a("update:show",!1)),onConfirm:U},{content:i((()=>[c(x,{class:"ti-dialog-content"},{default:i((()=>[c(x,{class:"ti-detail-box"},{default:i((()=>[c(x,{class:"ti-detail-image"},{default:i((()=>{var e,t,a,i;return[(null==(e=g.value)?void 0:e.image)&&(null==(t=g.value)?void 0:t.image[0])&&(null==(a=g.value)?void 0:a.image[0].file_path)?(u(),s(l,{key:0,src:null==(i=g.value)?void 0:i.image[0].file_path,mode:"widthFix"},null,8,["src"])):A("",!0)]})),_:1}),c(x,{class:"ti-detail-con"},{default:i((()=>[c(x,{class:"ti-detail-title text-ellipsis"},{default:i((()=>{var e;return[v(_(null==(e=g.value)?void 0:e.product_name_text),1)]})),_:1}),c(x,{class:"ti-price-box"},{default:i((()=>[c(C,{class:"ti-detail-unit"},{default:i((()=>[v(_(b(y)("單價：")),1)])),_:1}),c(C,{class:"ti-detail-price"},{default:i((()=>{var e;return[v(_(b(W)((null==(e=g.value)?void 0:e.product_price)||0)),1)]})),_:1}),c(C,{class:"ti-detail-subPrice"},{default:i((()=>{var e;return[v(_(b(q)((null==(e=g.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),c(x,{class:"ti-price-box"},{default:i((()=>[c(C,{class:"ti-detail-unit"},{default:i((()=>[v(_(b(y)("單位：")),1)])),_:1}),c(C,{class:"ti-detail-price"},{default:i((()=>{var e;return[v(_(null==(e=g.value)?void 0:e.product_unit_text),1)]})),_:1})])),_:1})])),_:1})])),_:1}),c(x,{class:"ti-detail-specs"},{default:i((()=>[c(I,{"scroll-y":""},{default:i((()=>[c(x,{class:"ti-specs-box"},{default:i((()=>{var e,t,l,a,p,f,h;return[(null==(e=g.value)?void 0:e.sku)&&(null==(t=g.value)?void 0:t.sku.length)>0?(u(),s(x,{key:0,class:"ti-specs-item"},{default:i((()=>{var e,t;return[(null==(e=g.value)?void 0:e.sku)&&(null==(t=g.value)?void 0:t.sku.length)>1?(u(),s(x,{key:0,class:"ti-specs-title"},{default:i((()=>[v(_(b(y)("規格")),1)])),_:1})):A("",!0),c(x,{class:"ti-specs-child"},{default:i((()=>{var e;return[(u(!0),o(d,null,n(null==(e=g.value)?void 0:e.sku,(e=>(u(),s(x,{key:e.product_sku_id,class:r([{active:e.product_sku_id==j.value.product_sku_id},"ti-child-item"]),onClick:t=>{return l=e.product_sku_id,void(j.value.product_sku_id!=l&&(j.value.product_sku_id=l));var l}},{default:i((()=>[c(C,{class:"ti-child-name"},{default:i((()=>[v(_(e.spec_name_text),1)])),_:2},1024),c(C,{class:"ti-child-price"},{default:i((()=>[v(_(b(W)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),c(C,{class:"ti-child-subPrice"},{default:i((()=>[v(_(b(q)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})]})),_:1})):A("",!0),(null==(l=g.value)?void 0:l.product_attr)&&(null==(a=g.value)?void 0:a.product_attr.length)>0?(u(!0),o(d,{key:1},n(null==(p=g.value)?void 0:p.product_attr,((e,t)=>(u(),s(x,{key:t,class:"ti-specs-item"},{default:i((()=>[c(x,{class:"ti-specs-title"},{default:i((()=>[v(_(e.attribute_name_text),1)])),_:2},1024),c(x,{class:"ti-specs-child"},{default:i((()=>[(u(!0),o(d,null,n(null==e?void 0:e.attribute_value_text,((e,l)=>(u(),s(x,{key:l,class:r([{active:D(t,l)},"ti-child-item"]),onClick:e=>((e,t)=>{j.value.attr[e]=t})(t,l)},{default:i((()=>[c(C,{class:"ti-child-name"},{default:i((()=>[v(_(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)):A("",!0),(null==(f=g.value)?void 0:f.product_feed)&&(null==(h=g.value)?void 0:h.product_feed.length)>0?(u(),s(x,{key:2,class:"ti-specs-item"},{default:i((()=>[c(x,{class:"ti-specs-title"},{default:i((()=>[v(_(b(y)("加料")),1)])),_:1}),c(x,{class:"ti-specs-child"},{default:i((()=>{var e;return[(u(!0),o(d,null,n(null==(e=g.value)?void 0:e.product_feed,((e,t)=>(u(),s(x,{key:t,class:r([{active:R(t)},"ti-child-item"]),onClick:e=>(e=>{const t=j.value.feed.indexOf(e);t>=0?j.value.feed.splice(t,1):j.value.feed.push(e)})(t)},{default:i((()=>[c(C,{class:"ti-child-name"},{default:i((()=>[v(_(e.feed_name_text),1)])),_:2},1024),c(C,{class:"ti-child-price"},{default:i((()=>[v(_(b(W)((null==e?void 0:e.price)||0)),1)])),_:2},1024),c(C,{class:"ti-child-subPrice"},{default:i((()=>[v(_(b(q)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):A("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText","confirmLoading"])}}},[["__scopeId","data-v-d2fd47bc"]]),re=V({__name:"dish-car-order-nav",emits:["car","confirm"],setup(t,{expose:l,emit:a}){const o=()=>{a("car")},d=()=>{a("confirm")},n=e(),r=e(!1),h=async()=>{var e;try{const t=await oe({table_id:I()},!1);n.value=(null==(e=t.data)?void 0:e.detail)||{},n.value.unSendKitchenProductTotalNum>0?r.value=!0:r.value=!1}catch(t){}};return h(),l({getCarData:h}),(e,t)=>{const l=S,a=p,h=f;return u(),s(h,{class:"ti-car-order"},{default:i((()=>[c(h,{class:"ti-order-total",onClick:o},{default:i((()=>[c(l,{class:"ti-total-image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE9SURBVHgB7ZjxrcIgEMY/Xt4AbvAYwRHc4DmKbuAG6gR1A92g3UA3sE6gTnAesZqG1gLKSf/oL7nQwKV8Be6AAj1DPR6IaMTF6NmgVIlUGDFsR2qSVUJ7I8iQIwWVKF2zWU3UBH2AhexJhtx8dFufPw5NF8gwYTu2jbxLkIYsmV3hEiQdYdoepdSCGn38OpzXbP+Qo2Q7YCAA9aqhyhNbyK6jHe+Zcy9PFrQgec52v11R9o0IayTe1IJKu6JL0B8S4EqM0lztii5BGvIELWoNeU52ReopC4qyAvL472PmWECyZAiF5LJ1Ti9uM8pDlMb9yKnxOWbNHHj/KjDwJs4pq8PTN+VizFb4DHuofxD88qW1MGcx/UPFjFsi5RzLv84nmTr0eBL3OEPNnxGrmP7vCDKXuk2V1Bax/Qd8uQE+N6CHpHz4IAAAAABJRU5ErkJggg=="}),c(a,{class:"ti-total-price"},{default:i((()=>{var e;return[v(_(b(W)((null==(e=n.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),c(a,{class:"ti-total-subPrice"},{default:i((()=>{var e;return[v(_(b(q)((null==(e=n.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1}),r.value?(u(),s(h,{key:0,class:"ti-total-badge-box"},{default:i((()=>[c(a,{class:"ti-total-badge"},{default:i((()=>{var e;return[v(_(null==(e=n.value)?void 0:e.unSendKitchenProductTotalNum),1)]})),_:1})])),_:1})):A("",!0),c(h,{class:"ti-order-btn",onClick:d},{default:i((()=>[c(a,{class:"ti-btn-text"},{default:i((()=>[v(_(e.$t("下單")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-8e21f0ac"]]),ve=V({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})}},emits:["change"],setup(t,{emit:l}){const a=t,o=e(!1),d=async e=>{var t,u;const s={order_product_id:null==(t=a.productItem)?void 0:t.order_product_id,product_num:null==(u=a.productItem)?void 0:u.total_num,type:e};"up"==e?s.product_num+=1:s.product_num-=1;try{o.value=!0;const e=await function(e){return Y("order.Order/sub",e)}(s);1==e.code&&l("change")}catch(i){}finally{o.value=!1}};return(e,l)=>{const a=f;return u(),s(a,{class:"ti-number-box",onClick:l[2]||(l[2]=K((()=>{}),["stop"]))},{default:i((()=>[c(a,{class:"ti-number-btn ti-number-minus",disabled:!1,onClick:l[0]||(l[0]=e=>d("down"))},{default:i((()=>[c(a,{class:"ti-number-minus-reduce"})])),_:1}),c(a,{class:"ti-number-input"},{default:i((()=>[v(_(t.productItem.total_num),1)])),_:1}),c(a,{class:"ti-number-btn ti-number-plus",disabled:!1,onClick:l[1]||(l[1]=e=>d("up"))},{default:i((()=>[c(a,{class:"ti-number-plus-add"}),c(a,{class:"ti-number-plus-add2"})])),_:1})])),_:1})}}},[["__scopeId","data-v-d611c51e"]]),_e=V({__name:"dish-car-ordering-list",emits:["success","change"],setup(t,{emit:l}){const a=e(!1),r=e(),m=e(),g=e({table_id:""}),x=async e=>{var t;g.table_id=I();try{const e=await oe(g,!1);r.value=e.data.detail,m.value=(null==(t=e.data.detail)?void 0:t.unSendKitchenProduct)||[],l("change")}catch(a){}},C=async e=>{try{a.value=!0;const e=await de({table_id:I()});T({title:y(e.msg),icon:"none"}),setTimeout((()=>{l("success")}),500)}catch(t){}finally{a.value=!1}};return x(),(e,t)=>{const l=f,a=p,g=h,I=k(w("ti-button"),M),P=k(w("ti-empty-data"),z);return u(),s(l,{class:"ti-shop-list-box"},{default:i((()=>{var e,p;return[(null==(e=m.value)?void 0:e.length)>0?(u(),s(l,{key:0,class:"ti-shop-list"},{default:i((()=>[c(l,null,{default:i((()=>[c(l,{class:"ti-cart-shop-head"},{default:i((()=>[c(l,{class:"ti-shop-head-title"},{default:i((()=>[v(_(b(y)("商品名稱")),1)])),_:1}),c(l,{class:"ti-shop-head-money"},{default:i((()=>[v(_(b(y)("金額")),1)])),_:1}),c(l,{class:"ti-shop-head-num"},{default:i((()=>[v(_(b(y)("數量")),1)])),_:1})])),_:1})])),_:1}),c(l,{class:"ti-scroll-box"},{default:i((()=>[c(g,{class:"ti-shop-scroll","scroll-y":""},{default:i((()=>[c(l,{class:"ti-shop-box"},{default:i((()=>[(u(!0),o(d,null,n(m.value,((e,o)=>(u(),s(l,{class:"ti-shop-item",key:e},{default:i((()=>[c(l,{class:"ti-shop-item-box"},{default:i((()=>[c(l,{class:"ti-shop-box"},{default:i((()=>[c(l,{class:"ti-shop-body-top"},{default:i((()=>[c(l,{class:"ti-shop-title text-ellipsis"},{default:i((()=>[v(_(e.product_name_text),1)])),_:2},1024),c(l,{class:"ti-shop-spec"},{default:i((()=>[v(_(e.product_attr),1)])),_:2},1024)])),_:2},1024),c(l,{class:"ti-shop-body-money"},{default:i((()=>[c(a,{class:"ti-shop-price"},{default:i((()=>[v(_(b(W)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),c(a,{class:"ti-shop-subPrice"},{default:i((()=>[v(_(b(q)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024),c(l,{class:"ti-shop-body-number"},{default:i((()=>[c(ve,{productItem:e,onChange:t[0]||(t[0]=e=>x())},null,8,["productItem"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),c(l,{class:"ti-content-bottom"},{default:i((()=>[c(l,{class:"ti-car-shop-bottom"},{default:i((()=>[c(l,{class:"ti-shop-bottom-item"},{default:i((()=>[c(l,null,{default:i((()=>[c(a,{class:"ti-shop-bottom-text"},{default:i((()=>{var e;return[v(_(b(y)("共")+((null==(e=r.value)?void 0:e.unSendKitchenProductTotalNum)||0)+b(y)("件")),1)]})),_:1})])),_:1}),c(l,null,{default:i((()=>[c(a,{class:"ti-shop-bottom-text"},{default:i((()=>[v(_(b(y)("小計：")),1)])),_:1}),c(a,{class:"ti-shop-bottom-price"},{default:i((()=>{var e;return[v(_(b(W)((null==(e=r.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),c(a,{class:"ti-shop-bottom-subPrice"},{default:i((()=>{var e;return[v(_(b(q)((null==(e=r.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),c(I,{title:b(y)("確認下單"),type:"primary",onClick:C},null,8,["title"])])),_:1})])),_:1})):A("",!0),(null==(p=m.value)?void 0:p.length)<=0?(u(),s(l,{key:1,class:"ti-empty-data-box"},{default:i((()=>[c(P,{title:b(y)("當前無待下單商品")},null,8,["title"])])),_:1})):A("",!0)]})),_:1})}}},[["__scopeId","data-v-508af573"]]),pe=V({__name:"dish-car-ordered-list",setup(t){const l=e([]);(async()=>{try{const t=await(e={table_id:I()},Y("order.Order/getSendKitchen",e));l.value=t.data.list||[]}catch(t){}var e})();return(e,t)=>{const a=f,r=p,m=h,g=k(w("ti-empty-data"),z);return u(),s(a,{class:"ti-shop-list"},{default:i((()=>[Object.keys(l.value).length>0?(u(),s(m,{key:0,class:"ti-shop-scroll","scroll-y":""},{default:i((()=>[(u(!0),o(d,null,n(l.value,((e,t)=>(u(),s(a,{class:"ti-shop-item",key:t},{default:i((()=>[c(a,{class:"ti-shop-time-top"}),c(a,{class:"ti-shop-time-box"},{default:i((()=>[v(_(e.date+" "+b(y)("下單")),1)])),_:2},1024),(u(!0),o(d,null,n(e.plist,((t,l)=>(u(),s(a,{key:l},{default:i((()=>[c(a,{class:"ti-shop-item-box"},{default:i((()=>[c(a,{class:"ti-shop-box"},{default:i((()=>[c(a,{class:"ti-shop-body-top"},{default:i((()=>[c(a,{class:"ti-shop-title text-ellipsis"},{default:i((()=>[v(_(t.product_name_text),1)])),_:2},1024),c(a,{class:"ti-shop-spec"},{default:i((()=>[v(_(t.product_attr),1)])),_:2},1024)])),_:2},1024),c(a,{class:"ti-shop-body-money"},{default:i((()=>[c(r,{class:"ti-shop-price"},{default:i((()=>[v(_(b(W)((null==t?void 0:t.product_price)||0)),1)])),_:2},1024),c(r,{class:"ti-shop-subPrice"},{default:i((()=>[v(_(b(q)((null==t?void 0:t.product_price)||0)),1)])),_:2},1024)])),_:2},1024),c(a,{class:"ti-shop-body-state"},{default:i((()=>[c(a,{class:"ti-state-left"},{default:i((()=>[v(_(t.finish_num),1)])),_:2},1024),c(a,{class:"ti-state-line"},{default:i((()=>[v("/")])),_:1}),c(a,{class:"ti-state-right"},{default:i((()=>[v(_(t.total_num),1)])),_:2},1024),c(a,{class:"ti-state-text"},{default:i((()=>{return[v(_((e=t.kitchen_status,y(0===e?"製作中":1===e?"已完成":"未知"))),1)];var e})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),l!=e.length-1?(u(),s(a,{key:0,class:"ti-shop-item-box-bottom-border"})):A("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})):A("",!0),Object.keys(l.value).length<=0?(u(),s(g,{key:1,class:"ti-empty-data",title:b(y)("當前無已下單商品")},null,8,["title"])):A("",!0)])),_:1})}}},[["__scopeId","data-v-bd29da58"]]),fe=V({__name:"dish-list",emits:["success"],setup(l,{emit:a}){const m=e(!1),g=e({category_id:null,shop_supplier_id:null,page:1,list_rows:30}),x=e([]),C=e(!1),P=e(),K=e(!1);t((()=>g.value.category_id),(()=>{U()}));const j=()=>{Z.value.getCarData()},L=()=>{K.value&&(g.value.page+=1,D())},U=()=>{g.value.page=1,g.value.shop_supplier_id=N(),D(!0)},R=e(0),D=async e=>{var t,l,a,u,s,i;if(C.value)return;const c={...g.value};c.category_id||(c.category_id=null),1==R.value&&(c.is_special=1);try{e&&(C.value=!0);const o=await function(e){return Y("product.product/index",e,{isLoading:!1})}(c);1==g.value.page&&(x.value=[]),x.value=x.value.concat((null==(l=null==(t=o.data)?void 0:t.list)?void 0:l.data)||[]),K.value=(null==(u=null==(a=o.data)?void 0:a.list)?void 0:u.last_page)>(null==(i=null==(s=o.data)?void 0:s.list)?void 0:i.current_page)}catch(o){}finally{e&&(C.value=!1)}};U(),e([]);const O=e(),E=()=>{O.value=!0,G.value=!0},B=()=>{H(!1)},Q=e([]),H=async e=>{var t;try{const l=await oe({table_id:I()},e);Q.value=(null==(t=l.data.detail)?void 0:t.unSendKitchenProduct)||[],Q.value.length>0?J():(O.value=!0,G.value=!1)}catch(l){}},J=async()=>{try{const e=await de({table_id:I()});T({title:y(e.msg),icon:"none"}),setTimeout((()=>{a("success"),Z.value.getCarData(),O.value=!0,G.value=!1}),300)}catch(e){}},V=(e,t)=>{e||(O.value=!1)},G=e(!0),M=e=>{G.value=e},$=()=>{G.value=!1};G.value=!0;const Z=e();return(e,t)=>{const l=k(w("ti-loading"),F),a=S,I=p,N=f,U=k(w("ti-empty-data"),z),D=h,Q=k(w("ti-drawer"),X);return u(),o(d,null,[c(N,{class:"ti-dish-box"},{default:i((()=>[c(ce,{categoryId:g.value.category_id,"onUpdate:categoryId":t[0]||(t[0]=e=>g.value.category_id=e),isSpecial:R.value,"onUpdate:isSpecial":t[1]||(t[1]=e=>R.value=e)},null,8,["categoryId","isSpecial"]),c(N,{class:"ti-dish-list"},{default:i((()=>[c(D,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:L},{default:i((()=>[C.value?(u(),s(l,{key:0})):x.value&&x.value.length>0?(u(),o(d,{key:1},[c(N,{class:"ti-dish-goods"},{default:i((()=>[(u(!0),o(d,null,n(x.value,((e,t)=>(u(),s(N,{key:t,class:r([{"sold-out":e.product_stock<=0},"ti-goods-item"]),onClick:t=>(e=>{if(e.product_stock<=0)return T({title:y("已售罄"),icon:"none"});m.value=!0,P.value=e.product_id})(e)},{default:i((()=>[c(N,{class:"ti-goods-image"},{default:i((()=>[e.image&&e.image[0]&&e.image[0].file_path?(u(),s(a,{key:0,src:e.image[0].file_path,mode:"scaleToFill"},null,8,["src"])):A("",!0),c(I,{class:"sold-out-text"},{default:i((()=>[v(_(b(y)("已售罄")),1)])),_:1})])),_:2},1024),c(N,{class:"ti-goods-content"},{default:i((()=>[c(N,{class:"ti-goods-title"},{default:i((()=>[v(_(e.product_name_text),1)])),_:2},1024),c(N,{class:"ti-price-box"},{default:i((()=>[c(I,{class:"ti-goods-price"},{default:i((()=>[v(_(b(W)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),c(I,{class:"ti-goods-subPrice"},{default:i((()=>[v(_(b(q)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),c(l,{status:K.value?"loading":"no-more"},null,8,["status"])],64)):(u(),s(U,{key:2}))])),_:1})])),_:1}),c(N,{class:"ti-car-order-nav"},{default:i((()=>[c(re,{ref_key:"carRef",ref:Z,onCar:E,onConfirm:B},null,512)])),_:1})])),_:1}),c(ne,{show:m.value,"onUpdate:show":t[2]||(t[2]=e=>m.value=e),productId:P.value,onSuccess:j},null,8,["show","productId"]),c(Q,{show:O.value,width:603.992,title:b(y)("我點的菜"),maskClick:!0,onChange:V},{content:i((()=>[c(N,{class:"ti-drawer-content"},{default:i((()=>[c(N,{class:"ti-content-head"},{default:i((()=>[c(N,{class:"ti-switch-box"},{default:i((()=>[c(N,{class:r(G.value?"ti-switch-on":"ti-switch-off"),onClick:t[3]||(t[3]=e=>M(!0))},{default:i((()=>[c(I,{class:r(G.value?"ti-switch-text-on":"ti-switch-text-off")},{default:i((()=>[v(_(b(y)("未下單")),1)])),_:1},8,["class"])])),_:1},8,["class"]),c(N,{class:"ti-switch-space"}),c(N,{class:r(G.value?"ti-switch-off":"ti-switch-on"),onClick:t[4]||(t[4]=e=>M(!1))},{default:i((()=>[c(I,{class:r(G.value?"ti-switch-text-off":"ti-switch-text-on")},{default:i((()=>[v(_(b(y)("已下單")),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})])),_:1}),G.value?(u(),s(_e,{key:0,onSuccess:$,onChange:j})):A("",!0),G.value?A("",!0):(u(),s(pe,{key:1}))])),_:1})])),footer:i((()=>[c(N)])),_:1},8,["show","width","title"])],64)}}},[["__scopeId","data-v-01259695"]]),he=V({__name:"opentable-index",setup(t){const l=e(!1),a=()=>{Y()},o=()=>{L({url:"/pages/index/opentable-index"})},d=e(),n=e("");e([]);const r=e();e();const h=e(),m=e("8080"),g=e=>{h.value=e},x=e=>{m.value=e},A=async()=>{if(h.value)if(m.value)try{let e="";e=h.value.startsWith("http://")||h.value.startsWith("https://")?m.value.length>0?h.value+":"+m.value:h.value:m.value.length>0?"http://"+h.value+":"+m.value:"http://"+h.value,l.value=!0;const t=await ee(e);te(e),U(t.data.app_id),R(t.data.shop_supplier_id),setTimeout((()=>{P()}),300)}catch(e){}finally{l.value=!1}else T({title:y("請輸入服務器端口"),icon:"none"});else T({title:y("請輸入服務器鏈接地址"),icon:"none"})},C=e(!1),P=()=>{C.value=!0},S=e=>{C.value=!1,e&&(r.value=e,n.value=y("已選 : ")+e.table_no)},K=()=>{h.value="",m.value="",n.value="",r.value=""},N=async()=>{if(h.value)if(m.value)if(r.value)try{const e=await le({table_id:r.value.table_id,old_table_id:I()});D(r.value),d.value=!1,G(),O(!1),L({url:"/pages/index/index"}),T({title:e.msg,icon:"none"})}catch(e){}else T({title:y("請查找桌位"),icon:"none"});else T({title:y("請輸入服務器端口"),icon:"none"});else T({title:y("請輸入服務器鏈接地址"),icon:"none"})},F=e(!1),Y=()=>{F.value=!0},V=async e=>{if(e)try{await H({password:e});d.value=!0,W()}catch(t){}else T({title:y("請輸入密碼"),icon:"none"})},W=()=>{F.value=!1},q=e({name:"",logo:"",tableNo:""}),G=async()=>{try{l.value=!0;const e=await ae();q.value.name=e.data.name,q.value.logo=e.data.logo,q.value.tableNo=E().table_no}catch(e){}finally{l.value=!1}};h.value=$();const M=e();return j((e=>{e.callServer&&setTimeout((()=>{M.value.tiCallClick("1")}),500)})),(e,t)=>{const l=k(w("ti-layout-head"),J),r=f,I=p,P=k(w("ti-input"),ue),T=k(w("ti-modal"),B),j=k(w("ti-layout-table-list"),se);return u(),s(r,{class:"ti-page",onClick:t[1]||(t[1]=e=>b(Z)())},{default:i((()=>[c(r,null,{default:i((()=>[c(l,{ref_key:"refCallServer",ref:M,isPay:!0,isTableNo:!0,onDoubleLogo:a,onRefresh:o},null,512)])),_:1}),c(Q,{show:F.value,title:b(y)("密碼"),password:!0,placeholder:b(y)("請輸入密碼"),onExit:W,onConfirm:V},null,8,["show","title","placeholder"]),c(fe),c(T,{show:d.value,title:b(y)("設置"),cancelText:b(y)("重置"),confirmText:b(y)("確定"),onCancel:K,onConfirm:N},{content:i((()=>[c(r,{class:"ti-item-input"},{default:i((()=>[c(r,{class:"ti-label-box"},{default:i((()=>[c(r,{class:"ti-label-left"},{default:i((()=>[c(I,{class:"ti-label-server"},{default:i((()=>[v(_(b(y)("服務器連接地址")),1)])),_:1})])),_:1}),c(r,{class:"ti-label-right",onClick:A},{default:i((()=>[c(I,{class:"ti-label-table"},{default:i((()=>[v(_(n.value?n.value:b(y)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),c(r,{class:"ti-input-box"},{default:i((()=>[c(P,{type:"text",onInput:g,value:h.value,placeholder:b(y)("請輸入服務器鏈接地址"),clearable:!1},null,8,["value","placeholder"]),c(r,{class:"ti-colon"},{default:i((()=>[v(":")])),_:1}),c(r,{class:"ti-input-port"},{default:i((()=>[c(P,{type:"number",onInput:x,value:m.value,placeholder:b(y)("請輸入服務器端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),c(j,{show:C.value,"onUpdate:show":t[0]||(t[0]=e=>C.value=e),onConfirm:S},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-b119a0e8"]]);export{he as default};
