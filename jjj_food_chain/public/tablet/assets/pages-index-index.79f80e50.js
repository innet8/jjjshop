import{r as a,o as e,i as l,a as t,b as s,c as o,g as i,u,d as n,e as c,w as r,f as d,h as v,j as p,k as _,l as f,m as h,F as m,n as b,t as y,$ as w,s as g,p as x,q as T,v as k,x as C,y as F,z as E,A as j,B as I,S as $,C as N,D,E as S}from"./index-e847f033.js";import{D as B,v as q,_ as z,a as A}from"./verify.15c1caa2.js";import{_ as L,g as M,a as R,b as U,s as G,c as H,d as J,e as K,v as O,f as P,h as Q,i as V,j as W,t as X,k as Y,l as Z}from"./baseinfo.705f3fb6.js";const aa=L({__name:"index",setup(L){const aa=a(0),ea=a(!0),la=a=>{aa.value=a.detail.current,ta(qa.value,aa.value)},ta=(a,e)=>{const l=a[e];"video"==K(l.real_name)&&setTimeout((()=>{oa.value=l,sa.value=!0,ea.value=!1}),50)},sa=a(!1),oa=a(),ia=()=>{sa.value=!1,ea.value=!0,aa.value==qa.value.length-1?(aa.value=0,ta(qa.value,aa.value)):aa.value+=1},ua=a(!1),na=()=>{Na()},ca=()=>{s({url:"/pages/index/index"})},ra=a(),da=a("");a([]);const va=a(),pa=a(!1),_a=a({ip:"",port:"",device_id:""}),fa=a=>{_a.value.ip=a},ha=a=>{_a.value.port=a},ma=async()=>{var a;const e={..._a.value};if(e.ip)if(e.port)try{const l=await O(P(`${null==e?void 0:e.ip}:${e.port}`));Q(e),x(l.data.app_id),T(l.data.shop_supplier_id),G(null==(a=l.data)?void 0:a.currency),setTimeout((()=>{pa.value=!0}),150)}catch(l){}else g({title:w("請輸入服務器端口"),icon:"none"});else g({title:w("請輸入服務器鏈接地址"),icon:"none"})},ba=a=>{pa.value=!1,a&&(va.value=a,da.value=a.table_no)},ya=()=>{_a.value.ip="",_a.value.port="",da.value="",va.value=""},wa=async()=>{var a;const e={..._a.value};if(e.ip)if(e.port)if(va.value)try{const l=await O(P(`${null==e?void 0:e.ip}:${e.port}`));Q(e),x(l.data.app_id),T(l.data.shop_supplier_id),G(null==(a=l.data)?void 0:a.currency),setTimeout((()=>{ga()}),150)}catch(l){}else g({title:w("請查找桌位"),icon:"none"});else g({title:w("請輸入服務器端口"),icon:"none"});else g({title:w("請輸入服務器鏈接地址"),icon:"none"})},ga=async()=>{try{const a=await V({table_id:va.value.table_id,old_table_id:k()});C(va.value),za(),g({title:a.msg,icon:"none"}),ra.value=!1}catch(a){}},xa=a(),Ta=async()=>{try{const a=await W({table_id:k()});1===parseInt(a.data.tablet.is_customer_order)?10===a.data.status?Ca():(F(!0),s({url:"/pages/index/opentable-index"})):xa.value.tiCallClick("1")}catch(a){}},ka=a(!1),Ca=()=>{ka.value=!0},Fa=a=>{a?Ia(a):g({title:w("請輸入人數"),icon:"none"})},Ea=()=>{ka.value=!1},ja=a({table_id:"",meal_num:""}),Ia=async a=>{ja.value.table_id=k(),ja.value.meal_num=a;try{await X(ja.value);F(!0),s({url:"/pages/index/opentable-index"})}catch(e){}},$a=a(!1),Na=()=>{$a.value=!0},Da=async a=>{if(a)try{await q({password:a});ra.value=!0,va.value=v(),da.value=va.value.table_no,Sa()}catch(e){}else g({title:w("請輸入密碼"),icon:"none"})},Sa=()=>{$a.value=!1},Ba=a({name:"",logo:"",tableNo:""}),qa=a([]),za=async()=>{var a,e,l;try{ua.value=!0;const t=await U();Ba.value.name=t.data.name,Ba.value.logo=t.data.logo,Ba.value.tableNo=v().table_no,G(null==(a=t.data)?void 0:a.currency),qa.value=(null==(l=null==(e=t.data)?void 0:e.tablet)?void 0:l.carousel)||[],qa.value.length>0&&ta(qa.value,0)}catch(t){}finally{ua.value=!1}};return e((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),o((()=>{l()&&!t()&&za()})),(()=>{const a=M();_a.value.ip=(null==a?void 0:a.ip)||R()||"127.0.0.1",_a.value.port=(null==a?void 0:a.port)||"8080"})(),i({success:a=>{_a.value.device_id=a.deviceId}}),(a,e)=>{const s=E(j("ti-layout-head"),z),o=p,i=I,v=$,g=N,x=D,T=S,k=E(j("ti-input"),Y),C=E(j("ti-modal"),A),F=E(j("ti-layout-table-list"),Z);return u(l)()&&!u(t)()?(n(),c(o,{key:0,class:"ti-page",onClick:e[1]||(e[1]=a=>u(J)())},{default:r((()=>[_(o,null,{default:r((()=>[_(s,{ref_key:"refCallServer",ref:xa,onDoubleLogo:na,onRefresh:ca},null,512)])),_:1}),_(o,{class:"ti-page-content"},{default:r((()=>[_(o,{class:"ti-page-left"},{default:r((()=>[sa.value?d("",!0):(n(),c(g,{key:0,onChange:la,class:"ti-swiper",current:aa.value,autoplay:ea.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:r((()=>[(n(!0),f(m,null,h(qa.value,((a,e)=>(n(),c(v,{class:"ti-swiper-item",key:e},{default:r((()=>["image"===u(K)(a.real_name)?(n(),c(i,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:a.file_path},null,8,["src"])):d("",!0),"video"===u(K)(a.real_name)?(n(),c(i,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):d("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),sa.value?(n(),c(g,{key:1,class:"ti-swiper"},{default:r((()=>[_(v,{class:"ti-swiper-item"},{default:r((()=>[_(x,{onEnded:ia,class:"ti-swiper-item-video",autoplay:!0,src:oa.value.file_path},null,8,["src"])])),_:1})])),_:1})):d("",!0)])),_:1}),_(o,{class:"ti-page-right",onTouchstart:a.handleTouchStart,onTouchmove:a.handleTouchMove,onTouchend:a.handleTouchEnd,controls:""},{default:r((()=>[_(o,{class:"ti-store-box"},{default:r((()=>[_(o,{class:"ti-store-item"},{default:r((()=>[_(i,{class:"ti-store-logo",src:Ba.value.logo},null,8,["src"]),_(T,{class:"ti-store-name"},{default:r((()=>[b(y(Ba.value.name),1)])),_:1})])),_:1}),_(o,{class:"ti-table-item"},{default:r((()=>[_(o,{class:"ti-table-number"},{default:r((()=>[b(y(u(w)("當前桌號："))+y(Ba.value.tableNo),1)])),_:1}),_(o,{class:"ti-table-button",onClick:Ta},{default:r((()=>[_(T,{class:"ti-table-button-text"},{default:r((()=>[b(y(u(w)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onTouchstart","onTouchmove","onTouchend"]),_(B,{show:ka.value,title:"["+Ba.value.tableNo+"]"+u(w)("就餐人数"),placeholder:u(w)("請輸入人數"),onExit:Ea,onConfirm:Fa},null,8,["show","title","placeholder"]),_(B,{show:$a.value,title:u(w)("密碼"),password:!0,placeholder:u(w)("請輸入密碼"),onExit:Sa,onConfirm:Da},null,8,["show","title","placeholder"])])),_:1}),_(C,{show:ra.value,title:u(w)("設置"),cancelText:u(w)("重置"),confirmText:u(w)("確定"),onCancel:ya,onConfirm:wa},{content:r((()=>[_(o,{class:"ti-item-input"},{default:r((()=>[_(o,{class:"ti-label-box"},{default:r((()=>[_(o,{class:"ti-label-left"},{default:r((()=>[_(T,{class:"ti-label-server"},{default:r((()=>[b(y(u(w)("服務器連接地址")),1)])),_:1})])),_:1}),_(o,{class:"ti-label-right",onClick:ma},{default:r((()=>[_(T,{class:"ti-label-table"},{default:r((()=>[b(y(da.value?u(w)("已選 : ")+u(H)(da.value,12):u(w)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),_(o,{class:"ti-input-box"},{default:r((()=>[_(k,{type:"text",onInput:fa,value:_a.value.ip,placeholder:u(w)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),_(o,{class:"ti-colon"},{default:r((()=>[b(":")])),_:1}),_(o,{class:"ti-input-port"},{default:r((()=>[_(k,{type:"number",onInput:ha,value:_a.value.port,placeholder:u(w)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),_(F,{show:pa.value,"onUpdate:show":e[0]||(e[0]=a=>pa.value=a),onConfirm:ba},null,8,["show"])])),_:1})):d("",!0)}}},[["__scopeId","data-v-9824175c"]]);export{aa as default};
