import{r as e,o as a,i as l,a as t,b as s,c as i,g as u,u as o,d as n,e as c,w as v,f as r,h as d,j as _,k as f,l as p,m as b,n as m,p as h,F as y,q as g,t as w,$ as x,s as k,v as C,x as F,y as T,z as I,A as j,B as E,C as $,D,E as B,S,G as q,H as z,I as A,J as G,K as H}from"./index-87298597.js";import{D as J,v as K,_ as L,a as O}from"./verify.4a5550c6.js";import{_ as P,u as R,g as U,a as M,s as N,b as Q,c as V,d as W,e as X,f as Y,v as Z,h as ee,t as ae,i as le,j as te,k as se,l as ie,m as ue}from"./baseinfo.d93d3633.js";const oe=P({__name:"index",setup(P){R();const oe=e(!1),ne=e(0),ce=e(!0),ve=e(!1),re=e=>{ne.value=e.detail.current,de(Ye.value,ne.value)},de=(e,a)=>{const l=e[a];"video"==Y(l.real_name)?setTimeout((()=>{fe.value=l,_e.value=!0,ce.value=!1,ve.value=!0}),50):ve.value=!1},_e=e(!1),fe=e(),pe=()=>{_e.value=!1,ce.value=!0,ne.value==Ye.value.length-1?(ne.value=0,de(Ye.value,ne.value)):ne.value+=1},be=()=>{ve.value?(_e.value=!1,ce.value=!1):ce.value=!1},me=()=>{ve.value?(_e.value=!0,ce.value=!0):ce.value=!0};e(!1);const he=()=>{Qe()},ye=()=>{s({url:"/pages/index/index"})},ge=e(),we=e("");e([]);const xe=e(),ke=e(!1),Ce=e({ip:"",port:"",device_id:""}),Fe=()=>{const e=d();Ce.value.ip=(null==e?void 0:e.ip)||U()||"127.0.0.1",Ce.value.port=(null==e?void 0:e.port)||"8080"},Te=e=>{Ce.value.ip=e},Ie=e=>{Ce.value.port=e},je=async()=>{var e;const a={...Ce.value};if(a.ip)if(a.port)try{const l=await Z(C(`${null==a?void 0:a.ip}:${a.port}`));F(a),T(l.data.app_id),I(l.data.shop_supplier_id),Q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{ke.value=!0}),150)}catch(l){k({title:x("绑定失败"),icon:"none"})}else k({title:x("請輸入連接埠"),icon:"none"});else k({title:x("請輸入伺服器位址"),icon:"none"})},Ee=e=>{ke.value=!1,e&&(xe.value=e,we.value=e.table_no)},$e=()=>{Fe(),we.value=_().table_no,xe.value=_()},De=async()=>{var e;const a={...Ce.value};if(a.ip)if(a.port)try{const l=await Z(C(`${null==a?void 0:a.ip}:${a.port}`));if(!xe.value)return void k({title:x("請查找桌位"),icon:"none"});F(a),T(l.data.app_id),I(l.data.shop_supplier_id),Q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Be()}),150)}catch(l){k({title:x("绑定失败"),icon:"none"})}else k({title:x("請輸入連接埠"),icon:"none"});else k({title:x("請輸入伺服器位址"),icon:"none"})},Be=async()=>{if(f()===xe.value.table_id)return k({title:x("绑定成功"),icon:"none"}),ge.value=!1,void me();try{const e=await ee({table_id:xe.value.table_id,old_table_id:f()});j(xe.value),Xe.value.table_no=xe.value.table_no,Ze(),k({title:e.msg,icon:"none"}),ge.value=!1}catch(e){}finally{me()}},Se=e(),qe=async()=>{if(1===Xe.value.is_call_service||1===Xe.value.is_customer_order)try{const e=await V({table_id:f()});1===parseInt(e.data.tablet.is_customer_order)?10===e.data.status?Ae():(E(!0),s({url:"/pages/index/opentable-index"})):Se.value.tiCallClick("1")}catch(e){}},ze=e(!1),Ae=()=>{ze.value=!0,be()},Ge=(e,a)=>{e?Pe(e,a):k({title:x("請輸入人數"),icon:"none"})},He=()=>{ze.value=!1,me()},Je=e(!1),Ke=e(),Le=e(null),Oe=e({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),Pe=(e,a)=>{if(Oe.value.meal_num=e,Oe.value.is_buffet=a?1:0,a)return Me();Re(e,a)},Re=async(e,a)=>{Oe.value.table_id=f(),Oe.value.meal_num=e,Oe.value.is_buffet=a?1:0;try{await ae(Oe.value);E(!0),s({url:"/pages/index/opentable-index"})}catch(l){}},Ue=e=>{if(!(Oe.value.buffet_ids.length>0&&Le.value!=e.is_comb))if(Le.value=e.is_comb,0==Le.value)Oe.value.buffet_ids=Oe.value.buffet_ids[0]!=e.id?[e.id]:[];else{const a=Oe.value.buffet_ids.indexOf(e.id);if(a>-1)Oe.value.buffet_ids.splice(a,1);else{if(Oe.value.buffet_ids.length>=2)return k({title:x("该类型套餐最多能选择{count}个",{count:2}),icon:"none"});Oe.value.buffet_ids.push(e.id)}}},Me=()=>{le().then((e=>{Ke.value=e.data,Ke.value&&Ke.value[0]&&Ue(Ke.value[0]),Je.value=!0}))},Ne=e(!1),Qe=()=>{Ne.value=!0,be()},Ve=async e=>{if(e)try{await K({password:e});ge.value=!0,xe.value=_(),we.value=xe.value.table_no,We()}catch(a){}else k({title:x("請輸入密碼"),icon:"none"})},We=()=>{(()=>{Ne.value=!1;const e=setTimeout((()=>{ge.value?be():me(),clearTimeout(e)}),300)})()},Xe=e({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),Ye=e([]),Ze=async()=>{var e,a,l,t,s,i,u;if(_()){oe.value=!0;try{const o=await M();N(o),Xe.value.name=o.data.name,Xe.value.logo=o.data.logo,Xe.value.is_call_service=parseInt(null==(a=null==(e=null==o?void 0:o.data)?void 0:e.tablet)?void 0:a.is_call_service),Xe.value.is_customer_order=parseInt(null==(t=null==(l=null==o?void 0:o.data)?void 0:l.tablet)?void 0:t.is_customer_order),Q(null==(s=o.data)?void 0:s.currency),Ye.value=(null==(u=null==(i=o.data)?void 0:i.tablet)?void 0:u.carousel)||[],Ye.value.length>0&&de(Ye.value,0),oe.value=!1}catch(o){oe.value=!1}finally{oe.value=!1}}};return a((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),i((()=>{l()&&!t()&&(Ze(),(async()=>{try{const e=await V({table_id:f()});Xe.value.table_no=e.data.table_no}catch(e){}})())})),Fe(),u({success:e=>{Ce.value.device_id=e.deviceId}}),(e,a)=>{const s=$(D("ti-layout-head"),L),i=p,u=B,d=S,_=q,f=z,k=A,C=$(D("ti-input"),te),F=$(D("ti-layout-table-list"),se),T=$(D("ti-modal"),O),I=G;return o(l)()&&!o(t)()?(n(),c(i,{key:0,class:"ti-page",onClick:a[3]||(a[3]=e=>o(X)())},{default:v((()=>[b(i,null,{default:v((()=>[oe.value?r("",!0):(n(),c(s,{key:0,ref_key:"refCallServer",ref:Se,onDoubleLogo:he,onRefresh:ye,is_call_service:Xe.value.is_call_service},null,8,["is_call_service"]))])),_:1}),oe.value?r("",!0):(n(),c(i,{key:0,class:"ti-page-content"},{default:v((()=>[b(i,{class:"ti-page-left"},{default:v((()=>[_e.value?r("",!0):(n(),c(_,{key:0,onChange:re,class:"ti-swiper",current:ne.value,autoplay:ce.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:v((()=>[(n(!0),m(y,null,h(Ye.value,((e,a)=>(n(),c(d,{class:"ti-swiper-item",key:a},{default:v((()=>["image"===o(Y)(e.real_name)?(n(),c(u,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):r("",!0),"video"===o(Y)(e.real_name)?(n(),c(u,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):r("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),_e.value?(n(),c(_,{key:1,class:"ti-swiper"},{default:v((()=>[b(d,{class:"ti-swiper-item"},{default:v((()=>{var e;return[b(f,{onEnded:pe,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=fe.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):r("",!0)])),_:1}),b(i,{class:"ti-page-right"},{default:v((()=>[b(i,{class:"ti-store-box"},{default:v((()=>[b(i,{class:"ti-store-item"},{default:v((()=>[b(u,{class:"ti-store-logo",src:Xe.value.logo},null,8,["src"]),b(k,{class:"ti-store-name"},{default:v((()=>[g(w(Xe.value.name),1)])),_:1})])),_:1}),b(i,{class:"ti-table-item"},{default:v((()=>[b(i,{class:"ti-table-number"},{default:v((()=>[g(w(o(x)("當前桌號："))+w(Xe.value.table_no),1)])),_:1}),b(i,{class:"ti-table-button",onClick:qe},{default:v((()=>[b(k,{class:"ti-table-button-text"},{default:v((()=>[g(w(o(x)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),b(J,{show:ze.value,title:"["+Xe.value.table_no+"]"+o(x)("就餐人数"),placeholder:o(x)("請輸入人數"),onExit:He,onConfirm:Ge},null,8,["show","title","placeholder"]),b(J,{show:Ne.value,title:o(x)("密碼"),password:!0,placeholder:o(x)("請輸入密碼"),onExit:We,onConfirm:Ve},null,8,["show","title","placeholder"])])),_:1})),b(T,{show:ge.value,title:o(x)("設置"),cancelText:o(x)("重置"),confirmText:o(x)("確定"),onCancel:$e,onConfirm:De},{content:v((()=>[b(i,{class:"ti-item-input"},{default:v((()=>[b(i,{class:"ti-label-box"},{default:v((()=>[b(i,{class:"ti-label-left"},{default:v((()=>[b(k,{class:"ti-label-server"},{default:v((()=>[g(w(o(x)("服務器連接地址")),1)])),_:1})])),_:1}),b(i,{class:"ti-label-right",onClick:je},{default:v((()=>[b(k,{class:"ti-label-table"},{default:v((()=>[g(w(we.value?o(x)("已選 : ")+o(W)(we.value,19):o(x)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),b(i,{class:"ti-input-box"},{default:v((()=>[b(C,{type:"text",onInput:Te,value:Ce.value.ip,placeholder:o(x)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),b(i,{class:"ti-colon"},{default:v((()=>[g(":")])),_:1}),b(i,{class:"ti-input-port"},{default:v((()=>[b(C,{type:"number",onInput:Ie,value:Ce.value.port,placeholder:o(x)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),b(F,{show:ke.value,"onUpdate:show":a[0]||(a[0]=e=>ke.value=e),onConfirm:Ee},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),b(T,{class:"ti-dialog-buffet",show:Je.value,title:o(x)("自助餐"),onCancel:a[1]||(a[1]=e=>Je.value=!1),onConfirm:a[2]||(a[2]=e=>Re(Oe.value.meal_num,Oe.value.is_buffet))},{content:v((()=>[b(i,{class:"ti-dialog-content"},{default:v((()=>[b(I,{class:"ti-buffet-scroll","scroll-y":""},{default:v((()=>[b(i,{class:"ti-buffet-list"},{default:v((()=>[(n(!0),m(y,null,h(Ke.value,(e=>(n(),c(i,{key:e.id,class:H(["ti-buffet-item",{active:Oe.value.buffet_ids.includes(e.id),disabled:Oe.value.buffet_ids.length>0&&Le.value!=e.is_comb}]),onClick:a=>Ue(e)},{default:v((()=>[b(i,{class:"ti-buffet-name"},{default:v((()=>[g(w(e.name_text||e.name),1)])),_:2},1024),b(i,null,{default:v((()=>[b(k,{class:"ti-buffet-price"},{default:v((()=>[g(w(o(ie)(e.price)),1)])),_:2},1024),b(k,{class:"ti-buffet-subPrice"},{default:v((()=>[g(w(o(ue)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):r("",!0)}}},[["__scopeId","data-v-37039438"]]);export{oe as default};
