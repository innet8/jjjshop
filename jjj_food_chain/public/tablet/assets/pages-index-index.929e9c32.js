import{u as e,a,s as l,g as t,d as s,r as i,o as u,i as n,b as o,c,e as r,f as d,h as f,j as v,k as _,l as b,w as p,m,n as h,p as y,q as g,t as w,v as x,x as C,y as k,z as I,A as T,F,B as E,C as $,$ as j,D as U,E as B,G as D,H as L,I as A,J as O,K as P,L as R,M as S,N as q,O as z,P as G,Q as H,R as J,S as K,T as M,U as N,V as Q,W as V,X as W,Y as X,Z as Y,_ as Z,a0 as ee,a1 as ae,a2 as le,a3 as te}from"./index-133812ce.js";import{D as se,v as ie,_ as ue,a as ne}from"./verify.828d12e7.js";import{_ as oe,u as ce,a as re,b as de}from"./ti-layout-table-list.7907a11c.js";const fe=oe({__name:"index",setup(oe){const fe=e(),ve=a(),{userInfo:_e}=l(fe),{tableInfo:be}=l(ve),{changeLocale:pe}=ce(),{getUserInfo:me,setUserInfo:he}=e(),{getTableInfoAsync:ye}=a();me().then((e=>{var a,l,i;t();const u=(null==(a=e.tablet)?void 0:a.language_list)||[];if(0==u.length)return;if(-1===u.findIndex((e=>e.key==t()))){const a=(null==(l=e.tablet)?void 0:l.default_language)||(null==(i=u[0])?void 0:i.key)||"en";s(),pe(a)}})).catch((e=>{})),ye();const ge=i(!1),we=i(0),xe=i(!0),Ce=i(!1),ke=e=>{var a,l;we.value=e.detail.current,Ie(null==(l=null==(a=_e.value)?void 0:a.tablet)?void 0:l.carousel,we.value)},Ie=(e,a)=>{const l=e[a];"video"==D(l.real_name)?setTimeout((()=>{Fe.value=l,Te.value=!0,xe.value=!1,Ce.value=!0}),50):Ce.value=!1},Te=i(!1),Fe=i(),Ee=()=>{var e,a,l,t;Te.value=!1,xe.value=!0,we.value==(null==(a=null==(e=_e.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(we.value=0,Ie(null==(t=null==(l=_e.value)?void 0:l.tablet)?void 0:t.carousel,we.value)):we.value+=1};i(!1);const $e=()=>{na()},je=()=>{c({url:"/pages/index/index"})},Ue=i(),Be=i("");i([]);const De=i(),Le=i(!1),Ae=i({ip:"",port:"",device_id:""}),Oe=()=>{const e=h();Ae.value.ip=(null==e?void 0:e.ip)||y()||"127.0.0.1",Ae.value.port=(null==e?void 0:e.port)||"8080"},Pe=e=>{Ae.value.ip=e},Re=e=>{Ae.value.port=e},Se=async()=>{var e;const a={...Ae.value};if(a.ip)if(a.port)try{const l=await A(O(`${null==a?void 0:a.ip}:${a.port}`));P(a),R(l.data.app_id),S(l.data.shop_supplier_id),q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Le.value=!0}),150)}catch(l){L({title:j("绑定失败"),icon:"none"})}else L({title:j("請輸入連接埠"),icon:"none"});else L({title:j("請輸入伺服器位址"),icon:"none"})},qe=e=>{Le.value=!1,e&&(De.value=e,Be.value=e.table_no)},ze=()=>{Oe(),Be.value=g().table_no,De.value=g()},Ge=async()=>{var e;const a={...Ae.value};if(a.ip)if(a.port)try{const l=await A(O(`${null==a?void 0:a.ip}:${a.port}`));if(!De.value)return void L({title:j("請查找桌位"),icon:"none"});P(a),R(l.data.app_id),S(l.data.shop_supplier_id),q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{He()}),150)}catch(l){L({title:j("绑定失败"),icon:"none"})}else L({title:j("請輸入連接埠"),icon:"none"});else L({title:j("請輸入伺服器位址"),icon:"none"})},He=async()=>{if(x()===De.value.table_id)return L({title:j("绑定成功"),icon:"none"}),void(Ue.value=!1);try{const e=await z({table_id:De.value.table_id,old_table_id:x()});G(De.value),me(),ye(),L({title:e.msg,icon:"none"}),Ue.value=!1}catch(e){}},Je=i(),Ke=i(!1),Me=async()=>{var e,a,l,t;if(1===parseInt(null==(e=null==_e?void 0:_e.value)?void 0:e.tablet.is_customer_order)){me();try{const e=await w({table_id:x()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)Ve();else{if(1==(null==(l=e.data.order)?void 0:l.is_buffet))return Ke.value=!0,void(Ze.value=!0);Ne()}else null==(t=Je.value)||t.tiCallClick("1")}catch(s){}}else null==(a=Je.value)||a.tiCallClick("1")},Ne=()=>{H(!0),c({url:"/pages/index/opentable-index"})},Qe=i(!1),Ve=()=>{Qe.value=!0},We=(e,a)=>{e?ta(e,a):L({title:j("請輸入人數"),icon:"none"})},Xe=()=>{Qe.value=!1},Ye=i(!1),Ze=i(!1),ea=i(),aa=i(null),la=i({table_id:"",meal_num:"",is_buffet:1,buffet_ids:[]}),ta=(e,a)=>{if(la.value.meal_num=e,la.value.is_buffet=a?1:0,a)return ia();sa(e,a)},sa=async(e,a)=>{if(1!=Ke.value){la.value.table_id=x(),la.value.meal_num=e,la.value.is_buffet=a?1:0;try{await J(la.value);Ne()}catch(l){}}else Ne()},ia=()=>{K().then((e=>{ea.value=e.data,Ye.value=!0}))},ua=i(!1),na=()=>{ua.value=!0},oa=async e=>{if(e)try{await ie({password:e});Ue.value=!0,De.value=g(),Be.value=De.value.table_no,ca()}catch(a){}else L({title:j("請輸入密碼"),icon:"none"})},ca=()=>{(()=>{ua.value=!1;const e=setTimeout((()=>{Ue.value,clearTimeout(e)}),300)})()},ra=i({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1});i([]);return u((()=>{n()&&o()&&c({url:"/pages/index/opentable-index"})})),r((()=>{n()&&!o()&&((async()=>{g()&&me()})(),(async()=>{try{const e=await w({table_id:x()});ra.value.table_no=e.data.table_no}catch(e){}})())})),d((()=>{var e;null==(e=Je.value)||e.showBuffet(!1,0)})),Oe(),f({success:e=>{Ae.value.device_id=e.deviceId}}),(e,a)=>{const l=M(N("ti-layout-head"),ue),t=C,s=Q,i=V,u=W,c=X,r=Y,d=M(N("ti-input"),re),f=M(N("ti-layout-table-list"),de),h=M(N("ti-modal"),ne),y=Z;return v(n)()&&!v(o)()?(_(),b(t,{key:0,class:"ti-page",onClick:a[5]||(a[5]=e=>v(B)())},{default:p((()=>[k(t,null,{default:p((()=>{var e,a;return[ge.value?m("",!0):(_(),b(l,{key:0,ref_key:"refCallServer",ref:Je,onDoubleLogo:$e,onRefresh:je,is_call_service:null==(a=null==(e=v(_e))?void 0:e.tablet)?void 0:a.is_call_service},null,8,["is_call_service"]))]})),_:1}),ge.value?m("",!0):(_(),b(t,{key:0,class:"ti-page-content"},{default:p((()=>{var e;return[k(t,{class:"ti-page-left"},{default:p((()=>[Te.value?m("",!0):(_(),b(u,{key:0,onChange:ke,class:"ti-swiper",current:we.value,autoplay:xe.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:p((()=>{var e,a;return[(_(!0),I(F,null,T(null==(a=null==(e=v(_e))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(_(),b(i,{class:"ti-swiper-item",key:a},{default:p((()=>["image"===v(D)(e.real_name)?(_(),b(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):m("",!0),"video"===v(D)(e.real_name)?(_(),b(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):m("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),Te.value?(_(),b(u,{key:1,class:"ti-swiper"},{default:p((()=>[k(i,{class:"ti-swiper-item"},{default:p((()=>{var e;return[k(c,{onEnded:Ee,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=Fe.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):m("",!0)])),_:1}),k(t,{class:"ti-page-right"},{default:p((()=>[k(t,{class:"ti-store-box"},{default:p((()=>[k(t,{class:"ti-store-item"},{default:p((()=>{var e;return[k(s,{class:"ti-store-logo",src:null==(e=v(_e))?void 0:e.logo},null,8,["src"]),k(r,{class:"ti-store-name"},{default:p((()=>{var e;return[E($(null==(e=v(_e))?void 0:e.name),1)]})),_:1})]})),_:1}),k(t,{class:"ti-table-item"},{default:p((()=>[k(t,{class:"ti-table-number"},{default:p((()=>{var e;return[E($(v(j)("當前桌號："))+$(null==(e=v(be))?void 0:e.table_no),1)]})),_:1}),k(t,{class:"ti-table-button",onClick:Me},{default:p((()=>[k(r,{class:"ti-table-button-text"},{default:p((()=>[E($(v(j)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),k(se,{show:Qe.value,title:"["+(null==(e=v(be))?void 0:e.table_no)+"]"+v(j)("就餐人数"),placeholder:v(j)("請輸入人數"),onExit:Xe,onConfirm:We},null,8,["show","title","placeholder"]),k(se,{show:ua.value,title:v(j)("密碼"),password:!0,placeholder:v(j)("請輸入密碼"),onExit:ca,onConfirm:oa},null,8,["show","title","placeholder"])]})),_:1})),k(h,{show:Ue.value,title:v(j)("設置"),cancelText:v(j)("重置"),confirmText:v(j)("確定"),onCancel:ze,onConfirm:Ge},{content:p((()=>[k(t,{class:"ti-item-input"},{default:p((()=>[k(t,{class:"ti-label-box"},{default:p((()=>[k(t,{class:"ti-label-left"},{default:p((()=>[k(r,{class:"ti-label-server"},{default:p((()=>[E($(v(j)("服務器連接地址")),1)])),_:1})])),_:1}),k(t,{class:"ti-label-right",onClick:Se},{default:p((()=>[k(r,{class:"ti-label-table"},{default:p((()=>[E($(Be.value?v(j)("已選 : ")+v(U)(Be.value,19):v(j)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),k(t,{class:"ti-input-box"},{default:p((()=>[k(d,{type:"text",onInput:Pe,value:Ae.value.ip,placeholder:v(j)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),k(t,{class:"ti-colon"},{default:p((()=>[E(":")])),_:1}),k(t,{class:"ti-input-port"},{default:p((()=>[k(d,{type:"number",onInput:Re,value:Ae.value.port,placeholder:v(j)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),k(f,{show:Le.value,"onUpdate:show":a[0]||(a[0]=e=>Le.value=e),onConfirm:qe},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),k(h,{class:"ti-dialog-buffet",show:Ye.value,title:v(j)("自助餐"),onCancel:a[1]||(a[1]=e=>(la.value.buffet_ids=[],void(Ye.value=!1))),onConfirm:a[2]||(a[2]=e=>{0!=la.value.buffet_ids.length?(Ye.value=!1,Ze.value=!0):L({title:j("请选择自助餐"),icon:"none"})})},{content:p((()=>[k(t,{class:"ti-dialog-content"},{default:p((()=>[k(y,{class:"ti-buffet-scroll","scroll-y":""},{default:p((()=>[k(t,{class:"ti-buffet-list"},{default:p((()=>[(_(!0),I(F,null,T(ea.value,(e=>(_(),b(t,{key:e.id,class:ee(["ti-buffet-item",{active:la.value.buffet_ids.includes(e.id),disabled:la.value.buffet_ids.length>0&&aa.value!=e.is_comb}]),onClick:a=>(e=>{if(!(la.value.buffet_ids.length>0&&aa.value!=e.is_comb))if(aa.value=e.is_comb,0==aa.value)la.value.buffet_ids=la.value.buffet_ids[0]!=e.id?[e.id]:[];else{const a=la.value.buffet_ids.indexOf(e.id);if(a>-1)la.value.buffet_ids.splice(a,1);else{if(la.value.buffet_ids.length>=2)return L({title:te("最多只能选择{count}个",{count:2}),icon:"none"});la.value.buffet_ids.push(e.id)}}})(e)},{default:p((()=>[k(t,{class:"ti-buffet-name"},{default:p((()=>[E($(e.name_text||e.name),1)])),_:2},1024),k(t,null,{default:p((()=>[k(r,{class:"ti-buffet-price"},{default:p((()=>[E($(v(ae)(e.price)),1)])),_:2},1024),k(r,{class:"ti-buffet-subPrice"},{default:p((()=>[E($(v(le)(e.price)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),k(h,{class:"ti-dialog-buffet",show:Ze.value,title:v(j)("提示"),onCancel:a[3]||(a[3]=e=>(Ze.value=!1,void(Ke.value=!1))),onConfirm:a[4]||(a[4]=e=>sa(la.value.meal_num,la.value.is_buffet))},{content:p((()=>[k(t,{class:"ti-dialog-content"},{default:p((()=>[k(y,{class:"ti-buffet-scroll","scroll-y":""},{default:p((()=>[k(t,{class:"ti-buffet-message"},{default:p((()=>[k(t,{class:"ti-buffet-case"}),k(t,{class:"ti-buffet-text"},{default:p((()=>[E($(v(j)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),k(t,{class:"ti-buffet-message"},{default:p((()=>[k(t,{class:"ti-buffet-case"}),k(t,{class:"ti-buffet-text"},{default:p((()=>[E($(v(j)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),k(t,{class:"ti-buffet-message"},{default:p((()=>[k(t,{class:"ti-buffet-case"}),k(t,{class:"ti-buffet-text"},{default:p((()=>[E($(v(j)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),k(t,{class:"ti-buffet-message"},{default:p((()=>[k(t,{class:"ti-buffet-case"}),k(t,{class:"ti-buffet-text"},{default:p((()=>[E($(v(j)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),k(t,{class:"ti-buffet-tips"},{default:p((()=>[E($(v(j)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"])])),_:1})):m("",!0)}}},[["__scopeId","data-v-bc71890a"]]);export{fe as default};
