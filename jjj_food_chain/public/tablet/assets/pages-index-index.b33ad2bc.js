import{r as e,o as a,i as l,a as t,b as s,c as i,g as u,u as o,d as n,e as c,w as r,f as v,h as d,j as _,k as p,l as f,m,F as b,n as h,t as y,$ as w,s as g,p as x,q as k,v as C,x as F,y as T,z as I,A as j,B as E,S as $,C as N,D,E as B}from"./index-57a355e6.js";import{D as S,v as q,_ as z,a as A}from"./verify.83e34804.js";import{_ as L,u as R,g as U,a as G,b as H,s as J,c as K,d as M,e as O,f as P,v as Q,h as V,i as W,j as X,k as Y,t as Z,l as ee,m as ae}from"./baseinfo.5443f927.js";const le=L({__name:"index",setup(L){R();const le=e(!1),te=e(0),se=e(!0),ie=e(!1),ue=e=>{te.value=e.detail.current,oe(Ge.value,te.value)},oe=(e,a)=>{const l=e[a];"video"==P(l.real_name)?setTimeout((()=>{ce.value=l,ne.value=!0,se.value=!1,ie.value=!0}),50):ie.value=!1},ne=e(!1),ce=e(),re=()=>{ne.value=!1,se.value=!0,te.value==Ge.value.length-1?(te.value=0,oe(Ge.value,te.value)):te.value+=1},ve=()=>{ie.value?(ne.value=!1,se.value=!1):se.value=!1},de=()=>{ie.value?(ne.value=!0,se.value=!0):se.value=!0};e(!1);const _e=()=>{Ae()},pe=()=>{s({url:"/pages/index/index"})},fe=e(),me=e("");e([]);const be=e(),he=e(!1),ye=e({ip:"",port:"",device_id:""}),we=()=>{const e=U();ye.value.ip=(null==e?void 0:e.ip)||G()||"127.0.0.1",ye.value.port=(null==e?void 0:e.port)||"8080"},ge=e=>{ye.value.ip=e},xe=e=>{ye.value.port=e},ke=async()=>{var e;const a={...ye.value};if(a.ip)if(a.port)try{const l=await Q(V(`${null==a?void 0:a.ip}:${a.port}`));W(a),x(l.data.app_id),k(l.data.shop_supplier_id),K(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{he.value=!0}),150)}catch(l){g({title:w("绑定失败"),icon:"none"})}else g({title:w("請輸入連接埠"),icon:"none"});else g({title:w("請輸入伺服器位址"),icon:"none"})},Ce=e=>{he.value=!1,e&&(be.value=e,me.value=e.table_no)},Fe=()=>{we(),me.value=d().table_no,be.value=d()},Te=async()=>{var e;const a={...ye.value};if(a.ip)if(a.port)try{const l=await Q(V(`${null==a?void 0:a.ip}:${a.port}`));if(!be.value)return void g({title:w("請查找桌位"),icon:"none"});W(a),x(l.data.app_id),k(l.data.shop_supplier_id),K(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Ie()}),150)}catch(l){g({title:w("绑定失败"),icon:"none"})}else g({title:w("請輸入連接埠"),icon:"none"});else g({title:w("請輸入伺服器位址"),icon:"none"})},Ie=async()=>{if(C()===be.value.table_id)return g({title:w("绑定成功"),icon:"none"}),fe.value=!1,void de();try{const e=await X({table_id:be.value.table_id,old_table_id:C()});F(be.value),He(),g({title:e.msg,icon:"none"}),fe.value=!1}catch(e){}finally{de()}},je=e(),Ee=async()=>{if(1===Ue.value.is_call_service||1===Ue.value.is_customer_order)try{const e=await Y({table_id:C()});1===parseInt(e.data.tablet.is_customer_order)?10===e.data.status?Ne():(T(!0),s({url:"/pages/index/opentable-index"})):je.value.tiCallClick("1")}catch(e){}},$e=e(!1),Ne=()=>{$e.value=!0,ve()},De=e=>{e?qe(e):g({title:w("請輸入人數"),icon:"none"})},Be=()=>{$e.value=!1,de()},Se=e({table_id:"",meal_num:""}),qe=async e=>{Se.value.table_id=C(),Se.value.meal_num=e;try{await Z(Se.value);T(!0),s({url:"/pages/index/opentable-index"})}catch(a){}},ze=e(!1),Ae=()=>{ze.value=!0,ve()},Le=async e=>{if(e)try{await q({password:e});fe.value=!0,be.value=d(),me.value=be.value.table_no,Re()}catch(a){}else g({title:w("請輸入密碼"),icon:"none"})},Re=()=>{(()=>{ze.value=!1;const e=setTimeout((()=>{fe.value?ve():de(),clearTimeout(e)}),300)})()},Ue=e({name:"",logo:"",tableNo:"",is_call_service:1,is_customer_order:1}),Ge=e([]),He=async()=>{var e,a,l,t,s,i,u;if(d()){le.value=!0;try{const o=await H();J(o),Ue.value.name=o.data.name,Ue.value.logo=o.data.logo,Ue.value.tableNo=d().table_no,Ue.value.is_call_service=parseInt(null==(a=null==(e=null==o?void 0:o.data)?void 0:e.tablet)?void 0:a.is_call_service),Ue.value.is_customer_order=parseInt(null==(t=null==(l=null==o?void 0:o.data)?void 0:l.tablet)?void 0:t.is_customer_order),K(null==(s=o.data)?void 0:s.currency),Ge.value=(null==(u=null==(i=o.data)?void 0:i.tablet)?void 0:u.carousel)||[],Ge.value.length>0&&oe(Ge.value,0),le.value=!1}catch(o){le.value=!1}finally{le.value=!1}}};return a((()=>{l()&&t()&&s({url:"/pages/index/opentable-index"})})),i((()=>{l()&&!t()&&He()})),we(),u({success:e=>{ye.value.device_id=e.deviceId}}),(e,a)=>{const s=I(j("ti-layout-head"),z),i=_,u=E,d=$,g=N,x=D,k=B,C=I(j("ti-input"),ee),F=I(j("ti-modal"),A),T=I(j("ti-layout-table-list"),ae);return o(l)()&&!o(t)()?(n(),c(i,{key:0,class:"ti-page",onClick:a[1]||(a[1]=e=>o(O)())},{default:r((()=>[p(i,null,{default:r((()=>[le.value?v("",!0):(n(),c(s,{key:0,ref_key:"refCallServer",ref:je,onDoubleLogo:_e,onRefresh:pe,is_call_service:Ue.value.is_call_service},null,8,["is_call_service"]))])),_:1}),le.value?v("",!0):(n(),c(i,{key:0,class:"ti-page-content"},{default:r((()=>[p(i,{class:"ti-page-left"},{default:r((()=>[ne.value?v("",!0):(n(),c(g,{key:0,onChange:ue,class:"ti-swiper",current:te.value,autoplay:se.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:r((()=>[(n(!0),f(b,null,m(Ge.value,((e,a)=>(n(),c(d,{class:"ti-swiper-item",key:a},{default:r((()=>["image"===o(P)(e.real_name)?(n(),c(u,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):v("",!0),"video"===o(P)(e.real_name)?(n(),c(u,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):v("",!0)])),_:2},1024)))),128))])),_:1},8,["current","autoplay"])),ne.value?(n(),c(g,{key:1,class:"ti-swiper"},{default:r((()=>[p(d,{class:"ti-swiper-item"},{default:r((()=>{var e;return[p(x,{onEnded:re,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ce.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):v("",!0)])),_:1}),p(i,{class:"ti-page-right"},{default:r((()=>[p(i,{class:"ti-store-box"},{default:r((()=>[p(i,{class:"ti-store-item"},{default:r((()=>[p(u,{class:"ti-store-logo",src:Ue.value.logo},null,8,["src"]),p(k,{class:"ti-store-name"},{default:r((()=>[h(y(Ue.value.name),1)])),_:1})])),_:1}),p(i,{class:"ti-table-item"},{default:r((()=>[p(i,{class:"ti-table-number"},{default:r((()=>[h(y(o(w)("當前桌號："))+y(Ue.value.tableNo),1)])),_:1}),p(i,{class:"ti-table-button",onClick:Ee},{default:r((()=>[p(k,{class:"ti-table-button-text"},{default:r((()=>[h(y(o(w)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),p(S,{show:$e.value,title:"["+Ue.value.tableNo+"]"+o(w)("就餐人数"),placeholder:o(w)("請輸入人數"),onExit:Be,onConfirm:De},null,8,["show","title","placeholder"]),p(S,{show:ze.value,title:o(w)("密碼"),password:!0,placeholder:o(w)("請輸入密碼"),onExit:Re,onConfirm:Le},null,8,["show","title","placeholder"])])),_:1})),p(F,{show:fe.value,title:o(w)("設置"),cancelText:o(w)("重置"),confirmText:o(w)("確定"),onCancel:Fe,onConfirm:Te},{content:r((()=>[p(i,{class:"ti-item-input"},{default:r((()=>[p(i,{class:"ti-label-box"},{default:r((()=>[p(i,{class:"ti-label-left"},{default:r((()=>[p(k,{class:"ti-label-server"},{default:r((()=>[h(y(o(w)("服務器連接地址")),1)])),_:1})])),_:1}),p(i,{class:"ti-label-right",onClick:ke},{default:r((()=>[p(k,{class:"ti-label-table"},{default:r((()=>[h(y(me.value?o(w)("已選 : ")+o(M)(me.value,19):o(w)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),p(i,{class:"ti-input-box"},{default:r((()=>[p(C,{type:"text",onInput:ge,value:ye.value.ip,placeholder:o(w)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),p(i,{class:"ti-colon"},{default:r((()=>[h(":")])),_:1}),p(i,{class:"ti-input-port"},{default:r((()=>[p(C,{type:"number",onInput:xe,value:ye.value.port,placeholder:o(w)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),p(T,{show:he.value,"onUpdate:show":a[0]||(a[0]=e=>he.value=e),onConfirm:Ce},null,8,["show"])])),_:1})):v("",!0)}}},[["__scopeId","data-v-fc44f856"]]);export{le as default};
