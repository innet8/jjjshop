import{a5 as e,r as t,a6 as l,a7 as a,a8 as s,h as u,x as i,v as o,w as c,F as n,y as d,j as r,Z as v,z as _,A as p,k as f,a9 as m,X as h,t as y,Y as g,T as b,aa as w,$ as x,ab as k,ac as C,f as A,ad as I,R as T,S,_ as L,a0 as P,ae as O,af as U,q as R,ag as B,E as F,a4 as N,ah as j,ai as K,d as D,aj as E,ak as Q,a1 as $,al as W,g as Y,am as H,o as J,e as G,l as M,m as V,an as q,n as z,L as X,ao as Z,B as ee,C as te,G as le,H as ae,I as se,J as ue,K as ie,O as oe,c as ce,M as ne,N as de}from"./index-b578dd66.js";import{a as re,b as ve,D as _e,v as pe,_ as fe}from"./verify.e13a13f4.js";import{_ as me,c as he,e as ye,f as ge,u as be,a as we,b as xe}from"./ti-layout-table-list.9fb88962.js";const ke=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,Ce=""+new URL("icon-lock-bd74ef9c.svg",import.meta.url).href;const Ae="./static/stepper-right.svg",Ie="./static/stepper-left.svg",Te=me({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null}},emits:["update:menuId"],setup(e,{emit:w}){const x=e,k=t(0),C=t(0),A=t([]),I=t(!1),T=t(!1),S=t(0);l((()=>x.list),(async e=>{if(await a(),!e||0==e.length)return;const t=s().in(this);if(e.map(((e,l)=>{t.select(`#scroll-item-${l}`).boundingClientRect((e=>{if(!e)return;const t=A.value;t[l]=e.width+10,A.value=t})).exec()})),x.menuId>0){const e=x.list.findIndex((e=>e.category_id==x.menuId));e>-1&&L(e)}t.select("#ti-menu-box").boundingClientRect().exec((e=>{var t;A.value.reduce(((e,t)=>e+t),0)>(null==(t=e[0])?void 0:t.width)?T.value=!0:T.value=!1}))}),{deep:!0,immediate:!0});const L=e=>{C.value=e,k.value=A.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(A.value[e]+100),w("update:menuId",x.list[e].category_id)},P=e=>{0!=e.detail.scrollLeft?I.value=!0:I.value=!1,!T.value&&S.value>e.detail.scrollLeft&&(T.value=!0),S.value=e.detail.scrollLeft},O=e=>{T.value=!1};function U(){k.value=S.value+m().screenWidth/2,S.value=k.value,I.value=!0}function R(){k.value=S.value-m().screenWidth/2,S.value=k.value,T.value=!0}return(e,t)=>{const l=h,a=y,s=g,m=b;return u(),i("div",{id:"ti-menu-box"},[o(s,{class:"ti-dish-menu","scroll-left":k.value,"scroll-x":"","enable-flex":"","scroll-with-animation":"",onScroll:P,onScrolltolower:O},{default:c((()=>[o(a,{class:"ti-menu-content"},{default:c((()=>[(u(!0),i(n,null,d(x.list,((t,s)=>(u(),r(a,{key:s,class:v(["ti-menu-item",{active:s==C.value}]),id:`scroll-item-${s}`,onClick:e=>L(s)},{default:c((()=>[o(l,{class:"ti-menu-title"},{default:c((()=>[_(p(0===s?e.$t(t.name_text):t.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"]),T.value?(u(),r(a,{key:0,class:"stepper stepper-right",onClick:U},{default:c((()=>[o(m,{src:Ae,mode:"scaleToFill"})])),_:1})):f("",!0),I.value?(u(),r(a,{key:1,class:"stepper stepper-left",onClick:R},{default:c((()=>[o(m,{src:Ie,mode:"scaleToFill"})])),_:1})):f("",!0)])}}},[["__scopeId","data-v-03ee3cac"]]),Se=me({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId","update:isSpecial"],setup(h,{emit:I}){const T=t([]),S=t(0),L=t(0),P=w((()=>{let e=(T.value.find((e=>e.category_id==S.value))||{}).child||[];return e&&e.length>0&&(e=[{name_text:x("全部"),category_id:0}].concat(e)),e})),O=w((()=>T.value.find((e=>e.category_id==S.value)))),U=w((()=>P.value.find((e=>e.category_id==L.value))));l((()=>S.value),(()=>{var e;N.value=!1,F.value=!1,P&&P.value.length>0&&(L.value=P.value[0].category_id,a((()=>{const e=s().in(this);e.selectAll(".ti-secondary-item").boundingClientRect(),e.select("#ti-dish-secondary-box").boundingClientRect(),e.exec((e=>{var t,l;(null==(t=e[0])?void 0:t.reduce(((e,t)=>e+t.width),0))>(null==(l=e[1])?void 0:l.width)?N.value=!0:N.value=!1}))}))),j.value=0,I("update:isSpecial",null==(e=O.value)?void 0:e.is_special),I("update:categoryId",S.value)}));const R=async(t,l)=>{try{const a=await function(t){return e("product.category/index",{},{isLoading:t})}(t);a.data.list&&(T.value=[{name_text:x("全部"),category_id:0}].concat(a.data.list),l&&(S.value=T.value[0].category_id))}catch(a){}};R(!0,!0),k("closeShowLanguage",(e=>{e.isSelectLanguage&&C()&&setTimeout((()=>{R(!1)}),500)})),k("refresh",(e=>{R(!1,!1)}));const B=t(0),F=t(!1),N=t(!1),j=t(0),K=e=>{0!=e.detail.scrollLeft?F.value=!0:F.value=!1,!N.value&&j.value>e.detail.scrollLeft&&(N.value=!0),j.value=e.detail.scrollLeft},D=e=>{N.value=!1};function E(){B.value=j.value+m().screenWidth/2,j.value=B.value,F.value=!0}function Q(){B.value=j.value-m().screenWidth/2,j.value=B.value,N.value=!0}return(e,t)=>{const l=y,a=g,s=b;return u(),r(l,{class:"ti-category-box"},{default:c((()=>[o(Te,{list:T.value,menuId:S.value,"onUpdate:menuId":t[0]||(t[0]=e=>S.value=e)},null,8,["list","menuId"]),o(l,{id:"ti-dish-secondary-box"},{default:c((()=>[o(a,{class:"ti-dish-secondary-menu","scroll-x":"","enable-flex":"","scroll-with-animation":"","scroll-left":B.value,onScroll:K,onScrolltolower:D},{default:c((()=>[o(l,{class:"ti-dish-secondary"},{default:c((()=>[(u(!0),i(n,null,d(A(P),((e,t)=>(u(),r(l,{key:t,class:v([{active:e.category_id==L.value},"ti-secondary-item"]),onClick:t=>{return l=e.category_id,L.value=l,I("update:isSpecial",null==(a=U.value)?void 0:a.is_special),void I("update:categoryId",L.value>0?L.value:S.value);var l,a}},{default:c((()=>[_(p(0===t?A(x)(e.name_text):e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"]),N.value?(u(),r(l,{key:0,class:"stepper stepper-right",onClick:E},{default:c((()=>[o(s,{src:Ae,mode:"scaleToFill"})])),_:1})):f("",!0),F.value?(u(),r(l,{key:1,class:"stepper stepper-left",onClick:Q},{default:c((()=>[o(s,{src:Ie,mode:"scaleToFill"})])),_:1})):f("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-23a59c9d"]]);function Le(t,l){return e("order.Order/getUnSendKitchen",t,{isLoading:l})}function Pe(t){return e("order.Order/sendKitchen",t,{isLoading:!0,isMessage:!1})}const Oe=me({__name:"goods-detail",props:{show:{type:Boolean,default:!1},productId:{type:Number,default:null}},emits:["update:show","success"],setup(a,{emit:s}){const m=a,w=t({}),k=t(!1),C=t(!1),N=t({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed:[],bag_price:0,delivery:I()?30:40,describe:null,is_buffet:1});l((()=>m.show),(()=>{m.show&&j()}));const j=async()=>{var t,l,a,s,u,i,o,c,n,d,r;if(!k.value||m.productId)try{k.value=!0;const v=await(r=m.productId,e("product.product/detail",{product_id:r}));w.value=v.data,N.value.product_id=null==(t=w.value)?void 0:t.product_id,N.value.price=null==(l=w.value)?void 0:l.product_price,N.value.product_price=null==(a=w.value)?void 0:a.product_price,N.value.is_buffet=null==(s=w.value)?void 0:s.is_buffet,(null==(u=w.value)?void 0:u.sku)&&(null==(i=w.value)?void 0:i.sku.length)>0&&(null==(o=w.value)||o.sku.some((e=>{if(e.stock_num>0)return N.value.product_sku_id=e.product_sku_id,!0}))),(null==(c=w.value)?void 0:c.product_attr)&&(null==(n=w.value)?void 0:n.product_attr.length)>0&&(null==(d=w.value)||d.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?N.value.attr[t]=0:N.value.attr[t]=null}))),N.value.feed&&N.value.feed.length>0&&(N.value.feed=[])}catch(v){}finally{k.value=!1}},K=async()=>{var t,l,a,u,i,o,c,n,d;if(C.value)return;const r={...N.value};r.attr=r.attr.join(","),r.feed=r.feed.join(",");let v=[];(null==(t=w.value)?void 0:t.sku)&&(null==(l=w.value)?void 0:l.sku.length)>0&&v.push(null==(a=w.value)?void 0:a.sku.find((e=>e.product_sku_id==N.value.product_sku_id)).spec_name_text),(null==(u=w.value)?void 0:u.product_attr)&&(null==(i=w.value)?void 0:i.product_attr.length)&&(null==(o=w.value)||o.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0&&(null==e?void 0:e.attribute_value[N.value.attr[t]])&&v.push(null==e?void 0:e.attribute_value[N.value.attr[t]])}))),(null==(c=w.value)?void 0:c.product_feed)&&(null==(n=w.value)?void 0:n.product_feed.length)>0&&(null==(d=w.value)||d.product_feed.map(((e,t)=>{D(t)&&(v.push(e.feed_name_text),r.price=O(r.price,null==e?void 0:e.price))}))),r.describe=v.join(";"),r.delivery=I()?30:40,r.order_id=U(),r.table_id=R();try{C.value=!0;const t=await function(t){return e("order.Order/add",t)}(r);1==t.code&&(B(t.data.order_id),F({title:t.msg,icon:"none"}),s("update:show",!1),setTimeout((()=>{s("success")}),100))}catch(_){}finally{C.value=!1}},D=e=>N.value.feed.indexOf(e)>-1,E=(e,t)=>N.value.attr[e]==t;return(e,t)=>{const l=b,a=y,k=h,I=g,O=T(S("ti-modal"),re);return u(),r(O,{show:m.show,title:A(x)("商品詳情"),cancelText:A(x)("取消"),confirmText:A(x)("確定"),confirmLoading:C.value,onCancel:t[0]||(t[0]=e=>s("update:show",!1)),onConfirm:K},{content:c((()=>[o(a,{class:"ti-dialog-content"},{default:c((()=>[o(a,{class:"ti-detail-box"},{default:c((()=>[o(a,{class:"ti-detail-image"},{default:c((()=>{var e,t,a,s;return[(null==(e=w.value)?void 0:e.image)&&(null==(t=w.value)?void 0:t.image[0])&&(null==(a=w.value)?void 0:a.image[0].file_path)?(u(),r(l,{key:0,src:null==(s=w.value)?void 0:s.image[0].file_path,mode:"widthFix"},null,8,["src"])):f("",!0)]})),_:1}),o(a,{class:"ti-detail-con"},{default:c((()=>[o(a,{class:"ti-detail-title text-ellipsis"},{default:c((()=>{var e;return[_(p(null==(e=w.value)?void 0:e.product_name_text),1)]})),_:1}),o(a,{class:"ti-price-box"},{default:c((()=>[o(k,{class:"ti-detail-unit"},{default:c((()=>[_(p(A(x)("單價：")),1)])),_:1}),o(k,{class:"ti-detail-price"},{default:c((()=>{var e;return[_(p(A(L)((null==(e=w.value)?void 0:e.product_price)||0)),1)]})),_:1}),o(k,{class:"ti-detail-subPrice"},{default:c((()=>{var e;return[_(p(A(P)((null==(e=w.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),o(a,{class:"ti-price-box"},{default:c((()=>[o(k,{class:"ti-detail-unit"},{default:c((()=>[_(p(A(x)("單位：")),1)])),_:1}),o(k,{class:"ti-detail-price"},{default:c((()=>{var e;return[_(p(null==(e=w.value)?void 0:e.product_unit_text),1)]})),_:1})])),_:1})])),_:1})])),_:1}),o(a,{class:"ti-detail-specs"},{default:c((()=>[o(I,{"scroll-y":""},{default:c((()=>[o(a,{class:"ti-specs-box"},{default:c((()=>{var e,t,l,s,m,h,y;return[(null==(e=w.value)?void 0:e.sku)&&(null==(t=w.value)?void 0:t.sku.length)>0?(u(),r(a,{key:0,class:"ti-specs-item"},{default:c((()=>[o(a,{class:"ti-specs-title"},{default:c((()=>[_(p(A(x)("規格")),1)])),_:1}),o(a,{class:"ti-specs-child"},{default:c((()=>{var e;return[(u(!0),i(n,null,d(null==(e=w.value)?void 0:e.sku,(e=>(u(),r(a,{key:e.product_sku_id,class:v([{active:e.product_sku_id==N.value.product_sku_id,disabled:e.stock_num<=0},"ti-child-item"]),onClick:t=>(e=>{e.stock_num<=0||N.value.product_sku_id!=e.product_sku_id&&(N.value.product_sku_id=e.product_sku_id)})(e)},{default:c((()=>[o(k,{class:"ti-child-name"},{default:c((()=>[_(p(e.spec_name_text),1)])),_:2},1024),o(k,{class:"ti-child-price"},{default:c((()=>[_(p(A(L)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),o(k,{class:"ti-child-subPrice"},{default:c((()=>[_(p(A(P)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):f("",!0),(null==(l=w.value)?void 0:l.product_attr)&&(null==(s=w.value)?void 0:s.product_attr.length)>0?(u(!0),i(n,{key:1},d(null==(m=w.value)?void 0:m.product_attr,((e,t)=>(u(),r(a,{key:t,class:"ti-specs-item"},{default:c((()=>[o(a,{class:"ti-specs-title"},{default:c((()=>[_(p(e.attribute_name_text),1)])),_:2},1024),o(a,{class:"ti-specs-child"},{default:c((()=>[(u(!0),i(n,null,d(null==e?void 0:e.attribute_value_text,((e,l)=>(u(),r(a,{key:l,class:v([{active:E(t,l)},"ti-child-item"]),onClick:e=>((e,t)=>{N.value.attr[e]=t})(t,l)},{default:c((()=>[o(k,{class:"ti-child-name"},{default:c((()=>[_(p(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)):f("",!0),(null==(h=w.value)?void 0:h.product_feed)&&(null==(y=w.value)?void 0:y.product_feed.length)>0?(u(),r(a,{key:2,class:"ti-specs-item"},{default:c((()=>[o(a,{class:"ti-specs-title"},{default:c((()=>[_(p(A(x)("加料")),1)])),_:1}),o(a,{class:"ti-specs-child"},{default:c((()=>{var e;return[(u(!0),i(n,null,d(null==(e=w.value)?void 0:e.product_feed,((e,t)=>(u(),r(a,{key:t,class:v([{active:D(t)},"ti-child-item"]),onClick:e=>(e=>{const t=N.value.feed.indexOf(e);t>=0?N.value.feed.splice(t,1):N.value.feed.push(e)})(t)},{default:c((()=>[o(k,{class:"ti-child-name"},{default:c((()=>[_(p(e.feed_name_text),1)])),_:2},1024),o(k,{class:"ti-child-price"},{default:c((()=>[_(p(A(L)((null==e?void 0:e.price)||0)),1)])),_:2},1024),o(k,{class:"ti-child-subPrice"},{default:c((()=>[_(p(A(P)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):f("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText","confirmLoading"])}}},[["__scopeId","data-v-9d75414c"]]),Ue=me({__name:"dish-car-order-nav",emits:["car","confirm"],setup(e,{expose:l,emit:a}){const s=()=>{a("car")},i=()=>{a("confirm")},n=t(),d=t(!1),v=async()=>{var e;try{const t=await Le({table_id:R()},!1);n.value=(null==(e=t.data)?void 0:e.detail)||{},n.value.totalNum>0?d.value=!0:d.value=!1}catch(t){}};return v(),l({getCarData:v}),(e,t)=>{const l=b,a=h,v=y;return u(),r(v,{class:"ti-car-order"},{default:c((()=>[o(v,{class:"ti-order-total",onClick:s},{default:c((()=>[o(l,{class:"ti-total-image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE9SURBVHgB7ZjxrcIgEMY/Xt4AbvAYwRHc4DmKbuAG6gR1A92g3UA3sE6gTnAesZqG1gLKSf/oL7nQwKV8Be6AAj1DPR6IaMTF6NmgVIlUGDFsR2qSVUJ7I8iQIwWVKF2zWU3UBH2AhexJhtx8dFufPw5NF8gwYTu2jbxLkIYsmV3hEiQdYdoepdSCGn38OpzXbP+Qo2Q7YCAA9aqhyhNbyK6jHe+Zcy9PFrQgec52v11R9o0IayTe1IJKu6JL0B8S4EqM0lztii5BGvIELWoNeU52ReopC4qyAvL472PmWECyZAiF5LJ1Ti9uM8pDlMb9yKnxOWbNHHj/KjDwJs4pq8PTN+VizFb4DHuofxD88qW1MGcx/UPFjFsi5RzLv84nmTr0eBL3OEPNnxGrmP7vCDKXuk2V1Bax/Qd8uQE+N6CHpHz4IAAAAABJRU5ErkJggg=="}),o(a,{class:"ti-total-price"},{default:c((()=>{var e;return[_(p(A(L)((null==(e=n.value)?void 0:e.totalPrice)||0)),1)]})),_:1}),o(a,{class:"ti-total-subPrice"},{default:c((()=>{var e;return[_(p(A(P)((null==(e=n.value)?void 0:e.totalPrice)||0)),1)]})),_:1})])),_:1}),d.value?(u(),r(v,{key:0,class:"ti-total-badge-box"},{default:c((()=>[o(a,{class:"ti-total-badge"},{default:c((()=>{var e;return[_(p(null==(e=n.value)?void 0:e.totalNum),1)]})),_:1})])),_:1})):f("",!0),o(v,{class:"ti-order-btn",onClick:i},{default:c((()=>[o(a,{class:"ti-btn-text"},{default:c((()=>[_(p(e.$t("下單")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a086c2c0"]]),Re=me({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})},isOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["change"],setup(l,{emit:a}){const s=l,i=t(!1),n=async t=>{var l,u,o;if(0==s.buyContinue&&1==s.isOverTime&&"up"==t)return void j("buffet_remain",x("用餐時間已到，無法繼續下單"));if(1==s.isOverTime&&1==(null==(l=s.productItem)?void 0:l.is_buffet_product)&&"up"==t)return void j("buffet_remain",x("自助餐时间已到达，自助餐商品不可继续下单"));const c={order_product_id:null==(u=s.productItem)?void 0:u.order_product_id,product_num:null==(o=s.productItem)?void 0:o.total_num,type:t};"up"==t?c.product_num+=1:c.product_num-=1;try{i.value=!0;const t=await function(t){return e("order.Order/sub",t)}(c);1==t.code&&a("change")}catch(n){}finally{i.value=!1}};return(e,t)=>{const a=y;return u(),r(a,{class:"ti-number-box",onClick:t[2]||(t[2]=N((()=>{}),["stop"]))},{default:c((()=>[o(a,{class:"ti-number-btn ti-number-minus",disabled:!1,onClick:t[0]||(t[0]=e=>n("down"))},{default:c((()=>[o(a,{class:"ti-number-minus-reduce"})])),_:1}),o(a,{class:"ti-number-input"},{default:c((()=>[_(p(l.productItem.total_num),1)])),_:1}),o(a,{class:"ti-number-btn ti-number-plus",disabled:!1,onClick:t[1]||(t[1]=e=>n("up"))},{default:c((()=>[o(a,{class:"ti-number-plus-add"}),o(a,{class:"ti-number-plus-add2"})])),_:1})])),_:1})}}},[["__scopeId","data-v-a257d356"]]),Be=me({__name:"dish-car-ordering-list",props:{isOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["success","change","sendkitchenFail"],setup(e,{emit:l}){const a=e,s=t(!1),v=t(),m=t(),b=t({table_id:""}),w=async e=>{var t;b.table_id=R();try{const e=await Le(b,!1);v.value=e.data.detail,m.value=(null==(t=e.data.detail)?void 0:t.unSendKitchenProduct)||[],l("change")}catch(a){}},C=async e=>{try{s.value=!0;const e=await Pe({table_id:R()});F({title:x(e.msg),icon:"none"}),setTimeout((()=>{l("success")}),500)}catch(t){l("sendkitchenFail",t)}finally{s.value=!1}};return w(),k("handleDelProuct",(e=>{w()})),(e,t)=>{const l=y,s=h,b=g,k=T(S("ti-button"),he),I=T(S("ti-empty-data"),ye);return u(),r(l,{class:"ti-shop-list-box"},{default:c((()=>{var e,h;return[(null==(e=m.value)?void 0:e.length)>0?(u(),r(l,{key:0,class:"ti-shop-list"},{default:c((()=>[o(l,null,{default:c((()=>[o(l,{class:"ti-cart-shop-head"},{default:c((()=>[o(l,{class:"ti-shop-head-title"},{default:c((()=>[_(p(A(x)("商品名稱")),1)])),_:1}),o(l,{class:"ti-shop-head-money"},{default:c((()=>[_(p(A(x)("金額")),1)])),_:1}),o(l,{class:"ti-shop-head-num"},{default:c((()=>[_(p(A(x)("數量")),1)])),_:1})])),_:1})])),_:1}),o(l,{class:"ti-scroll-box"},{default:c((()=>[o(b,{class:"ti-shop-scroll","scroll-y":""},{default:c((()=>[o(l,{class:"ti-shop-box"},{default:c((()=>[(u(!0),i(n,null,d(m.value,((e,i)=>(u(),r(l,{class:"ti-shop-item",key:e},{default:c((()=>[o(l,{class:"ti-shop-item-box"},{default:c((()=>[o(l,{class:"ti-shop-box"},{default:c((()=>[o(l,{class:"ti-shop-body-top"},{default:c((()=>[o(l,{class:"ti-shop-title text-ellipsis"},{default:c((()=>[_(p(e.product_name_text),1)])),_:2},1024),o(l,{class:"ti-shop-spec"},{default:c((()=>[_(p(e.product_attr),1)])),_:2},1024)])),_:2},1024),o(l,{class:"ti-shop-body-money"},{default:c((()=>[o(s,{class:"ti-shop-price"},{default:c((()=>[_(p(A(L)((null==e?void 0:e.total_pay_price)||0)),1)])),_:2},1024),o(s,{class:"ti-shop-subPrice"},{default:c((()=>[_(p(A(P)((null==e?void 0:e.total_pay_price)||0)),1)])),_:2},1024)])),_:2},1024),o(l,{class:"ti-shop-body-number"},{default:c((()=>[o(Re,{buyContinue:a.buyContinue,isOverTime:a.isOverTime,productItem:e,onChange:t[0]||(t[0]=e=>w())},null,8,["buyContinue","isOverTime","productItem"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),o(l,{class:"ti-content-bottom"},{default:c((()=>[o(l,{class:"ti-car-shop-bottom"},{default:c((()=>[o(l,{class:"ti-shop-bottom-item"},{default:c((()=>[o(l,null,{default:c((()=>[o(s,{class:"ti-shop-bottom-text"},{default:c((()=>{var e;return[_(p(A(x)("共")+((null==(e=v.value)?void 0:e.unSendKitchenProductTotalNum)||0)+A(x)("件")),1)]})),_:1})])),_:1}),o(l,null,{default:c((()=>[o(s,{class:"ti-shop-bottom-text"},{default:c((()=>[_(p(A(x)("小計：")),1)])),_:1}),o(s,{class:"ti-shop-bottom-price"},{default:c((()=>{var e;return[_(p(A(L)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),o(s,{class:"ti-shop-bottom-subPrice"},{default:c((()=>{var e;return[_(p(A(P)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),o(k,{title:A(x)("確認下單"),type:"primary",onClick:C},null,8,["title"])])),_:1})])),_:1})):f("",!0),(null==(h=m.value)?void 0:h.length)<=0?(u(),r(l,{key:1,class:"ti-empty-data-box"},{default:c((()=>[o(I,{title:A(x)("當前無待下單商品")},null,8,["title"])])),_:1})):f("",!0)]})),_:1})}}},[["__scopeId","data-v-0c6353cf"]]),Fe=me({__name:"dish-car-ordered-list",setup(l){const a=t([]);(async()=>{try{const l=await(t={table_id:R()},e("order.Order/getSendKitchen",t));a.value=l.data.list||[]}catch(l){}var t})();return(e,t)=>{const l=y,s=h,v=g,m=T(S("ti-empty-data"),ye);return u(),r(l,{class:"ti-shop-list"},{default:c((()=>[Object.keys(a.value).length>0?(u(),r(v,{key:0,class:"ti-shop-scroll","scroll-y":""},{default:c((()=>[(u(!0),i(n,null,d(a.value,((e,t)=>(u(),r(l,{class:"ti-shop-item",key:t},{default:c((()=>[o(l,{class:"ti-shop-time-top"}),o(l,{class:"ti-shop-time-box"},{default:c((()=>[_(p(e.date+" "+A(x)("下單")),1)])),_:2},1024),(u(!0),i(n,null,d(e.plist,((t,a)=>(u(),r(l,{key:a},{default:c((()=>[o(l,{class:"ti-shop-item-box"},{default:c((()=>[o(l,{class:"ti-shop-box"},{default:c((()=>[o(l,{class:"ti-shop-body-top"},{default:c((()=>[o(l,{class:"ti-shop-title text-ellipsis"},{default:c((()=>[_(p(t.product_name_text),1)])),_:2},1024),o(l,{class:"ti-shop-spec"},{default:c((()=>[_(p(t.product_attr),1)])),_:2},1024)])),_:2},1024),o(l,{class:"ti-shop-body-money"},{default:c((()=>[o(s,{class:"ti-shop-price"},{default:c((()=>[_(p(A(L)((null==t?void 0:t.total_pay_price)||0)),1)])),_:2},1024),o(s,{class:"ti-shop-subPrice"},{default:c((()=>[_(p(A(P)((null==t?void 0:t.total_pay_price)||0)),1)])),_:2},1024)])),_:2},1024),o(l,{class:"ti-shop-body-state"},{default:c((()=>[o(l,{class:"ti-state-left"},{default:c((()=>[_(p(t.finish_num),1)])),_:2},1024),o(l,{class:"ti-state-line"},{default:c((()=>[_("/")])),_:1}),o(l,{class:"ti-state-right"},{default:c((()=>[_(p(t.total_num),1)])),_:2},1024),o(l,{class:"ti-state-text"},{default:c((()=>{return[_(p((e=t.kitchen_status,x(0===e?"製作中":1===e?"已完成":"未知"))),1)];var e})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),a!=e.length-1?(u(),r(l,{key:0,class:"ti-shop-item-box-bottom-border"})):f("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})):f("",!0),Object.keys(a.value).length<=0?(u(),r(m,{key:1,class:"ti-empty-data",title:A(x)("當前無已下單商品")},null,8,["title"])):f("",!0)])),_:1})}}},[["__scopeId","data-v-6603f170"]]),Ne=me({__name:"goods-not-enough",props:{show:{type:Boolean,default:!1},productList:{type:Array,default:[]}},emits:["update:show","confirm"],setup(e,{emit:t}){const l=e,a=()=>{t("confirm")};return(s,v)=>{const f=h,m=y,b=g,w=T(S("ti-modal"),re);return u(),r(w,{class:"ti-action-tip",show:l.show,isCancelShow:!1,title:s.$t("温馨提示"),confirmText:s.$t("確定"),onCancel:v[0]||(v[0]=e=>t("update:show",!1)),onConfirm:a},{content:c((()=>[o(m,{class:"ti-dialog-content"},{default:c((()=>[o(m,{class:"ti-detail-box"},{default:c((()=>[o(f,{class:"ti-detail-des"},{default:c((()=>[_(p(s.$t("商品庫存不足，請重新選擇")),1)])),_:1})])),_:1}),o(m,{class:"ti-detail-specs"},{default:c((()=>[o(b,{"scroll-y":""},{default:c((()=>[(u(!0),i(n,null,d(e.productList,((e,t)=>(u(),r(m,{class:"ti-specs-box"},{default:c((()=>[o(m,{class:"ti-specs-item"},{default:c((()=>[o(m,{class:"ti-specs-title"},{default:c((()=>[_(p(e.product_name_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmText"])}}},[["__scopeId","data-v-a9bc6e2e"]]),je=me({__name:"dish-list",emits:["success"],setup(a,{emit:s}){const m=t(!1),w=t({category_id:null,shop_supplier_id:null,page:1,list_rows:30}),I=t([]),O=t(!1),U=t(),B=t(!1),N=t(!1),j=t(0);t(!1);const Y=t(!1),H=t(!1),J=t("");t(!1);const G=t(!1);l((()=>w.value.category_id),(()=>{z()}));const M=()=>{me.value.getCarData()},V=()=>{B.value&&(w.value.page+=1,Z())},q=e=>{H.value=!0,J.value=e},z=()=>{w.value.page=1,w.value.shop_supplier_id=K(),Z(!0)},X=t(0),Z=async t=>{var l,a,s,u,i,o;if(O.value)return;const c={...w.value};c.category_id||(c.category_id=null),1==X.value&&(c.is_special=1);try{t&&(O.value=!0);const n=await function(t){return e("product.product/index",t,{isLoading:!1})}(c);1==w.value.page&&(I.value=[]),I.value=I.value.concat((null==(a=null==(l=n.data)?void 0:l.list)?void 0:a.data)||[]),B.value=(null==(u=null==(s=n.data)?void 0:s.list)?void 0:u.last_page)>(null==(o=null==(i=n.data)?void 0:i.list)?void 0:o.current_page)}catch(n){}finally{t&&(O.value=!1)}};z(),k("closeShowLanguage",(e=>{e.isSelectLanguage&&C()&&setTimeout((()=>{z()}),500)})),k("refresh",(e=>{z()})),t([]);const ee=t(),te=()=>{ee.value=!0,_e.value=!0},le=()=>{se(!1)},ae=t([]),se=async e=>{var t;try{const l=await Le({table_id:R()},e);ae.value=(null==(t=l.data.detail)?void 0:t.unSendKitchenProduct)||[],ae.value.length>0?oe():(ee.value=!0,_e.value=!1)}catch(l){}},ue=t([]),ie=t(!1),oe=async()=>{try{const e=await Pe({table_id:R()});F({title:x(e.msg),icon:"none"}),setTimeout((()=>{s("success"),me.value.getCarData(),ee.value=!0,_e.value=!1}),300)}catch(e){ne(e)}},ce=(e,t)=>{e||(ee.value=!1)},ne=e=>{0==e.data.length?q(e.msg):(ue.value=e.data,ie.value=!0)};t([]);const de=async()=>{ie.value=!1},_e=t(!0),pe=e=>{_e.value=e},fe=()=>{_e.value=!1};_e.value=!0;const me=t(),he=t(-1),be=t(!0);return D((()=>{k("globalLock",(e=>{Y.value=1==e})),k("remind",(e=>{const t=-1!=parseInt(e.buffet_expired_time);if(be.value=e.is_buy_continue,!t)return;const l=e.buffet_remaining_time,a=60*parseInt(e.minute);l<=a&&he.value>=a&&(j.value=e.minute,N.value=!0),he.value=l})),k("buffetOver",(e=>{const t=G.value;G.value=0==e,G.value!=t&&1==G.value&&(N.value=!0)})),k("buffet_remain",(e=>{q(e)}))})),E((()=>{Q("globalLock"),Q("closeShowLanguage"),Q("refresh"),Q("buffet_remain")})),(e,t)=>{const l=T(S("ti-loading"),ve),a=b,s=h,k=y,C=T(S("ti-empty-data"),ye),R=g,K=T(S("ti-drawer"),ge),D=T(S("ti-modal"),re);return u(),i(n,null,[o(k,{class:"ti-dish-box"},{default:c((()=>[o(Se,{categoryId:w.value.category_id,"onUpdate:categoryId":t[0]||(t[0]=e=>w.value.category_id=e),isSpecial:X.value,"onUpdate:isSpecial":t[1]||(t[1]=e=>X.value=e)},null,8,["categoryId","isSpecial"]),o(k,{class:"ti-dish-list"},{default:c((()=>[o(R,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:V},{default:c((()=>[O.value?(u(),r(l,{key:0})):I.value&&I.value.length>0?(u(),i(n,{key:1},[o(k,{class:"ti-dish-goods"},{default:c((()=>[(u(!0),i(n,null,d(I.value,((e,t)=>(u(),r(k,{key:t,class:v([{"sold-out":e.product_stock<=0||1==e.limit_num_status},"ti-goods-item"]),onClick:t=>(e=>e.product_stock<=0?F({title:x("已售罄"),icon:"none"}):1==e.limit_num_status?F({title:x("已限購"),icon:"none"}):void(0!=be.value||1!=G.value?1!=G.value||1!=e.is_buffet?(m.value=!0,U.value=e.product_id):q(x("自助餐时间已到达，自助餐商品不可继续下单")):q(x("用餐時間已到，無法繼續下單"))))(e)},{default:c((()=>[o(k,{class:"ti-goods-image"},{default:c((()=>[e.image&&e.image[0]&&e.image[0].file_path?(u(),r(a,{key:0,src:e.image[0].file_path,mode:"scaleToFill"},null,8,["src"])):f("",!0),e.product_stock<=0?(u(),r(s,{key:1,class:"sold-out-text"},{default:c((()=>[_(p(A(x)("已售罄")),1)])),_:1})):f("",!0),1==e.limit_num_status?(u(),r(s,{key:2,class:"sold-out-text"},{default:c((()=>[_(p(A(x)("已限購")),1)])),_:1})):f("",!0)])),_:2},1024),o(k,{class:"ti-goods-content"},{default:c((()=>[o(k,{class:"ti-goods-title line-clamp-2"},{default:c((()=>[_(p(e.product_name_text),1)])),_:2},1024),o(k,{class:"ti-price-box"},{default:c((()=>[o(s,{class:"ti-goods-price"},{default:c((()=>[_(p(A(L)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),o(s,{class:"ti-goods-subPrice"},{default:c((()=>[_(p(A(P)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),1==(null==e?void 0:e.is_buffet)&&(null==e?void 0:e.buffet_limit_num)>0||0==(null==e?void 0:e.is_buffet)&&(null==e?void 0:e.limit_num)>0?(u(),r(k,{key:0,class:"ti-restriction"},{default:c((()=>[_(p(A($)("限購{count}份",{count:1==(null==e?void 0:e.is_buffet)?null==e?void 0:e.buffet_limit_num:(null==e?void 0:e.limit_num)||0})),1)])),_:2},1024)):f("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),o(l,{status:B.value?"loading":"no-more"},null,8,["status"])],64)):(u(),r(C,{key:2}))])),_:1})])),_:1}),o(k,{class:"ti-car-order-nav"},{default:c((()=>[o(Ue,{ref_key:"carRef",ref:me,onCar:te,onConfirm:le},null,512)])),_:1})])),_:1}),o(Oe,{show:m.value,"onUpdate:show":t[2]||(t[2]=e=>m.value=e),productId:U.value,onSuccess:M},null,8,["show","productId"]),o(Ne,{style:{"z-index":"9999"},show:ie.value,"onUpdate:show":t[3]||(t[3]=e=>ie.value=e),productList:ue.value,onConfirm:de},null,8,["show","productList"]),o(K,{show:ee.value,width:603.992,title:A(x)("我點的菜"),maskClick:!0,onChange:ce},{content:c((()=>[o(k,{class:"ti-drawer-content"},{default:c((()=>[o(k,{class:"ti-content-head"},{default:c((()=>[o(k,{class:"ti-switch-box"},{default:c((()=>[o(k,{class:v(_e.value?"ti-switch-on":"ti-switch-off"),onClick:t[4]||(t[4]=e=>pe(!0))},{default:c((()=>[o(s,{class:v(_e.value?"ti-switch-text-on":"ti-switch-text-off")},{default:c((()=>[_(p(A(x)("未下單")),1)])),_:1},8,["class"])])),_:1},8,["class"]),o(k,{class:"ti-switch-space"}),o(k,{class:v(_e.value?"ti-switch-off":"ti-switch-on"),onClick:t[5]||(t[5]=e=>pe(!1))},{default:c((()=>[o(s,{class:v(_e.value?"ti-switch-text-off":"ti-switch-text-on")},{default:c((()=>[_(p(A(x)("已下單")),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})])),_:1}),_e.value?(u(),r(Be,{key:0,buyContinue:be.value,isOverTime:G.value,onSuccess:fe,onChange:M,onSendkitchenFail:ne},null,8,["buyContinue","isOverTime"])):f("",!0),_e.value?f("",!0):(u(),r(Fe,{key:1}))])),_:1})])),footer:c((()=>[o(k)])),_:1},8,["show","width","title"]),o(D,{class:"ti-action-tips",show:N.value,"onUpdate:show":t[6]||(t[6]=e=>N.value=e),isCancelShow:!1,content:G.value?A(x)("如有需要，請呼叫服務員"):A(x)("請在剩餘時間完成選購"),onConfirm:t[7]||(t[7]=e=>N.value=!1)},{title:c((()=>[o(k,{class:"warning-header"},{default:c((()=>[o(k,{class:"warning-image-round"},{default:c((()=>[o(a,{class:"warning-image",src:ke})])),_:1}),G.value?(u(),r(k,{key:1,class:"warning-text"},{default:c((()=>[_(p(A(x)("時間結束")),1)])),_:1})):(u(),r(k,{key:0,class:"warning-text"},{default:c((()=>[o(s,null,{default:c((()=>[_(p(A(x)("剩余")),1)])),_:1}),o(s,{class:"warning-text red"},{default:c((()=>[_(p(j.value),1)])),_:1}),o(s,null,{default:c((()=>[_(p(A(x)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),default:c((()=>[W("template",null,[o(k)])])),_:1},8,["show","content"]),o(D,{class:"ti-action-tips",show:Y.value,"onUpdate:show":t[8]||(t[8]=e=>Y.value=e),isCancelShow:!1,isConfirmShow:!1},{title:c((()=>[o(k,{class:"warning-header"},{default:c((()=>[o(k,{class:"warning-image-round"},{default:c((()=>[o(a,{class:"warning-image",src:Ce})])),_:1}),o(k,{class:"warning-text"},{default:c((()=>[_(p(A(x)("订单已锁定")),1)])),_:1})])),_:1})])),footer:c((()=>[o(k)])),_:1},8,["show"]),o(D,{class:"ti-action-tips",show:H.value,"onUpdate:show":t[9]||(t[9]=e=>H.value=e),isCancelShow:!1,isConfirmShow:!0,onConfirm:t[10]||(t[10]=e=>H.value=!1),title:A(x)("溫馨提示"),content:J.value},{title:c((()=>[o(k,{class:"warning-header"},{default:c((()=>[o(k,{class:"warning-image-round"},{default:c((()=>[o(a,{class:"warning-image",src:ke})])),_:1}),o(k,{class:"warning-text"},{default:c((()=>[_(p(A(x)("温馨提示")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-cb08d218"]]),Ke=me({__name:"opentable-index",setup(e){be(),t(!1);const l=()=>{B()},a=()=>{j("refresh",{})},s=t(),i=t(),n=t("");t([]);const d=t(),v=t(!1),f=t({ip:"",port:"",device_id:""}),m=()=>{const e=M();f.value.ip=(null==e?void 0:e.ip)||V()||"127.0.0.1",f.value.port=(null==e?void 0:e.port)||"8080"},g=e=>{f.value.ip=e},b=e=>{f.value.port=e},w=async()=>{var e;const t={...f.value};if(t.ip)if(t.port)try{const l=await le(ae(`${null==t?void 0:t.ip}:${t.port}`));se(t),ue(l.data.app_id),ie(l.data.shop_supplier_id),X(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{v.value=!0}),150)}catch(l){F({title:x("绑定失败"),icon:"none"})}else F({title:x("請輸入連接埠"),icon:"none"});else F({title:x("請輸入伺服器位址"),icon:"none"})},I=e=>{v.value=!1,e&&(d.value=e,n.value=e.table_no)},L=()=>{m(),n.value=z().table_no,d.value=z()},P=async()=>{var e;const t={...f.value};if(t.ip)if(t.port)try{const l=await le(ae(`${null==t?void 0:t.ip}:${t.port}`));if(!d.value)return void F({title:x("請查找桌位"),icon:"none"});se(t),ue(l.data.app_id),ie(l.data.shop_supplier_id),X(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{O()}),150)}catch(l){F({title:x("绑定失败"),icon:"none"})}else F({title:x("請輸入連接埠"),icon:"none"});else F({title:x("請輸入伺服器位址"),icon:"none"})},O=async()=>{if(R()===d.value.table_id)return F({title:x("绑定成功"),icon:"none"}),i.value=!1,oe(!1),void setTimeout((()=>{ce({url:"/pages/index/index"})}),150);try{await ne({table_id:d.value.table_id,old_table_id:R()});de(d.value),F({title:x("绑定成功"),icon:"none"}),i.value=!1,oe(!1),setTimeout((()=>{ce({url:"/pages/index/index"})}),150)}catch(e){}},U=t(!1),B=()=>{U.value=!0},N=async e=>{if(e)try{await pe({password:e});i.value=!0,d.value=z(),n.value=d.value.table_no,K()}catch(t){}else F({title:x("請輸入密碼"),icon:"none"})},K=()=>{U.value=!1};m(),Y({success:e=>{f.value.device_id=e.deviceId}});const D=t();H((()=>{clearTimeout(D.value)}));const $=t({name:"",logo:"",tableNo:"",is_call_service:1}),W=async e=>{var t,l,a;if(C())try{const s=await q(e);$.value.name=s.data.name,$.value.logo=s.data.logo,$.value.tableNo=z().table_no,$.value.is_call_service=parseInt(null==(l=null==(t=null==s?void 0:s.data)?void 0:t.tablet)?void 0:l.is_call_service),X(null==(a=s.data)?void 0:a.currency),Z(s)}catch(s){}};return k("refresh",(e=>{W(!1)})),J((()=>{W(!1)})),E((()=>{Q("refresh")})),G((()=>{var e;null==(e=s.value)||e.showBuffet(!0,0)})),(e,t)=>{const d=T(S("ti-layout-head"),fe),m=y,k=h,C=T(S("ti-input"),we),O=T(S("ti-layout-table-list"),xe),R=T(S("ti-modal"),re);return u(),r(m,{class:"ti-page",onClick:t[1]||(t[1]=e=>A(te)())},{default:c((()=>[o(m,null,{default:c((()=>[o(d,{ref_key:"refCallServer",ref:s,isPay:!0,isTableNo:!0,onDoubleLogo:l,onRefresh:a,is_call_service:$.value.is_call_service},null,8,["is_call_service"])])),_:1}),o(_e,{show:U.value,title:A(x)("密碼"),password:!0,placeholder:A(x)("請輸入密碼"),onExit:K,onConfirm:N},null,8,["show","title","placeholder"]),o(je),o(R,{show:i.value,title:A(x)("設置"),cancelText:A(x)("重置"),confirmText:A(x)("確定"),onCancel:L,onConfirm:P},{content:c((()=>[o(m,{class:"ti-item-input"},{default:c((()=>[o(m,{class:"ti-label-box"},{default:c((()=>[o(m,{class:"ti-label-left"},{default:c((()=>[o(k,{class:"ti-label-server"},{default:c((()=>[_(p(A(x)("服務器連接地址")),1)])),_:1})])),_:1}),o(m,{class:"ti-label-right",onClick:w},{default:c((()=>[o(k,{class:"ti-label-table"},{default:c((()=>[_(p(n.value?A(x)("已選 : ")+A(ee)(n.value,19):A(x)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),o(m,{class:"ti-input-box"},{default:c((()=>[o(C,{type:"text",onInput:g,value:f.value.ip,placeholder:A(x)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),o(m,{class:"ti-colon"},{default:c((()=>[_(":")])),_:1}),o(m,{class:"ti-input-port"},{default:c((()=>[o(C,{type:"number",onInput:b,value:f.value.port,placeholder:A(x)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1}),o(O,{show:v.value,"onUpdate:show":t[0]||(t[0]=e=>v.value=e),onConfirm:I},null,8,["show"])])),_:1},8,["show","title","cancelText","confirmText"])])),_:1})}}},[["__scopeId","data-v-f1624263"]]);export{Ke as default};
