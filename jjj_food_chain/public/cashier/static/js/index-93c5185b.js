import{f as e,e as a,q as t,b as l,c as s,u as r,m as o,w as i,d,a as n,x as c,y as p,n as u,p as m,A as h,k as _,v as g}from"./element-plus-cd5f0841.js";import{o as f}from"./order-98f20b2c.js";import y from"./refund-27a39992.js";import{q as b}from"./qs-c6aa5595.js";import{_ as v}from"./index-42a7c458.js";import{ag as w,c as x,P as C,S as j,T as k,Y as D,o as z,V as F,a as N,W as S,$ as V,X as B,M as T,at as P,au as q}from"./@vue-ec4837bd.js";import"./lodash-es-42625722.js";import"./async-validator-cf877c1f.js";import"./@vueuse-351f2583.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-399cea60.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./request-0a0c61ce.js";import"./axios-63583d02.js";import"./keyboard-e373de57.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./vue-router-bec44c5f.js";import"./pinia-57a80881.js";import"./sass-9c753014.js";import"./immutable-f1afe65f.js";const I={components:{Refund:y},data:()=>({order_type:"second",is_refund:!1,detail:null,activeName:0,loading:!0,tableData:[],pageSize:10,totalDataNumber:0,curPage:1,searchForm:{search:"",time:"",eat_type:"20",time_type:1},exStyle:[],shopList:[],create_time:"",order_count:{payment:0,delivery:0,received:0},dialogBatchDelivery:!1,open_edit:!1,order_no:0}),created(){this.getData()},methods:{arraySpanMethod(e){if(e.rowIndex%2==0&&0===e.columnIndex)return[1,8]},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},orderTypeClick(e){let a=this;a.curPage=1,a.searchForm.eat_type=e,a.getData()},handleClick(e){let a=this;e!=a.activeName&&(a.activeName=e,a.curPage=1,a.getData())},getData(){let e=this,a=e.searchForm;a.dataType=e.activeName,a.page=e.curPage,a.list_rows=e.pageSize,e.loading=!0,f.getList(a,!0).then((a=>{e.tableData=a.data.list.data,e.tableData.length>0&&e.openDetail(e.tableData[0]),e.totalDataNumber=a.data.list.total,e.loading=!1})).catch((e=>{}))},cancelClick(e){this.order_no=e.order_no,this.open_edit=!0},closeDialogFunc(e,a){"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},addClick(e){let a=e.order_id;this.$router.push({path:"/order/order/Detail",query:{order_id:a}})},settleFunc(){let t=this,l={order_id:t.detail.order_id};e.confirm("确定要完成订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.loading=!0,f.settle(l,!0).then((e=>{a({message:e.msg,type:"success"}),t.detail=null,t.getData()})).catch((e=>{t.loading=!1}))})).catch((()=>{a({type:"info",message:"已取消"})}))},print(){let t=this,l={order_id:t.detail.order_id};e.confirm("确定要打印小票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.loading=!0,f.print(l,!0).then((e=>{t.loading=!1,a({message:e.msg,type:"success"})})).catch((e=>{t.loading=!1}))})).catch((()=>{a({type:"info",message:"已取消"})}))},openRefund(){this.is_refund=!0},closeRefund(e){let t=this;if(e&&"undefined"!=e){let l={order_id:t.detail.order_id,refund_money:e};t.loading=!0,f.refund(l,!0).then((e=>{a({message:e.msg,type:"success"}),t.detail=null,t.getData()})).catch((e=>{t.loading=!1}))}this.is_refund=!1},onSubmit(){this.curPage=1,this.tableData=[],this.getData()},onExport:function(){let e=window.location.protocol+"//"+window.location.host;window.location.href=e+"/index.php/shop/order.operate/export?"+b.stringify(this.searchForm)},showBatchDelivery(){this.dialogBatchDelivery=!0},gotoExpress(){this.$router.push("/setting/express/index")},onBeforeUploadImage(e){const t="xlsx"===e.name.substring(e.name.lastIndexOf(".")+1),l=e.size/1024/1024<10;return t||a.error("上传文件只能是excel格式!"),l||a.error("上传文件大小不能超过 10MB!"),t&&l},openDetail(e){this.detail=e},UploadImage(e){let t=this;const l=this.$loading({lock:!0,text:"正在处理,请等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=new FormData;s.append("iFile",e.file),f.batchDelivery(s).then((e=>{l.close(),t.dialogBatchDelivery=!1,a({message:e.msg,type:"warning"})})).catch((t=>{l.close(),a({message:"本次处理失败",type:"warning"}),e.onError()}))}}},R=e=>(P("data-v-081eab03"),e=e(),q(),e),U={class:"user"},M={class:"common-seach-wrap"},Y={class:"block"},$=R((()=>N("span",{class:"demonstration"},null,-1))),E={class:"product-content"},L={class:"table-wrap"},A={class:"d-s-c mb16"},O={class:"orange f20 fb tc",style:{"line-height":"84px"}},W={class:""},X={class:""},G={class:""},H={class:"pagination"},J=R((()=>N("div",{class:"common-form"},"顾客信息",-1))),K=R((()=>N("div",{class:"d-b-c pl20 ww100"},[N("div",{class:"flex-1"},"用户昵称：无"),N("div",{class:"flex-1"},"手机号：无")],-1))),Q=R((()=>N("div",{class:"common-form border-t"},"订单信息",-1))),Z={class:"d-b-c pl20 ww100"},ee={class:"flex-1"},ae={class:"flex-1"},te={class:"d-b-c pl20 ww100"},le={class:"flex-1"},se={class:"flex-1"},re={class:"d-b-c pl20 ww100"},oe={class:"flex-1"},ie={class:"flex-1"},de={class:"d-b-c pl20 ww100"},ne={class:"flex-1"},ce={class:"flex-1"},pe={class:"f14"},ue={class:"f12 mt10 gray9"},me={class:"d-e-c pr20"},he={key:0,class:"mr20"},_e={key:1,class:"mr20"},ge={key:2,class:"mr20"},fe={class:"d-e-c ww100"};const ye=v(I,[["render",function(e,a,f,y,b,v){const P=l,q=s,I=r,R=o,ye=i,be=d,ve=n,we=c,xe=p,Ce=u,je=m,ke=h,De=_,ze=t,Fe=w("Refund"),Ne=g;return z(),x("div",U,[C(ze,{class:"user"},{default:j((()=>[C(De,{span:null!=b.detail?16:24,class:"cashier-order p20",style:F(null!=b.detail?"padding-right:0":"")},{default:j((()=>[N("div",M,[C(ve,{inline:!0,model:b.searchForm,class:"demo-form-inline"},{default:j((()=>[C(q,{label:"订单号"},{default:j((()=>[C(P,{modelValue:b.searchForm.search,"onUpdate:modelValue":a[0]||(a[0]=e=>b.searchForm.search=e),placeholder:"请输入订单号"},null,8,["modelValue"])])),_:1}),C(q,{label:"下单时间"},{default:j((()=>[C(R,{modelValue:b.searchForm.time_type,"onUpdate:modelValue":a[1]||(a[1]=e=>b.searchForm.time_type=e)},{default:j((()=>[C(I,{label:1},{default:j((()=>[S("今天")])),_:1}),C(I,{label:2},{default:j((()=>[S("昨天")])),_:1}),C(I,{label:3},{default:j((()=>[S("一周")])),_:1}),C(I,{label:0},{default:j((()=>[S("全部")])),_:1})])),_:1},8,["modelValue"])])),_:1}),C(q,{label:"起始时间"},{default:j((()=>[N("div",Y,[$,C(ye,{modelValue:b.searchForm.time,"onUpdate:modelValue":a[2]||(a[2]=e=>b.searchForm.time=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])])),_:1}),C(q,null,{default:j((()=>[C(be,{type:"success",onClick:v.onSubmit},{default:j((()=>[S("搜索")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),N("div",E,[N("div",L,[C(xe,{"model-value":b.searchForm.eat_type,onTabChange:v.orderTypeClick},{default:j((()=>[C(we,{label:"收银订单",name:"20"}),C(we,{label:"桌台订单",name:"10"})])),_:1},8,["model-value","onTabChange"]),N("div",A,[C(be,{class:"mr16",size:"medium",type:1==b.activeName?"danger":"",onClick:a[3]||(a[3]=e=>v.handleClick(1)),round:""},{default:j((()=>[S("待完成 ")])),_:1},8,["type"]),C(be,{class:"mr16",size:"medium",type:2==b.activeName?"danger":"",onClick:a[4]||(a[4]=e=>v.handleClick(2)),round:""},{default:j((()=>[S("已完成 ")])),_:1},8,["type"]),C(be,{class:"mr16",size:"medium",type:3==b.activeName?"danger":"",onClick:a[5]||(a[5]=e=>v.handleClick(3)),round:""},{default:j((()=>[S("已取消 ")])),_:1},8,["type"]),C(be,{class:"mr16",size:"medium",type:0==b.activeName?"danger":"",onClick:a[6]||(a[6]=e=>v.handleClick(0)),round:""},{default:j((()=>[S("全部 ")])),_:1},8,["type"])]),V((z(),k(je,{data:b.tableData,style:{width:"100%"},onCurrentChange:v.openDetail},{default:j((()=>[C(Ce,{prop:"callNo",label:"名称"},{default:j((e=>[N("div",O,B(20==e.row.eat_type?e.row.callNo:e.row.table_no),1)])),_:1}),C(Ce,{prop:"order_no",label:"订单号"}),C(Ce,{prop:"pay_time_text",label:"支付时间"},{default:j((e=>[N("div",W,B(20==e.row.pay_status.value?e.row.pay_time_text:"——"),1)])),_:1}),C(Ce,{prop:"pay_price",label:"实付金额"},{default:j((e=>[N("div",X,[S(B(e.row.pay_price)+" ",1),N("span",{class:T(e.row.refund_money>0?"red":"green")},"("+B(e.row.refund_money>0?"已退款:￥"+e.row.refund_money:e.row.pay_status.text)+")",3)])])),_:1}),C(Ce,{prop:"callNo",label:"消费方式"},{default:j((e=>[N("div",G,B(e.row.pay_type.text),1)])),_:1}),C(Ce,{prop:"state_text",label:"状态"})])),_:1},8,["data","onCurrentChange"])),[[Ne,b.loading]])]),N("div",H,[C(ke,{onSizeChange:v.handleSizeChange,onCurrentChange:v.handleCurrentChange,background:"","current-page":b.curPage,"page-size":b.pageSize,layout:"total, prev, pager, next, jumper",total:b.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])])),_:1},8,["span","style"]),null!=b.detail?(z(),k(De,{key:0,span:null!=b.detail?8:0,class:"cashier-order-right p20"},{default:j((()=>[V((z(),k(ve,{ref:"form",model:b.detail},{default:j((()=>[J,C(q,{label:"",rules:[{required:!0,message:" "}],prop:"name"},{default:j((()=>[K])),_:1}),Q,C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",Z,[N("div",ee,"订单来源："+B(b.detail.order_source_text),1),N("div",ae,"取单号："+B(b.detail.callNo),1)])])),_:1}),C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",te,[N("div",le,"就餐方式："+B(b.detail.delivery_type.text),1),N("div",se,"订单号："+B(b.detail.order_no),1)])])),_:1}),C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",re,[N("div",oe,"订单金额："+B(b.detail.order_price),1),N("div",ie,"订单优惠："+B(b.detail.discount_money),1)])])),_:1}),C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",de,[N("div",ne,"实付金额："+B(b.detail.pay_price),1),N("div",ce,"支付方式："+B(b.detail.pay_type.text),1)])])),_:1}),C(q,{label:"",prop:"customer",class:"border-t pl20","max-height":"300"},{default:j((()=>[V((z(),k(je,{data:b.detail.product,style:{width:"100%"}},{default:j((()=>[C(Ce,{prop:"product_name",label:"商品名称"},{default:j((e=>[N("div",pe,B(e.row.product_name),1),N("div",ue,B(e.row.product_attr),1)])),_:1}),C(Ce,{prop:"product_price",label:"单价"}),C(Ce,{prop:"total_num",label:"数量"}),C(Ce,{prop:"total_price",label:"金额"})])),_:1},8,["data"])),[[Ne,null==b.detail]])])),_:1}),C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",me,[b.detail.bag_price>0?(z(),x("div",he,"包装费："+B(b.detail.bag_price)+"元",1)):D("",!0),b.detail.service_money>0?(z(),x("div",_e,"服务费："+B(b.detail.service_money)+"元",1)):D("",!0),b.detail.refund_money>0?(z(),x("div",ge,"退款金额："+B(b.detail.refund_money)+"元",1)):D("",!0)])])),_:1}),C(q,{label:"",prop:"customer"},{default:j((()=>[N("div",fe,[C(be,{class:"mr16",size:"medium",type:"info",onClick:v.print},{default:j((()=>[S("打印小票")])),_:1},8,["onClick"]),10==b.detail.order_status.value&&20==b.detail.pay_status.value?(z(),k(be,{key:0,class:"mr16",size:"medium",type:"danger",onClick:v.openRefund},{default:j((()=>[S(" 退款 ")])),_:1},8,["onClick"])):D("",!0),10==b.detail.order_status.value&&20==b.detail.pay_status.value?(z(),k(be,{key:1,class:"mr16",size:"medium",type:"success",onClick:v.settleFunc},{default:j((()=>[S("完成 ")])),_:1},8,["onClick"])):D("",!0)])])),_:1})])),_:1},8,["model"])),[[Ne,b.loading]])])),_:1},8,["span"])):D("",!0)])),_:1}),null!=b.detail?(z(),k(Fe,{key:0,onClose:v.closeRefund,is_pop:b.is_refund,price:b.detail.pay_price},null,8,["onClose","is_pop","price"])):D("",!0)])}],["__scopeId","data-v-081eab03"]]);export{ye as default};
