import{f as e,e as t,h as a,d as l,j as s,r as o,F as i,g as d,c as r,n,p as c,a as u,C as p,B as m,D as A}from"./element-plus-cd5f0841.js";import{u as b,_,g}from"./index-1d6a11a7.js";import{r as y}from"./request-874d4953.js";import{o as h}from"./order-55f2c858.js";import f from"./cash-9169c06c.js";import U from"./money-fcc9298b.js";import{ag as v,o as k,c as C,P as T,S as j,a as x,Q,a9 as w,W as L,a1 as M,Y as F,X as I,T as V,M as B,at as H,au as P}from"./@vue-ec4837bd.js";import"./lodash-es-42625722.js";import"./async-validator-cf877c1f.js";import"./@vueuse-351f2583.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-399cea60.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-bec44c5f.js";import"./pinia-57a80881.js";import"./sass-9c753014.js";import"./immutable-f1afe65f.js";import"./axios-63583d02.js";import"./qs-c6aa5595.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./keyboard-24ac2a23.js";import"./user-884a9e99.js";let Y={getCategory:(e,t)=>y._post("/cashier/store.table/area",e,t),getTable:(e,t)=>y._post("/cashier/store.table/table",e,t),getHallCart:(e,t)=>y._post("/cashier/order.HallCart/detail",e,t),cancelHallCart:(e,t)=>y._post("/cashier/order.HallCart/cancel",e,t),payFunc:(e,t)=>y._post("/cashier/order.Order/pay",e,t),changeMoney:(e,t)=>y._post("/cashier/order.HallCart/changeMoney",e,t),getchangeTable:(e,t)=>y._post("/cashier/store.table/changeTable",e,t),changeTable:(e,t)=>y._post("/cashier/order.Order/changeTable",e,t),printFunc:(e,t)=>y._post("/cashier/order.Order/print",e,t)};const{memberInfo:z}=b(),R={components:{Cash:f,Money:U},data:()=>({areaIndex:null,typeIndex:null,tableArr_id:"",cartInfo:{},tableArr:[],isTurntable:!1,is_money:!1,is_cash:!1,detail:null,loading:!0,cartloading:!0,area_id:0,type_id:0,curPage:1,pageSize:20,listData:[],last_page:1,table_id:0,no_more:!0,tableData:[],tableList:[],model:{table_id:0,product_num:0,product:[]},typeList:[],categoryList:[]}),computed:{},created(){this.username=g("userinfo_cashier"),this.getCategory()},methods:{handleClose(){},refreshFunc(){this.table_id=0,this.model={table_id:0,product_num:0,product:[]},this.getTable()},settleFunc(){let a=this,l={order_id:a.model.order_id};e.confirm("确定要完成订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.loading=!0,h.settle(l,!0).then((e=>{t({message:e.msg,type:"success"}),a.table_id=0,a.model={table_id:0,product_num:0,product:[]},a.getTable(),a.loading=!1})).catch((e=>{a.loading=!1}))})).catch((()=>{t({type:"info",message:"已取消"})}))},noMore(){return this.last_page>=this.curPage},disableds(){return this.loading||this.noMore()},getTable(){let e=this,t={area_id:e.area_id,type_id:e.type_id};Y.getTable(t,!0).then((t=>{e.tableList=t.data.list,e.loading=!1})).catch((t=>{e.loading=!1}))},changeType(e){this.type_id=e,this.curPage=1,this.listData=[],this.getTable()},print(){let a=this,l={order_id:a.detail.order_id};e.confirm("确定要打印小票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.loading=!0,h.print(l,!0).then((e=>{a.loading=!1,t({message:e.msg,type:"success"})})).catch((e=>{a.loading=!1}))})).catch((()=>{t({type:"info",message:"已取消"})}))},clearTable(a){let l=this;a&&(this.model=a),e.confirm("确定要关闭桌台并取消订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,l.cancelHallCart()})).catch((()=>{t({type:"info",message:"已取消"})}))},cancelHallCart(){let e=this;Y.cancelHallCart({table_id:e.model.table_id},!0).then((a=>{t({message:a.msg,type:"success"}),e.model={table_id:0,product_num:0,product:[]},e.getTable(),e.loading=!1})).catch((e=>{}))},pickTable(e){if(this.table_id==e.table_id||this.loading)return;this.loading=!0,this.table_id=e.table_id;let t=e;e.status>20?this.getHallCart():(t.product_num=0,t.product=[],this.loading=!1,this.model=t)},getHallCart(){let e=this,t={table_id:e.table_id};Y.getHallCart(t,!0).then((t=>{e.loading=!1,e.model=t.data.detail,e.model.table_id=e.table_id})).catch((e=>{}))},changeMoney(){this.is_money=!0},closeTableFunc(e){let a=this;a.isTurntable=!1,null!=e&&(a.tableArr_id?Y.changeTable({table_id:a.tableArr_id,order_id:a.model.order_id},!0).then((e=>{a.isTurntable=!1,a.refreshFunc()})):t.error("请选择桌号"))},printFunc(){Y.printFunc({order_id:this.model.order_id},!0).then((e=>{t({message:e.msg,type:"success"})}))},changeTable(){let e=this;Y.getchangeTable({table_id:e.model.table_id},!0).then((t=>{e.tableArr=t.data.list,e.isTurntable=!0}))},closeMoney(e){let a=this;if(e){let l=e;l.order_id=a.model.order_id,Y.changeMoney(l,!0).then((e=>{a.getHallCart(),t({message:e.msg,type:"success"})}))}this.is_money=!1},closeCash(e){let a=this;if(e&&null!=e){let l={pay_type:e,order_id:a.model.order_id,user_id:0};z&&(l.user_id=z.user_id),Y.payFunc(l,!0).then((e=>{a.getTable(),a.getHallCart(),t({message:e.msg,type:"success"})})).catch((e=>{t.error(e.msg)}))}this.is_cash=!1},getCategory(){let e=this;Y.getCategory({},!0).then((t=>{e.categoryList=t.data.list,e.typeList=e.categoryList[0].typeList,e.typeList.length>0?e.type_id=e.typeList[0].type_id:e.type_id=0,e.loading=!1,e.categoryFunc(e.categoryList[0].area_id)})).catch((e=>{}))},categoryFunc(e){let t=this;t.loading||t.area_id==e||(t.loading=!0,t.area_id=e,t.tableList=[],t.categoryList.some((e=>{e.area_id!=t.area_id||(t.typeList=e.typeList)})),t.typeList.length>0?t.type_id=t.typeList[0].type_id:t.type_id=0,t.curPage=1,t.listData=[],t.getTable())},toCart(e){this.$emit("close",e,this.model)},returnProduct(a){let l=this,s={};s.order_id=a.order_id,s.order_product_id=a.order_product_id,s.num=a.total_num,e.confirm("确定要退菜吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{h.moveProduct(s,!0).then((e=>{t({message:e.msg,type:"success"}),l.getHallCart()}))}))}}},E=e=>(H("data-v-edf21270"),e=e(),P(),e),K={class:"home-container table-home"},O={class:"category-list"},W=["onClick"],X={class:"table-list"},q=["onClick"],D={key:0,class:"f14 gray3 mt20"},Z={key:1,class:"f14 gray3 mt20"},J={key:2,class:"f14 gray3 mt20"},N={key:3,class:"f12 gray6 mt16"},S=["onClick"],G={class:"d-s-c mb10"},$=E((()=>x("span",null,"状态：",-1))),ee=E((()=>x("div",{class:"d-c-c mr20"},[x("div",{class:"color-box status10"}),L(" 未开台 ")],-1))),te=E((()=>x("div",{class:"d-c-c mr20"},[x("div",{class:"color-box status20"}),L(" 已开台 ")],-1))),ae=E((()=>x("div",{class:"d-c-c mr20"},[x("div",{class:"color-box status30"}),L(" 就餐中 ")],-1))),le={key:0,class:"d-s-c border-t bottom-nav"},se=[E((()=>x("span",{class:"icon iconfont icon-qingkong table-itemicon mb5"},null,-1))),E((()=>x("div",null,"整单清空",-1)))],oe=[E((()=>x("span",{class:"icon iconfont icon-zhekou-shi table-itemicon mb5"},null,-1))),E((()=>x("div",null,"折扣/抹零",-1)))],ie=[E((()=>x("span",{class:"icon iconfont icon-view table-itemicon mb5"},null,-1))),E((()=>x("div",null,"转台",-1)))],de=[E((()=>x("span",{class:"icon iconfont icon-dingdan table-itemicon mb5"},null,-1))),E((()=>x("div",null,"打印预结单",-1)))],re={class:"table-info"},ne={key:0,class:"table-info-top"},ce={class:"d-b-c"},ue={class:"f24"},pe={key:0},me={key:0},Ae={key:1,class:"table-info-top"},be=E((()=>x("div",{class:"p20 fb f14"},"点选已开台桌台，可以在此查看点餐信息。",-1))),_e={class:""},ge={class:"gray9 f12"},ye={class:"red"},he={class:"d-e-c ww100"},fe={key:0,class:"mr20"},Ue={class:"price-color"},ve=E((()=>x("span",{class:"price-color f24 fb"},"￥",-1))),ke={class:"price-color f28 fb"},Ce={key:2,class:"d-a-c ww100"},Te={class:"mb16"},je={class:"mb16"},xe={class:"mb16"},Qe={class:"dialog-footer"};const we=_(R,[["render",function(e,t,b,_,g,y){const h=a,f=l,U=s,H=o,P=i,Y=d,z=r,R=n,E=c,we=u,Le=A,Me=p,Fe=m,Ie=v("Cash"),Ve=v("Money");return k(),C("div",K,[T(Y,{class:"ww100"},{default:j((()=>[T(h,{width:"128px"},{default:j((()=>[x("ul",O,[(k(!0),C(Q,null,w(g.categoryList,((e,t)=>(k(),C("li",{class:B(["item",g.area_id==e.area_id?"active":""]),key:t,onClick:t=>y.categoryFunc(e.area_id)},I(e.area_name),11,W)))),128))])])),_:1}),T(Y,{class:"hh100"},{default:j((()=>[T(H,null,{default:j((()=>[T(Y,{class:"hh100"},{default:j((()=>[T(U,{class:"table-head",height:"auto"},{default:j((()=>[(k(!0),C(Q,null,w(g.typeList,((e,t)=>(k(),V(f,{class:"mr20",onClick:t=>y.changeType(e.type_id),type:e.type_id==g.type_id?"danger":"info",round:"",key:t},{default:j((()=>[L(I(e.type_name)+"("+I(e.num)+") ",1)])),_:2},1032,["onClick","type"])))),128))])),_:1}),T(H,{class:"table-box"},{default:j((()=>[x("div",X,[(k(!0),C(Q,null,w(g.tableList,((e,t)=>(k(),C("div",{key:t,class:B(["table-item",g.table_id==e.table_id?"active":""]),onClick:t=>y.pickTable(e)},[x("div",{class:B(["table-item-top","status"+e.status])},I(e.table_no),3),10==e.status?(k(),C("div",D,"未开台")):F("",!0),20==e.status?(k(),C("div",Z,"已开台")):F("",!0),30==e.status?(k(),C("div",J,"就餐中")):F("",!0),30==e.status?(k(),C("div",N,I(e.use_time),1)):F("",!0),30==e.status?(k(),C("img",{key:4,onClick:M((t=>y.clearTable(e)),["stop"]),class:"close-icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAAXNSR0IArs4c6QAAAV9QTFRFAAAA/4AA/78A/5kA/7YA/6oA/5kA/6IA/6oA/50A/6QA/6oA/58A/6UA/6oA/6EA/6YA/6oA/6IA/6YA/6oA/6MA/6cA/6EA/6QA/6cA/6UA/6cA/6UA/6gA/6MA/6MA/6YA/6gA/6QA/6YA/6QA/6YA/6QA/6UA/6cA/6UA/6YA/6QA/6YA/6QA/6QA/6UA/6UA/6YA/6QA/6UA/6UA/6QA/6UA/6UA/6QA/6UA/6UA/6YA/6UA/6QA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6YA/6UA/6QA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6YA/6UA/6UA/6QA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6YA/6UA/6QA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UA/6UAqBaEgAAAAHR0Uk5TAAIEBQcJCgsMDQ4PEBESExQVFhcYGRobHB0fICIjJCcoKSo5O0hJSktSWVpkZWhpb3V2eoCBgoOHi42PkZKUlpeZm6WssbO0uLq8wMHKy8zOz9HS09TV1tfY2drb3N3e3+Dh4uPk5ufo6evs8PHy9Pf4/f5uTOsSAAACpElEQVRYw63Z6VfTQBAAcBQVEAjQUsAWvNPU+1asByoiCnKIBdpCpKXIoRWv+f+fbfdwkybb2WT2U3a67/cme0z2vXZ1kbYbQOs5ANRendiDY0LPBlqwmR8lyDw60AZaMAe0YBZoQQdoQcUjAW2gBdX8KECvFx/MAi2YA1rQn19c0AFaMMCLBdpACwblFwcM9qKDIV5kMMyLCtpAC4bmFxHUeJFAG2jBHNCCWaAFHaAFO3mmoA20YMf8DEGEZwRmgRbMAS2Iys8AdIAWxHpYkO2/+dv5XwFGffrOB0OQ5feg8XS51uZtZRrxJ0Yg8+Zbz0nX5xWsVnzBAOTzd4v1hsseb7WHhe/iQbEej3g/saV4K708mkeDsh58n+SRgU3pLZ/msUt1LKjsl91hHrOEuHSKRyYOsYvi2X9fpFhk73uG91N72G3jq3/Ffh7vK6j5JXawG7utHnzu478MbsCKmD+rjD0pAfVgfYD/NvpGPCVc7NELPL9rPb5RQyXsWQ6pB4WzXq+MLQ6h36NCvzLKs8u1oKZerU3JURdK2PKlrX+zctgcth5q6/2ntBw3uYkDtd+jdXVVRlwMqM1vw7fKbmdQO3/lQd/oVLUTqPXcET4qMzvKn8Z39aCNym+8AkVRe5IVZUTNLL+EOMlNozQkquH/6gXvjOZP5JT52urvjLXP40MDb9sSu++AR6pCHJNf1yt47zDFR53bl7GKWJn0Nz7oJP5+Kl5m6kgJ7k3w6FPWf25wf7nJ5+/AE60mPd/ltMF96H2Q1/gWsnn82Oq8MrqPP27ebY7awrXz8o1/9JrdTxfuzQTdvn6+uL/Inq4Z30/17WWE+6SuLRJ7cycM1gPR8rT57V8n9f6+ttT/F+K27WcX1QP3+89xjFZ7O32121Ng/gEPNM/usukMzQAAAABJRU5ErkJggg=="},null,8,S)):F("",!0)],10,q)))),128))])])),_:1}),T(P,{height:"auto"},{default:j((()=>[x("div",null,[x("div",G,[$,ee,te,ae,T(f,{type:"warning",size:"small",round:"",onClick:t[0]||(t[0]=e=>y.refreshFunc())},{default:j((()=>[L("刷新")])),_:1})]),0!=g.model.table_id&&g.model.product_num>0?(k(),C("div",le,[x("div",{class:"c-p d-c-c d-c mr25",onClick:t[1]||(t[1]=M((e=>y.clearTable(null)),["stop"]))},se),x("div",{class:"c-p d-c-c d-c mr25",onClick:t[2]||(t[2]=e=>y.changeMoney())},oe),x("div",{class:"c-p d-c-c d-c mr25",onClick:t[3]||(t[3]=(...e)=>y.changeTable&&y.changeTable(...e))},ie),x("div",{class:"c-p d-c-c d-c mr25",onClick:t[4]||(t[4]=(...e)=>y.printFunc&&y.printFunc(...e))},de)])):F("",!0)])])),_:1})])),_:1})])),_:1}),T(h,{width:"40%",style:{"padding-top":"15px","padding-right":"20px","box-sizing":"border-box"}},{default:j((()=>[x("div",re,[T(we,{size:"small",ref:"form",model:g.model,"label-width":"",style:{"text-align":"left"}},{default:j((()=>[T(z,{label:"",class:"mb0"},{default:j((()=>[0!=g.model.table_id?(k(),C("div",ne,[x("div",ce,[x("div",null,[L(" 桌台： "),x("span",ue,I(g.model.table_no),1)]),g.model.meal_num?(k(),C("div",pe,"人数："+I(g.model.meal_num)+"人",1)):F("",!0)]),g.model.order_source?(k(),C("div",me,"订单来源："+I(g.model.order_source_text),1)):F("",!0)])):(k(),C("div",Ae,"请点击左侧桌号台"))])),_:1}),0==g.model.table_id||g.model.product_num<=0?(k(),V(z,{key:0,label:""},{default:j((()=>[be])),_:1})):F("",!0),0!=g.model.table_id&&g.model.product_num>0?(k(),C(Q,{key:1},[T(z,{label:""},{default:j((()=>[T(E,{class:"order-table","highlight-current-row":"",data:g.model.product},{default:j((()=>[T(R,{type:"index",align:"center"}),T(R,{prop:"product_name",label:"商品名称"},{default:j((e=>[x("div",_e,I(e.row.product_name),1),x("div",ge,I(e.row.product_attr),1)])),_:1}),T(R,{prop:"total_num",label:"数量"}),T(R,{prop:"product_price",label:"价格"},{default:j((e=>[x("span",ye,"￥"+I(e.row.product_price),1)])),_:1}),T(R,{prop:"",label:"操作"},{default:j((e=>[g.model.product.length>1?(k(),V(f,{key:0,type:"text",onClick:t=>y.returnProduct(e.row)},{default:j((()=>[L("退菜")])),_:2},1032,["onClick"])):F("",!0)])),_:1})])),_:1},8,["data"])])),_:1}),g.model.product.length>0?(k(),V(z,{key:0,label:"",class:"tr p20"},{default:j((()=>[x("div",null,"应收：￥"+I(g.model.total_price)+"元",1),x("div",he,[g.model.service_money>0?(k(),C("div",fe,"服务费：￥"+I(g.model.service_money)+"元",1)):F("",!0),x("div",Ue,"优惠：￥"+I(g.model.discount_money)+"元",1)]),x("div",null,[L(" 数量"+I(g.model.product_num)+"件,实收： ",1),ve,x("span",ke,I(g.model.pay_price),1),L(" 元 ")])])),_:1})):F("",!0)],64)):F("",!0),0!=g.model.table_id&&g.model.product&&g.model.product.length>=0?(k(),C("div",Ce,[g.model.product.length>=0&&(!g.model.pay_status||20!=g.model.pay_status.value)?(k(),C(Q,{key:0},[g.model.product.length<=0?(k(),C("button",{key:0,class:"pay-btn",type:"button",onClick:t[5]||(t[5]=e=>y.toCart("tableBuy"))},"协助点餐")):F("",!0),g.model.product.length>0?(k(),C("button",{key:1,class:"pay-btn",type:"button",onClick:t[6]||(t[6]=e=>y.toCart("addMeal"))},"协助加餐")):F("",!0)],64)):F("",!0),g.model.product.length>0?(k(),C(Q,{key:1},[20!=g.model.pay_status.value?(k(),C("button",{key:0,class:"pay-btn",type:"button",onClick:t[7]||(t[7]=e=>g.is_cash=!0)},"结账")):F("",!0),20==g.model.pay_status.value?(k(),C("button",{key:1,class:"pay-btn",type:"button",onClick:t[8]||(t[8]=(...e)=>y.settleFunc&&y.settleFunc(...e))},"完成")):F("",!0)],64)):F("",!0)])):F("",!0)])),_:1},8,["model"])])])),_:1})])),_:1})])),_:1}),T(Fe,{title:"转台",modelValue:g.isTurntable,"onUpdate:modelValue":t[13]||(t[13]=e=>g.isTurntable=e),width:"30%"},{footer:j((()=>[x("span",Qe,[T(f,{onClick:t[12]||(t[12]=e=>y.closeTableFunc(null))},{default:j((()=>[L("取 消")])),_:1}),T(f,{type:"primary",onClick:y.closeTableFunc},{default:j((()=>[L("确 定")])),_:1},8,["onClick"])])])),default:j((()=>[x("div",Te,[T(Me,{modelValue:g.areaIndex,"onUpdate:modelValue":t[9]||(t[9]=e=>g.areaIndex=e),placeholder:"请选择"},{default:j((()=>[(k(!0),C(Q,null,w(g.tableArr,((e,t)=>(k(),V(Le,{key:e.area_id,label:e.area_name,value:t},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),x("div",je,[T(Me,{modelValue:g.typeIndex,"onUpdate:modelValue":t[10]||(t[10]=e=>g.typeIndex=e),placeholder:"请选择"},{default:j((()=>[null!=g.areaIndex&&g.tableArr[g.areaIndex]?(k(!0),C(Q,{key:0},w(g.tableArr[g.areaIndex].typeList,((e,t)=>(k(),V(Le,{key:e.type_id,label:e.type_name,value:t},null,8,["label","value"])))),128)):F("",!0)])),_:1},8,["modelValue"])]),x("div",xe,[T(Me,{modelValue:g.tableArr_id,"onUpdate:modelValue":t[11]||(t[11]=e=>g.tableArr_id=e),placeholder:"请选择"},{default:j((()=>[null!=g.areaIndex&&null!=g.typeIndex&&g.tableArr[g.areaIndex]&&g.tableArr[g.areaIndex].typeList?(k(!0),C(Q,{key:0},w(g.tableArr[g.areaIndex].typeList[g.typeIndex].tableList,((e,t)=>(k(),V(Le,{key:e.table_id,label:e.table_no,value:e.table_id},null,8,["label","value"])))),128)):F("",!0)])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"]),T(Ie,{is_pop:g.is_cash,price:g.model.pay_price||0,onClose:y.closeCash},null,8,["is_pop","price","onClose"]),T(Ve,{is_money:g.is_money,cartInfo:g.model,onClose:y.closeMoney},null,8,["is_money","cartInfo","onClose"])])}],["__scopeId","data-v-edf21270"]]);export{we as default};
