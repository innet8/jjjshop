import{e,f as a,h as t,C as s,j as l,d as o,b as i,k as r,n as c,o as d,p as n,c as u,a as m,q as p,r as h,g,s as _,v as f,D as y,t as b}from"./element-plus-cd5f0841.js";import{U as C}from"./user-15cc0f5a.js";import{H as j}from"./home-0a1a7490.js";import v from"./serch-a47694a7.js";import w from"./money-4c2de8e2.js";import P from"./change-96a44279.js";import k from"./spec-c6fe22c2.js";import{u as V,_ as D}from"./index-42a7c458.js";import{ag as M,o as S,c as I,P as x,S as F,a as L,M as U,Q as T,a9 as $,$ as z,T as q,X as B,W as H,Y as A,at as N,au as Q}from"./@vue-ec4837bd.js";import"./lodash-es-42625722.js";import"./async-validator-cf877c1f.js";import"./@vueuse-351f2583.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-399cea60.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./request-0a0c61ce.js";import"./axios-63583d02.js";import"./qs-c6aa5595.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./keyboard-e373de57.js";import"./vue-router-bec44c5f.js";import"./pinia-57a80881.js";import"./sass-9c753014.js";import"./immutable-f1afe65f.js";const{userInfo:R}=V(),W={components:{Search:v,Money:w,Spec:k,Change:P},data:()=>({num:"",promodel:null,isChange:!1,is_money:!1,is_search:!1,is_spec:!1,is_cash:!1,detail:null,loading:!0,cartloading:!0,category_id:0,cart_id:0,curPage:1,pageSize:20,listData:[],last_page:1,no_more:!0,username:R&&R.userName,version:"",product_name:"",tableData:[],pay_model:{},categoryList:[],cartInfo:{cart_total_num:0,discount_money:"",line_money:0,total_bag_price:0,total_pay_price:0,total_price:0},productList:[]}),props:["model","type"],computed:{},created(){this.num=this.model.meal_num||"",this.getTableList(),this.getCategory(),this.getCart()},methods:{noMore(){return this.last_page>=this.curPage},disableds(){return this.loading||this.noMore()},getTableList(){let e=this;C.getVersion({},!0).then((a=>{e.version=a.data.version})).catch((e=>{}))},getCart(){let e=this,a={table_id:e.model.table_id};e.cartloading=!0,j.HallCartList(a,!0).then((a=>{e.cartloading=!1,e.tableData=a.data.productList,e.cartInfo=a.data.cartInfo})).catch((a=>{e.cartloading=!1}))},cartAdd(e,a){let t=this;a.product_id;let s=e,l="mid";s<=1&&(l="down"),j.subHallCart({product_num:s,cart_id:a.cart_id,type:l},!0).then((e=>{t.getCart()})).catch((e=>{}))},handleCurrentChange(e){e&&(this.cart_id=e.cart_id,this.promodel=e)},changeMoney(){this.tableData.length<=0||(this.is_money=!0)},changeProduct(){this.promodel?this.isChange=!0:e({message:"请选择商品",type:"warning"})},deleteProduct(){let e=this;if(!e.cart_id)return;let t={cart_id:e.cart_id};a.confirm("确定要商品删行吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.cartloading=!0,j.delProduct(t,!0).then((a=>{e.cart_id=0,e.getCart(),e.$message({message:a.msg,type:"success"})}))}))},getCategory(){let e=this;j.getCategory({},!0).then((a=>{e.categoryList=a.data.list,e.getProduct()})).catch((e=>{}))},categoryFunc(e){this.loading||this.category_id==e||(this.loading=!0,this.category_id=e,this.curPage=1,this.listData=[],this.getProduct())},searchPro(){this.loading||(this.loading=!0,this.curPage=1,this.listData=[],this.getProduct())},getProduct(e){let a=this;a.loading=!0;let t={category_id:a.category_id,page:a.curPage,list_rows:a.pageSize,search:a.product_name};j.getProduct(t,!0).then((e=>{a.loading=!1,a.listData=a.listData.concat(e.data.list.data),a.last_page=e.data.list.last_page,e.data.list.last_page<=1&&(a.no_more=!0)})).catch((e=>{a.loading=!1}))},addProduct(e){this.detail=e,this.is_spec=!0},addCart(e){let a=this,t=e;t.table_id=a.model.table_id,j.addHallCart(t,!0).then((e=>{a.getCart()})).catch((e=>{}))},closeSpec(e){e&&null!=e&&"undefined"!=e&&this.addCart(e),this.detail=null,this.is_spec=!1},closeFunc(){this.$emit("close","home",null)},addMeal(e){let a=this;if(!a.loading&&e&&null!=e){let e={table_id:a.model.table_id,order_id:a.model.order_id,meal_num:a.num,user_id:0};a.loading=!0,j.addMeal(e,!0).then((e=>{a.loading=!1,a.getCart(),a.$message({message:e.msg,type:"success"}),a.$emit("close","home",null)})).catch((e=>{a.loading=!1}))}},closeCash(a){let t=this;if("addMeal"!=t.type){if(!t.num>0)e.error("请选择就餐人数");else if(!t.loading&&a&&null!=a){let a={table_id:t.model.table_id,meal_num:t.num,user_id:0};t.loading=!0,j.tableBuy(a,!0).then((a=>{t.loading=!1,t.getCart(),e({message:a.msg,type:"success"}),t.$emit("close","home",null)})).catch((e=>{t.loading=!1}))}}else t.addMeal(a)},scrolltolowerFunc(){let e=this;e.loading||e.curPage>=e.last_page||(e.loading=!0,e.curPage++,e.getProduct())},closeSearch(){this.is_search=!1},closeMoney(a){let t=this;if(a){let s=a;j.changeMoney(s,!0).then((a=>{t.cart_id=0,t.getCart(),e({message:a.msg,type:"success"})}))}this.is_money=!1},closeChange(a){let t=this;if(a){let s={cart_id:t.promodel.cart_id,price:a};j.changePrice(s,!0).then((a=>{t.cart_id=0,t.getCart(),e({message:a.msg,type:"success"})}))}this.isChange=!1}}},X=e=>(N("data-v-9573c909"),e=e(),Q(),e),Y={key:0,class:"home-container"},E={class:"category-list"},G=["onClick"],J={class:"d-c-c ww100 hh100"},K={class:"mr20"},O=X((()=>L("span",{class:""},"就餐人数 ",-1))),Z={class:""},ee=X((()=>L("span",{class:""},"收银员：",-1))),ae={class:"mb16"},te={class:"scroll-list"},se=["infinite-scroll-disabled"],le=["onClick"],oe=["src"],ie={class:"product-name text-ellipsis-2"},re={class:"d-b-c"},ce={class:"product-price"},de={class:""},ne={class:"gray9 f12"},ue={class:"red"},me={class:"tr ww100"},pe=X((()=>L("span",{class:"price-color f24 fb"},"￥",-1))),he={class:"price-color f28 fb"},ge={class:"d-a-c ww100"},_e=["disabled"];const fe=D(W,[["render",function(e,a,C,j,v,w){const P=t,k=y,V=s,D=l,N=o,Q=i,R=M("CirclePlus"),W=b,X=r,fe=c,ye=d,be=n,Ce=u,je=m,ve=p,we=h,Pe=g,ke=M("Search"),Ve=M("Money"),De=M("Change"),Me=M("Spec"),Se=_,Ie=f;return null!=C.model?(S(),I("div",Y,[x(Pe,{class:"ww100"},{default:F((()=>[x(P,{width:"128px"},{default:F((()=>[L("ul",E,[L("li",{class:U(["item",0==v.category_id?"active":""]),onClick:a[0]||(a[0]=e=>w.categoryFunc(0))},"全部",2),(S(!0),I(T,null,$(v.categoryList,((e,a)=>(S(),I("li",{class:U(["item",v.category_id==e.category_id?"active":""]),key:a,onClick:a=>w.categoryFunc(e.category_id)},B(e.name),11,G)))),128))])])),_:1}),x(Pe,{class:"hh100"},{default:F((()=>[x(D,{class:"border-b"},{default:F((()=>[L("div",J,[L("div",K,[O,x(V,{modelValue:v.num,"onUpdate:modelValue":a[1]||(a[1]=e=>v.num=e),placeholder:"请选择"},{default:F((()=>[(S(),I(T,null,$(20,(e=>x(k,{key:e.value,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),L("div",Z,[ee,x(V,{disabled:"",modelValue:v.username,"onUpdate:modelValue":a[2]||(a[2]=e=>v.username=e),placeholder:"请选择"},null,8,["modelValue"])])])])),_:1}),x(we,{class:"o-h"},{default:F((()=>[x(ve,{gutter:50},{default:F((()=>[x(X,{span:12},{default:F((()=>[L("div",ae,[x(Q,{placeholder:"请输入内容",modelValue:v.product_name,"onUpdate:modelValue":a[3]||(a[3]=e=>v.product_name=e),class:"input-with-select"},{append:F((()=>[x(N,{class:"search-btn",icon:"Search",onClick:w.searchPro},null,8,["onClick"])])),_:1},8,["modelValue"])]),L("div",te,[z((S(),I("div",{class:"product-list ww100","infinite-scroll-disabled":w.disableds()},[(S(!0),I(T,null,$(v.listData,((e,a)=>(S(),I("div",{class:"product-item",key:e.product_id,onClick:a=>w.addProduct(e)},[L("img",{src:e.image[0].file_path,alt:""},null,8,oe),L("div",ie,B(e.product_name),1),L("div",re,[L("span",ce,"￥"+B(e.product_price),1),x(W,{class:"icon-add"},{default:F((()=>[x(R)])),_:1})])],8,le)))),128))],8,se)),[[Se,w.scrolltolowerFunc]])])])),_:1}),x(X,{span:12,class:"pl250 b-s-b"},{default:F((()=>[x(je,{size:"small",ref:"form","label-width":"",style:{"text-align":"left"}},{default:F((()=>[x(Ce,{label:""},{default:F((()=>[z((S(),q(be,{class:"order-table","highlight-current-row":"",onCurrentChange:w.handleCurrentChange,data:v.tableData,"show-header":!1},{default:F((()=>[x(fe,{type:"index",align:"center"}),x(fe,{prop:"product_name",label:"商品名称"},{default:F((e=>[L("div",de,B(e.row.product.product_name),1),L("div",ne,B(e.row.describe),1)])),_:1}),x(fe,{prop:"price",label:"商品价格"},{default:F((e=>[L("span",ue,"￥"+B(e.row.price),1)])),_:1}),x(fe,{prop:"total_num",label:"商品数量"},{default:F((e=>[x(ye,{onChange:a=>w.cartAdd(a,e.row),size:"mini",modelValue:e.row.product_num,"onUpdate:modelValue":a=>e.row.product_num=a,min:0,label:""},null,8,["onChange","modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["onCurrentChange","data"])),[[Ie,v.cartloading]])])),_:1}),x(Ce,{label:""},{default:F((()=>[L("div",me,[H("数量"+B(v.cartInfo.cart_total_num)+"件,合计：",1),pe,L("span",he,B(v.cartInfo.total_price),1),H("元 ")])])),_:1}),x(Ce,{label:"",class:""},{default:F((()=>[L("div",ge,[L("button",{class:"pay-btn",type:"button",onClick:a[4]||(a[4]=(...e)=>w.closeCash&&w.closeCash(...e)),disabled:v.tableData.length<=0},"下单",8,_e),L("button",{class:"pay-btn",type:"button",onClick:a[5]||(a[5]=(...e)=>w.closeFunc&&w.closeFunc(...e))},"返回")])])),_:1})])),_:1},512)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),x(ke,{is_search:v.is_search,onClose:w.closeSearch},null,8,["is_search","onClose"]),x(Ve,{is_money:v.is_money,cartInfo:v.cartInfo,onClose:w.closeMoney},null,8,["is_money","cartInfo","onClose"]),x(De,{isChange:v.isChange,promodel:v.promodel,onClose:w.closeChange},null,8,["isChange","promodel","onClose"]),x(Me,{is_pop:v.is_spec,detail:v.detail,onClose:w.closeSpec},null,8,["is_pop","detail","onClose"])])):A("",!0)}],["__scopeId","data-v-9573c909"]]);export{fe as default};
