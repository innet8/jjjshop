import{$ as a,_ as t,r as l,a as e,e as i,c as s,o as n,f as u,g as o,h as c,n as d,F as r,i as _,t as f,p as v,s as y,k as p,S as g,w as m,b,d as h,u as w,j as k,I as C,v as I,N as x,x as $,q as S,z as N,A as L,O,D as z,C as A,U,V,W as B}from"./index-14bf2711.js";const D=t({__name:"cancel-all",props:{show:{type:Boolean,default:!1},tableId:{type:[Number,String],default:null},list:{type:Array,default:()=>[]}},emits:["update:show","success"],setup(t,{emit:m}){const b=t,h=l(!1),w=async()=>{var t;if(!h.value)try{h.value=!0;const l=await(t={table_id:b.tableId},a("order.HallCart/cancel",t));y({title:l.msg,icon:"none"}),m("update:show",!1),m("success")}catch(l){}finally{h.value=!1}};return(a,l)=>{const y=p,k=g,C=e(s("ti-modal"),i);return n(),u(C,{class:"ti-action-tips",title:a.$t("溫馨提示"),show:b.show,confirmLoading:h.value,onCancel:l[0]||(l[0]=a=>m("update:show",!1)),onConfirm:w},{content:o((()=>[c(y,{class:"ti-dialog-content"},{default:o((()=>[b.list&&t.list.length>0?(n(),d(r,{key:0},[c(y,{class:"ti-cancel-title"},{default:o((()=>[_(f(a.$t("此單有商品已送廚，是否取消此筆交易？")),1)])),_:1}),c(y,{class:"ti-cancel-all"},{default:o((()=>[c(k,{"scroll-y":""},{default:o((()=>[c(y,{class:"ti-cancel-list"},{default:o((()=>[(n(!0),d(r,null,v(b.list,((a,t)=>(n(),u(y,{key:t,class:"ti-cancel-item"},{default:o((()=>[_(f(null==a?void 0:a.product_name_text),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})],64)):(n(),d(r,{key:1},[_(f(a.$t("是否取消此筆交易？")),1)],64))])),_:1})])),_:1},8,["title","show","confirmLoading"])}}},[["__scopeId","data-v-2649cc86"]]),j=t({__name:"open-table",props:{show:{type:Boolean,default:!1},tableNo:{type:String,default:null},tableId:{type:[Number,String],default:null}},emits:["update:show","success"],setup(t,{emit:d}){const r=t,_=l(!1),f=l("");m((()=>r.show),(()=>{r.show&&(f.value="")}));const v=a=>{a&&(f.value+=a)},g=async()=>{if(f.value<=0)return y({title:k("請輸入人數"),icon:"none"});try{_.value=!0;const l=await(t={table_id:r.tableId,meal_num:f.value},a("order.Order/tableBuy",t));1==l.code&&(y({title:l.msg,icon:"none"}),d("update:show",!1),d("success"))}catch(l){}finally{_.value=!1}var t};return(a,t)=>{const l=e(s("ti-input"),b),y=p,m=e(s("ti-keyboard"),h),C=e(s("ti-modal"),i);return n(),u(C,{show:r.show,title:`[${r.tableNo}]${w(k)("就餐人數")}`},{content:o((()=>[c(y,{class:"ti-dialog-content"},{default:o((()=>[c(y,{class:"ti-modify-input"},{default:o((()=>[c(l,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),placeholder:w(k)("請輸入人數"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:o((()=>[c(y,{class:"ti-dialog-btn"},{default:o((()=>[c(m,{primaryLoading:_.value,isDoubleZero:!0,isCross:!1,isDrop:!1,onExit:t[1]||(t[1]=a=>d("update:show",!1)),onClear:t[2]||(t[2]=a=>f.value=""),onInput:v,onConfirm:g},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-949b2cf8"]]),H=t({__name:"index",setup(t){const i=l({area_id:"",type_id:"",table_status:""}),y=l(!1),b=l(!1),h=l([]),U=l(),V=l(),B=l([]),H=l([]),K=C((()=>U.value-V.value)),P=l(!1),q=l(),E=l([]),F=l(!1),M=l(),T=l();m((()=>i.value),(()=>{G(!0)}),{deep:!0});const W=a=>{const t=a%60;return`${Math.floor(a/60)} ${k("分钟")} ${t} ${k("秒")}`},Z=async t=>{var l,e,i;try{const s=await(i={table_id:t},a("order.HallCart/getUnSendKitchen",i));E.value=(null==(e=null==(l=s.data)?void 0:l.detail)?void 0:e.unSendKitchenProduct)||[],P.value=!0,q.value=t}catch(s){}},G=async t=>{var l,e,s,n;if(!b.value)try{t&&(b.value=!0);const u=await(n=i.value,a("store.table/table",n));h.value=(null==(l=u.data)?void 0:l.list)||[],U.value=(null==(e=u.data)?void 0:e.total_num)||0,V.value=(null==(s=u.data)?void 0:s.available_num)||0}catch(u){}finally{t&&(b.value=!1)}};return(async()=>{var t,l;try{const e=await a("store.table/tableType");B.value=(null==(t=e.data)?void 0:t.areaList)||[],H.value=(null==(l=e.data)?void 0:l.typeList)||[]}catch(e){}})(),G(!0),(a,t)=>{const l=p,m=g,C=e(s("ti-loading"),I),J=e(s("uni-icons"),x),Q=A,R=e(s("ti-empty-data"),$);return n(),d(r,null,[c(l,{class:"ti-dining-box"},{default:o((()=>[c(l,{class:"ti-dining-category"},{default:o((()=>[c(m,{"scroll-x":""},{default:o((()=>[c(l,{class:"ti-category-list"},{default:o((()=>[c(l,{class:"ti-category-item"},{default:o((()=>[c(l,{class:S(["ti-category-all",{active:""==i.value.area_id}]),onClick:t[0]||(t[0]=a=>i.value.area_id="")},{default:o((()=>[_(f(w(k)("全部")),1)])),_:1},8,["class"]),c(l,{class:"ti-category-child"},{default:o((()=>[(n(!0),d(r,null,v(B.value,(a=>(n(),u(l,{key:a.area_id,class:S([{active:i.value.area_id==a.area_id},"ti-category-childItem"]),onClick:t=>i.value.area_id=a.area_id},{default:o((()=>[_(f(a.area_name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),c(l,{class:"ti-category-item"},{default:o((()=>[c(l,{class:S(["ti-category-all",{active:""==i.value.type_id}]),onClick:t[1]||(t[1]=a=>i.value.type_id="")},{default:o((()=>[_(f(w(k)("全部")),1)])),_:1},8,["class"]),c(l,{class:"ti-category-child"},{default:o((()=>[(n(!0),d(r,null,v(H.value,(a=>(n(),u(l,{key:a.type_id,class:S([{active:i.value.type_id==a.type_id},"ti-category-childItem"]),onClick:t=>i.value.type_id=a.type_id},{default:o((()=>[_(f(a.type_name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),c(l,{class:"ti-category-item"},{default:o((()=>[c(l,{class:S(["ti-category-all",{active:""==i.value.table_status}]),onClick:t[2]||(t[2]=a=>i.value.table_status="")},{default:o((()=>[_(f(w(k)("全部")),1)])),_:1},8,["class"]),c(l,{class:"ti-category-child"},{default:o((()=>[c(l,{class:S(["ti-category-childItem",{active:"10"==i.value.table_status}]),onClick:t[3]||(t[3]=a=>i.value.table_status="10")},{default:o((()=>[_(f(w(k)("可用"))+" ("+f(V.value||0)+") ",1)])),_:1},8,["class"]),c(l,{class:S(["ti-category-childItem",{active:"30"==i.value.table_status}]),onClick:t[4]||(t[4]=a=>i.value.table_status="30")},{default:o((()=>[_(f(w(k)("佔用"))+" ("+f(w(K)||0)+") ",1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(l,{class:"ti-dining-table"},{default:o((()=>[c(m,{class:"ti-scroll","scroll-y":""},{default:o((()=>[b.value?(n(),u(C,{key:0})):h.value&&h.value.length>0?(n(),d(r,{key:1},[c(l,{class:"ti-dining-list"},{default:o((()=>[(n(!0),d(r,null,v(h.value,(a=>(n(),u(l,{key:a.table_id,class:S([{green:30!=a.status},"ti-dining-item"]),onClick:t=>(a=>{30!=a.status&&(T.value=a.table_no,M.value=a.table_id,F.value=!0)})(a)},{default:o((()=>[c(l,{class:"ti-dining-number"},{default:o((()=>[_(f(a.table_no),1)])),_:2},1024),30==a.status?(n(),u(l,{key:0,class:"ti-dining-info"},{default:o((()=>[c(l,{class:"ti-dining-info-item"},{default:o((()=>[c(l,{class:"ti-dining-info-icon"},{default:o((()=>[c(J,{"custom-prefix":"iconfont",type:"icon-user",size:"18",color:"#100A05"})])),_:1}),c(l,{class:"ti-dining-info-text"},{default:o((()=>{var t;return[_(f((null==(t=a.underwayOrder)?void 0:t.meal_num)||"-"),1)]})),_:2},1024)])),_:2},1024),c(l,{class:"ti-dining-info-item"},{default:o((()=>[c(l,{class:"ti-dining-info-icon"},{default:o((()=>[c(J,{"custom-prefix":"iconfont",type:"icon-wallet",size:"18",color:"#100A05"})])),_:1}),c(l,{class:"ti-dining-info-text"},{default:o((()=>[c(Q,{class:"ti-dining-info-price"},{default:o((()=>{var t;return[_(f(w(N)(null==(t=a.underwayOrder)?void 0:t.total_price)),1)]})),_:2},1024),c(Q,{class:"ti-dining-info-subPrice"},{default:o((()=>{var t;return[_(f(w(L)(null==(t=a.underwayOrder)?void 0:t.total_price)),1)]})),_:2},1024)])),_:2},1024)])),_:2},1024),c(l,{class:"ti-dining-info-item"},{default:o((()=>[c(l,{class:"ti-dining-info-icon"},{default:o((()=>[c(J,{"custom-prefix":"iconfont",type:"icon-clock",size:"18",color:"#100A05"})])),_:1}),c(l,{class:"ti-dining-info-text"},{default:o((()=>{var t;return[_(f(W(null==(t=a.underwayOrder)?void 0:t.elapsed_time)),1)]})),_:2},1024)])),_:2},1024)])),_:2},1024)):(n(),u(l,{key:1,class:"ti-dining-idle"},{default:o((()=>[_(f(w(k)("空闲中")),1)])),_:1})),30==a.status?(n(),u(l,{key:2,class:"ti-dining-close",onClick:O((t=>Z(a.table_id)),["stop"])},{default:o((()=>[c(J,{type:"closeempty",size:"14",color:"#fff"})])),_:2},1032,["onClick"])):z("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),c(C,{status:y.value?"loading":"no-more"},null,8,["status"])],64)):(n(),u(R,{key:2}))])),_:1})])),_:1}),c(l,{class:"ti-dining-total"},{default:o((()=>[c(l,{class:"ti-dining-total-box"},{default:o((()=>[c(l,{class:"ti-dining-total-item"},{default:o((()=>[_(f(w(k)("全部"))+" ("+f(U.value)+")",1)])),_:1}),c(l,{class:"ti-dining-total-item"},{default:o((()=>[c(l,{class:"ti-dining-total-color green"}),c(l,null,{default:o((()=>[_(f(w(k)("可用"))+" ("+f(V.value||0)+")",1)])),_:1})])),_:1}),c(l,{class:"ti-dining-total-item"},{default:o((()=>[c(l,{class:"ti-dining-total-color orange"}),c(l,null,{default:o((()=>[_(f(w(k)("佔用"))+" ("+f(w(K)||0)+")",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),c(D,{show:P.value,"onUpdate:show":t[5]||(t[5]=a=>P.value=a),tableId:q.value,list:E.value,onSuccess:t[6]||(t[6]=a=>G())},null,8,["show","tableId","list"]),c(j,{show:F.value,"onUpdate:show":t[7]||(t[7]=a=>F.value=a),tableId:M.value,tableNo:T.value,onSuccess:t[8]||(t[8]=a=>G())},null,8,["show","tableId","tableNo"])],64)}}},[["__scopeId","data-v-1a1911a8"]]),K={__name:"index",setup:a=>(U((()=>{V()})),(a,t)=>{const l=B("ti-layout");return n(),u(l,null,{default:o((()=>[c(H)])),_:1})})};export{K as default};
