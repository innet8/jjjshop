var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a,l)=>new Promise(((t,s)=>{var o=e=>{try{i(l.next(e))}catch(a){s(a)}},u=e=>{try{i(l.throw(e))}catch(a){s(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);i((l=l.apply(e,a)).next())}));import{_ as u,u as i,s as n,h as r,j as d,k as c,l as p,m as v,n as f,b as m,c as _,w as g,d as h,p as y,t as b,q as w,v as x,x as k,y as V,i as C,z as I,A as j,B as O,C as P,D as U,E as F,$ as L,F as $,G as z,H as D,I as E,J as R,K as S,L as q,M as A,N as B,r as G,O as H,P as J,Q as K,R as M,S as N}from"./index-a317a63f.js";import{_ as Q}from"./ti-select.6c87023f.js";const T=""+new URL("bg-93598f2d.png",import.meta.url).href,W=""+new URL("login_logo-83575c4a.svg",import.meta.url).href,X=u({__name:"set-language",setup(e){const a=i(),{languageData:l,languageDefault:t}=n(a),s=r(),o=r();d((()=>{s.value=c()||t.value,o.value=p[s.value]}));const u=e=>{s.value!=e&&(s.value=e,o.value=p[e],x(e))};return(e,a)=>{const t=v(f("uni-icons"),k),i=V,n=C,r=v(f("ti-select"),Q);return m(),_(r,{modelValue:s.value,clear:!1,placement:"top",localdata:w(l),onChange:u},{select:g((()=>[h(n,{class:"ti-language"},{default:g((()=>[h(t,{"custom-prefix":"iconfont",type:"icon-global",size:"16"}),h(i,{class:"ti-language-text"},{default:g((()=>[y(b(o.value),1)])),_:1}),h(t,{type:"right",size:"16",style:{transform:"rotate(90deg)"}})])),_:1})])),_:1},8,["modelValue","localdata"])}}},[["__scopeId","data-v-d948fc55"]]),Y=u({__name:"index",setup(e){var u;const n=i(),c=I(),p=r(!0),x=r(!1),k=r(!1),V=r({user_name:"",password:""}),Q=j((()=>!V.value.user_name||!V.value.password)),Y=r(!1),Z=r(!(null==(u=O())?void 0:u.api_url)),ee=r({ip:"",port:"",device_id:""});P((()=>Z.value),(()=>{Z.value&&ae()})),d((()=>{ae(),U({success:e=>{ee.value.device_id=e.deviceId}})}));const ae=()=>{const e=O();ee.value.ip=(null==e?void 0:e.ip)||F()||"127.0.0.1",ee.value.port=(null==e?void 0:e.port)||"8080"},le=()=>o(this,null,(function*(){var e,o,u,i,r,d,c,p;const v=((e,o)=>{for(var u in o||(o={}))l.call(o,u)&&s(e,u,o[u]);if(a)for(var u of a(o))t.call(o,u)&&s(e,u,o[u]);return e})({},ee.value);if(!v.ip)return $({title:L("请输入服务器地址"),icon:"none"});if(!v.port)return $({title:L("请输入端口"),icon:"none"});try{Y.value=!0;const a=yield z(D(`${null==v?void 0:v.ip}:${v.port}`),{key:ee.value.device_id,address:ee.value.ip,port:ee.value.port});(null==(o=null==(e=a.data)?void 0:e.shop)?void 0:o.app_id)&&(null==(i=null==(u=a.data)?void 0:u.shop)?void 0:i.shop_supplier_id)?(Z.value=!1,$({title:L("绑定成功"),icon:"none"}),E(null==(d=null==(r=a.data)?void 0:r.shop)?void 0:d.app_id),R(null==(p=null==(c=a.data)?void 0:c.shop)?void 0:p.shop_supplier_id),S(v),setTimeout((()=>{var e;O()&&q(`${null==(e=O())?void 0:e.api_url}/cashier-mini`)}),100),n.getList()):$({title:L("绑定失败"),icon:"none"})}catch(f){$({title:L("绑定失败"),icon:"none"})}finally{Y.value=!1}})),te=()=>o(this,null,(function*(){if(!V.value.user_name)return $({title:L("請輸入賬號"),icon:"none"});if(!V.value.password)return $({title:L("输入登录密码"),icon:"none"});try{k.value=!0;const e=yield A(V.value);e.data.token&&(B(e.data.token),c.getUserInfo(!0),G({url:"/pages/index/index"}))}catch(e){}finally{k.value=!1}})),se=e=>{e&&(1==p.value&&(V.value.user_name+=e),1==x.value&&(V.value.password+=e))},oe=e=>{p.value="username"===e,x.value="password"===e},ue=()=>{1==p.value&&(V.value.user_name=""),1==x.value&&(V.value.password="")},ie=()=>{Z.value=!Z.value};return(e,a)=>{const l=H,t=C,s=J,o=v(f("ti-button"),K),u=v(f("ti-input"),M),i=v(f("ti-keyboard"),N);return m(),_(t,{class:"ti-login"},{default:g((()=>[h(t,{class:"ti-login-img"},{default:g((()=>[h(l,{src:T,mode:"widthFix"})])),_:1}),h(t,{class:"ti-login-box"},{default:g((()=>[Z.value?(m(),_(t,{key:0,class:"ti-serve-box"},{default:g((()=>[h(t,{class:"ti-serve-head"},{default:g((()=>[h(t,{class:"ti-serve-logo"},{default:g((()=>[h(l,{src:W,mode:"widthFix"})])),_:1}),h(t,{class:"ti-serve-title"},{default:g((()=>[y(b(w(L)("收银机")),1)])),_:1})])),_:1}),h(t,{class:"ti-serve-label"},{default:g((()=>[y(b(w(L)("服务器连接地址")),1)])),_:1}),h(t,{class:"ti-serve-input"},{default:g((()=>[h(t,{class:"ti-serve-ip"},{default:g((()=>[h(s,{modelValue:ee.value.ip,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.ip=e),type:"text",placeholder:w(L)("服务器地址")},null,8,["modelValue","placeholder"])])),_:1}),h(t,{class:"ti-serve-colon"},{default:g((()=>[y(":")])),_:1}),h(t,{class:"ti-serve-port"},{default:g((()=>[h(s,{modelValue:ee.value.port,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.port=e),type:"number",placeholder:w(L)("端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),h(t,{class:"ti-serve-btn"},{default:g((()=>[h(o,{onClick:ae},{default:g((()=>[y(b(w(L)("重置")),1)])),_:1}),h(o,{loading:Y.value,type:"primary",onClick:le},{default:g((()=>[y(b(w(L)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(m(),_(t,{key:1,class:"ti-login-form"},{default:g((()=>[h(t,{class:"ti-form-box"},{default:g((()=>[h(t,{class:"ti-form-head"},{default:g((()=>[h(t,{class:"ti-login-logo"},{default:g((()=>[h(l,{src:W,mode:"widthFix"})])),_:1}),h(t,{class:"ti-login-title"},{default:g((()=>[y(b(w(L)("收银机")),1)])),_:1})])),_:1}),h(t,{class:"ti-form-username"},{default:g((()=>[h(u,{modelValue:V.value.user_name,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value.user_name=e),prefixIcon:"icon-user",placeholder:w(L)("請輸入用戶名"),focus:p.value,onClick:a[3]||(a[3]=e=>oe("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),h(t,{class:"ti-form-password"},{default:g((()=>[h(u,{modelValue:V.value.password,"onUpdate:modelValue":a[4]||(a[4]=e=>V.value.password=e),prefixIcon:"icon-lock",placeholder:w(L)("請輸入登錄密碼"),focus:x.value,password:!0,onClick:a[5]||(a[5]=e=>oe("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),h(t,{class:"ti-form-btn"},{default:g((()=>[h(o,{type:"primary",loading:k.value,disabled:w(Q),onClick:te},{default:g((()=>[y(b(w(L)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),h(t,{class:"ti-form-link",onClick:ie},{default:g((()=>[y(b(w(L)("更换服务器")),1)])),_:1})])),_:1}),h(t,{class:"ti-form-keyboard"},{default:g((()=>[h(i,{isExit:!1,isPrimary:!1,onInput:se,onClear:ue})])),_:1})])),_:1}))])),_:1}),h(t,{class:"ti-language-box"},{default:g((()=>[h(X)])),_:1})])),_:1})}}},[["__scopeId","data-v-af536032"]]);export{Y as default};
