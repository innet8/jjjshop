var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,t=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,o=(e,a,l)=>new Promise(((s,t)=>{var o=e=>{try{u(l.next(e))}catch(a){t(a)}},i=e=>{try{u(l.throw(e))}catch(a){t(a)}},u=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,i);u((l=l.apply(e,a)).next())}));import{_ as i,u,s as n,h as r,l as d,j as c,k as p,m as v,b as f,c as m,w as _,d as g,n as h,t as y,p as b,q as w,v as x,i as k,x as V,y as C,z as I,A as j,B as O,C as P,D as U,$ as L,E as F,F as $,G as z,H as E,I as R,J as D,K as q,L as A,M as B,r as G,N as H,O as J,P as K,Q as M,R as N}from"./index-85835b28.js";import{u as Q,_ as S}from"./locale.39f93951.js";const T=""+new URL("bg-93598f2d.png",import.meta.url).href,W=""+new URL("login_logo-83575c4a.svg",import.meta.url).href,X=i({__name:"set-language",setup(e){const a=u(),{languageData:l}=n(a),{changeLocale:s}=Q(),t=r((()=>d[c()])),o=e=>{e&&e!==c()&&s(e)};return(e,a)=>{const s=p(v("uni-icons"),w),i=x,u=k,n=p(v("ti-select"),S);return f(),m(n,{modelValue:b(c)(),clear:!1,placement:"top",localdata:b(l),onChange:o},{select:_((()=>[g(u,{class:"ti-language"},{default:_((()=>[g(s,{"custom-prefix":"iconfont",type:"icon-global",size:"16"}),g(i,{class:"ti-language-text"},{default:_((()=>[h(y(b(t)),1)])),_:1}),g(s,{type:"right",size:"16",style:{transform:"rotate(90deg)"}})])),_:1})])),_:1},8,["modelValue","localdata"])}}},[["__scopeId","data-v-822dd917"]]),Y=i({__name:"index",setup(e){var i;const n=u(),d=V(),c=C(!0),w=C(!1),x=C(!1),Q=C({user_name:"",password:""}),S=r((()=>!Q.value.user_name||!Q.value.password)),Y=C(!1),Z=C(!(null==(i=I())?void 0:i.api_url)),ee=C({ip:"",port:"",device_id:""});j((()=>Z.value),(()=>{Z.value&&ae()})),O((()=>{ae(),P({success:e=>{ee.value.device_id=e.deviceId}})}));const ae=()=>{const e=I();ee.value.ip=(null==e?void 0:e.ip)||U()||"127.0.0.1",ee.value.port=(null==e?void 0:e.port)||"8080"},le=()=>o(this,null,(function*(){var e,o,i,u,r,d,c,p;const v=((e,o)=>{for(var i in o||(o={}))l.call(o,i)&&t(e,i,o[i]);if(a)for(var i of a(o))s.call(o,i)&&t(e,i,o[i]);return e})({},ee.value);if(!v.ip)return F({title:L("请输入服务器地址"),icon:"none"});if(!v.port)return F({title:L("请输入端口"),icon:"none"});try{Y.value=!0;const a=yield $(z(`${null==v?void 0:v.ip}:${v.port}`),{key:ee.value.device_id,address:ee.value.ip,port:ee.value.port});(null==(o=null==(e=a.data)?void 0:e.shop)?void 0:o.app_id)&&(null==(u=null==(i=a.data)?void 0:i.shop)?void 0:u.shop_supplier_id)?(Z.value=!1,F({title:L("绑定成功"),icon:"none"}),E(null==(d=null==(r=a.data)?void 0:r.shop)?void 0:d.app_id),R(null==(p=null==(c=a.data)?void 0:c.shop)?void 0:p.shop_supplier_id),D(v),setTimeout((()=>{var e;I()&&q(`${null==(e=I())?void 0:e.api_url}/cashier-mini`)}),100),n.getList()):F({title:L("绑定失败"),icon:"none"})}catch(f){F({title:L("绑定失败"),icon:"none"})}finally{Y.value=!1}})),se=()=>o(this,null,(function*(){if(!Q.value.user_name)return F({title:L("請輸入賬號"),icon:"none"});if(!Q.value.password)return F({title:L("输入登录密码"),icon:"none"});try{x.value=!0;const e=yield A(Q.value);e.data.token&&(B(e.data.token),d.getUserInfo(!0),G({url:"/pages/index/index"}))}catch(e){}finally{x.value=!1}})),te=e=>{e&&(1==c.value&&(Q.value.user_name+=e),1==w.value&&(Q.value.password+=e))},oe=e=>{c.value="username"===e,w.value="password"===e},ie=()=>{1==c.value&&(Q.value.user_name=""),1==w.value&&(Q.value.password="")},ue=()=>{Z.value=!Z.value};return(e,a)=>{const l=H,s=k,t=J,o=p(v("ti-button"),K),i=p(v("ti-input"),M),u=p(v("ti-keyboard"),N);return f(),m(s,{class:"ti-login"},{default:_((()=>[g(s,{class:"ti-login-img"},{default:_((()=>[g(l,{src:T,mode:"widthFix"})])),_:1}),g(s,{class:"ti-login-box"},{default:_((()=>[Z.value?(f(),m(s,{key:0,class:"ti-serve-box"},{default:_((()=>[g(s,{class:"ti-serve-head"},{default:_((()=>[g(s,{class:"ti-serve-logo"},{default:_((()=>[g(l,{src:W,mode:"widthFix"})])),_:1}),g(s,{class:"ti-serve-title"},{default:_((()=>[h(y(b(L)("收银机")),1)])),_:1})])),_:1}),g(s,{class:"ti-serve-label"},{default:_((()=>[h(y(b(L)("服务器连接地址")),1)])),_:1}),g(s,{class:"ti-serve-input"},{default:_((()=>[g(s,{class:"ti-serve-ip"},{default:_((()=>[g(t,{modelValue:ee.value.ip,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.ip=e),type:"text",placeholder:b(L)("服务器地址")},null,8,["modelValue","placeholder"])])),_:1}),g(s,{class:"ti-serve-colon"},{default:_((()=>[h(":")])),_:1}),g(s,{class:"ti-serve-port"},{default:_((()=>[g(t,{modelValue:ee.value.port,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.port=e),type:"number",placeholder:b(L)("端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),g(s,{class:"ti-serve-btn"},{default:_((()=>[g(o,{onClick:ae},{default:_((()=>[h(y(b(L)("重置")),1)])),_:1}),g(o,{loading:Y.value,type:"primary",onClick:le},{default:_((()=>[h(y(b(L)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(f(),m(s,{key:1,class:"ti-login-form"},{default:_((()=>[g(s,{class:"ti-form-box"},{default:_((()=>[g(s,{class:"ti-form-head"},{default:_((()=>[g(s,{class:"ti-login-logo"},{default:_((()=>[g(l,{src:W,mode:"widthFix"})])),_:1}),g(s,{class:"ti-login-title"},{default:_((()=>[h(y(b(L)("收银机")),1)])),_:1})])),_:1}),g(s,{class:"ti-form-username"},{default:_((()=>[g(i,{modelValue:Q.value.user_name,"onUpdate:modelValue":a[2]||(a[2]=e=>Q.value.user_name=e),prefixIcon:"icon-user",placeholder:b(L)("請輸入用戶名"),focus:c.value,onClick:a[3]||(a[3]=e=>oe("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),g(s,{class:"ti-form-password"},{default:_((()=>[g(i,{modelValue:Q.value.password,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value.password=e),prefixIcon:"icon-lock",placeholder:b(L)("請輸入登錄密碼"),focus:w.value,password:!0,onClick:a[5]||(a[5]=e=>oe("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),g(s,{class:"ti-form-btn"},{default:_((()=>[g(o,{type:"primary",loading:x.value,disabled:b(S),onClick:se},{default:_((()=>[h(y(b(L)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),g(s,{class:"ti-form-link",onClick:ue},{default:_((()=>[h(y(b(L)("更换服务器")),1)])),_:1})])),_:1}),g(s,{class:"ti-form-keyboard"},{default:_((()=>[g(u,{isExit:!1,isPrimary:!1,onInput:te,onClear:ie})])),_:1})])),_:1}))])),_:1}),g(s,{class:"ti-language-box"},{default:_((()=>[g(X)])),_:1})])),_:1})}}},[["__scopeId","data-v-af536032"]]);export{Y as default};
