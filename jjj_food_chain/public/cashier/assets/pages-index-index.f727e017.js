import{_ as e,m as t,p as l,r as a,J as u,b as s,K as i,L as d,o,d as n,w as c,e as r,f as v,t as p,u as _,$ as f,x as m,j as y,H as h,M as b,N as g,O as w,P as k,Q as I,S as x,R as C,T as P,U as $,V as D,W as U,X as L,i as S,Y as V,Z as j,a0 as N,a1 as K,c as O,a2 as B,a3 as T,a4 as E,a5 as F,a as Z,a6 as z,a7 as R,a8 as A,a9 as M,n as G,aa as H,ab as J,G as Q,ac as W,ad as X,ae as Y,af as q,ag as ee,ah as te,ai as le}from"./index-0ac080f5.js";import{f as ae,a as ue,b as se,c as ie,g as de,d as oe,e as ne,h as ce,i as re,j as ve,k as pe,l as _e,m as fe,n as me,o as ye,p as he}from"./product.f1cdd73e.js";import{_ as be}from"./u-switch.00d25c3d.js";const ge=e({__name:"modify-price",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:h}){const b=e,g=t(!1),w=t("");l((()=>b.show),(()=>{b.show&&(w.value="")}));const k=e=>{e&&(w.value+=e)},I=async()=>{var e;if(w.value<=0)return m({title:f("請輸入價格"),icon:"none"});try{g.value=!0;const t=await ae({order_product_id:null==(e=b.productItem)?void 0:e.order_product_id,price:w.value});1==t.code&&(m({title:t.msg,icon:"none"}),h("update:show",!1),h("success"))}catch(t){}finally{g.value=!1}};return(t,l)=>{const m=y,x=a(s("ti-input"),u),C=a(s("ti-keyboard"),i),P=a(s("ti-modal"),d);return o(),n(P,{show:b.show,title:_(f)("價格")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-modify-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(p((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-modify-input"},{default:c((()=>[r(x,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),placeholder:_(f)("請輸入價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(C,{primaryLoading:g.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>h("update:show",!1)),onClear:l[2]||(l[2]=e=>w.value=""),onInput:k,onConfirm:I},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-574c9bdc"]]),we=e({__name:"remark",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:u}){const i=e,g=t(!1),w=t("");l((()=>i.show),(()=>{var e;i.show&&(w.value=(null==(e=i.productItem)?void 0:e.remark)||"")}));const k=async()=>{var e;try{g.value=!0;const t=await ue({order_product_id:null==(e=i.productItem)?void 0:e.order_product_id,remark:w.value.trim()});1==t.code&&(m({title:t.msg,icon:"none"}),u("update:show",!1),u("success"))}catch(t){}finally{g.value=!1}};return(t,l)=>{const m=y,I=b,x=a(s("ti-button"),h),C=a(s("ti-modal"),d);return o(),n(C,{show:i.show,title:_(f)("備註")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-remark-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(p((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-remark-textarea"},{default:c((()=>[r(I,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),"placeholder-style":"color:rgba(16,10,5,.3)",placeholder:_(f)("请输入")},null,8,["modelValue","placeholder"])])),_:1}),r(m,{class:"ti-remark-num"},{default:c((()=>{var e;return[v(p((null==(e=w.value)?void 0:e.trim().length)||0)+"/50 ",1)]})),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(x,{onClick:l[1]||(l[1]=e=>u("update:show",!1))},{default:c((()=>[v(p(_(f)("退出")),1)])),_:1}),r(x,{onClick:l[2]||(l[2]=e=>w.value="")},{default:c((()=>[v(p(_(f)("清空")),1)])),_:1}),r(x,{loading:g.value,type:"primary",onClick:k},{default:c((()=>[v(p(_(f)("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-e26b6c83"]]),ke=e({__name:"withdrawal",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:h}){const b=e,x=t(!1),C=t(""),P=t([f("等待時間長"),f("口味不好"),f("菜賣光了")]),$=t(0);l((()=>b.show),(()=>{var e;b.show&&(C.value=(null==(e=b.productItem)?void 0:e.total_num)||"")}));const D=e=>{e&&(C.value+=e)},U=async()=>{var e,t;if(C.value<=0)return m({title:f("請輸入價格"),icon:"none"});try{x.value=!0;const l=await se({order_id:null==(e=b.productItem)?void 0:e.order_id,order_product_id:null==(t=b.productItem)?void 0:t.order_product_id,num:C.value,return_reason:P.value[$.value]});1==l.code&&(m({title:l.msg,icon:"none"}),h("update:show",!1),h("success"))}catch(l){}finally{x.value=!1}};return(t,l)=>{const m=y,L=a(s("ti-input"),u),S=a(s("ti-keyboard"),i),V=a(s("ti-modal"),d);return o(),n(V,{show:b.show,title:_(f)("退菜")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-withdrawal-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(p((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-withdrawal-list"},{default:c((()=>[(o(!0),g(w,null,k(P.value,((e,t)=>(o(),n(m,{key:t,class:I([{active:t==$.value},"ti-withdrawal-item"]),onClick:e=>(e=>{$.value=e})(t)},{default:c((()=>[v(p(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(m,{class:"ti-withdrawal-input"},{default:c((()=>[r(L,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),placeholder:_(f)("请输入退菜數量"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(S,{primaryLoading:x.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>h("update:show",!1)),onClear:l[2]||(l[2]=e=>C.value=""),onInput:D,onConfirm:U},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-98d0bf8e"]]),Ie=e({__name:"cancel-all",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show","success"],setup(e,{emit:l}){const u=e,i=t(!1),_=async()=>{if(!i.value)try{i.value=!0;const e=await ie({order_id:u.orderId});m({title:e.msg,icon:"none"}),l("update:show",!1),l("success")}catch(e){}finally{i.value=!1}};return(t,f)=>{const m=y,h=x,b=a(s("ti-modal"),d);return o(),n(b,{class:"ti-action-tips",title:t.$t("溫馨提示"),show:u.show,confirmLoading:i.value,onCancel:f[0]||(f[0]=e=>l("update:show",!1)),onConfirm:_},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[u.sendKitchen&&e.sendKitchen.length>0?(o(),g(w,{key:0},[r(m,{class:"ti-cancel-title"},{default:c((()=>[v(p(t.$t("此單有商品已送廚，是否取消此筆交易？")),1)])),_:1}),r(m,{class:"ti-cancel-all"},{default:c((()=>[r(h,{"scroll-y":""},{default:c((()=>[r(m,{class:"ti-cancel-list"},{default:c((()=>[(o(!0),g(w,null,k(u.sendKitchen,((e,t)=>(o(),n(m,{key:t,class:"ti-cancel-item"},{default:c((()=>[v(p(null==e?void 0:e.product_name_text),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})],64)):(o(),g(w,{key:1},[v(p(t.$t("是否取消此筆交易？")),1)],64))])),_:1})])),_:1},8,["title","show","confirmLoading"])}}},[["__scopeId","data-v-9ce42bf3"]]),xe=e({__name:"order-pickup",props:{show:{type:Boolean,default:!1},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show","success"],setup(e,{emit:u}){const i=e,d=t(),b=t(!1),I=t(!1),V=t(),j=t({page:1,list_rows:20}),N=t(!1),K=t([]),O=t(!1);l((()=>i.show),(()=>{i.show&&B()}));const B=()=>{j.value.page=1,E(!0)},T=()=>{O.value&&(j.value.page+=1,E())},E=async e=>{var t,l,a,u,s;if(!N.value)try{e&&(N.value=!0);const i=await de(j.value);1==j.value.page&&(K.value=[]),K.value=K.value.concat((null==(t=i.data)?void 0:t.productList)||[]),O.value=(null==(a=null==(l=i.data)?void 0:l.list)?void 0:a.last_page)>(null==(s=null==(u=i.data)?void 0:u.list)?void 0:s.current_page)}catch(i){}finally{e&&(N.value=!1)}};return(t,l)=>{const j=a(s("ti-loading"),C),E=S,F=y,Z=a(s("ti-button"),h),z=a(s("ti-empty-data"),P),R=x,A=a(s("ti-drawer"),$);return o(),n(F,null,{default:c((()=>[r(A,{show:i.show,isConfirmShow:!1,title:_(f)("取單"),onCancel:l[0]||(l[0]=e=>u("update:show",!1))},{content:c((()=>[r(F,{class:"ti-order-pickup"},{default:c((()=>[r(R,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:T},{default:c((()=>[N.value?(o(),n(j,{key:0})):K.value&&K.value.length>0?(o(),g(w,{key:1},[r(F,{class:"ti-pickup-list"},{default:c((()=>[(o(!0),g(w,null,k(K.value,((e,t)=>(o(),n(F,{key:t,class:"ti-pickup-item"},{default:c((()=>[r(F,{class:"ti-pickup-top"},{default:c((()=>[r(F,{class:"ti-pickup-left"},{default:c((()=>[r(F,{class:"ti-price-box"},{default:c((()=>[r(E,{class:"ti-price-text"},{default:c((()=>[v(p(_(f)("訂單總價：")),1)])),_:1}),r(E,{class:"ti-pickup-price"},{default:c((()=>[v(p(_(D)(null==e?void 0:e.total_price)),1)])),_:2},1024),r(E,{class:"ti-pickup-subPrice"},{default:c((()=>[v(p(_(U)(null==e?void 0:e.total_price)),1)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-time"},{default:c((()=>[r(E,null,{default:c((()=>[v(p(_(f)("掛單時間：")),1)])),_:1}),r(E,null,{default:c((()=>[v(p(null==e?void 0:e.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-action"},{default:c((()=>[r(F,{class:"ti-cancel-all"},{default:c((()=>[r(Z,{type:"danger",onClick:t=>{return l=e.order_id,V.value=l,void(I.value=!0);var l}},{default:c((()=>[v(p(_(f)("整單取消")),1)])),_:2},1032,["onClick"])])),_:2},1024),r(F,null,{default:c((()=>[r(Z,{type:"primary",loading:d.value==e.order_id&&b.value,onClick:t=>(async e=>{if(!b.value){d.value=e;try{b.value=!0;const t=await oe({order_id:e});m({title:t.msg,icon:"none"}),u("update:show",!1),L(e),setTimeout((()=>{u("success")}),100)}catch(t){}finally{b.value=!1}}})(e.order_id)},{default:c((()=>[v(p(_(f)("取單")),1)])),_:2},1032,["loading","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-goods"},{default:c((()=>[r(F,{class:"ti-goods-head"},{default:c((()=>[r(F,null,{default:c((()=>[v(p(_(f)("商品名称")),1)])),_:1}),r(F,null,{default:c((()=>[v(p(_(f)("金額")),1)])),_:1}),r(F,null,{default:c((()=>[v(p(_(f)("數量")),1)])),_:1})])),_:1}),r(F,{class:"ti-goods-body"},{default:c((()=>[(o(!0),g(w,null,k((null==e?void 0:e.product)||[],((e,t)=>(o(),n(F,{key:t,class:"ti-goods-item"},{default:c((()=>[r(F,null,{default:c((()=>[v(p(null==e?void 0:e.product_name_text),1)])),_:2},1024),r(F,null,{default:c((()=>[r(E,{class:"ti-goods-price"},{default:c((()=>[v(p(_(D)(null==e?void 0:e.product_price)),1)])),_:2},1024),r(E,{class:"ti-goods-subPrice"},{default:c((()=>[v(p(_(U)(null==e?void 0:e.product_price)),1)])),_:2},1024)])),_:2},1024),r(F,null,{default:c((()=>[v(p(`x ${null==e?void 0:e.total_num}`),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(j,{status:O.value?"loading":"no-more"},null,8,["status"])],64)):(o(),n(z,{key:2}))])),_:1})])),_:1})])),_:1},8,["show","title"]),r(Ie,{show:I.value,"onUpdate:show":l[1]||(l[1]=e=>I.value=e),orderId:V.value,sendKitchen:e.sendKitchen,onSuccess:l[2]||(l[2]=e=>B())},null,8,["show","orderId","sendKitchen"])])),_:1})}}},[["__scopeId","data-v-fa021bbd"]]),Ce=e({__name:"preferential",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null},totalPayPrice:{type:[Number,String],default:0},preferentialData:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:b}){const x=e,C=t({type:1,money:"",rate:"",discountType:1}),P=t(!1);l((()=>x.show),(()=>{var e,t;if(x.show){const l={type:1,money:"",rate:"",discountType:1};(null==(e=x.preferentialData)?void 0:e.discount_ratio)&&(l.type=2,l.rate=null==(t=x.preferentialData)?void 0:t.discount_ratio),C.value=l}})),l((()=>C.value.type),((e,t)=>{1==t?C.value.money="":2==t?C.value.rate="":3==t&&(C.value.discountType=1)}));const $=e=>{C.value.discountType=e.detail.value},L=()=>{1==C.value.type?C.value.money="":2==C.value.type&&(C.value.rate="")},O=e=>{e&&(1==C.value.type?C.value.money+=e:2==C.value.type&&(C.value.rate+=e))},B=async()=>{const e={...C.value,order_id:x.orderId};if(!P.value){if(1==e.type){if(e.money<=0)return m({title:f("请输入實付價格"),icon:"none"})}else if(2==e.type&&e.rate<=0)return m({title:f("请输入優惠折扣"),icon:"none"});try{P.value=!0;const t=await ne(e);m({title:t.msg,icon:"none"}),b("update:show",!1),b("success")}catch(t){}finally{P.value=!1}}};return(t,l)=>{const m=y,T=S,E=a(s("ti-input"),u),F=j,Z=N,z=K,R=a(s("ti-button"),h),A=a(s("ti-keyboard"),i),M=a(s("ti-modal"),d);return o(),n(M,{show:x.show,title:_(f)("優惠折扣")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-preferential-box"},{default:c((()=>[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(p(_(f)("當前價格")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(T,{class:"ti-preferential-price"},{default:c((()=>[v(p(_(D)(e.totalPayPrice)),1)])),_:1}),r(T,{class:"ti-preferential-subPrice"},{default:c((()=>[v(p(_(U)(e.totalPayPrice)),1)])),_:1})])),_:1}),r(m,{class:"ti-preferential-label"},{default:c((()=>[v(p(_(f)("優惠方式")),1)])),_:1}),r(m,{class:"ti-preferential-input ti-preferential-type"},{default:c((()=>[(o(!0),g(w,null,k([_(f)("改價"),_(f)("折扣"),_(f)("抹零")],((e,t)=>(o(),n(m,{key:t,class:I([{active:C.value.type==t+1},"ti-preferential-type-item"]),onClick:e=>C.value.type=t+1},{default:c((()=>[v(p(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),1==C.value.type?(o(),g(w,{key:0},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(p(_(f)("實付價格")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(E,{modelValue:C.value.money,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value.money=e),placeholder:_(f)("请输入實付價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})],64)):V("",!0),2==C.value.type?(o(),g(w,{key:1},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(p(_(f)("折扣")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(E,{modelValue:C.value.rate,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value.rate=e),placeholder:_(f)("请输入折扣"),focus:!0},{right:c((()=>[r(m,{class:"ti-preferential-percentage"},{default:c((()=>[v("%")])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})],64)):V("",!0),3==C.value.type?(o(),g(w,{key:2},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(p(_(f)("抹零方式")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(z,{class:"ti-type-radio",onChange:$},{default:c((()=>[r(Z,null,{default:c((()=>[r(F,{value:"1",color:"#ffbe00",checked:"true"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(p(_(f)("抹分")),1)])),_:1})])),_:1}),r(Z,null,{default:c((()=>[r(F,{value:"2",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(p(_(f)("抹角")),1)])),_:1})])),_:1}),r(Z,null,{default:c((()=>[r(F,{value:"3",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(p(_(f)("四捨五入到角")),1)])),_:1})])),_:1}),r(Z,null,{default:c((()=>[r(F,{value:"4",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(p(_(f)("四捨五入到元")),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):V("",!0)])),_:1})])),_:1})])),footer:c((()=>[3==C.value.type?(o(),n(m,{key:0,class:"ti-dialog-btn"},{default:c((()=>[r(R,{onClick:l[2]||(l[2]=e=>b("update:show",!1))},{default:c((()=>[v(p(_(f)("退出")),1)])),_:1}),r(R,{loading:P.value,type:"primary",onClick:B},{default:c((()=>[v(p(_(f)("确定")),1)])),_:1},8,["loading"])])),_:1})):(o(),n(m,{key:1,class:"ti-dialog-btn ti-preferential-keyboard"},{default:c((()=>[r(A,{primaryLoading:P.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[3]||(l[3]=e=>b("update:show",!1)),onClear:L,onInput:O,onConfirm:B},null,8,["primaryLoading"])])),_:1}))])),_:1},8,["show","title"])}}},[["__scopeId","data-v-cc69726f"]]),Pe=e({__name:"action-list",props:{productItem:{type:Object,default:()=>({})},orderId:{type:[Number,String],default:null},orderList:{type:Array,default:()=>[]},totalPayPrice:{type:[Number,String],default:0},preferentialData:{type:Object,default:()=>({})}},emits:["success"],setup(e,{emit:l}){const u=e,i=O((()=>u.orderList&&u.orderList.length>0)),n=O((()=>u.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)>0)))),h=O((()=>u.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)<=0)))),b=t(B()),k=t(!1),I=t(!1),x=t(!1),C=t(!1),P=t(!1),$=t(!1),D=t(!1),U=t(!1),L=t(!1),V=t(!1),j=t(!1),N=t(!1),K=t(!1),Z=()=>{u.orderList&&u.orderList.length>0?K.value=!0:N.value=!0},z=e=>{T(e)},R=async()=>{var e;if(!C.value)try{C.value=!0;const t=await ce({order_product_id:null==(e=u.productItem)?void 0:e.order_product_id});1==t.code&&(m({title:t.msg,icon:"none"}),l("success"))}catch(t){}finally{x.value=!1,C.value=!1}},A=()=>{E(),setTimeout((()=>{l("success")}),100)},M=async()=>{if(!$.value)try{$.value=!0;const e=await re({delivery:b.value?30:40,order_id:u.orderId});m({title:e.msg,icon:"none"}),P.value=!1,l("success")}catch(e){}finally{$.value=!1}},G=async()=>{if(!I.value)try{I.value=!0;const e=await ve({order_id:u.orderId});1==e.code&&(m({title:e.msg,icon:"none"}),E(),setTimeout((()=>{l("success")}),100))}catch(e){}finally{k.value=!1,I.value=!1}};return(t,m)=>{const I=S,C=a(s("u-switch"),be),$=y,O=F,B=a(s("ti-modal"),d);return o(),g(w,null,[r($,{class:"ti-action-box"},{default:c((()=>[r($,{class:"ti-action-btn"},{default:c((()=>[r($,{class:"ti-action-pack"},{default:c((()=>[r(I,{class:"ti-pack-text"},{default:c((()=>[v(p(_(f)("打包")),1)])),_:1}),r(C,{modelValue:b.value,"onUpdate:modelValue":m[0]||(m[0]=e=>b.value=e),activeColor:"#FFBE00",size:"20",onChange:z},null,8,["modelValue"])])),_:1}),r($,{class:"ti-btn-box"},{default:c((()=>{var t,l,a;return[r(O,{class:"ti-btn-item",disabled:!(e.productItem&&0==(null==(t=e.productItem)?void 0:t.is_send_kitchen)),onClick:m[1]||(m[1]=e=>x.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("删除")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:0!=(null==(l=e.productItem)?void 0:l.is_send_kitchen),onClick:m[2]||(m[2]=e=>L.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("备注")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:!_(i),onClick:m[3]||(m[3]=e=>U.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("價格")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:!_(i),onClick:m[4]||(m[4]=e=>k.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("掛單")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:!1,onClick:Z},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("取單")),1)])),_:1})])),_:1}),r(O,{class:"ti-btn-item danger",disabled:!_(i),onClick:m[5]||(m[5]=e=>(async()=>{D.value=!0})())},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("整單取消")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:0==_(h).length,onClick:m[6]||(m[6]=e=>P.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("送廚")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item danger",disabled:!(e.productItem&&1==(null==(a=e.productItem)?void 0:a.is_send_kitchen)),onClick:m[7]||(m[7]=e=>V.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("退菜")),1)])),_:1})])),_:1},8,["disabled"]),r(O,{class:"ti-btn-item",disabled:!_(i),onClick:m[8]||(m[8]=e=>j.value=!0)},{default:c((()=>[r(I,{class:"text-ellipsis"},{default:c((()=>[v(p(_(f)("優惠折扣")),1)])),_:1})])),_:1},8,["disabled"])]})),_:1})])),_:1})])),_:1}),r(B,{class:"ti-action-tips",show:x.value,"onUpdate:show":m[9]||(m[9]=e=>x.value=e),title:_(f)("溫馨提示"),content:_(f)("是否删除此商品？"),onConfirm:R},null,8,["show","title","content"]),r(B,{class:"ti-action-tips",show:P.value,"onUpdate:show":m[10]||(m[10]=e=>P.value=e),title:_(f)("溫馨提示"),content:_(f)("是否将商品送廚？"),onConfirm:M},null,8,["show","title","content"]),r(B,{class:"ti-action-tips",show:k.value,"onUpdate:show":m[11]||(m[11]=e=>k.value=e),title:_(f)("溫馨提示"),content:_(f)("是否将商品挂单？"),onConfirm:G},null,8,["show","title","content"]),r(Ie,{show:D.value,"onUpdate:show":m[12]||(m[12]=e=>D.value=e),sendKitchen:_(n),orderId:u.orderId,onSuccess:A},null,8,["show","sendKitchen","orderId"]),r(ge,{show:U.value,"onUpdate:show":m[13]||(m[13]=e=>U.value=e),productItem:u.productItem,onSuccess:m[14]||(m[14]=e=>l("success"))},null,8,["show","productItem"]),r(we,{show:L.value,"onUpdate:show":m[15]||(m[15]=e=>L.value=e),productItem:u.productItem,onSuccess:m[16]||(m[16]=e=>l("success"))},null,8,["show","productItem"]),r(xe,{show:N.value,"onUpdate:show":m[17]||(m[17]=e=>N.value=e),sendKitchen:_(n),onSuccess:m[18]||(m[18]=e=>l("success"))},null,8,["show","sendKitchen"]),r(B,{class:"ti-action-tips",show:K.value,"onUpdate:show":m[19]||(m[19]=e=>K.value=e),title:_(f)("溫馨提示"),content:_(f)("请先将购物车内的商品挂单或结账后再取单"),onConfirm:m[20]||(m[20]=e=>K.value=!1)},null,8,["show","title","content"]),r(ke,{show:V.value,"onUpdate:show":m[21]||(m[21]=e=>V.value=e),productItem:u.productItem,onSuccess:m[22]||(m[22]=e=>l("success"))},null,8,["show","productItem"]),r(Ce,{show:j.value,"onUpdate:show":m[23]||(m[23]=e=>j.value=e),preferentialData:u.preferentialData,orderId:u.orderId,totalPayPrice:e.totalPayPrice,onSuccess:m[24]||(m[24]=e=>l("success"))},null,8,["show","preferentialData","orderId","totalPayPrice"])],64)}}},[["__scopeId","data-v-809a9eb1"]]),$e=e({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})}},emits:["change"],setup(e,{emit:l}){const u=e,i=t(!1),d=async e=>{var t,a;const s={order_product_id:null==(t=u.productItem)?void 0:t.order_product_id,product_num:null==(a=u.productItem)?void 0:a.total_num,type:e};"up"==e?s.product_num+=1:s.product_num-=1;try{i.value=!0;1==(await pe(s)).code&&l("change")}catch(d){}finally{i.value=!1}};return(e,t)=>{const l=a(s("uni-icons"),Z),_=F,f=y;return o(),n(f,{class:"ti-number-box",onClick:t[2]||(t[2]=z((()=>{}),["stop"]))},{default:c((()=>{var e,a,s,o,n,m;return[r(_,{class:"ti-number-btn ti-number-minus",disabled:(null==(e=u.productItem)?void 0:e.total_num)<=1||i.value||(null==(a=u.productItem)?void 0:a.is_send_kitchen)>0,onClick:t[0]||(t[0]=e=>d("down"))},{default:c((()=>[r(l,{"custom-prefix":"iconfont",type:"icon-minus",size:"16"})])),_:1},8,["disabled"]),r(f,{class:"ti-number-input"},{default:c((()=>{var e;return[v(p((null==(e=u.productItem)?void 0:e.total_num)||1),1)]})),_:1}),r(_,{class:"ti-number-btn ti-number-plus",disabled:(null==(s=u.productItem)?void 0:s.total_num)>=(null==(n=null==(o=u.productItem)?void 0:o.product)?void 0:n.product_stock)||i.value||(null==(m=u.productItem)?void 0:m.is_send_kitchen)>0,onClick:t[1]||(t[1]=e=>d("up"))},{default:c((()=>[r(l,{type:"plusempty",size:"16"})])),_:1},8,["disabled"])]})),_:1})}}},[["__scopeId","data-v-1f4f3df5"]]),De=e({__name:"member",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null}},emits:["update:show","change"],setup(e,{emit:b}){const g=e,w=t(!1),k=t(""),I=t({}),x=t(!1);l((()=>g.show),(()=>{g.show&&(k.value="",I.value={})}));const C=()=>{b("update:show",!1),b("change",null)},P=e=>{e&&(k.value+=e)},$=async()=>{if(!k.value)return m({title:f("请输入会员手机号/ID"),icon:"none"});try{w.value=!0;const e=await R({mobile:k.value,order_id:g.orderId});I.value={...e.data.user,total_pay_price:e.data.total_pay_price}}catch(e){}finally{w.value=!1}},L=async()=>{var e;try{x.value=!0;await A({order_id:g.orderId,user_id:(null==(e=I.value)?void 0:e.user_id)||0});b("update:show",!1),b("change",I.value)}catch(t){}finally{x.value=!1}};return(e,t)=>{const l=a(s("ti-input"),u),m=a(s("ti-button"),h),b=y,j=S,N=a(s("ti-keyboard"),i),K=a(s("ti-modal"),d);return o(),n(K,{show:g.show,title:_(f)("会员")},{content:c((()=>[r(b,{class:"ti-dialog-content"},{default:c((()=>{var e;return[r(b,{class:"ti-payment-input"},{default:c((()=>[r(l,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),placeholder:_(f)("請輸入會員手機號/ID"),focus:!0},null,8,["modelValue","placeholder"]),r(m,{loading:w.value,type:"primary",onClick:$},{default:c((()=>[v(p(_(f)("查找")),1)])),_:1},8,["loading"])])),_:1}),(null==(e=I.value)?void 0:e.user_id)?(o(),n(b,{key:0,class:"ti-payment-member"},{default:c((()=>[r(b,{class:"ti-member-list"},{default:c((()=>[r(b,{class:"ti-member-item"},{default:c((()=>[r(b,{class:"ti-member-head"},{default:c((()=>[v(p(_(f)("暱稱")),1)])),_:1}),r(b,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=I.value)?void 0:e.nickName)||"-"),1)]})),_:1})])),_:1}),r(b,{class:"ti-member-item"},{default:c((()=>[r(b,{class:"ti-member-head"},{default:c((()=>[v(p(_(f)("會員卡/等級")),1)])),_:1}),r(b,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e,t,l,a;return[v(p(`${(null==(t=null==(e=I.value)?void 0:e.card)?void 0:t.card_name)||"-"}/${(null==(a=null==(l=I.value)?void 0:l.grade)?void 0:a.name)||"-"}`),1)]})),_:1})])),_:1}),r(b,{class:"ti-member-item"},{default:c((()=>[r(b,{class:"ti-member-head"},{default:c((()=>[v(p(_(f)("餘額")),1)])),_:1}),r(b,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=I.value)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),r(b,{class:"ti-member-item"},{default:c((()=>[r(b,{class:"ti-member-head"},{default:c((()=>[v(p(_(f)("積分")),1)])),_:1}),r(b,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=I.value)?void 0:e.points)||0),1)]})),_:1})])),_:1})])),_:1}),r(b,{class:"ti-member-discount"},{default:c((()=>[r(j,{class:"ti-discount-title"},{default:c((()=>[v(p(_(f)("會員折扣應收金額")),1)])),_:1}),r(j,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=I.value)?void 0:e.total_pay_price)||0)),1)]})),_:1}),r(j,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=I.value)?void 0:e.total_pay_price)||0)),1)]})),_:1})])),_:1})])),_:1})):V("",!0)]})),_:1})])),footer:c((()=>[r(b,{class:"ti-dialog-btn"},{default:c((()=>[r(N,{primaryLoading:x.value,isDoubleZero:!1,isCross:!0,isDrop:!0,onExit:C,onClear:t[1]||(t[1]=e=>k.value=""),onInput:P,onConfirm:L},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-bb5ec981"]]),Ue=e({__name:"payment-type",props:{show:{type:Boolean,default:!1},totalPayPrice:{type:[Number,String],default:0},orderId:{type:[Number,String],default:null},memberDetail:{type:Object,default:()=>({})}},emits:["update:show"],setup(e,{emit:u}){const i=e,f=t(!1),b=t([]),x=t({delivery:null,pay_type:"40",user_id:null,order_id:null}),C=t(!1),$=t(!1);l((()=>i.show),(()=>{i.show&&(b.value=[],x.value.pay_type="40")})),l((()=>x.value.pay_type),(()=>{i.show&&(x.value.pay_type>0||(b.value&&b.value.length>0?x.value.pay_type=b.value[0].value:M().then((e=>{b.value=e.data||[],x.value.pay_type=b.value[0].value}))))}));const L=async()=>{try{await A({order_id:i.orderId,user_id:0});u("success")}catch(e){}},O=e=>{x.value.pay_type=e.detail.value},T=async()=>{if(!$.value)try{$.value=!0;const e=await H({order_id:i.orderId});m({title:e.msg,icon:"none"})}catch(e){}finally{$.value=!1}},F=async()=>{var e;if(C.value)return;const t={...x.value};t.delivery=B()?30:40,t.order_id=i.orderId,t.user_id=null==(e=i.memberDetail)?void 0:e.user_id;try{C.value=!0;const e=await J(t);m({title:e.msg,icon:"none"}),u("update:show",!1),E(),setTimeout((()=>{u("success")}),100)}catch(l){}finally{C.value=!1}};return(t,l)=>{const m=S,B=y,E=j,Z=N,z=K,R=Q,A=a(s("ti-empty-data"),P),M=a(s("ti-button"),h),H=a(s("ti-modal"),d);return o(),n(H,{show:i.show,title:t.$t("結賬")},{content:c((()=>[r(B,{class:"ti-dialog-content"},{default:c((()=>{var a;return[r(B,{class:"ti-payment-money"},{default:c((()=>[r(m,{class:"ti-payment-label"},{default:c((()=>[v(p(t.$t("應收金額")),1)])),_:1}),r(m,{class:"ti-payment-price"},{default:c((()=>[v(p(_(D)(e.totalPayPrice)),1)])),_:1}),r(m,{class:"ti-payment-subPrice"},{default:c((()=>[v(p(_(U)(e.totalPayPrice)),1)])),_:1})])),_:1}),r(B,{class:"ti-payment-type"},{default:c((()=>[r(B,{class:"ti-type-label"},{default:c((()=>[v(p(t.$t("收款方式")),1)])),_:1}),r(z,{class:"ti-type-radio",onChange:O},{default:c((()=>[r(Z,null,{default:c((()=>[r(E,{value:"40",color:"#ffbe00",checked:"true"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(p(t.$t("現金")),1)])),_:1})])),_:1}),r(Z,null,{default:c((()=>[r(E,{value:"10",color:"#ffbe00"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(p(t.$t("餘額")),1)])),_:1})])),_:1}),r(Z,null,{default:c((()=>[r(E,{value:"",color:"#ffbe00"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(p(t.$t("其他方式")),1)])),_:1})])),_:1})])),_:1})])),_:1}),"40"!=x.value.pay_type&&"10"!=x.value.pay_type?(o(),n(B,{key:0,class:"ti-payment-other"},{default:c((()=>[r(B,{class:"ti-other-title"},{default:c((()=>[v(p(t.$t("用戶通過店內掃碼等方式進行支付，確認用戶支付完成後，點擊確認即可完成付款操作。")),1)])),_:1}),b.value&&b.value.length>0?(o(),n(B,{key:0,class:"ti-other-list"},{default:c((()=>[(o(!0),g(w,null,k(b.value,(e=>(o(),n(B,{key:e.value,class:I([{active:e.value==x.value.pay_type},"ti-other-item"]),onClick:t=>x.value.pay_type=e.value},{default:c((()=>[r(B,{class:"ti-other-image"},{default:c((()=>{var t;return[r(R,{src:`${(null==(t=_(G)())?void 0:t.api_url)||""}/${e.img}`,mode:"widthFix"},null,8,["src"])]})),_:2},1024),r(B,{class:"ti-other-text"},{default:c((()=>[v(p(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):(o(),n(A,{key:1}))])),_:1})):V("",!0),(null==(a=i.memberDetail)?void 0:a.user_id)?(o(),n(B,{key:1,class:"ti-payment-member"},{default:c((()=>[r(B,{class:"ti-payment-top"},{default:c((()=>[r(B,{class:"ti-payment-top-name"},{default:c((()=>[v(p(t.$t("會員")),1)])),_:1}),r(B,{class:"ti-payment-top-discomfort",onClick:L},{default:c((()=>[v(p(t.$t("不使用此會員")),1)])),_:1})])),_:1}),r(B,{class:"ti-member-list"},{default:c((()=>[r(B,{class:"ti-member-item"},{default:c((()=>[r(B,{class:"ti-member-head"},{default:c((()=>[v(p(t.$t("暱稱")),1)])),_:1}),r(B,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=i.memberDetail)?void 0:e.nickName)||"-"),1)]})),_:1})])),_:1}),r(B,{class:"ti-member-item"},{default:c((()=>[r(B,{class:"ti-member-head"},{default:c((()=>[v(p(t.$t("會員卡/等級")),1)])),_:1}),r(B,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e,t,l,a;return[v(p(`${(null==(t=null==(e=i.memberDetail)?void 0:e.card)?void 0:t.card_name)||"-"}/${(null==(a=null==(l=i.memberDetail)?void 0:l.grade)?void 0:a.name)||"-"}`),1)]})),_:1})])),_:1}),r(B,{class:"ti-member-item"},{default:c((()=>[r(B,{class:"ti-member-head"},{default:c((()=>[v(p(t.$t("餘額")),1)])),_:1}),r(B,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=i.memberDetail)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),r(B,{class:"ti-member-item"},{default:c((()=>[r(B,{class:"ti-member-head"},{default:c((()=>[v(p(t.$t("積分")),1)])),_:1}),r(B,{class:"ti-member-name text-ellipsis"},{default:c((()=>{var e;return[v(p((null==(e=i.memberDetail)?void 0:e.points)||0),1)]})),_:1})])),_:1})])),_:1})])),_:1})):V("",!0),r(De,{show:f.value,"onUpdate:show":l[0]||(l[0]=e=>f.value=e),orderId:i.orderId,onChange:l[1]||(l[1]=e=>u("success"))},null,8,["show","orderId"])]})),_:1})])),footer:c((()=>[r(B,{class:"ti-dialog-btn"},{default:c((()=>[r(M,{onClick:l[2]||(l[2]=e=>u("update:show",!1))},{default:c((()=>[v(p(t.$t("退出")),1)])),_:1}),r(M,{loading:$.value,onClick:T},{default:c((()=>[v(p(t.$t("打印")),1)])),_:1},8,["loading"]),r(M,{onClick:l[3]||(l[3]=e=>f.value=!0)},{default:c((()=>[v(p(t.$t("会员")),1)])),_:1}),r(M,{loading:C.value,type:"primary",onClick:F},{default:c((()=>[v(p(t.$t("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-017e0d9f"]]),Le=e({__name:"cart-list",setup(e,{expose:l}){const u=t(),i=t(!1),d=t(!1),f=t({}),m=t({}),h=t({}),b=t([]),$=t(),L=t({}),j=()=>{i.value=!0},N=async e=>{var t,l,a,s,i,o,n,c,r,v,p;const _={...h.value};_.order_id=W();try{e&&(d.value=!0);const y=await _e(_);if(L.value={discount_ratio:null==(a=null==(l=null==(t=y.data)?void 0:t.allProductInfo)?void 0:l.orderInfo)?void 0:a.discount_ratio},m.value=null==(i=null==(s=y.data)?void 0:s.allProductInfo)?void 0:i.sumInfo,b.value=(null==(c=null==(n=null==(o=y.data)?void 0:o.allProductInfo)?void 0:n.orderInfo)?void 0:c.product)||[],b.value&&b.value.length>0){let e=0;(null==(r=f.value)?void 0:r.order_product_id)&&(e=b.value.findIndex((e=>{var t;return e.order_product_id==(null==(t=f.value)?void 0:t.order_product_id)}))),f.value=b.value[Math.max(e,0)],u.value=null==(p=null==(v=y.data)?void 0:v.allProductInfo)?void 0:p.userInfo,$.value=W()}else f.value=null,u.value=null,$.value=null,E()}catch(y){}finally{e&&(d.value=!1)}};return N(!0),l({getCartData:N}),(e,t)=>{var l,h;const K=y,O=a(s("ti-loading"),C),B=S,T=a(s("ti-empty-data"),P),E=x,Z=F;return o(),g(w,null,[r(K,{class:"ti-cart-box"},{default:c((()=>[r(K,{class:"ti-cart-list"},{default:c((()=>[r(K,{class:"ti-cart-shop-head"},{default:c((()=>[r(K,{class:"ti-shop-head-title"},{default:c((()=>[v(p(e.$t("商品名稱")),1)])),_:1}),r(K,{class:"ti-shop-head-money"},{default:c((()=>[v(p(e.$t("金額")),1)])),_:1}),r(K,{class:"ti-shop-head-num"},{default:c((()=>[v(p(e.$t("數量")),1)])),_:1})])),_:1}),r(K,{class:"ti-shop-list"},{default:c((()=>[r(E,{"scroll-y":""},{default:c((()=>[d.value?(o(),n(O,{key:0})):b.value&&b.value.length>0?(o(),n(K,{key:1,class:"ti-shop-box"},{default:c((()=>[(o(!0),g(w,null,k(b.value,(e=>{var l;return o(),n(K,{key:e,class:I([{active:(null==(l=f.value)?void 0:l.order_product_id)==(null==e?void 0:e.order_product_id)},"ti-shop-item"]),onClick:t=>(e=>{var t;(null==(t=f.value)?void 0:t.order_product_id)!=(null==e?void 0:e.order_product_id)&&(f.value=e)})(e)},{default:c((()=>[r(K,{class:"ti-shop-item-box"},{default:c((()=>[r(K,{class:"ti-shop-box"},{default:c((()=>[r(K,{class:"ti-shop-body-top"},{default:c((()=>[r(K,{class:"ti-shop-title text-ellipsis"},{default:c((()=>[v(p(e.product_name_text),1)])),_:2},1024),e.product_attr?(o(),n(K,{key:0,class:"ti-shop-spec"},{default:c((()=>[v("( "+p(e.product_attr)+" )",1)])),_:2},1024)):V("",!0)])),_:2},1024),r(K,{class:"ti-shop-body-money"},{default:c((()=>[r(B,{class:"ti-shop-price"},{default:c((()=>[v(p(_(D)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(B,{class:"ti-shop-subPrice"},{default:c((()=>[v(p(_(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024),r($e,{productItem:e,onChange:t[0]||(t[0]=e=>N())},null,8,["productItem"])])),_:2},1024),e.remark?(o(),n(K,{key:0,class:"ti-shop-remark"},{default:c((()=>[v(p(e.remark),1)])),_:2},1024)):V("",!0)])),_:2},1024)])),_:2},1032,["class","onClick"])})),128))])),_:1})):(o(),n(T,{key:2}))])),_:1})])),_:1})])),_:1}),r(K,{class:"ti-cart-statistics"},{default:c((()=>[r(K,{class:"ti-cart-total"},{default:c((()=>[r(B,{class:"ti-total-text"},{default:c((()=>[v(p(e.$t("小計:")),1)])),_:1}),r(B,{class:"ti-total-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=m.value)?void 0:e.subtotal)||0)),1)]})),_:1}),r(B,{class:"ti-total-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=m.value)?void 0:e.subtotal)||0)),1)]})),_:1})])),_:1}),r(K,{class:"ti-cart-discount"},{default:c((()=>[r(K,{class:"ti-discount-item"},{default:c((()=>[r(K,null,{default:c((()=>[r(B,{class:"ti-discount-text"},{default:c((()=>[v(p(e.$t("服務費:")),1)])),_:1}),r(B,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=m.value)?void 0:e.service_money)||0)),1)]})),_:1}),r(B,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=m.value)?void 0:e.service_money)||0)),1)]})),_:1})])),_:1}),r(K,null,{default:c((()=>{var t;return[r(B,{class:"ti-discount-text"},{default:c((()=>[v(p(e.$t("優惠折扣:")),1)])),_:1}),r(B,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(p(`-${_(D)((null==(e=m.value)?void 0:e.special_discount)||0)}`),1)]})),_:1}),_(U)((null==(t=m.value)?void 0:t.special_discount)||0)?(o(),n(B,{key:0,class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(p(`-${_(U)((null==(e=m.value)?void 0:e.special_discount)||0)}`),1)]})),_:1})):V("",!0)]})),_:1})])),_:1}),r(K,{class:"ti-discount-item"},{default:c((()=>[r(K,null,{default:c((()=>[r(B,{class:"ti-discount-text"},{default:c((()=>[v(p(e.$t("消費稅:")),1)])),_:1}),r(B,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=m.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1}),r(B,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=m.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1})])),_:1}),r(K,null,{default:c((()=>{var t;return[r(B,{class:"ti-discount-text"},{default:c((()=>[v(p(e.$t("會員折扣:")),1)])),_:1}),r(B,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(p(`-${_(D)((null==(e=m.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1}),_(U)((null==(t=m.value)?void 0:t.total_user_discount_money)||0)?(o(),n(B,{key:0,class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(p(`-${_(U)((null==(e=m.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1})):V("",!0)]})),_:1})])),_:1})])),_:1}),r(K,{class:"ti-cart-settlement"},{default:c((()=>[r(K,{class:"ti-settlement-total"},{default:c((()=>[r(B,{class:"ti-settlement-text"},{default:c((()=>[v(p(e.$t("應收：")),1)])),_:1}),r(B,{class:"ti-settlement-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=m.value)?void 0:e.total_pay_price)||0)),1)]})),_:1}),r(B,{class:"ti-settlement-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=m.value)?void 0:e.total_pay_price)||0)),1)]})),_:1})])),_:1}),r(Z,{class:"ti-settlement-btn",disabled:b.value.length<=0,onClick:j},{default:c((()=>[r(B,null,{default:c((()=>[v(p(e.$t("結賬")),1)])),_:1}),b.value.length>0?(o(),n(B,{key:0,class:"ti-settlement-badge"},{default:c((()=>[v(p(b.value.length),1)])),_:1})):V("",!0)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),r(Pe,{productItem:f.value,orderId:$.value,preferentialData:L.value,totalPayPrice:null==(l=m.value)?void 0:l.total_pay_price,orderList:b.value,onSuccess:t[1]||(t[1]=e=>N())},null,8,["productItem","orderId","preferentialData","totalPayPrice","orderList"]),r(Ue,{show:i.value,"onUpdate:show":t[2]||(t[2]=e=>i.value=e),orderId:$.value,totalPayPrice:null==(h=m.value)?void 0:h.total_pay_price,memberDetail:u.value,onSuccess:t[3]||(t[3]=e=>N())},null,8,["show","orderId","totalPayPrice","memberDetail"])],64)}}},[["__scopeId","data-v-8b8516e4"]]),Se=e({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null}},emits:["update:menuId"],setup(e,{emit:a}){const u=e,s=t(0),i=t(0),d=t([]);l((()=>u.list),(async e=>{if(await X(),!e||0==e.length)return;const t=Y().in(this);if(e.map(((e,l)=>{t.select(`#scroll-item-${l}`).boundingClientRect((e=>{if(!e)return;const t=d.value;t[l]=e.width+10,d.value=t})).exec()})),u.menuId>0){const e=u.list.findIndex((e=>e.category_id==u.menuId));e>-1&&_(e)}}),{deep:!0,immediate:!0});const _=e=>{i.value=e,s.value=d.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(d.value[e]+100),a("update:menuId",u.list[e].category_id)};return(e,t)=>{const l=S,a=y,d=x;return o(),n(d,{class:"ti-dish-menu","scroll-left":s.value,"scroll-x":"","enable-flex":"","scroll-with-animation":""},{default:c((()=>[r(a,{class:"ti-menu-content"},{default:c((()=>[(o(!0),g(w,null,k(u.list,((e,t)=>(o(),n(a,{key:t,class:I(["ti-menu-item",{active:t==i.value}]),id:`scroll-item-${t}`,onClick:e=>_(t)},{default:c((()=>[r(l,{class:"ti-menu-title"},{default:c((()=>[v(p(e.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"])}}},[["__scopeId","data-v-4f990a9b"]]),Ve=e({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId"],setup(e,{emit:a}){const u=t([]),s=t(0),i=t(0),d=O((()=>{let e=(u.value.find((e=>e.category_id==s.value))||{}).child||[];return e&&e.length>0&&(e=[{name_text:f("全部"),category_id:0}].concat(e)),e}));l((()=>s.value),(()=>{a("update:categoryId",s.value),d&&d.length>0&&(i.value=d.value[0].category_id)}));return(async()=>{try{const e=await fe();e.data.list&&(u.value=[{name_text:f("全部"),category_id:0}].concat(e.data.list),s.value=u.value[0].category_id)}catch(e){}})(),(e,t)=>{const l=y;return o(),n(l,{class:"ti-category-box"},{default:c((()=>[r(Se,{list:u.value,menuId:s.value,"onUpdate:menuId":t[0]||(t[0]=e=>s.value=e)},null,8,["list","menuId"]),r(l,{class:"ti-dish-secondary"},{default:c((()=>[(o(!0),g(w,null,k(_(d),((e,t)=>(o(),n(l,{key:t,class:I([{active:e.category_id==i.value},"ti-secondary-item"]),onClick:t=>{return l=e.category_id,i.value=l,void a("update:categoryId",i.value>0?i.value:s.value);var l}},{default:c((()=>[v(p(e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-52ae0756"]]),je=e({__name:"goods-detail",props:{show:{type:Boolean,default:!1},productId:{type:Number,default:null}},emits:["update:show","success"],setup(e,{emit:u}){const i=e,h=t({}),b=t(!1),C=t(!1),P=t({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed:[],bag_price:0,delivery:B()?30:40,describe:null});l((()=>i.show),(()=>{i.show&&$()}));const $=async()=>{var e,t,l,a,u,s,d,o,n;if(!b.value||i.productId)try{b.value=!0;const c=await me(i.productId);h.value=c.data,P.value.product_id=null==(e=h.value)?void 0:e.product_id,P.value.price=null==(t=h.value)?void 0:t.product_price,P.value.product_price=null==(l=h.value)?void 0:l.product_price,(null==(a=h.value)?void 0:a.sku)&&(null==(u=h.value)?void 0:u.sku.length)>0&&(P.value.product_sku_id=null==(s=h.value)?void 0:s.sku[0].product_sku_id),(null==(d=h.value)?void 0:d.product_attr)&&(null==(o=h.value)?void 0:o.product_attr.length)>0&&(null==(n=h.value)||n.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value_text)&&(null==e?void 0:e.attribute_value_text.length)>0?P.value.attr[t]=0:P.value.attr[t]=null}))),P.value.feed&&P.value.feed.length>0&&(P.value.feed=[])}catch(c){}finally{b.value=!1}},j=async()=>{var e,t,l,a,s,i,d,o,n;if(C.value)return;const c={...P.value};c.attr=c.attr.join(","),c.feed=c.feed.join(",");let r=[];if((null==(e=h.value)?void 0:e.sku)&&(null==(t=h.value)?void 0:t.sku.length)>0){const e=null==(l=h.value)?void 0:l.sku.find((e=>e.product_sku_id==P.value.product_sku_id));c.price=(null==e?void 0:e.product_price)||0,(null==e?void 0:e.spec_name)&&r.push(null==e?void 0:e.spec_name)}(null==(a=h.value)?void 0:a.product_attr)&&(null==(s=h.value)?void 0:s.product_attr.length)&&(null==(i=h.value)||i.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0&&(null==e?void 0:e.attribute_value[P.value.attr[t]])&&r.push(null==e?void 0:e.attribute_value[P.value.attr[t]])}))),(null==(d=h.value)?void 0:d.product_feed)&&(null==(o=h.value)?void 0:o.product_feed.length)>0&&(null==(n=h.value)||n.product_feed.map(((e,t)=>{N(t)&&(r.push(e.feed_name),c.price=q(c.price,null==e?void 0:e.price))}))),c.describe=r.join(";"),c.delivery=B()?30:40,c.order_id=W();try{C.value=!0;const e=await ye(c);1==e.code&&(L(e.data.order_id),m({title:e.msg,icon:"none"}),u("update:show",!1),setTimeout((()=>{u("success")}),100))}catch(v){}finally{C.value=!1}},N=e=>P.value.feed.indexOf(e)>-1,K=(e,t)=>P.value.attr[e]==t;return(e,t)=>{const l=Q,m=y,b=S,$=x,L=a(s("ti-modal"),d);return o(),n(L,{show:i.show,title:_(f)("商品详情"),confirmLoading:C.value,onCancel:t[0]||(t[0]=e=>u("update:show",!1)),onConfirm:j},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-detail-box"},{default:c((()=>[r(m,{class:"ti-detail-image"},{default:c((()=>{var e,t,a,u;return[(null==(e=h.value)?void 0:e.image)&&(null==(t=h.value)?void 0:t.image[0])&&(null==(a=h.value)?void 0:a.image[0].file_path)?(o(),n(l,{key:0,src:null==(u=h.value)?void 0:u.image[0].file_path,mode:"widthFix"},null,8,["src"])):V("",!0)]})),_:1}),r(m,{class:"ti-detail-con"},{default:c((()=>[r(m,{class:"ti-detail-title text-ellipsis"},{default:c((()=>{var e;return[v(p(null==(e=h.value)?void 0:e.product_name_text),1)]})),_:1}),r(m,{class:"ti-price-box"},{default:c((()=>[r(b,{class:"ti-detail-unit"},{default:c((()=>[v(p(_(f)("單價：")),1)])),_:1}),r(b,{class:"ti-detail-price"},{default:c((()=>{var e;return[v(p(_(D)((null==(e=h.value)?void 0:e.product_price)||0)),1)]})),_:1}),r(b,{class:"ti-detail-subPrice"},{default:c((()=>{var e;return[v(p(_(U)((null==(e=h.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),r(m,{class:"ti-price-box"},{default:c((()=>[r(b,{class:"ti-detail-unit"},{default:c((()=>[v(p(_(f)("單位：")),1)])),_:1}),r(b,{class:"ti-detail-price"},{default:c((()=>{var e;return[v(p(null==(e=h.value)?void 0:e.product_unit_text),1)]})),_:1})])),_:1})])),_:1})])),_:1}),r(m,{class:"ti-detail-specs"},{default:c((()=>[r($,{"scroll-y":""},{default:c((()=>[r(m,{class:"ti-specs-box"},{default:c((()=>{var e,t,l,a,u,s,i;return[(null==(e=h.value)?void 0:e.sku)&&(null==(t=h.value)?void 0:t.sku.length)>0?(o(),n(m,{key:0,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(p(_(f)("規格")),1)])),_:1}),r(m,{class:"ti-specs-child"},{default:c((()=>{var e;return[(o(!0),g(w,null,k(null==(e=h.value)?void 0:e.sku,(e=>(o(),n(m,{key:e.product_sku_id,class:I([{active:e.product_sku_id==P.value.product_sku_id},"ti-child-item"]),onClick:t=>{return l=e.product_sku_id,void(P.value.product_sku_id!=l&&(P.value.product_sku_id=l));var l}},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(p(e.spec_name_text),1)])),_:2},1024),r(b,{class:"ti-child-price"},{default:c((()=>[v(p(_(D)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(b,{class:"ti-child-subPrice"},{default:c((()=>[v(p(_(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):V("",!0),(null==(l=h.value)?void 0:l.product_attr)&&(null==(a=h.value)?void 0:a.product_attr.length)>0?(o(!0),g(w,{key:1},k(null==(u=h.value)?void 0:u.product_attr,((e,t)=>(o(),n(m,{key:t,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(p(e.attribute_name_text),1)])),_:2},1024),r(m,{class:"ti-specs-child"},{default:c((()=>[(o(!0),g(w,null,k(null==e?void 0:e.attribute_value_text,((e,l)=>(o(),n(m,{key:l,class:I([{active:K(t,l)},"ti-child-item"]),onClick:e=>((e,t)=>{P.value.attr[e]=t})(t,l)},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(p(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)):V("",!0),(null==(s=h.value)?void 0:s.product_feed)&&(null==(i=h.value)?void 0:i.product_feed.length)>0?(o(),n(m,{key:2,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(p(_(f)("加料")),1)])),_:1}),r(m,{class:"ti-specs-child"},{default:c((()=>{var e;return[(o(!0),g(w,null,k(null==(e=h.value)?void 0:e.product_feed,((e,t)=>(o(),n(m,{key:t,class:I([{active:N(t)},"ti-child-item"]),onClick:e=>(e=>{const t=P.value.feed.indexOf(e);t>=0?P.value.feed.splice(t,1):P.value.feed.push(e)})(t)},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(p(e.feed_name_text),1)])),_:2},1024),r(b,{class:"ti-child-price"},{default:c((()=>[v(p(_(D)((null==e?void 0:e.price)||0)),1)])),_:2},1024),r(b,{class:"ti-child-subPrice"},{default:c((()=>[v(p(_(U)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):V("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmLoading"])}}},[["__scopeId","data-v-26fd0de7"]]),Ne=e({__name:"dish-list",emits:["success"],setup(e,{emit:u}){const i=t(!1),d=t({category_id:null,page:1,list_rows:20}),h=t([]),b=t(!1),$=t(),L=t(!1);l((()=>d.value.category_id),(()=>{K()}));const j=()=>{u("success")},N=()=>{L.value&&(d.value.page+=1,O())},K=()=>{d.value.page=1,O(!0)},O=async e=>{var t,l,a,u,s,i;if(b.value)return;const o={...d.value};o.category_id||(o.category_id=null);try{e&&(b.value=!0);const n=await he(o);1==d.value.page&&(h.value=[]),h.value=h.value.concat((null==(l=null==(t=n.data)?void 0:t.list)?void 0:l.data)||[]),L.value=(null==(u=null==(a=n.data)?void 0:a.list)?void 0:u.last_page)>(null==(i=null==(s=n.data)?void 0:s.list)?void 0:i.current_page)}catch(n){}finally{e&&(b.value=!1)}};return K(),(e,t)=>{const l=a(s("ti-loading"),C),u=Q,K=S,O=y,B=a(s("ti-empty-data"),P),T=x;return o(),g(w,null,[r(O,{class:"ti-dish-box"},{default:c((()=>[r(Ve,{categoryId:d.value.category_id,"onUpdate:categoryId":t[0]||(t[0]=e=>d.value.category_id=e)},null,8,["categoryId"]),r(O,{class:"ti-dish-list"},{default:c((()=>[r(T,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:N},{default:c((()=>[b.value?(o(),n(l,{key:0})):h.value&&h.value.length>0?(o(),g(w,{key:1},[r(O,{class:"ti-dish-goods"},{default:c((()=>[(o(!0),g(w,null,k(h.value,((e,t)=>(o(),n(O,{key:t,class:I([{"sold-out":e.product_stock<=0},"ti-goods-item"]),onClick:t=>(e=>{if(e.product_stock<=0)return m({title:f("已售罄"),icon:"none"});i.value=!0,$.value=e.product_id})(e)},{default:c((()=>[r(O,{class:"ti-goods-image"},{default:c((()=>[e.image&&e.image[0]&&e.image[0].file_path?(o(),n(u,{key:0,src:e.image[0].file_path,mode:"widthFix"},null,8,["src"])):V("",!0),r(K,{class:"sold-out-text"},{default:c((()=>[v(p(_(f)("已售罄")),1)])),_:1})])),_:2},1024),r(O,{class:"ti-goods-content"},{default:c((()=>[r(O,{class:"ti-goods-title line-clamp-2"},{default:c((()=>[v(p(e.product_name_text),1)])),_:2},1024),r(O,{class:"ti-price-box"},{default:c((()=>[r(K,{class:"ti-goods-price"},{default:c((()=>[v(p(_(D)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(K,{class:"ti-goods-subPrice"},{default:c((()=>[v(p(_(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(l,{status:L.value?"loading":"no-more"},null,8,["status"])],64)):(o(),n(B,{key:2}))])),_:1})])),_:1})])),_:1}),r(je,{show:i.value,"onUpdate:show":t[1]||(t[1]=e=>i.value=e),productId:$.value,onSuccess:j},null,8,["show","productId"])],64)}}},[["__scopeId","data-v-ba0621bb"]]),Ke=e({__name:"index",setup(e){const l=t();ee((()=>{te()}));const a=()=>{var e;null==(e=l.value)||e.getCartData()};return(e,t)=>{const u=y,s=le("ti-layout");return o(),n(s,null,{default:c((()=>[r(u,{class:"ti-index"},{default:c((()=>[r(Le,{ref_key:"cartRef",ref:l},null,512),r(Ne,{onSuccess:a})])),_:1})])),_:1})}}},[["__scopeId","data-v-5474dea1"]]);export{Ke as default};
