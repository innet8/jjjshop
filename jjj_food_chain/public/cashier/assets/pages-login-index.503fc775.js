import{_ as a,H as e,a as l,M as s,c as t,o,f as u,g as i,h as d,i as n,t as r,u as c,Y as p,Z as v,a0 as f,a1 as _,B as m,j as g,a2 as h,r as y,O as b,w,a3 as x,a4 as k,a5 as V,s as C,$ as I,a6 as U,a7 as j,a8 as F,a9 as $,aa as z,ab as L,ac as P,ad as R,P as B,ae as E,k as H,b as M,d as O}from"./index-869f311b.js";import{_ as Y}from"./uni-data-select.c3147a85.js";const Z=""+new URL("bg-93598f2d.png",import.meta.url).href,q=""+new URL("login_logo-83575c4a.svg",import.meta.url).href,A=a({__name:"set-language",setup(a){const h=e((()=>v[f()])),y=a=>{a&&a!==f()&&_(a)};return(a,e)=>{const v=l(t("uni-icons"),s),f=m,_=l(t("uni-data-select"),Y),b=g;return o(),u(b,{class:"ti-language"},{default:i((()=>[d(v,{"custom-prefix":"iconfont",type:"icon-global",size:"16"}),d(f,{class:"ti-language-text"},{default:i((()=>[n(r(c(h)),1)])),_:1}),d(v,{type:"right",size:"16",style:{transform:"rotate(90deg)"}}),d(b,{class:"ti-language-select"},{default:i((()=>[d(_,{clear:!1,localdata:c(p)()||[],onChange:y},null,8,["localdata"])])),_:1})])),_:1})}}},[["__scopeId","data-v-6b3feecf"]]),D=a({__name:"index",setup(a){var s;const p=h(),v=y(!0),f=y(!1),_=y(!1),m=y({user_name:"",password:""}),Y=e((()=>!m.value.user_name||!m.value.password)),D=y(!1),G=y(!(null==(s=b())?void 0:s.api_url)),J=y({ip:"",port:"",device_id:""});w((()=>G.value),(()=>{G.value&&K()})),x((()=>{K(),k({success:a=>{J.value.device_id=a.deviceId}})}));const K=()=>{const a=b();J.value.ip=(null==a?void 0:a.ip)||V()||"127.0.0.1",J.value.port=(null==a?void 0:a.port)||"8080"},N=async()=>{var a,e,l,s;const t={...J.value};if(!t.ip)return C({title:I("请输入地址"),icon:"none"});if(!t.port)return C({title:I("请输入端口"),icon:"none"});try{D.value=!0;const o=await U(j(`${null==t?void 0:t.ip}:${t.port}`),{key:J.value.device_id,address:J.value.ip,port:J.value.port});G.value=!1,C({title:I("绑定成功"),icon:"none"}),F(null==(e=null==(a=o.data)?void 0:a.shop)?void 0:e.app_id),$(null==(s=null==(l=o.data)?void 0:l.shop)?void 0:s.shop_supplier_id),z(t)}catch(o){C({title:I("绑定失败"),icon:"none"})}finally{D.value=!1}},Q=async()=>{if(!m.value.user_name)return C({title:I("請輸入賬號"),icon:"none"});if(!m.value.password)return C({title:I("输入登录密码"),icon:"none"});try{_.value=!0;const a=await L(m.value);a.data.token&&(P(a.data.token),p.setUserInfo(!0),R({url:"/pages/index/index"}))}catch(a){}finally{_.value=!1}},S=a=>{a&&(1==v.value&&(m.value.user_name+=a),1==f.value&&(m.value.password+=a))},T=a=>{v.value="username"===a,f.value="password"===a},W=()=>{1==v.value&&(m.value.user_name=""),1==f.value&&(m.value.password="")},X=()=>{J.value={ip:"",port:""}},aa=()=>{G.value=!G.value};return(a,e)=>{const s=B,p=g,h=E,y=l(t("ti-button"),H),b=l(t("ti-input"),M),w=l(t("ti-keyboard"),O);return o(),u(p,{class:"ti-login"},{default:i((()=>[d(p,{class:"ti-login-img"},{default:i((()=>[d(s,{src:Z,mode:"widthFix"})])),_:1}),d(p,{class:"ti-login-box"},{default:i((()=>[G.value?(o(),u(p,{key:0,class:"ti-serve-box"},{default:i((()=>[d(p,{class:"ti-serve-head"},{default:i((()=>[d(p,{class:"ti-serve-logo"},{default:i((()=>[d(s,{src:q,mode:"widthFix"})])),_:1}),d(p,{class:"ti-serve-title"},{default:i((()=>[n(r(c(I)("收银机")),1)])),_:1})])),_:1}),d(p,{class:"ti-serve-label"},{default:i((()=>[n(r(c(I)("服務器連接地址")),1)])),_:1}),d(p,{class:"ti-serve-input"},{default:i((()=>[d(p,{class:"ti-serve-ip"},{default:i((()=>[d(h,{modelValue:J.value.ip,"onUpdate:modelValue":e[0]||(e[0]=a=>J.value.ip=a),type:"text",placeholder:c(I)("请输入地址")},null,8,["modelValue","placeholder"])])),_:1}),d(p,{class:"ti-serve-colon"},{default:i((()=>[n(":")])),_:1}),d(p,{class:"ti-serve-port"},{default:i((()=>[d(h,{modelValue:J.value.port,"onUpdate:modelValue":e[1]||(e[1]=a=>J.value.port=a),type:"number",placeholder:c(I)("请输入端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),d(p,{class:"ti-serve-btn"},{default:i((()=>[d(y,{onClick:X},{default:i((()=>[n(r(c(I)("重置")),1)])),_:1}),d(y,{loading:D.value,type:"primary",onClick:N},{default:i((()=>[n(r(c(I)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(o(),u(p,{key:1,class:"ti-login-form"},{default:i((()=>[d(p,{class:"ti-form-box"},{default:i((()=>[d(p,{class:"ti-form-head"},{default:i((()=>[d(p,{class:"ti-login-logo"},{default:i((()=>[d(s,{src:q,mode:"widthFix"})])),_:1}),d(p,{class:"ti-login-title"},{default:i((()=>[n(r(c(I)("收银机")),1)])),_:1})])),_:1}),d(p,{class:"ti-form-username"},{default:i((()=>[d(b,{modelValue:m.value.user_name,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.user_name=a),prefixIcon:"icon-user",placeholder:c(I)("請輸入用戶名"),focus:v.value,onClick:e[3]||(e[3]=a=>T("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),d(p,{class:"ti-form-password"},{default:i((()=>[d(b,{modelValue:m.value.password,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.password=a),prefixIcon:"icon-lock",placeholder:c(I)("請輸入登錄密碼"),focus:f.value,password:!0,onClick:e[5]||(e[5]=a=>T("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),d(p,{class:"ti-form-btn"},{default:i((()=>[d(y,{type:"primary",loading:_.value,disabled:c(Y),onClick:Q},{default:i((()=>[n(r(c(I)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),d(p,{class:"ti-form-link",onClick:aa},{default:i((()=>[n(r(c(I)("更换服务器")),1)])),_:1})])),_:1}),d(p,{class:"ti-form-keyboard"},{default:i((()=>[d(w,{isExit:!1,isPrimary:!1,onInput:S,onClear:W})])),_:1})])),_:1}))])),_:1}),d(p,{class:"ti-language-box"},{default:i((()=>[d(A)])),_:1})])),_:1})}}},[["__scopeId","data-v-bfcbded1"]]);export{D as default};
