import{_ as a,u as e,c as l,r as s,a as t,b as o,o as u,d as i,w as n,e as d,f as r,t as c,g as p,l as v,h as f,i as _,j as m,k as g,m as h,n as y,p as w,q as x,s as b,v as k,x as V,y as C,$ as I,z as U,A as F,B as L,C as j,D as z,E as $,F as E,G as R,H as q,I as A,J as B,K as D,L as G}from"./index-482a09f0.js";import{_ as H}from"./uni-data-select.e6b9e621.js";const J=""+new URL("bg-93598f2d.png",import.meta.url).href,K=""+new URL("login_logo-83575c4a.svg",import.meta.url).href,P=a({__name:"set-language",setup(a){const{changeLocale:h}=e(),y=l((()=>f[_()])),w=a=>{a&&a!==_()&&h(a)};return(a,e)=>{const l=s(o("uni-icons"),t),f=m,_=s(o("uni-data-select"),H),h=g;return u(),i(h,{class:"ti-language"},{default:n((()=>[d(l,{"custom-prefix":"iconfont",type:"icon-global",size:"16"}),d(f,{class:"ti-language-text"},{default:n((()=>[r(c(p(y)),1)])),_:1}),d(l,{type:"right",size:"16",style:{transform:"rotate(90deg)"}}),d(h,{class:"ti-language-select"},{default:n((()=>[d(_,{clear:!1,localdata:p(v)()||[],onChange:w},null,8,["localdata"])])),_:1})])),_:1})}}},[["__scopeId","data-v-7a155b65"]]),M=a({__name:"index",setup(a){var e;const t=h(),v=y(!0),f=y(!1),_=y(!1),m=y({user_name:"",password:""}),H=l((()=>!m.value.user_name||!m.value.password)),M=y(!1),N=y(!(null==(e=w())?void 0:e.api_url)),O=y({ip:"",port:"",device_id:""});x((()=>N.value),(()=>{N.value&&Q()})),b((()=>{Q(),k({success:a=>{O.value.device_id=a.deviceId}})}));const Q=()=>{const a=w();O.value.ip=(null==a?void 0:a.ip)||V()||"127.0.0.1",O.value.port=(null==a?void 0:a.port)||"8080"},S=async()=>{var a,e,l,s,t,o,u,i;const n={...O.value};if(!n.ip)return C({title:I("请输入地址"),icon:"none"});if(!n.port)return C({title:I("请输入端口"),icon:"none"});try{M.value=!0;const d=await U(F(`${null==n?void 0:n.ip}:${n.port}`),{key:O.value.device_id,address:O.value.ip,port:O.value.port});(null==(e=null==(a=d.data)?void 0:a.shop)?void 0:e.app_id)&&(null==(s=null==(l=d.data)?void 0:l.shop)?void 0:s.shop_supplier_id)?(N.value=!1,C({title:I("绑定成功"),icon:"none"}),L(null==(o=null==(t=d.data)?void 0:t.shop)?void 0:o.app_id),j(null==(i=null==(u=d.data)?void 0:u.shop)?void 0:i.shop_supplier_id),z(n)):C({title:I("绑定失败"),icon:"none"})}catch(d){C({title:I("绑定失败"),icon:"none"})}finally{M.value=!1}},T=async()=>{if(!m.value.user_name)return C({title:I("請輸入賬號"),icon:"none"});if(!m.value.password)return C({title:I("输入登录密码"),icon:"none"});try{_.value=!0;const a=await $(m.value);a.data.token&&(E(a.data.token),t.setUserInfo(!0),R({url:"/pages/index/index"}))}catch(a){}finally{_.value=!1}},W=a=>{a&&(1==v.value&&(m.value.user_name+=a),1==f.value&&(m.value.password+=a))},X=a=>{v.value="username"===a,f.value="password"===a},Y=()=>{1==v.value&&(m.value.user_name=""),1==f.value&&(m.value.password="")},Z=()=>{O.value={ip:"",port:""}},aa=()=>{N.value=!N.value};return(a,e)=>{const l=q,t=g,h=A,y=s(o("ti-button"),B),w=s(o("ti-input"),D),x=s(o("ti-keyboard"),G);return u(),i(t,{class:"ti-login"},{default:n((()=>[d(t,{class:"ti-login-img"},{default:n((()=>[d(l,{src:J,mode:"widthFix"})])),_:1}),d(t,{class:"ti-login-box"},{default:n((()=>[N.value?(u(),i(t,{key:0,class:"ti-serve-box"},{default:n((()=>[d(t,{class:"ti-serve-head"},{default:n((()=>[d(t,{class:"ti-serve-logo"},{default:n((()=>[d(l,{src:K,mode:"widthFix"})])),_:1}),d(t,{class:"ti-serve-title"},{default:n((()=>[r(c(p(I)("收银机")),1)])),_:1})])),_:1}),d(t,{class:"ti-serve-label"},{default:n((()=>[r(c(p(I)("服務器連接地址")),1)])),_:1}),d(t,{class:"ti-serve-input"},{default:n((()=>[d(t,{class:"ti-serve-ip"},{default:n((()=>[d(h,{modelValue:O.value.ip,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value.ip=a),type:"text",placeholder:p(I)("请输入地址")},null,8,["modelValue","placeholder"])])),_:1}),d(t,{class:"ti-serve-colon"},{default:n((()=>[r(":")])),_:1}),d(t,{class:"ti-serve-port"},{default:n((()=>[d(h,{modelValue:O.value.port,"onUpdate:modelValue":e[1]||(e[1]=a=>O.value.port=a),type:"number",placeholder:p(I)("请输入端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),d(t,{class:"ti-serve-btn"},{default:n((()=>[d(y,{onClick:Z},{default:n((()=>[r(c(p(I)("重置")),1)])),_:1}),d(y,{loading:M.value,type:"primary",onClick:S},{default:n((()=>[r(c(p(I)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(u(),i(t,{key:1,class:"ti-login-form"},{default:n((()=>[d(t,{class:"ti-form-box"},{default:n((()=>[d(t,{class:"ti-form-head"},{default:n((()=>[d(t,{class:"ti-login-logo"},{default:n((()=>[d(l,{src:K,mode:"widthFix"})])),_:1}),d(t,{class:"ti-login-title"},{default:n((()=>[r(c(p(I)("收银机")),1)])),_:1})])),_:1}),d(t,{class:"ti-form-username"},{default:n((()=>[d(w,{modelValue:m.value.user_name,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.user_name=a),prefixIcon:"icon-user",placeholder:p(I)("請輸入用戶名"),focus:v.value,onClick:e[3]||(e[3]=a=>X("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),d(t,{class:"ti-form-password"},{default:n((()=>[d(w,{modelValue:m.value.password,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.password=a),prefixIcon:"icon-lock",placeholder:p(I)("請輸入登錄密碼"),focus:f.value,password:!0,onClick:e[5]||(e[5]=a=>X("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),d(t,{class:"ti-form-btn"},{default:n((()=>[d(y,{type:"primary",loading:_.value,disabled:p(H),onClick:T},{default:n((()=>[r(c(p(I)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),d(t,{class:"ti-form-link",onClick:aa},{default:n((()=>[r(c(p(I)("更换服务器")),1)])),_:1})])),_:1}),d(t,{class:"ti-form-keyboard"},{default:n((()=>[d(x,{isExit:!1,isPrimary:!1,onInput:W,onClear:Y})])),_:1})])),_:1}))])),_:1}),d(t,{class:"ti-language-box"},{default:n((()=>[d(P)])),_:1})])),_:1})}}},[["__scopeId","data-v-f8d85a51"]]);export{M as default};
