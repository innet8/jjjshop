import{$ as e,_ as t,r as l,w as a,a as u,b as s,c as i,d as o,e as d,o as n,f as c,g as r,h as v,i as _,t as p,u as f,j as m,s as y,k as h,l as b,m as g,n as w,F as k,p as I,q as x,S as C,v as P,x as $,y as L,z as U,A as S,B as V,C as j,D as K,E as D,G as N,H as B,I as O,J as T,K as E,L as F,M as z,N as Z,O as A,P as M,Q as R,R as q,T as G,U as H,V as J,W as Q}from"./index-3bbd2984.js";import{_ as W}from"./u-switch.02248848.js";import{f as X,g as Y,a as ee,b as te}from"./payment.ca4cf5da.js";const le=t({__name:"modify-price",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(t,{emit:b}){const g=t,w=l(!1),k=l("");a((()=>g.show),(()=>{g.show&&(k.value="")}));const I=e=>{e&&(k.value+=e)},x=async()=>{var t,l;if(k.value<=0)return y({title:m("請輸入價格"),icon:"none"});try{w.value=!0;const a=await(l={order_product_id:null==(t=g.productItem)?void 0:t.order_product_id,price:k.value},e("order.cart/changePrice",l));1==a.code&&(y({title:a.msg,icon:"none"}),b("update:show",!1),b("success"))}catch(a){}finally{w.value=!1}};return(e,l)=>{const a=h,y=u(i("ti-input"),s),C=u(i("ti-keyboard"),o),P=u(i("ti-modal"),d);return n(),c(P,{show:g.show,title:f(m)("價格")},{content:r((()=>[v(a,{class:"ti-dialog-content"},{default:r((()=>[v(a,{class:"ti-modify-title text-ellipsis"},{default:r((()=>{var e,l,a;return[_(p((null==(e=t.productItem)?void 0:e.product_name_text)||(null==(a=null==(l=t.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),v(a,{class:"ti-modify-input"},{default:r((()=>[v(y,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),placeholder:f(m)("請輸入價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:r((()=>[v(a,{class:"ti-dialog-btn"},{default:r((()=>[v(C,{primaryLoading:w.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>b("update:show",!1)),onClear:l[2]||(l[2]=e=>k.value=""),onInput:I,onConfirm:x},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-574c9bdc"]]),ae=t({__name:"remark",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(t,{emit:s}){const o=t,w=l(!1),k=l("");a((()=>o.show),(()=>{var e;o.show&&(k.value=(null==(e=o.productItem)?void 0:e.remark)||"")}));const I=async()=>{var t,l;if(!k.value)return y({title:m("请输入備註"),icon:"none"});try{w.value=!0;const a=await(l={order_product_id:null==(t=o.productItem)?void 0:t.order_product_id,remark:k.value.trim()},e("order.cart/remark",l));1==a.code&&(y({title:a.msg,icon:"none"}),s("update:show",!1),s("success"))}catch(a){}finally{w.value=!1}};return(e,l)=>{const a=h,y=g,x=u(i("ti-button"),b),C=u(i("ti-modal"),d);return n(),c(C,{show:o.show,title:f(m)("備註")},{content:r((()=>[v(a,{class:"ti-dialog-content"},{default:r((()=>[v(a,{class:"ti-remark-title text-ellipsis"},{default:r((()=>{var e,l,a;return[_(p((null==(e=t.productItem)?void 0:e.product_name_text)||(null==(a=null==(l=t.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),v(a,{class:"ti-remark-textarea"},{default:r((()=>[v(y,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),"placeholder-style":"color:rgba(16,10,5,.3)",placeholder:f(m)("请输入")},null,8,["modelValue","placeholder"])])),_:1}),v(a,{class:"ti-remark-num"},{default:r((()=>{var e;return[_(p((null==(e=k.value)?void 0:e.trim().length)||0)+"/50 ",1)]})),_:1})])),_:1})])),footer:r((()=>[v(a,{class:"ti-dialog-btn"},{default:r((()=>[v(x,{onClick:l[1]||(l[1]=e=>s("update:show",!1))},{default:r((()=>[_(p(f(m)("退出")),1)])),_:1}),v(x,{onClick:l[2]||(l[2]=e=>k.value="")},{default:r((()=>[_(p(f(m)("清空")),1)])),_:1}),v(x,{loading:w.value,type:"primary",onClick:I},{default:r((()=>[_(p(f(m)("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-3c09f473"]]),ue=t({__name:"withdrawal",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(t,{emit:b}){const g=t,C=l(!1),P=l(""),$=l([m("等待時間長"),m("口味不好"),m("菜賣光了")]),L=l(0);a((()=>g.show),(()=>{g.show&&(P.value="")}));const U=e=>{e&&(P.value+=e)},S=async()=>{var t,l,a;if(P.value<=0)return y({title:m("請輸入價格"),icon:"none"});try{C.value=!0;const u=await(a={order_id:null==(t=g.productItem)?void 0:t.order_id,order_product_id:null==(l=g.productItem)?void 0:l.order_product_id,num:P.value,return_reason:$.value[L.value]},e("order.cart/moveProduct",a));1==u.code&&(y({title:u.msg,icon:"none"}),b("update:show",!1),b("success"))}catch(u){}finally{C.value=!1}};return(e,l)=>{const a=h,y=u(i("ti-input"),s),V=u(i("ti-keyboard"),o),j=u(i("ti-modal"),d);return n(),c(j,{show:g.show,title:f(m)("退菜")},{content:r((()=>[v(a,{class:"ti-dialog-content"},{default:r((()=>[v(a,{class:"ti-withdrawal-title text-ellipsis"},{default:r((()=>{var e,l,a;return[_(p((null==(e=t.productItem)?void 0:e.product_name_text)||(null==(a=null==(l=t.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),v(a,{class:"ti-withdrawal-list"},{default:r((()=>[(n(!0),w(k,null,I($.value,((e,t)=>(n(),c(a,{key:t,class:x([{active:t==L.value},"ti-withdrawal-item"]),onClick:e=>(e=>{L.value=e})(t)},{default:r((()=>[_(p(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),v(a,{class:"ti-withdrawal-input"},{default:r((()=>[v(y,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e),placeholder:f(m)("请输入退菜數量"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:r((()=>[v(a,{class:"ti-dialog-btn"},{default:r((()=>[v(V,{primaryLoading:C.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>b("update:show",!1)),onClear:l[2]||(l[2]=e=>P.value=""),onInput:U,onConfirm:S},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-448a75f2"]]),se=t({__name:"cancel-all",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show","success"],setup(t,{emit:a}){const s=t,o=l(!1),f=async()=>{var t;if(!o.value)try{o.value=!0;const l=await(t={order_id:s.orderId},e("order.cart/delStay",t));y({title:l.msg,icon:"none"}),a("update:show",!1),a("success")}catch(l){}finally{o.value=!1}};return(e,l)=>{const m=h,y=C,b=u(i("ti-modal"),d);return n(),c(b,{class:"ti-action-tips",title:e.$t("溫馨提示"),show:s.show,confirmLoading:o.value,onCancel:l[0]||(l[0]=e=>a("update:show",!1)),onConfirm:f},{content:r((()=>[v(m,{class:"ti-dialog-content"},{default:r((()=>[s.sendKitchen&&t.sendKitchen.length>0?(n(),w(k,{key:0},[v(m,{class:"ti-cancel-title"},{default:r((()=>[_(p(e.$t("此單有商品已送廚，是否取消此筆交易？")),1)])),_:1}),v(m,{class:"ti-cancel-all"},{default:r((()=>[v(y,{"scroll-y":""},{default:r((()=>[v(m,{class:"ti-cancel-list"},{default:r((()=>[(n(!0),w(k,null,I(s.sendKitchen,((e,t)=>(n(),c(m,{key:t,class:"ti-cancel-item"},{default:r((()=>[_(p(null==e?void 0:e.product_name_text),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})],64)):(n(),w(k,{key:1},[_(p(e.$t("是否取消此筆交易？")),1)],64))])),_:1})])),_:1},8,["title","show","confirmLoading"])}}},[["__scopeId","data-v-9ce42bf3"]]),ie=t({__name:"order-pickup",props:{show:{type:Boolean,default:!1},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show"],setup(t,{emit:s}){const o=t,d=l(),g=l(!1),x=l(!1),K=l(),D=l({page:1,list_rows:10}),N=l(!1),B=l([]),O=l(!1);a((()=>o.show),(()=>{o.show&&T()}));const T=()=>{D.value.page=1,F(!0)},E=()=>{O.value&&(D.value.page+=1,F())},F=async t=>{var l,a,u,s,i,o;if(!N.value)try{t&&(N.value=!0);const d=await(o=D.value,e("order.cart/stayList",o,{isLoading:!1}));1==D.value.page&&(B.value=[]),B.value=B.value.concat((null==(l=d.data)?void 0:l.productList)||[]),O.value=(null==(u=null==(a=d.data)?void 0:a.list)?void 0:u.last_page)>(null==(i=null==(s=d.data)?void 0:s.list)?void 0:i.current_page)}catch(d){}finally{t&&(N.value=!1)}},z=async t=>{if(!g.value){d.value=t;try{g.value=!0;const a=await(l={order_id:t},e("order.cart/pick",l));y({title:a.msg,icon:"none"}),s("update:show",!1),V(t),setTimeout((()=>{s("success")}),100)}catch(a){}finally{g.value=!1}var l}};return(e,l)=>{const a=u(i("ti-loading"),P),y=j,V=h,D=u(i("ti-button"),b),F=u(i("ti-empty-data"),$),Z=C,A=u(i("ti-drawer"),L);return n(),c(V,null,{default:r((()=>[v(A,{show:o.show,isConfirmShow:!1,title:f(m)("取單"),onCancel:l[0]||(l[0]=e=>s("update:show",!1))},{content:r((()=>[v(V,{class:"ti-order-pickup"},{default:r((()=>[v(Z,{"scroll-y":"","lower-threshold":50,onScrolltolower:E},{default:r((()=>[N.value?(n(),c(a,{key:0})):B.value&&B.value.length>0?(n(),w(k,{key:1},[v(V,{class:"ti-pickup-list"},{default:r((()=>[(n(!0),w(k,null,I(B.value,((e,t)=>(n(),c(V,{key:t,class:"ti-pickup-item"},{default:r((()=>[v(V,{class:"ti-pickup-top"},{default:r((()=>[v(V,{class:"ti-pickup-left"},{default:r((()=>[v(V,{class:"ti-price-box"},{default:r((()=>[v(y,{class:"ti-price-text"},{default:r((()=>[_(p(f(m)("訂單總價：")),1)])),_:1}),v(y,{class:"ti-pickup-price"},{default:r((()=>[_(p(f(U)(null==e?void 0:e.total_price)),1)])),_:2},1024),v(y,{class:"ti-pickup-subPrice"},{default:r((()=>[_(p(f(S)(null==e?void 0:e.total_price)),1)])),_:2},1024)])),_:2},1024),v(V,{class:"ti-pickup-time"},{default:r((()=>[v(y,null,{default:r((()=>[_(p(f(m)("掛單時間：")),1)])),_:1}),v(y,null,{default:r((()=>[_(p(null==e?void 0:e.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(V,{class:"ti-pickup-action"},{default:r((()=>[v(V,{class:"ti-cancel-all"},{default:r((()=>[v(D,{type:"danger",onClick:t=>{return l=e.order_id,K.value=l,void(x.value=!0);var l}},{default:r((()=>[_(p(f(m)("整單取消")),1)])),_:2},1032,["onClick"])])),_:2},1024),v(V,null,{default:r((()=>[v(D,{type:"primary",loading:d.value==e.order_id&&g.value,onClick:t=>z(e.order_id)},{default:r((()=>[_(p(f(m)("取單")),1)])),_:2},1032,["loading","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),v(V,{class:"ti-pickup-goods"},{default:r((()=>[v(V,{class:"ti-goods-head"},{default:r((()=>[v(V,null,{default:r((()=>[_(p(f(m)("商品名称")),1)])),_:1}),v(V,null,{default:r((()=>[_(p(f(m)("金額")),1)])),_:1}),v(V,null,{default:r((()=>[_(p(f(m)("數量")),1)])),_:1})])),_:1}),v(V,{class:"ti-goods-body"},{default:r((()=>[(n(!0),w(k,null,I((null==e?void 0:e.product)||[],((e,t)=>(n(),c(V,{key:t,class:"ti-goods-item"},{default:r((()=>[v(V,null,{default:r((()=>{var t;return[_(p(null==(t=null==e?void 0:e.product)?void 0:t.product_name_text),1)]})),_:2},1024),v(V,null,{default:r((()=>[v(y,{class:"ti-goods-price"},{default:r((()=>[_(p(f(U)(null==e?void 0:e.price)),1)])),_:2},1024),v(y,{class:"ti-goods-subPrice"},{default:r((()=>[_(p(f(S)(null==e?void 0:e.price)),1)])),_:2},1024)])),_:2},1024),v(V,null,{default:r((()=>[_(p(`x ${null==e?void 0:e.product_num}`),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),v(a,{status:O.value?"loading":"no-more"},null,8,["status"])],64)):(n(),c(F,{key:2}))])),_:1})])),_:1})])),_:1},8,["show","title"]),v(se,{show:x.value,"onUpdate:show":l[1]||(l[1]=e=>x.value=e),orderId:K.value,sendKitchen:t.sendKitchen,onSuccess:l[2]||(l[2]=e=>T())},null,8,["show","orderId","sendKitchen"])])),_:1})}}},[["__scopeId","data-v-0821af84"]]),oe=t({__name:"preferential",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})},totalPayPrice:{type:[Number,String],default:0}},emits:["update:show","success"],setup(t,{emit:g}){const C=t,P=l({type:1,money:"",rate:"",discountType:1}),$=l(!1);a((()=>C.show),(()=>{P.value={type:1,money:"",rate:"",discountType:1}})),a((()=>P.value.type),((e,t)=>{1==t?P.value.money="":2==t?P.value.rate="":3==t&&(P.value.discountType=1)}));const L=e=>{P.value.discountType=e.detail.value},V=()=>{1==P.value.type?P.value.money="":2==P.value.type&&(P.value.rate="")},O=e=>{e&&(1==P.value.type?P.value.money+=e:2==P.value.type&&(P.value.rate+=e))},T=async()=>{if(!$.value){if(1==P.value.type){if(P.value.money<=0)return y({title:"请输入實付價格",icon:"none"})}else if(2==P.value.type&&P.value.rate<=0)return y({title:"请输入優惠折扣",icon:"none"});try{$.value=!0;const l=await(t=P.value,e("order.cart/changeMoney",t));y({title:l.msg,icon:"none"}),g("update:show",!1),g("success")}catch(l){}finally{$.value=!1}var t}};return(e,l)=>{const a=h,y=j,E=u(i("ti-input"),s),F=D,z=N,Z=B,A=u(i("ti-button"),b),M=u(i("ti-keyboard"),o),R=u(i("ti-modal"),d);return n(),c(R,{show:C.show,title:f(m)("優惠折扣")},{content:r((()=>[v(a,{class:"ti-dialog-content"},{default:r((()=>[v(a,{class:"ti-preferential-box"},{default:r((()=>[v(a,{class:"ti-preferential-label"},{default:r((()=>[_(p(f(m)("當前價格")),1)])),_:1}),v(a,{class:"ti-preferential-input"},{default:r((()=>[v(y,{class:"ti-preferential-price"},{default:r((()=>[_(p(f(U)(t.totalPayPrice)),1)])),_:1}),v(y,{class:"ti-preferential-subPrice"},{default:r((()=>[_(p(f(S)(t.totalPayPrice)),1)])),_:1})])),_:1}),v(a,{class:"ti-preferential-label"},{default:r((()=>[_(p(f(m)("優惠方式")),1)])),_:1}),v(a,{class:"ti-preferential-input ti-preferential-type"},{default:r((()=>[(n(!0),w(k,null,I([f(m)("改價"),f(m)("折扣"),f(m)("抹零")],((e,t)=>(n(),c(a,{key:t,class:x([{active:P.value.type==t+1},"ti-preferential-type-item"]),onClick:e=>P.value.type=t+1},{default:r((()=>[_(p(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),1==P.value.type?(n(),w(k,{key:0},[v(a,{class:"ti-preferential-label"},{default:r((()=>[_(p(f(m)("實付價格")),1)])),_:1}),v(a,{class:"ti-preferential-input"},{default:r((()=>[v(E,{modelValue:P.value.money,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value.money=e),placeholder:f(m)("请输入實付價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})],64)):K("",!0),2==P.value.type?(n(),w(k,{key:1},[v(a,{class:"ti-preferential-label"},{default:r((()=>[_(p(f(m)("優惠折扣")),1)])),_:1}),v(a,{class:"ti-preferential-input"},{default:r((()=>[v(E,{modelValue:P.value.rate,"onUpdate:modelValue":l[1]||(l[1]=e=>P.value.rate=e),placeholder:f(m)("请输入優惠折扣"),focus:!0},{right:r((()=>[v(a,{class:"ti-preferential-percentage"},{default:r((()=>[_("%")])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})],64)):K("",!0),3==P.value.type?(n(),w(k,{key:2},[v(a,{class:"ti-preferential-label"},{default:r((()=>[_(p(f(m)("抹零方式")),1)])),_:1}),v(a,{class:"ti-preferential-input"},{default:r((()=>[v(Z,{class:"ti-type-radio",onChange:L},{default:r((()=>[v(z,null,{default:r((()=>[v(F,{value:"1",color:"#ffbe00",checked:"true"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(f(m)("抹分")),1)])),_:1})])),_:1}),v(z,null,{default:r((()=>[v(F,{value:"2",color:"#ffbe00"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(f(m)("抹角")),1)])),_:1})])),_:1}),v(z,null,{default:r((()=>[v(F,{value:"3",color:"#ffbe00"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(f(m)("四捨五入到角")),1)])),_:1})])),_:1}),v(z,null,{default:r((()=>[v(F,{value:"4",color:"#ffbe00"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(f(m)("四捨五入到元")),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):K("",!0)])),_:1})])),_:1})])),footer:r((()=>[3==P.value.type?(n(),c(a,{key:0,class:"ti-dialog-btn"},{default:r((()=>[v(A,{onClick:l[2]||(l[2]=e=>g("update:show",!1))},{default:r((()=>[_(p(f(m)("退出")),1)])),_:1}),v(A,{loading:$.value,type:"primary",onClick:T},{default:r((()=>[_(p(f(m)("确定")),1)])),_:1},8,["loading"])])),_:1})):(n(),c(a,{key:1,class:"ti-dialog-btn ti-preferential-keyboard"},{default:r((()=>[v(M,{primaryLoading:$.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[3]||(l[3]=e=>g("update:show",!1)),onClear:V,onInput:O,onConfirm:T},null,8,["primaryLoading"])])),_:1}))])),_:1},8,["show","title"])}}},[["__scopeId","data-v-ba590849"]]),de=t({__name:"action-list",props:{productItem:{type:Object,default:()=>({})},orderId:{type:[Number,String],default:null},orderList:{type:Array,default:()=>[]},totalPayPrice:{type:[Number,String],default:0}},emits:["success"],setup(t,{emit:a}){const s=t,o=O((()=>s.orderList&&s.orderList.length>0)),c=O((()=>s.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)>0)))),b=O((()=>s.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)<=0)))),g=l(T()),I=l(!1),x=l(!1),C=l(!1),P=l(!1),$=l(!1),L=l(!1),U=l(!1),S=l(!1),V=l(!1),K=l(!1),D=l(!1),N=l(!1),B=e=>{E(e)},Z=async()=>{var t,l;if(!P.value)try{P.value=!0;const u=await(l={order_product_id:null==(t=s.productItem)?void 0:t.order_product_id},e("order.cart/delProduct",l));1==u.code&&(y({title:u.msg,icon:"none"}),a("success"))}catch(u){}finally{C.value=!1,P.value=!1}},A=()=>{F(),setTimeout((()=>{a("success")}),100)},M=async()=>{var t;if(!L.value)try{L.value=!0;const l=await(t={delivery:g.value?30:40,order_id:s.orderId},e("order.cart/sendKitchen",t));1==l.code&&(y({title:l.msg,icon:"none"}),a("success"))}catch(l){}finally{$.value=!1,L.value=!1}},R=async()=>{var t;if(!x.value)try{x.value=!0;const l=await(t={order_id:s.orderId},e("order.cart/stay",t));1==l.code&&(y({title:l.msg,icon:"none"}),F(),setTimeout((()=>{a("success")}),100))}catch(l){}finally{I.value=!1,x.value=!1}};return(e,l)=>{const y=j,O=u(i("u-switch"),W),T=h,E=z,F=u(i("ti-modal"),d);return n(),w(k,null,[v(T,{class:"ti-action-box"},{default:r((()=>[v(T,{class:"ti-action-btn"},{default:r((()=>[v(T,{class:"ti-action-pack"},{default:r((()=>[v(y,{class:"ti-pack-text"},{default:r((()=>[_(p(f(m)("打包")),1)])),_:1}),v(O,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=e=>g.value=e),activeColor:"#FFBE00",size:"20",onChange:B},null,8,["modelValue"])])),_:1}),v(T,{class:"ti-btn-box"},{default:r((()=>{var e,a,u,s,i,d;return[v(E,{class:"ti-btn-item",disabled:!(null==(e=t.productItem)?void 0:e.order_product_id),onClick:l[1]||(l[1]=e=>C.value=!0)},{default:r((()=>[_(p(f(m)("删除")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:!(null==(a=t.productItem)?void 0:a.order_product_id)&&0!=(null==(u=t.productItem)?void 0:u.is_send_kitchen),onClick:l[2]||(l[2]=e=>V.value=!0)},{default:r((()=>[_(p(f(m)("备注")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:!(null==(s=t.productItem)?void 0:s.order_product_id)&&!(null==(i=t.productItem)?void 0:i.order_id),onClick:l[3]||(l[3]=e=>S.value=!0)},{default:r((()=>[_(p(f(m)("價格")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:!f(o),onClick:l[4]||(l[4]=e=>I.value=!0)},{default:r((()=>[_(p(f(m)("掛單")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:!1,onClick:l[5]||(l[5]=e=>D.value=!0)},{default:r((()=>[_(p(f(m)("取單")),1)])),_:1}),v(E,{class:"ti-btn-item danger",disabled:!f(o),onClick:l[6]||(l[6]=e=>(async()=>{U.value=!0})())},{default:r((()=>[_(p(f(m)("整單取消")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:0==f(b).length,onClick:l[7]||(l[7]=e=>$.value=!0)},{default:r((()=>[_(p(f(m)("送廚")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item danger",disabled:!f(o)&&0!=(null==(d=t.productItem)?void 0:d.is_send_kitchen),onClick:l[8]||(l[8]=e=>K.value=!0)},{default:r((()=>[_(p(f(m)("退菜")),1)])),_:1},8,["disabled"]),v(E,{class:"ti-btn-item",disabled:!f(o),onClick:l[9]||(l[9]=e=>N.value=!0)},{default:r((()=>[_(p(f(m)("優惠折扣")),1)])),_:1},8,["disabled"])]})),_:1})])),_:1})])),_:1}),v(F,{class:"ti-action-tips",show:C.value,"onUpdate:show":l[10]||(l[10]=e=>C.value=e),confirmLoading:P.value,title:f(m)("溫馨提示"),content:f(m)("是否删除此商品？"),onConfirm:Z},null,8,["show","confirmLoading","title","content"]),v(F,{class:"ti-action-tips",show:$.value,"onUpdate:show":l[11]||(l[11]=e=>$.value=e),confirmLoading:L.value,title:f(m)("溫馨提示"),content:f(m)("是否将商品送廚？"),onConfirm:M},null,8,["show","confirmLoading","title","content"]),v(F,{class:"ti-action-tips",show:I.value,"onUpdate:show":l[12]||(l[12]=e=>I.value=e),confirmLoading:x.value,title:f(m)("溫馨提示"),content:f(m)("是否将商品挂单？"),onConfirm:R},null,8,["show","confirmLoading","title","content"]),v(se,{show:U.value,"onUpdate:show":l[13]||(l[13]=e=>U.value=e),sendKitchen:f(c),orderId:s.orderId,onSuccess:A},null,8,["show","sendKitchen","orderId"]),v(le,{show:S.value,"onUpdate:show":l[14]||(l[14]=e=>S.value=e),productItem:s.productItem,onSuccess:l[15]||(l[15]=e=>a("success"))},null,8,["show","productItem"]),v(ae,{show:V.value,"onUpdate:show":l[16]||(l[16]=e=>V.value=e),productItem:s.productItem,onSuccess:l[17]||(l[17]=e=>a("success"))},null,8,["show","productItem"]),v(ie,{show:D.value,"onUpdate:show":l[18]||(l[18]=e=>D.value=e),sendKitchen:f(c),onSuccess:l[19]||(l[19]=e=>a("success"))},null,8,["show","sendKitchen"]),v(ue,{show:K.value,"onUpdate:show":l[20]||(l[20]=e=>K.value=e),productItem:s.productItem,onSuccess:l[21]||(l[21]=e=>a("success"))},null,8,["show","productItem"]),v(oe,{show:N.value,"onUpdate:show":l[22]||(l[22]=e=>N.value=e),productItem:s.productItem,totalPayPrice:t.totalPayPrice,onSuccess:l[23]||(l[23]=e=>a("success"))},null,8,["show","productItem","totalPayPrice"])],64)}}},[["__scopeId","data-v-b65d7382"]]),ne=t({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})}},emits:["change"],setup(t,{emit:a}){const s=t,o=l(!1),d=async t=>{var l,u;const i={order_product_id:null==(l=s.productItem)?void 0:l.order_product_id,product_num:null==(u=s.productItem)?void 0:u.total_num,type:t};"up"==t?i.product_num+=1:i.product_num-=1;try{o.value=!0;const t=await function(t){return e("order.cart/sub",t)}(i);1==t.code&&a("change")}catch(d){}finally{o.value=!1}};return(e,t)=>{const l=u(i("uni-icons"),Z),a=z,f=h;return n(),c(f,{class:"ti-number-box",onClick:t[2]||(t[2]=A((()=>{}),["stop"]))},{default:r((()=>{var e,u,i,n,c,m;return[v(a,{class:"ti-number-btn ti-number-minus",disabled:(null==(e=s.productItem)?void 0:e.total_num)<=1||o.value||(null==(u=s.productItem)?void 0:u.is_send_kitchen)>0,onClick:t[0]||(t[0]=e=>d("down"))},{default:r((()=>[v(l,{"custom-prefix":"iconfont",type:"icon-minus",size:"16"})])),_:1},8,["disabled"]),v(f,{class:"ti-number-input"},{default:r((()=>{var e;return[_(p((null==(e=s.productItem)?void 0:e.total_num)||1),1)]})),_:1}),v(a,{class:"ti-number-btn ti-number-plus",disabled:(null==(i=s.productItem)?void 0:i.total_num)>=(null==(c=null==(n=s.productItem)?void 0:n.product)?void 0:c.product_stock)||o.value||(null==(m=s.productItem)?void 0:m.is_send_kitchen)>0,onClick:t[1]||(t[1]=e=>d("up"))},{default:r((()=>[v(l,{type:"plusempty",size:"16"})])),_:1},8,["disabled"])]})),_:1})}}},[["__scopeId","data-v-1f4f3df5"]]),ce=t({__name:"member",props:{show:{type:Boolean,default:!1}},emits:["update:show","change"],setup(e,{emit:t}){const m=e,y=l(!1),g=l(""),w=l({});a((()=>m.show),(()=>{m.show&&(g.value="",w.value={})}));const k=()=>{t("update:show",!1),t("change",null)},I=e=>{e&&(g.value+=e)},x=async()=>{try{y.value=!0;const e=await X({mobile:g.value});1==e.code&&(w.value=e.data)}catch(e){}finally{y.value=!1}},C=()=>{t("update:show",!1),t("change",w.value)};return(e,t)=>{const l=u(i("ti-input"),s),a=u(i("ti-button"),b),P=h,$=j,L=u(i("ti-keyboard"),o),V=u(i("ti-modal"),d);return n(),c(V,{show:m.show,title:e.$t("会员")},{content:r((()=>[v(P,{class:"ti-dialog-content"},{default:r((()=>{var u;return[v(P,{class:"ti-payment-input"},{default:r((()=>[v(l,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:e.$t("請輸入會員手機號/ID"),focus:!0},null,8,["modelValue","placeholder"]),v(a,{loading:y.value,type:"primary",onClick:x},{default:r((()=>[_(p(e.$t("查找")),1)])),_:1},8,["loading"])])),_:1}),(null==(u=w.value)?void 0:u.user_id)?(n(),c(P,{key:0,class:"ti-payment-member"},{default:r((()=>[v(P,{class:"ti-member-list"},{default:r((()=>[v(P,{class:"ti-member-item"},{default:r((()=>[v(P,{class:"ti-member-head"},{default:r((()=>[_(p(e.$t("暱稱")),1)])),_:1}),v(P,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p(null==(e=w.value)?void 0:e.nickName),1)]})),_:1})])),_:1}),v(P,{class:"ti-member-item"},{default:r((()=>[v(P,{class:"ti-member-head"},{default:r((()=>[_(p(e.$t("會員卡/等級")),1)])),_:1}),v(P,{class:"ti-member-name"},{default:r((()=>{var e,t;return[_(p(null==(t=null==(e=w.value)?void 0:e.grade)?void 0:t.name),1)]})),_:1})])),_:1}),v(P,{class:"ti-member-item"},{default:r((()=>[v(P,{class:"ti-member-head"},{default:r((()=>[_(p(e.$t("餘額")),1)])),_:1}),v(P,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p((null==(e=w.value)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),v(P,{class:"ti-member-item"},{default:r((()=>[v(P,{class:"ti-member-head"},{default:r((()=>[_(p(e.$t("積分")),1)])),_:1}),v(P,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p((null==(e=w.value)?void 0:e.total_points)||0),1)]})),_:1})])),_:1})])),_:1}),v(P,{class:"ti-member-discount"},{default:r((()=>[v($,{class:"ti-discount-title"},{default:r((()=>[_(p(e.$t("會員折扣應收金額")),1)])),_:1}),v($,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=w.value)?void 0:e.expend_money)||0)),1)]})),_:1}),v($,{class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=w.value)?void 0:e.expend_money)||0)),1)]})),_:1})])),_:1})])),_:1})):K("",!0)]})),_:1})])),footer:r((()=>[v(P,{class:"ti-dialog-btn"},{default:r((()=>[v(L,{isDoubleZero:!1,isCross:!0,isDrop:!0,onExit:k,onClear:t[1]||(t[1]=e=>g.value=""),onInput:I,onConfirm:C})])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-202656c7"]]),re=t({__name:"payment-type",props:{show:{type:Boolean,default:!1},totalPayPrice:{type:[Number,String],default:0},orderId:{type:[Number,String],default:null}},emits:["update:show"],setup(e,{emit:t}){const s=e,o=l(!1),m=l({}),g=l([]),C=l({delivery:null,pay_type:"40",user_id:null,order_id:null}),P=l(!1),L=l(!1);a((()=>s.show),(()=>{s.show&&(g.value=[],C.value.pay_type="40")})),a((()=>C.value.pay_type),(()=>{s.show&&(C.value.pay_type>0||(g.value&&g.value.length>0?C.value.pay_type=g.value[0].value:Y().then((e=>{g.value=e.data||[],C.value.pay_type=g.value[0].value}))))}));const V=e=>{m.value=e},O=e=>{C.value.pay_type=e.detail.value},E=async()=>{if(!L.value)try{L.value=!0;const e=await ee({order_id:s.orderId});y({title:e.msg,icon:"none"})}catch(e){}finally{L.value=!1}},z=async()=>{var e;if(P.value)return;const l={...C.value};l.delivery=T()?30:40,l.order_id=s.orderId,l.user_id=null==(e=m.value)?void 0:e.user_id;try{P.value=!0;const e=await te(l);y({title:e.msg,icon:"none"}),t("update:show",!1),t("success"),F()}catch(a){}finally{P.value=!1}};return(l,a)=>{const y=j,T=h,F=D,Z=N,A=B,R=M,q=u(i("ti-empty-data"),$),G=u(i("ti-button"),b),H=u(i("ti-modal"),d);return n(),c(H,{show:s.show,title:l.$t("結賬")},{content:r((()=>[v(T,{class:"ti-dialog-content"},{default:r((()=>{var t;return[v(T,{class:"ti-payment-money"},{default:r((()=>[v(y,{class:"ti-payment-label"},{default:r((()=>[_(p(l.$t("應收金額")),1)])),_:1}),v(y,{class:"ti-payment-price"},{default:r((()=>[_(p(f(U)(e.totalPayPrice)),1)])),_:1}),v(y,{class:"ti-payment-subPrice"},{default:r((()=>[_(p(f(S)(e.totalPayPrice)),1)])),_:1})])),_:1}),v(T,{class:"ti-payment-type"},{default:r((()=>[v(T,{class:"ti-type-label"},{default:r((()=>[_(p(l.$t("收款方式")),1)])),_:1}),v(A,{class:"ti-type-radio",onChange:O},{default:r((()=>[v(Z,null,{default:r((()=>[v(F,{value:"40",color:"#ffbe00",checked:"true"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(l.$t("現金")),1)])),_:1})])),_:1}),v(Z,null,{default:r((()=>[v(F,{value:"10",color:"#ffbe00"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(l.$t("餘額")),1)])),_:1})])),_:1}),v(Z,null,{default:r((()=>[v(F,{value:"",color:"#ffbe00"}),v(y,{class:"ti-radio-text"},{default:r((()=>[_(p(l.$t("其他方式")),1)])),_:1})])),_:1})])),_:1})])),_:1}),"40"!=C.value.pay_type&&"10"!=C.value.pay_type?(n(),c(T,{key:0,class:"ti-payment-other"},{default:r((()=>[v(T,{class:"ti-other-title"},{default:r((()=>[_(p(l.$t("用戶通過店內掃碼等方式進行支付，確認用戶支付完成後，點擊確認即可完成付款操作。")),1)])),_:1}),g.value&&g.value.length>0?(n(),c(T,{key:0,class:"ti-other-list"},{default:r((()=>[(n(!0),w(k,null,I(g.value,(e=>(n(),c(T,{key:e.value,class:x([{active:e.value==C.value.pay_type},"ti-other-item"]),onClick:t=>C.value.pay_type=e.value},{default:r((()=>[v(T,{class:"ti-other-image"},{default:r((()=>[v(R,{src:e.img,mode:"widthFix"},null,8,["src"])])),_:2},1024),v(T,{class:"ti-other-text"},{default:r((()=>[_(p(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):(n(),c(q,{key:1}))])),_:1})):K("",!0),(null==(t=m.value)?void 0:t.user_id)?(n(),c(T,{key:1,class:"ti-payment-member"},{default:r((()=>[v(T,{class:"ti-payment-top"},{default:r((()=>[v(T,{class:"ti-payment-top-name"},{default:r((()=>[_(p(l.$t("會員")),1)])),_:1}),v(T,{class:"ti-payment-top-discomfort",onClick:a[0]||(a[0]=e=>m.value=null)},{default:r((()=>[_(p(l.$t("不使用此會員")),1)])),_:1})])),_:1}),v(T,{class:"ti-member-list"},{default:r((()=>[v(T,{class:"ti-member-item"},{default:r((()=>[v(T,{class:"ti-member-head"},{default:r((()=>[_(p(l.$t("暱稱")),1)])),_:1}),v(T,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p(null==(e=m.value)?void 0:e.nickName),1)]})),_:1})])),_:1}),v(T,{class:"ti-member-item"},{default:r((()=>[v(T,{class:"ti-member-head"},{default:r((()=>[_(p(l.$t("會員卡/等級")),1)])),_:1}),v(T,{class:"ti-member-name"},{default:r((()=>{var e,t;return[_(p(null==(t=null==(e=m.value)?void 0:e.grade)?void 0:t.name),1)]})),_:1})])),_:1}),v(T,{class:"ti-member-item"},{default:r((()=>[v(T,{class:"ti-member-head"},{default:r((()=>[_(p(l.$t("餘額")),1)])),_:1}),v(T,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p((null==(e=m.value)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),v(T,{class:"ti-member-item"},{default:r((()=>[v(T,{class:"ti-member-head"},{default:r((()=>[_(p(l.$t("積分")),1)])),_:1}),v(T,{class:"ti-member-name"},{default:r((()=>{var e;return[_(p((null==(e=m.value)?void 0:e.total_points)||0),1)]})),_:1})])),_:1})])),_:1}),v(T,{class:"ti-member-discount"},{default:r((()=>[v(y,{class:"ti-discount-title"},{default:r((()=>[_(p(l.$t("會員折扣應收金額")),1)])),_:1}),v(y,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=m.value)?void 0:e.expend_money)||0)),1)]})),_:1}),v(y,{class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=m.value)?void 0:e.expend_money)||0)),1)]})),_:1})])),_:1})])),_:1})):K("",!0),v(ce,{show:o.value,"onUpdate:show":a[1]||(a[1]=e=>o.value=e),onChange:V},null,8,["show"])]})),_:1})])),footer:r((()=>[v(T,{class:"ti-dialog-btn"},{default:r((()=>[v(G,{onClick:a[2]||(a[2]=e=>t("update:show",!1))},{default:r((()=>[_(p(l.$t("退出")),1)])),_:1}),v(G,{loading:L.value,onClick:E},{default:r((()=>[_(p(l.$t("打印")),1)])),_:1},8,["loading"]),v(G,{onClick:a[3]||(a[3]=e=>o.value=!0)},{default:r((()=>[_(p(l.$t("会员")),1)])),_:1}),v(G,{loading:P.value,type:"primary",onClick:z},{default:r((()=>[_(p(l.$t("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-6edbdbaf"]]),ve=t({__name:"cart-list",setup(t,{expose:a}){const s=l(!1),o=l(!1),d=l({}),m=l({}),y=l({}),b=l([]),g=l(),L=()=>{s.value=!0},V=async t=>{var l,a,u,s,i,n,c;const r={...y.value};r.order_id=R();try{t&&(o.value=!0);const v=await function(t){return e("order.cart/list",t,{isLoading:!1})}(r);if(1==v.code&&(m.value=null==(a=null==(l=v.data)?void 0:l.allProductInfo)?void 0:a.sumInfo,g.value=null==(u=v.data)?void 0:u.order_id,b.value=(null==(n=null==(i=null==(s=v.data)?void 0:s.allProductInfo)?void 0:i.orderInfo)?void 0:n.product)||[],b.value&&b.value.length>0)){let e=0;(null==(c=d.value)?void 0:c.order_product_id)&&(e=b.value.findIndex((e=>{var t;return e.order_product_id==(null==(t=d.value)?void 0:t.order_product_id)}))),d.value=b.value[Math.max(e,0)]}}catch(v){}finally{t&&(o.value=!1)}};return V(!0),a({getCartData:V}),(e,t)=>{var l,a;const y=h,D=u(i("ti-loading"),P),N=j,B=u(i("ti-empty-data"),$),O=C,T=z;return n(),w(k,null,[v(y,{class:"ti-cart-box"},{default:r((()=>[v(y,{class:"ti-cart-list"},{default:r((()=>[v(y,{class:"ti-cart-shop-head"},{default:r((()=>[v(y,{class:"ti-shop-head-title"},{default:r((()=>[_(p(e.$t("商品名稱")),1)])),_:1}),v(y,{class:"ti-shop-head-money"},{default:r((()=>[_(p(e.$t("金額")),1)])),_:1}),v(y,{class:"ti-shop-head-num"},{default:r((()=>[_(p(e.$t("數量")),1)])),_:1})])),_:1}),v(y,{class:"ti-shop-list"},{default:r((()=>[v(O,{"scroll-y":""},{default:r((()=>[o.value?(n(),c(D,{key:0})):b.value&&b.value.length>0?(n(),c(y,{key:1,class:"ti-shop-box"},{default:r((()=>[(n(!0),w(k,null,I(b.value,(e=>{var l;return n(),c(y,{key:e,class:x([{active:(null==(l=d.value)?void 0:l.order_product_id)==(null==e?void 0:e.order_product_id)},"ti-shop-item"]),onClick:t=>(e=>{var t;(null==(t=d.value)?void 0:t.order_product_id)!=(null==e?void 0:e.order_product_id)&&(d.value=e)})(e)},{default:r((()=>[v(y,{class:"ti-shop-item-box"},{default:r((()=>[v(y,{class:"ti-shop-box"},{default:r((()=>[v(y,{class:"ti-shop-body-top"},{default:r((()=>[v(y,{class:"ti-shop-title text-ellipsis"},{default:r((()=>[_(p(e.product_name_text),1)])),_:2},1024),e.product_attr?(n(),c(y,{key:0,class:"ti-shop-spec"},{default:r((()=>[_("( "+p(e.product_attr)+" )",1)])),_:2},1024)):K("",!0)])),_:2},1024),v(y,{class:"ti-shop-body-money"},{default:r((()=>[v(N,{class:"ti-shop-price"},{default:r((()=>[_(p(f(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),v(N,{class:"ti-shop-subPrice"},{default:r((()=>[_(p(f(S)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024),v(ne,{productItem:e,onChange:t[0]||(t[0]=e=>V())},null,8,["productItem"])])),_:2},1024),e.remark?(n(),c(y,{key:0,class:"ti-shop-remark"},{default:r((()=>[_(p(e.remark),1)])),_:2},1024)):K("",!0)])),_:2},1024)])),_:2},1032,["class","onClick"])})),128))])),_:1})):(n(),c(B,{key:2}))])),_:1})])),_:1})])),_:1}),v(y,{class:"ti-cart-statistics"},{default:r((()=>[v(y,{class:"ti-cart-total"},{default:r((()=>[v(N,{class:"ti-total-text"},{default:r((()=>[_(p(e.$t("小計:")),1)])),_:1}),v(N,{class:"ti-total-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=m.value)?void 0:e.subtotal)||0)),1)]})),_:1}),v(N,{class:"ti-total-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=m.value)?void 0:e.subtotal)||0)),1)]})),_:1})])),_:1}),v(y,{class:"ti-cart-discount"},{default:r((()=>[v(y,{class:"ti-discount-item"},{default:r((()=>[v(y,null,{default:r((()=>[v(N,{class:"ti-discount-text"},{default:r((()=>[_(p(e.$t("服務費:")),1)])),_:1}),v(N,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=m.value)?void 0:e.service_money)||0)),1)]})),_:1}),v(N,{class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=m.value)?void 0:e.service_money)||0)),1)]})),_:1})])),_:1}),v(y,null,{default:r((()=>{var t;return[v(N,{class:"ti-discount-text"},{default:r((()=>[_(p(e.$t("優惠折扣:")),1)])),_:1}),v(N,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(`-${f(U)((null==(e=m.value)?void 0:e.special_discount)||0)}`),1)]})),_:1}),f(S)((null==(t=m.value)?void 0:t.special_discount)||0)?(n(),c(N,{key:0,class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(`-${f(S)((null==(e=m.value)?void 0:e.special_discount)||0)}`),1)]})),_:1})):K("",!0)]})),_:1})])),_:1}),v(y,{class:"ti-discount-item"},{default:r((()=>[v(y,null,{default:r((()=>[v(N,{class:"ti-discount-text"},{default:r((()=>[_(p(e.$t("消費稅:")),1)])),_:1}),v(N,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=m.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1}),v(N,{class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=m.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1})])),_:1}),v(y,null,{default:r((()=>{var t;return[v(N,{class:"ti-discount-text"},{default:r((()=>[_(p(e.$t("會員折扣:")),1)])),_:1}),v(N,{class:"ti-discount-price"},{default:r((()=>{var e;return[_(p(`-${f(U)((null==(e=m.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1}),f(S)((null==(t=m.value)?void 0:t.total_user_discount_money)||0)?(n(),c(N,{key:0,class:"ti-discount-subPrice"},{default:r((()=>{var e;return[_(p(`-${f(S)((null==(e=m.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1})):K("",!0)]})),_:1})])),_:1})])),_:1}),v(y,{class:"ti-cart-settlement"},{default:r((()=>[v(y,{class:"ti-settlement-total"},{default:r((()=>[v(N,{class:"ti-settlement-text"},{default:r((()=>[_(p(e.$t("應收：")),1)])),_:1}),v(N,{class:"ti-settlement-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=m.value)?void 0:e.total_pay_price)||0)),1)]})),_:1}),v(N,{class:"ti-settlement-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=m.value)?void 0:e.total_pay_price)||0)),1)]})),_:1})])),_:1}),v(T,{class:"ti-settlement-btn",disabled:b.value.length<=0,onClick:L},{default:r((()=>[v(N,null,{default:r((()=>[_(p(e.$t("結賬")),1)])),_:1}),b.value.length>0?(n(),c(N,{key:0,class:"ti-settlement-badge"},{default:r((()=>[_(p(b.value.length),1)])),_:1})):K("",!0)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),v(de,{productItem:d.value,orderId:g.value,totalPayPrice:null==(l=m.value)?void 0:l.total_pay_price,orderList:b.value,onSuccess:t[1]||(t[1]=e=>V())},null,8,["productItem","orderId","totalPayPrice","orderList"]),v(re,{show:s.value,"onUpdate:show":t[2]||(t[2]=e=>s.value=e),orderId:g.value,totalPayPrice:null==(a=m.value)?void 0:a.total_pay_price,onSuccess:t[3]||(t[3]=e=>V(!0))},null,8,["show","orderId","totalPayPrice"])],64)}}},[["__scopeId","data-v-f03455c2"]]);const _e=t({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null}},emits:["update:menuId"],setup(e,{emit:t}){const u=e,s=l(0),i=l(0),o=l([]);a((()=>u.list),(async e=>{if(await q(),!e||0==e.length)return;const t=G().in(this);if(e.map(((e,l)=>{t.select(`#scroll-item-${l}`).boundingClientRect((e=>{if(!e)return;const t=o.value;t[l]=e.width+10,o.value=t})).exec()})),u.menuId>0){const e=u.list.findIndex((e=>e.category_id==u.menuId));e>-1&&d(e)}}),{deep:!0,immediate:!0});const d=e=>{i.value=e,s.value=o.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(o.value[e]+100),t("update:menuId",u.list[e].category_id)};return(e,t)=>{const l=j,a=h,o=C;return n(),c(o,{class:"ti-dish-menu","scroll-left":s.value,"scroll-x":"","enable-flex":"","scroll-with-animation":""},{default:r((()=>[v(a,{class:"ti-menu-content"},{default:r((()=>[(n(!0),w(k,null,I(u.list,((e,t)=>(n(),c(a,{key:t,class:x(["ti-menu-item",{active:t==i.value}]),id:`scroll-item-${t}`,onClick:e=>d(t)},{default:r((()=>[v(l,{class:"ti-menu-title"},{default:r((()=>[_(p(e.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"])}}},[["__scopeId","data-v-4f990a9b"]]),pe=t({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId"],setup(t,{emit:u}){const s=l([]),i=l(0),o=l(0),d=O((()=>{let e=(s.value.find((e=>e.category_id==i.value))||{}).child||[];return e&&e.length>0&&(e=[{name_text:m("全部"),category_id:0}].concat(e)),e}));a((()=>i.value),(()=>{u("update:categoryId",i.value),d&&d.length>0&&(o.value=d.value[0].category_id)}));return(async()=>{try{const t=await e("product.category/index");t.data.list&&(s.value=[{name_text:m("全部"),category_id:0}].concat(t.data.list),i.value=s.value[0].category_id)}catch(t){}})(),(e,t)=>{const l=h;return n(),c(l,{class:"ti-category-box"},{default:r((()=>[v(_e,{list:s.value,menuId:i.value,"onUpdate:menuId":t[0]||(t[0]=e=>i.value=e)},null,8,["list","menuId"]),v(l,{class:"ti-dish-secondary"},{default:r((()=>[(n(!0),w(k,null,I(f(d),((e,t)=>(n(),c(l,{key:t,class:x([{active:e.category_id==o.value},"ti-secondary-item"]),onClick:t=>{return l=e.category_id,o.value=l,void u("update:categoryId",o.value>0?o.value:i.value);var l}},{default:r((()=>[_(p(e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-79344589"]]),fe=t({__name:"goods-detail",props:{show:{type:Boolean,default:!1},productId:{type:Number,default:null}},emits:["update:show","success"],setup(t,{emit:s}){const o=t,b=l({}),g=l(!1),P=l(!1),$=l({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed:[],bag_price:0,delivery:T()?30:40,describe:null});a((()=>o.show),(()=>{o.show&&L()}));const L=async()=>{var t,l,a,u,s,i,d,n,c,r;if(!g.value||o.productId)try{g.value=!0;const v=await(r=o.productId,e("product.product/detail",{product_id:r}));b.value=v.data,$.value.product_id=null==(t=b.value)?void 0:t.product_id,$.value.price=null==(l=b.value)?void 0:l.product_price,$.value.product_price=null==(a=b.value)?void 0:a.product_price,(null==(u=b.value)?void 0:u.product_sku)&&(null==(s=b.value)?void 0:s.product_sku.length)>0&&($.value.product_sku_id=null==(i=b.value)?void 0:i.product_sku[0].product_sku_id),(null==(d=b.value)?void 0:d.product_attr)&&(null==(n=b.value)?void 0:n.product_attr.length)>0&&(null==(c=b.value)||c.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?$.value.attr[t]=0:$.value.attr[t]=null}))),$.value.feed&&$.value.feed.length>0&&($.value.feed=[])}catch(v){}finally{g.value=!1}},D=async()=>{var t,l,a,u,i,o,d,n,c;if(P.value)return;const r={...$.value};r.attr=r.attr.join(","),r.feed=r.feed.join(",");let v=[];(null==(t=b.value)?void 0:t.product_sku)&&(null==(l=b.value)?void 0:l.product_sku.length)>0&&v.push(null==(a=b.value)?void 0:a.product_sku.find((e=>e.product_sku_id==$.value.product_sku_id)).spec_name_text),(null==(u=b.value)?void 0:u.product_attr)&&(null==(i=b.value)?void 0:i.product_attr.length)&&(null==(o=b.value)||o.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0&&(null==e?void 0:e.attribute_value[$.value.attr[t]])&&v.push(null==e?void 0:e.attribute_value[$.value.attr[t]])}))),(null==(d=b.value)?void 0:d.product_feed)&&(null==(n=b.value)?void 0:n.product_feed.length)>0&&(null==(c=b.value)||c.product_feed.map(((e,t)=>{N(t)&&v.push(e.feed_name_text)}))),r.describe=v.join(";"),r.delivery=T()?30:40,r.order_id=R();try{P.value=!0;const t=await function(t){return e("order.cart/add",t)}(r);1==t.code&&(V(t.data.order_id),y({title:t.msg,icon:"none"}),s("update:show",!1),setTimeout((()=>{s("success")}),100))}catch(_){}finally{P.value=!1}},N=e=>$.value.feed.indexOf(e)>-1,B=(e,t)=>$.value.attr[e]==t;return(e,t)=>{const l=M,a=h,y=j,g=C,L=u(i("ti-modal"),d);return n(),c(L,{show:o.show,title:f(m)("商品详情"),confirmLoading:P.value,onCancel:t[0]||(t[0]=e=>s("update:show",!1)),onConfirm:D},{content:r((()=>[v(a,{class:"ti-dialog-content"},{default:r((()=>[v(a,{class:"ti-detail-box"},{default:r((()=>[v(a,{class:"ti-detail-image"},{default:r((()=>{var e,t,a,u;return[(null==(e=b.value)?void 0:e.image)&&(null==(t=b.value)?void 0:t.image[0])&&(null==(a=b.value)?void 0:a.image[0].file_path)?(n(),c(l,{key:0,src:null==(u=b.value)?void 0:u.image[0].file_path,mode:"widthFix"},null,8,["src"])):K("",!0)]})),_:1}),v(a,{class:"ti-detail-con"},{default:r((()=>[v(a,{class:"ti-detail-title text-ellipsis"},{default:r((()=>{var e;return[_(p(null==(e=b.value)?void 0:e.product_name_text),1)]})),_:1}),v(a,{class:"ti-price-box"},{default:r((()=>[v(y,{class:"ti-detail-unit"},{default:r((()=>[_(p(f(m)("單價：")),1)])),_:1}),v(y,{class:"ti-detail-price"},{default:r((()=>{var e;return[_(p(f(U)((null==(e=b.value)?void 0:e.product_price)||0)),1)]})),_:1}),v(y,{class:"ti-detail-subPrice"},{default:r((()=>{var e;return[_(p(f(S)((null==(e=b.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),v(a,{class:"ti-price-box"},{default:r((()=>[v(y,{class:"ti-detail-unit"},{default:r((()=>[_(p(f(m)("單位：")),1)])),_:1}),v(y,{class:"ti-detail-price"},{default:r((()=>{var e;return[_(p(null==(e=b.value)?void 0:e.product_unit_text),1)]})),_:1})])),_:1})])),_:1})])),_:1}),v(a,{class:"ti-detail-specs"},{default:r((()=>[v(g,{"scroll-y":""},{default:r((()=>[v(a,{class:"ti-specs-box"},{default:r((()=>{var e,t,l,u,s,i,o;return[(null==(e=b.value)?void 0:e.product_sku)&&(null==(t=b.value)?void 0:t.product_sku.length)>0?(n(),c(a,{key:0,class:"ti-specs-item"},{default:r((()=>[v(a,{class:"ti-specs-title"},{default:r((()=>[_(p(f(m)("規格")),1)])),_:1}),v(a,{class:"ti-specs-child"},{default:r((()=>{var e;return[(n(!0),w(k,null,I(null==(e=b.value)?void 0:e.product_sku,(e=>(n(),c(a,{key:e.product_sku_id,class:x([{active:e.product_sku_id==$.value.product_sku_id},"ti-child-item"]),onClick:t=>{return l=e.product_sku_id,void($.value.product_sku_id!=l&&($.value.product_sku_id=l));var l}},{default:r((()=>[v(y,{class:"ti-child-name"},{default:r((()=>[_(p(e.spec_name_text),1)])),_:2},1024),v(y,{class:"ti-child-price"},{default:r((()=>[_(p(f(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),v(y,{class:"ti-child-subPrice"},{default:r((()=>[_(p(f(S)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):K("",!0),(null==(l=b.value)?void 0:l.product_attr)&&(null==(u=b.value)?void 0:u.product_attr.length)>0?(n(!0),w(k,{key:1},I(null==(s=b.value)?void 0:s.product_attr,((e,t)=>(n(),c(a,{key:t,class:"ti-specs-item"},{default:r((()=>[v(a,{class:"ti-specs-title"},{default:r((()=>[_(p(e.attribute_name_text),1)])),_:2},1024),v(a,{class:"ti-specs-child"},{default:r((()=>[(n(!0),w(k,null,I(null==e?void 0:e.attribute_value,((e,l)=>(n(),c(a,{key:l,class:x([{active:B(t,l)},"ti-child-item"]),onClick:e=>((e,t)=>{$.value.attr[e]=t})(t,l)},{default:r((()=>[v(y,{class:"ti-child-name"},{default:r((()=>[_(p(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)):K("",!0),(null==(i=b.value)?void 0:i.product_feed)&&(null==(o=b.value)?void 0:o.product_feed.length)>0?(n(),c(a,{key:2,class:"ti-specs-item"},{default:r((()=>[v(a,{class:"ti-specs-title"},{default:r((()=>[_(p(f(m)("加料")),1)])),_:1}),v(a,{class:"ti-specs-child"},{default:r((()=>{var e;return[(n(!0),w(k,null,I(null==(e=b.value)?void 0:e.product_feed,((e,t)=>(n(),c(a,{key:t,class:x([{active:N(t)},"ti-child-item"]),onClick:e=>(e=>{const t=$.value.feed.indexOf(e);t>=0?$.value.feed.splice(t,1):$.value.feed.push(e)})(t)},{default:r((()=>[v(y,{class:"ti-child-name"},{default:r((()=>[_(p(e.feed_name_text),1)])),_:2},1024),v(y,{class:"ti-child-price"},{default:r((()=>[_(p(f(U)((null==e?void 0:e.price)||0)),1)])),_:2},1024),v(y,{class:"ti-child-subPrice"},{default:r((()=>[_(p(f(S)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):K("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmLoading"])}}},[["__scopeId","data-v-6abc2601"]]),me=t({__name:"dish-list",emits:["success"],setup(t,{emit:s}){const o=l(!1),d=l({category_id:null,page:1,list_rows:10}),b=l([]),g=l(!1),L=l(),V=l(!1);a((()=>d.value.category_id),(()=>{B()}));const D=()=>{s("success")},N=()=>{V.value&&(d.value.page+=1,O())},B=()=>{d.value.page=1,O(!0)},O=async t=>{var l,a,u,s,i,o;if(g.value)return;const n={...d.value};n.category_id||(n.category_id=null);try{t&&(g.value=!0);const c=await function(t){return e("product.product/index",t,{isLoading:!1})}(n);1==d.value.page&&(b.value=[]),b.value=b.value.concat((null==(a=null==(l=c.data)?void 0:l.list)?void 0:a.data)||[]),V.value=(null==(s=null==(u=c.data)?void 0:u.list)?void 0:s.last_page)>(null==(o=null==(i=c.data)?void 0:i.list)?void 0:o.current_page)}catch(c){}finally{t&&(g.value=!1)}};return B(),(e,t)=>{const l=u(i("ti-loading"),P),a=M,s=j,B=h,O=u(i("ti-empty-data"),$),T=C;return n(),w(k,null,[v(B,{class:"ti-dish-box"},{default:r((()=>[v(pe,{categoryId:d.value.category_id,"onUpdate:categoryId":t[0]||(t[0]=e=>d.value.category_id=e)},null,8,["categoryId"]),v(B,{class:"ti-dish-list"},{default:r((()=>[v(T,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:N},{default:r((()=>[g.value?(n(),c(l,{key:0})):b.value&&b.value.length>0?(n(),w(k,{key:1},[v(B,{class:"ti-dish-goods"},{default:r((()=>[(n(!0),w(k,null,I(b.value,((e,t)=>(n(),c(B,{key:t,class:x([{"sold-out":e.product_stock<=0},"ti-goods-item"]),onClick:t=>(e=>{if(e.product_stock<=0)return y({title:m("已售罄"),icon:"none"});o.value=!0,L.value=e.product_id})(e)},{default:r((()=>[v(B,{class:"ti-goods-image"},{default:r((()=>[e.image&&e.image[0]&&e.image[0].file_path?(n(),c(a,{key:0,src:e.image[0].file_path,mode:"widthFix"},null,8,["src"])):K("",!0),v(s,{class:"sold-out-text"},{default:r((()=>[_(p(f(m)("已售罄")),1)])),_:1})])),_:2},1024),v(B,{class:"ti-goods-content"},{default:r((()=>[v(B,{class:"ti-goods-title"},{default:r((()=>[_(p(e.product_name_text),1)])),_:2},1024),v(B,{class:"ti-price-box"},{default:r((()=>[v(s,{class:"ti-goods-price"},{default:r((()=>[_(p(f(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),v(s,{class:"ti-goods-subPrice"},{default:r((()=>[_(p(f(S)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),v(l,{status:V.value?"loading":"no-more"},null,8,["status"])],64)):(n(),c(O,{key:2}))])),_:1})])),_:1})])),_:1}),v(fe,{show:o.value,"onUpdate:show":t[1]||(t[1]=e=>o.value=e),productId:L.value,onSuccess:D},null,8,["show","productId"])],64)}}},[["__scopeId","data-v-7e04d9ee"]]),ye=t({__name:"index",setup(e){const t=l();H((()=>{J()}));const a=()=>{var e;null==(e=t.value)||e.getCartData()};return(e,l)=>{const u=h,s=Q("ti-layout");return n(),c(s,null,{default:r((()=>[v(u,{class:"ti-index"},{default:r((()=>[v(ve,{ref_key:"cartRef",ref:t},null,512),v(me,{onSuccess:a})])),_:1})])),_:1})}}},[["__scopeId","data-v-5474dea1"]]);export{ye as default};
