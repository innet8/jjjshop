import{_ as e,r as t,w as l,a,b as u,c as s,d as i,e as d,o,f as n,g as c,h as r,i as v,t as _,u as p,$ as f,s as m,j as y,k as h,l as b,m as g,F as w,n as k,p as I,S as x,q as C,v as $,x as P,y as L,z as U,A as S,B as V,C as j,D as N,E as K,G as D,H as B,I as O,J as T,K as E,L as F,M as z,N as Z,O as A,P as R,Q as M,R as q,T as G,U as H,V as J,W as Q,X as W}from"./index-869f311b.js";import{f as X,a as Y,b as ee,c as te,g as le,d as ae,e as ue,h as se,i as ie,j as de,k as oe,l as ne,m as ce,n as re,o as ve,p as _e}from"./product.e73dfde0.js";import{_ as pe}from"./u-switch.e55fcb93.js";import{f as fe,a as me,g as ye,b as he,c as be}from"./payment.2fe1ab4c.js";const ge=e({__name:"modify-price",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:h}){const b=e,g=t(!1),w=t("");l((()=>b.show),(()=>{b.show&&(w.value="")}));const k=e=>{e&&(w.value+=e)},I=async()=>{var e;if(w.value<=0)return m({title:f("請輸入價格"),icon:"none"});try{g.value=!0;const t=await X({order_product_id:null==(e=b.productItem)?void 0:e.order_product_id,price:w.value});1==t.code&&(m({title:t.msg,icon:"none"}),h("update:show",!1),h("success"))}catch(t){}finally{g.value=!1}};return(t,l)=>{const m=y,x=a(s("ti-input"),u),C=a(s("ti-keyboard"),i),$=a(s("ti-modal"),d);return o(),n($,{show:b.show,title:p(f)("價格")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-modify-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(_((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-modify-input"},{default:c((()=>[r(x,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),placeholder:p(f)("請輸入價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(C,{primaryLoading:g.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>h("update:show",!1)),onClear:l[2]||(l[2]=e=>w.value=""),onInput:k,onConfirm:I},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-574c9bdc"]]),we=e({__name:"remark",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:u}){const i=e,g=t(!1),w=t("");l((()=>i.show),(()=>{var e;i.show&&(w.value=(null==(e=i.productItem)?void 0:e.remark)||"")}));const k=async()=>{var e;if(!w.value)return m({title:f("请输入備註"),icon:"none"});try{g.value=!0;const t=await Y({order_product_id:null==(e=i.productItem)?void 0:e.order_product_id,remark:w.value.trim()});1==t.code&&(m({title:t.msg,icon:"none"}),u("update:show",!1),u("success"))}catch(t){}finally{g.value=!1}};return(t,l)=>{const m=y,I=b,x=a(s("ti-button"),h),C=a(s("ti-modal"),d);return o(),n(C,{show:i.show,title:p(f)("備註")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-remark-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(_((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-remark-textarea"},{default:c((()=>[r(I,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),"placeholder-style":"color:rgba(16,10,5,.3)",placeholder:p(f)("请输入")},null,8,["modelValue","placeholder"])])),_:1}),r(m,{class:"ti-remark-num"},{default:c((()=>{var e;return[v(_((null==(e=w.value)?void 0:e.trim().length)||0)+"/50 ",1)]})),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(x,{onClick:l[1]||(l[1]=e=>u("update:show",!1))},{default:c((()=>[v(_(p(f)("退出")),1)])),_:1}),r(x,{onClick:l[2]||(l[2]=e=>w.value="")},{default:c((()=>[v(_(p(f)("清空")),1)])),_:1}),r(x,{loading:g.value,type:"primary",onClick:k},{default:c((()=>[v(_(p(f)("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-3c09f473"]]),ke=e({__name:"withdrawal",props:{show:{type:Boolean,default:!1},productItem:{type:Object,default:()=>({})}},emits:["update:show","success"],setup(e,{emit:h}){const b=e,x=t(!1),C=t(""),$=t([f("等待時間長"),f("口味不好"),f("菜賣光了")]),P=t(0);l((()=>b.show),(()=>{var e;b.show&&(C.value=(null==(e=b.productItem)?void 0:e.total_num)||"")}));const L=e=>{e&&(C.value+=e)},U=async()=>{var e,t;if(C.value<=0)return m({title:f("請輸入價格"),icon:"none"});try{x.value=!0;const l=await ee({order_id:null==(e=b.productItem)?void 0:e.order_id,order_product_id:null==(t=b.productItem)?void 0:t.order_product_id,num:C.value,return_reason:$.value[P.value]});1==l.code&&(m({title:l.msg,icon:"none"}),h("update:show",!1),h("success"))}catch(l){}finally{x.value=!1}};return(t,l)=>{const m=y,S=a(s("ti-input"),u),V=a(s("ti-keyboard"),i),j=a(s("ti-modal"),d);return o(),n(j,{show:b.show,title:p(f)("退菜")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-withdrawal-title text-ellipsis"},{default:c((()=>{var t,l,a;return[v(_((null==(t=e.productItem)?void 0:t.product_name_text)||(null==(a=null==(l=e.productItem)?void 0:l.product)?void 0:a.product_name_text)),1)]})),_:1}),r(m,{class:"ti-withdrawal-list"},{default:c((()=>[(o(!0),g(w,null,k($.value,((e,t)=>(o(),n(m,{key:t,class:I([{active:t==P.value},"ti-withdrawal-item"]),onClick:e=>(e=>{P.value=e})(t)},{default:c((()=>[v(_(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(m,{class:"ti-withdrawal-input"},{default:c((()=>[r(S,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),placeholder:p(f)("请输入退菜數量"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),footer:c((()=>[r(m,{class:"ti-dialog-btn"},{default:c((()=>[r(V,{primaryLoading:x.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[1]||(l[1]=e=>h("update:show",!1)),onClear:l[2]||(l[2]=e=>C.value=""),onInput:L,onConfirm:U},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-98d0bf8e"]]),Ie=e({__name:"cancel-all",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show","success"],setup(e,{emit:l}){const u=e,i=t(!1),p=async()=>{if(!i.value)try{i.value=!0;const e=await te({order_id:u.orderId});m({title:e.msg,icon:"none"}),l("update:show",!1),l("success")}catch(e){}finally{i.value=!1}};return(t,f)=>{const m=y,h=x,b=a(s("ti-modal"),d);return o(),n(b,{class:"ti-action-tips",title:t.$t("溫馨提示"),show:u.show,confirmLoading:i.value,onCancel:f[0]||(f[0]=e=>l("update:show",!1)),onConfirm:p},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[u.sendKitchen&&e.sendKitchen.length>0?(o(),g(w,{key:0},[r(m,{class:"ti-cancel-title"},{default:c((()=>[v(_(t.$t("此單有商品已送廚，是否取消此筆交易？")),1)])),_:1}),r(m,{class:"ti-cancel-all"},{default:c((()=>[r(h,{"scroll-y":""},{default:c((()=>[r(m,{class:"ti-cancel-list"},{default:c((()=>[(o(!0),g(w,null,k(u.sendKitchen,((e,t)=>(o(),n(m,{key:t,class:"ti-cancel-item"},{default:c((()=>[v(_(null==e?void 0:e.product_name_text),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})],64)):(o(),g(w,{key:1},[v(_(t.$t("是否取消此筆交易？")),1)],64))])),_:1})])),_:1},8,["title","show","confirmLoading"])}}},[["__scopeId","data-v-9ce42bf3"]]),xe=e({__name:"order-pickup",props:{show:{type:Boolean,default:!1},sendKitchen:{type:Object,default:()=>[]}},emits:["update:show"],setup(e,{emit:u}){const i=e,d=t(),b=t(!1),I=t(!1),j=t(),N=t({page:1,list_rows:20}),K=t(!1),D=t([]),B=t(!1);l((()=>i.show),(()=>{i.show&&O()}));const O=()=>{N.value.page=1,E(!0)},T=()=>{B.value&&(N.value.page+=1,E())},E=async e=>{var t,l,a,u,s;if(!K.value)try{e&&(K.value=!0);const i=await le(N.value);1==N.value.page&&(D.value=[]),D.value=D.value.concat((null==(t=i.data)?void 0:t.productList)||[]),B.value=(null==(a=null==(l=i.data)?void 0:l.list)?void 0:a.last_page)>(null==(s=null==(u=i.data)?void 0:u.list)?void 0:s.current_page)}catch(i){}finally{e&&(K.value=!1)}};return(t,l)=>{const N=a(s("ti-loading"),C),E=V,F=y,z=a(s("ti-button"),h),Z=a(s("ti-empty-data"),$),A=x,R=a(s("ti-drawer"),P);return o(),n(F,null,{default:c((()=>[r(R,{show:i.show,isConfirmShow:!1,title:p(f)("取單"),onCancel:l[0]||(l[0]=e=>u("update:show",!1))},{content:c((()=>[r(F,{class:"ti-order-pickup"},{default:c((()=>[r(A,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:T},{default:c((()=>[K.value?(o(),n(N,{key:0})):D.value&&D.value.length>0?(o(),g(w,{key:1},[r(F,{class:"ti-pickup-list"},{default:c((()=>[(o(!0),g(w,null,k(D.value,((e,t)=>(o(),n(F,{key:t,class:"ti-pickup-item"},{default:c((()=>[r(F,{class:"ti-pickup-top"},{default:c((()=>[r(F,{class:"ti-pickup-left"},{default:c((()=>[r(F,{class:"ti-price-box"},{default:c((()=>[r(E,{class:"ti-price-text"},{default:c((()=>[v(_(p(f)("訂單總價：")),1)])),_:1}),r(E,{class:"ti-pickup-price"},{default:c((()=>[v(_(p(L)(null==e?void 0:e.total_price)),1)])),_:2},1024),r(E,{class:"ti-pickup-subPrice"},{default:c((()=>[v(_(p(U)(null==e?void 0:e.total_price)),1)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-time"},{default:c((()=>[r(E,null,{default:c((()=>[v(_(p(f)("掛單時間：")),1)])),_:1}),r(E,null,{default:c((()=>[v(_(null==e?void 0:e.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-action"},{default:c((()=>[r(F,{class:"ti-cancel-all"},{default:c((()=>[r(z,{type:"danger",onClick:t=>{return l=e.order_id,j.value=l,void(I.value=!0);var l}},{default:c((()=>[v(_(p(f)("整單取消")),1)])),_:2},1032,["onClick"])])),_:2},1024),r(F,null,{default:c((()=>[r(z,{type:"primary",loading:d.value==e.order_id&&b.value,onClick:t=>(async e=>{if(!b.value){d.value=e;try{b.value=!0;const t=await ae({order_id:e});m({title:t.msg,icon:"none"}),u("update:show",!1),S(e),setTimeout((()=>{u("success")}),100)}catch(t){}finally{b.value=!1}}})(e.order_id)},{default:c((()=>[v(_(p(f)("取單")),1)])),_:2},1032,["loading","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),r(F,{class:"ti-pickup-goods"},{default:c((()=>[r(F,{class:"ti-goods-head"},{default:c((()=>[r(F,null,{default:c((()=>[v(_(p(f)("商品名称")),1)])),_:1}),r(F,null,{default:c((()=>[v(_(p(f)("金額")),1)])),_:1}),r(F,null,{default:c((()=>[v(_(p(f)("數量")),1)])),_:1})])),_:1}),r(F,{class:"ti-goods-body"},{default:c((()=>[(o(!0),g(w,null,k((null==e?void 0:e.product)||[],((e,t)=>(o(),n(F,{key:t,class:"ti-goods-item"},{default:c((()=>[r(F,null,{default:c((()=>[v(_(null==e?void 0:e.product_name_text),1)])),_:2},1024),r(F,null,{default:c((()=>[r(E,{class:"ti-goods-price"},{default:c((()=>[v(_(p(L)(null==e?void 0:e.product_price)),1)])),_:2},1024),r(E,{class:"ti-goods-subPrice"},{default:c((()=>[v(_(p(U)(null==e?void 0:e.product_price)),1)])),_:2},1024)])),_:2},1024),r(F,null,{default:c((()=>[v(_(`x ${null==e?void 0:e.total_num}`),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(N,{status:B.value?"loading":"no-more"},null,8,["status"])],64)):(o(),n(Z,{key:2}))])),_:1})])),_:1})])),_:1},8,["show","title"]),r(Ie,{show:I.value,"onUpdate:show":l[1]||(l[1]=e=>I.value=e),orderId:j.value,sendKitchen:e.sendKitchen,onSuccess:l[2]||(l[2]=e=>O())},null,8,["show","orderId","sendKitchen"])])),_:1})}}},[["__scopeId","data-v-6e0689d9"]]),Ce=e({__name:"preferential",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null},totalPayPrice:{type:[Number,String],default:0}},emits:["update:show","success"],setup(e,{emit:b}){const x=e,C=t({type:1,money:"",rate:"",discountType:1}),$=t(!1);l((()=>x.show),(()=>{C.value={type:1,money:"",rate:"",discountType:1}})),l((()=>C.value.type),((e,t)=>{1==t?C.value.money="":2==t?C.value.rate="":3==t&&(C.value.discountType=1)}));const P=e=>{C.value.discountType=e.detail.value},S=()=>{1==C.value.type?C.value.money="":2==C.value.type&&(C.value.rate="")},B=e=>{e&&(1==C.value.type?C.value.money+=e:2==C.value.type&&(C.value.rate+=e))},O=async()=>{const e={...C.value,order_id:x.orderId};if(!$.value){if(1==e.type){if(e.money<=0)return m({title:f("请输入實付價格"),icon:"none"})}else if(2==e.type&&e.rate<=0)return m({title:f("请输入優惠折扣"),icon:"none"});try{$.value=!0;const t=await ue(e);m({title:t.msg,icon:"none"}),b("update:show",!1),b("success")}catch(t){}finally{$.value=!1}}};return(t,l)=>{const m=y,T=V,E=a(s("ti-input"),u),F=N,z=K,Z=D,A=a(s("ti-button"),h),R=a(s("ti-keyboard"),i),M=a(s("ti-modal"),d);return o(),n(M,{show:x.show,title:p(f)("優惠折扣")},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-preferential-box"},{default:c((()=>[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(_(p(f)("當前價格")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(T,{class:"ti-preferential-price"},{default:c((()=>[v(_(p(L)(e.totalPayPrice)),1)])),_:1}),r(T,{class:"ti-preferential-subPrice"},{default:c((()=>[v(_(p(U)(e.totalPayPrice)),1)])),_:1})])),_:1}),r(m,{class:"ti-preferential-label"},{default:c((()=>[v(_(p(f)("優惠方式")),1)])),_:1}),r(m,{class:"ti-preferential-input ti-preferential-type"},{default:c((()=>[(o(!0),g(w,null,k([p(f)("改價"),p(f)("折扣"),p(f)("抹零")],((e,t)=>(o(),n(m,{key:t,class:I([{active:C.value.type==t+1},"ti-preferential-type-item"]),onClick:e=>C.value.type=t+1},{default:c((()=>[v(_(e),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),1==C.value.type?(o(),g(w,{key:0},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(_(p(f)("實付價格")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(E,{modelValue:C.value.money,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value.money=e),placeholder:p(f)("请输入實付價格"),focus:!0},null,8,["modelValue","placeholder"])])),_:1})],64)):j("",!0),2==C.value.type?(o(),g(w,{key:1},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(_(p(f)("優惠折扣")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(E,{modelValue:C.value.rate,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value.rate=e),placeholder:p(f)("请输入優惠折扣"),focus:!0},{right:c((()=>[r(m,{class:"ti-preferential-percentage"},{default:c((()=>[v("%")])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})],64)):j("",!0),3==C.value.type?(o(),g(w,{key:2},[r(m,{class:"ti-preferential-label"},{default:c((()=>[v(_(p(f)("抹零方式")),1)])),_:1}),r(m,{class:"ti-preferential-input"},{default:c((()=>[r(Z,{class:"ti-type-radio",onChange:P},{default:c((()=>[r(z,null,{default:c((()=>[r(F,{value:"1",color:"#ffbe00",checked:"true"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(_(p(f)("抹分")),1)])),_:1})])),_:1}),r(z,null,{default:c((()=>[r(F,{value:"2",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(_(p(f)("抹角")),1)])),_:1})])),_:1}),r(z,null,{default:c((()=>[r(F,{value:"3",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(_(p(f)("四捨五入到角")),1)])),_:1})])),_:1}),r(z,null,{default:c((()=>[r(F,{value:"4",color:"#ffbe00"}),r(T,{class:"ti-radio-text"},{default:c((()=>[v(_(p(f)("四捨五入到元")),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):j("",!0)])),_:1})])),_:1})])),footer:c((()=>[3==C.value.type?(o(),n(m,{key:0,class:"ti-dialog-btn"},{default:c((()=>[r(A,{onClick:l[2]||(l[2]=e=>b("update:show",!1))},{default:c((()=>[v(_(p(f)("退出")),1)])),_:1}),r(A,{loading:$.value,type:"primary",onClick:O},{default:c((()=>[v(_(p(f)("确定")),1)])),_:1},8,["loading"])])),_:1})):(o(),n(m,{key:1,class:"ti-dialog-btn ti-preferential-keyboard"},{default:c((()=>[r(R,{primaryLoading:$.value,isDoubleZero:!0,isCross:!1,isDrop:!0,onExit:l[3]||(l[3]=e=>b("update:show",!1)),onClear:S,onInput:B,onConfirm:O},null,8,["primaryLoading"])])),_:1}))])),_:1},8,["show","title"])}}},[["__scopeId","data-v-9c69711b"]]),$e=e({__name:"action-list",props:{productItem:{type:Object,default:()=>({})},orderId:{type:[Number,String],default:null},orderList:{type:Array,default:()=>[]},totalPayPrice:{type:[Number,String],default:0}},emits:["success"],setup(e,{emit:l}){const u=e,i=B((()=>u.orderList&&u.orderList.length>0)),n=B((()=>u.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)>0)))),h=B((()=>u.orderList.filter((e=>(null==e?void 0:e.is_send_kitchen)<=0)))),b=t(O()),k=t(!1),I=t(!1),x=t(!1),C=t(!1),$=t(!1),P=t(!1),L=t(!1),U=t(!1),S=t(!1),j=t(!1),N=t(!1),K=t(!1),D=t(!1),z=()=>{u.orderList&&u.orderList.length>0?D.value=!0:K.value=!0},Z=e=>{T(e)},A=async()=>{var e;if(!C.value)try{C.value=!0;const t=await se({order_product_id:null==(e=u.productItem)?void 0:e.order_product_id});1==t.code&&(m({title:t.msg,icon:"none"}),l("success"))}catch(t){}finally{x.value=!1,C.value=!1}},R=()=>{E(),setTimeout((()=>{l("success")}),100)},M=async()=>{if(!P.value)try{P.value=!0;const e=await ie({delivery:b.value?30:40,order_id:u.orderId});m({title:e.msg,icon:"none"}),$.value=!1,l("success")}catch(e){$.value=!1}finally{P.value=!1}},q=async()=>{if(!I.value)try{I.value=!0;const e=await de({order_id:u.orderId});1==e.code&&(m({title:e.msg,icon:"none"}),E(),setTimeout((()=>{l("success")}),100))}catch(e){}finally{k.value=!1,I.value=!1}};return(t,m)=>{const B=V,O=a(s("u-switch"),pe),T=y,E=F,G=a(s("ti-modal"),d);return o(),g(w,null,[r(T,{class:"ti-action-box"},{default:c((()=>[r(T,{class:"ti-action-btn"},{default:c((()=>[r(T,{class:"ti-action-pack"},{default:c((()=>[r(B,{class:"ti-pack-text"},{default:c((()=>[v(_(p(f)("打包")),1)])),_:1}),r(O,{modelValue:b.value,"onUpdate:modelValue":m[0]||(m[0]=e=>b.value=e),activeColor:"#FFBE00",size:"20",onChange:Z},null,8,["modelValue"])])),_:1}),r(T,{class:"ti-btn-box"},{default:c((()=>{var t,l,a;return[r(E,{class:"ti-btn-item",disabled:!(e.productItem&&0==(null==(t=e.productItem)?void 0:t.is_send_kitchen)),onClick:m[1]||(m[1]=e=>x.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("删除")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:0!=(null==(l=e.productItem)?void 0:l.is_send_kitchen),onClick:m[2]||(m[2]=e=>S.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("备注")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:!p(i),onClick:m[3]||(m[3]=e=>U.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("價格")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:!p(i),onClick:m[4]||(m[4]=e=>k.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("掛單")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:!1,onClick:z},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("取單")),1)])),_:1})])),_:1}),r(E,{class:"ti-btn-item danger",disabled:!p(i),onClick:m[5]||(m[5]=e=>(async()=>{L.value=!0})())},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("整單取消")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:0==p(h).length,onClick:m[6]||(m[6]=e=>$.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("送廚")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item danger",disabled:!(e.productItem&&1==(null==(a=e.productItem)?void 0:a.is_send_kitchen)),onClick:m[7]||(m[7]=e=>j.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("退菜")),1)])),_:1})])),_:1},8,["disabled"]),r(E,{class:"ti-btn-item",disabled:!p(i),onClick:m[8]||(m[8]=e=>N.value=!0)},{default:c((()=>[r(B,{class:"text-ellipsis"},{default:c((()=>[v(_(p(f)("優惠折扣")),1)])),_:1})])),_:1},8,["disabled"])]})),_:1})])),_:1})])),_:1}),r(G,{class:"ti-action-tips",show:x.value,"onUpdate:show":m[9]||(m[9]=e=>x.value=e),confirmLoading:C.value,title:p(f)("溫馨提示"),content:p(f)("是否删除此商品？"),onConfirm:A},null,8,["show","confirmLoading","title","content"]),r(G,{class:"ti-action-tips",show:$.value,"onUpdate:show":m[10]||(m[10]=e=>$.value=e),confirmLoading:P.value,title:p(f)("溫馨提示"),content:p(f)("是否将商品送廚？"),onConfirm:M},null,8,["show","confirmLoading","title","content"]),r(G,{class:"ti-action-tips",show:k.value,"onUpdate:show":m[11]||(m[11]=e=>k.value=e),confirmLoading:I.value,title:p(f)("溫馨提示"),content:p(f)("是否将商品挂单？"),onConfirm:q},null,8,["show","confirmLoading","title","content"]),r(Ie,{show:L.value,"onUpdate:show":m[12]||(m[12]=e=>L.value=e),sendKitchen:p(n),orderId:u.orderId,onSuccess:R},null,8,["show","sendKitchen","orderId"]),r(ge,{show:U.value,"onUpdate:show":m[13]||(m[13]=e=>U.value=e),productItem:u.productItem,onSuccess:m[14]||(m[14]=e=>l("success"))},null,8,["show","productItem"]),r(we,{show:S.value,"onUpdate:show":m[15]||(m[15]=e=>S.value=e),productItem:u.productItem,onSuccess:m[16]||(m[16]=e=>l("success"))},null,8,["show","productItem"]),r(xe,{show:K.value,"onUpdate:show":m[17]||(m[17]=e=>K.value=e),sendKitchen:p(n),onSuccess:m[18]||(m[18]=e=>l("success"))},null,8,["show","sendKitchen"]),r(G,{class:"ti-action-tips",show:D.value,"onUpdate:show":m[19]||(m[19]=e=>D.value=e),title:p(f)("溫馨提示"),content:p(f)("请先将购物车内的商品挂单或结账后再取单"),onConfirm:m[20]||(m[20]=e=>D.value=!1)},null,8,["show","title","content"]),r(ke,{show:j.value,"onUpdate:show":m[21]||(m[21]=e=>j.value=e),productItem:u.productItem,onSuccess:m[22]||(m[22]=e=>l("success"))},null,8,["show","productItem"]),r(Ce,{show:N.value,"onUpdate:show":m[23]||(m[23]=e=>N.value=e),orderId:u.orderId,totalPayPrice:e.totalPayPrice,onSuccess:m[24]||(m[24]=e=>l("success"))},null,8,["show","orderId","totalPayPrice"])],64)}}},[["__scopeId","data-v-d3cd7f3f"]]),Pe=e({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})}},emits:["change"],setup(e,{emit:l}){const u=e,i=t(!1),d=async e=>{var t,a;const s={order_product_id:null==(t=u.productItem)?void 0:t.order_product_id,product_num:null==(a=u.productItem)?void 0:a.total_num,type:e};"up"==e?s.product_num+=1:s.product_num-=1;try{i.value=!0;1==(await oe(s)).code&&l("change")}catch(d){}finally{i.value=!1}};return(e,t)=>{const l=a(s("uni-icons"),z),p=F,f=y;return o(),n(f,{class:"ti-number-box",onClick:t[2]||(t[2]=Z((()=>{}),["stop"]))},{default:c((()=>{var e,a,s,o,n,m;return[r(p,{class:"ti-number-btn ti-number-minus",disabled:(null==(e=u.productItem)?void 0:e.total_num)<=1||i.value||(null==(a=u.productItem)?void 0:a.is_send_kitchen)>0,onClick:t[0]||(t[0]=e=>d("down"))},{default:c((()=>[r(l,{"custom-prefix":"iconfont",type:"icon-minus",size:"16"})])),_:1},8,["disabled"]),r(f,{class:"ti-number-input"},{default:c((()=>{var e;return[v(_((null==(e=u.productItem)?void 0:e.total_num)||1),1)]})),_:1}),r(p,{class:"ti-number-btn ti-number-plus",disabled:(null==(s=u.productItem)?void 0:s.total_num)>=(null==(n=null==(o=u.productItem)?void 0:o.product)?void 0:n.product_stock)||i.value||(null==(m=u.productItem)?void 0:m.is_send_kitchen)>0,onClick:t[1]||(t[1]=e=>d("up"))},{default:c((()=>[r(l,{type:"plusempty",size:"16"})])),_:1},8,["disabled"])]})),_:1})}}},[["__scopeId","data-v-1f4f3df5"]]),Le=e({__name:"member",props:{show:{type:Boolean,default:!1},orderId:{type:[Number,String],default:null}},emits:["update:show","change"],setup(e,{emit:f}){const m=e,b=t(!1),g=t(""),w=t({}),k=t(!1);l((()=>m.show),(()=>{m.show&&(g.value="",w.value={})}));const I=()=>{f("update:show",!1),f("change",null)},x=e=>{e&&(g.value+=e)},C=async()=>{try{b.value=!0;const e=await fe({mobile:g.value,order_id:m.orderId});w.value={...e.data.user,pay_price:e.data.total_product_pay_price}}catch(e){}finally{b.value=!1}},$=async()=>{var e;try{k.value=!0;await me({order_id:m.orderId,user_id:(null==(e=w.value)?void 0:e.user_id)||0});f("update:show",!1),f("change",w.value)}catch(t){}finally{k.value=!1}};return(e,t)=>{const l=a(s("ti-input"),u),f=a(s("ti-button"),h),P=y,S=V,N=a(s("ti-keyboard"),i),K=a(s("ti-modal"),d);return o(),n(K,{show:m.show,title:e.$t("会员")},{content:c((()=>[r(P,{class:"ti-dialog-content"},{default:c((()=>{var a;return[r(P,{class:"ti-payment-input"},{default:c((()=>[r(l,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:e.$t("請輸入會員手機號/ID"),focus:!0},null,8,["modelValue","placeholder"]),r(f,{loading:b.value,type:"primary",onClick:C},{default:c((()=>[v(_(e.$t("查找")),1)])),_:1},8,["loading"])])),_:1}),(null==(a=w.value)?void 0:a.user_id)?(o(),n(P,{key:0,class:"ti-payment-member"},{default:c((()=>[r(P,{class:"ti-member-list"},{default:c((()=>[r(P,{class:"ti-member-item"},{default:c((()=>[r(P,{class:"ti-member-head"},{default:c((()=>[v(_(e.$t("暱稱")),1)])),_:1}),r(P,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_(null==(e=w.value)?void 0:e.nickName),1)]})),_:1})])),_:1}),r(P,{class:"ti-member-item"},{default:c((()=>[r(P,{class:"ti-member-head"},{default:c((()=>[v(_(e.$t("會員卡/等級")),1)])),_:1}),r(P,{class:"ti-member-name"},{default:c((()=>{var e,t,l,a;return[v(_(`${null==(t=null==(e=w.value)?void 0:e.card)?void 0:t.card_name}/${null==(a=null==(l=w.value)?void 0:l.grade)?void 0:a.name}`),1)]})),_:1})])),_:1}),r(P,{class:"ti-member-item"},{default:c((()=>[r(P,{class:"ti-member-head"},{default:c((()=>[v(_(e.$t("餘額")),1)])),_:1}),r(P,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_((null==(e=w.value)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),r(P,{class:"ti-member-item"},{default:c((()=>[r(P,{class:"ti-member-head"},{default:c((()=>[v(_(e.$t("積分")),1)])),_:1}),r(P,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_((null==(e=w.value)?void 0:e.points)||0),1)]})),_:1})])),_:1})])),_:1}),r(P,{class:"ti-member-discount"},{default:c((()=>[r(S,{class:"ti-discount-title"},{default:c((()=>[v(_(e.$t("會員折扣應收金額")),1)])),_:1}),r(S,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=w.value)?void 0:e.pay_price)||0)),1)]})),_:1}),r(S,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=w.value)?void 0:e.pay_price)||0)),1)]})),_:1})])),_:1})])),_:1})):j("",!0)]})),_:1})])),footer:c((()=>[r(P,{class:"ti-dialog-btn"},{default:c((()=>[r(N,{primaryLoading:k.value,isDoubleZero:!1,isCross:!0,isDrop:!0,onExit:I,onClear:t[1]||(t[1]=e=>g.value=""),onInput:x,onConfirm:$},null,8,["primaryLoading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-a6572711"]]),Ue=e({__name:"payment-type",props:{show:{type:Boolean,default:!1},totalPayPrice:{type:[Number,String],default:0},orderId:{type:[Number,String],default:null}},emits:["update:show"],setup(e,{emit:u}){const i=e,f=t(!1),b=t({}),x=t([]),C=t({delivery:null,pay_type:"40",user_id:null,order_id:null}),P=t(!1),S=t(!1);l((()=>i.show),(()=>{i.show&&(x.value=[],C.value.pay_type="40")})),l((()=>C.value.pay_type),(()=>{i.show&&(C.value.pay_type>0||(x.value&&x.value.length>0?C.value.pay_type=x.value[0].value:ye().then((e=>{x.value=e.data||[],C.value.pay_type=x.value[0].value}))))})),l((()=>b.value),(()=>{u("success")}),{deep:!0});const B=async()=>{try{await me({order_id:i.orderId,user_id:0});b.value=null}catch(e){}},T=e=>{b.value=e},F=e=>{C.value.pay_type=e.detail.value},z=async()=>{if(!S.value)try{S.value=!0;const e=await he({order_id:i.orderId});m({title:e.msg,icon:"none"})}catch(e){}finally{S.value=!1}},Z=async()=>{var e;if(P.value)return;const t={...C.value};t.delivery=O()?30:40,t.order_id=i.orderId,t.user_id=null==(e=b.value)?void 0:e.user_id;try{P.value=!0;const e=await be(t);m({title:e.msg,icon:"none"}),u("update:show",!1),E(),setTimeout((()=>{u("success")}),100)}catch(l){}finally{P.value=!1}};return(t,l)=>{const m=V,O=y,E=N,M=K,q=D,G=R,H=a(s("ti-empty-data"),$),J=a(s("ti-button"),h),Q=a(s("ti-modal"),d);return o(),n(Q,{show:i.show,title:t.$t("結賬")},{content:c((()=>[r(O,{class:"ti-dialog-content"},{default:c((()=>{var a;return[r(O,{class:"ti-payment-money"},{default:c((()=>[r(m,{class:"ti-payment-label"},{default:c((()=>[v(_(t.$t("應收金額")),1)])),_:1}),r(m,{class:"ti-payment-price"},{default:c((()=>[v(_(p(L)(e.totalPayPrice)),1)])),_:1}),r(m,{class:"ti-payment-subPrice"},{default:c((()=>[v(_(p(U)(e.totalPayPrice)),1)])),_:1})])),_:1}),r(O,{class:"ti-payment-type"},{default:c((()=>[r(O,{class:"ti-type-label"},{default:c((()=>[v(_(t.$t("收款方式")),1)])),_:1}),r(q,{class:"ti-type-radio",onChange:F},{default:c((()=>[r(M,null,{default:c((()=>[r(E,{value:"40",color:"#ffbe00",checked:"true"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(_(t.$t("現金")),1)])),_:1})])),_:1}),r(M,null,{default:c((()=>[r(E,{value:"10",color:"#ffbe00"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(_(t.$t("餘額")),1)])),_:1})])),_:1}),r(M,null,{default:c((()=>[r(E,{value:"",color:"#ffbe00"}),r(m,{class:"ti-radio-text"},{default:c((()=>[v(_(t.$t("其他方式")),1)])),_:1})])),_:1})])),_:1})])),_:1}),"40"!=C.value.pay_type&&"10"!=C.value.pay_type?(o(),n(O,{key:0,class:"ti-payment-other"},{default:c((()=>[r(O,{class:"ti-other-title"},{default:c((()=>[v(_(t.$t("用戶通過店內掃碼等方式進行支付，確認用戶支付完成後，點擊確認即可完成付款操作。")),1)])),_:1}),x.value&&x.value.length>0?(o(),n(O,{key:0,class:"ti-other-list"},{default:c((()=>[(o(!0),g(w,null,k(x.value,(e=>(o(),n(O,{key:e.value,class:I([{active:e.value==C.value.pay_type},"ti-other-item"]),onClick:t=>C.value.pay_type=e.value},{default:c((()=>[r(O,{class:"ti-other-image"},{default:c((()=>{var t;return[r(G,{src:`${(null==(t=p(A)())?void 0:t.api_url)||""}/${e.img}`,mode:"widthFix"},null,8,["src"])]})),_:2},1024),r(O,{class:"ti-other-text"},{default:c((()=>[v(_(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):(o(),n(H,{key:1}))])),_:1})):j("",!0),(null==(a=b.value)?void 0:a.user_id)?(o(),n(O,{key:1,class:"ti-payment-member"},{default:c((()=>[r(O,{class:"ti-payment-top"},{default:c((()=>[r(O,{class:"ti-payment-top-name"},{default:c((()=>[v(_(t.$t("會員")),1)])),_:1}),r(O,{class:"ti-payment-top-discomfort",onClick:B},{default:c((()=>[v(_(t.$t("不使用此會員")),1)])),_:1})])),_:1}),r(O,{class:"ti-member-list"},{default:c((()=>[r(O,{class:"ti-member-item"},{default:c((()=>[r(O,{class:"ti-member-head"},{default:c((()=>[v(_(t.$t("暱稱")),1)])),_:1}),r(O,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_(null==(e=b.value)?void 0:e.nickName),1)]})),_:1})])),_:1}),r(O,{class:"ti-member-item"},{default:c((()=>[r(O,{class:"ti-member-head"},{default:c((()=>[v(_(t.$t("會員卡/等級")),1)])),_:1}),r(O,{class:"ti-member-name"},{default:c((()=>{var e,t,l,a;return[v(_(`${null==(t=null==(e=b.value)?void 0:e.card)?void 0:t.card_name}/${null==(a=null==(l=b.value)?void 0:l.grade)?void 0:a.name}`),1)]})),_:1})])),_:1}),r(O,{class:"ti-member-item"},{default:c((()=>[r(O,{class:"ti-member-head"},{default:c((()=>[v(_(t.$t("餘額")),1)])),_:1}),r(O,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_((null==(e=b.value)?void 0:e.balance)||0),1)]})),_:1})])),_:1}),r(O,{class:"ti-member-item"},{default:c((()=>[r(O,{class:"ti-member-head"},{default:c((()=>[v(_(t.$t("積分")),1)])),_:1}),r(O,{class:"ti-member-name"},{default:c((()=>{var e;return[v(_((null==(e=b.value)?void 0:e.points)||0),1)]})),_:1})])),_:1})])),_:1}),r(O,{class:"ti-member-discount"},{default:c((()=>[r(m,{class:"ti-discount-title"},{default:c((()=>[v(_(t.$t("會員折扣應收金額")),1)])),_:1}),r(m,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=b.value)?void 0:e.pay_price)||0)),1)]})),_:1}),r(m,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=b.value)?void 0:e.pay_price)||0)),1)]})),_:1})])),_:1})])),_:1})):j("",!0),r(Le,{show:f.value,"onUpdate:show":l[0]||(l[0]=e=>f.value=e),orderId:i.orderId,onChange:T},null,8,["show","orderId"])]})),_:1})])),footer:c((()=>[r(O,{class:"ti-dialog-btn"},{default:c((()=>[r(J,{onClick:l[1]||(l[1]=e=>u("update:show",!1))},{default:c((()=>[v(_(t.$t("退出")),1)])),_:1}),r(J,{loading:S.value,onClick:z},{default:c((()=>[v(_(t.$t("打印")),1)])),_:1},8,["loading"]),r(J,{onClick:l[2]||(l[2]=e=>f.value=!0)},{default:c((()=>[v(_(t.$t("会员")),1)])),_:1}),r(J,{loading:P.value,type:"primary",onClick:Z},{default:c((()=>[v(_(t.$t("确定")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-ea4c1c31"]]),Se=e({__name:"cart-list",setup(e,{expose:l}){const u=t(!1),i=t(!1),d=t({}),f=t({}),m=t({}),h=t([]),b=t(),P=()=>{u.value=!0},S=async e=>{var t,l,a,u,s,o;const n={...m.value};n.order_id=M();try{e&&(i.value=!0);const c=await ne(n);if(f.value=null==(l=null==(t=c.data)?void 0:t.allProductInfo)?void 0:l.sumInfo,h.value=(null==(s=null==(u=null==(a=c.data)?void 0:a.allProductInfo)?void 0:u.orderInfo)?void 0:s.product)||[],h.value&&h.value.length>0){let e=0;(null==(o=d.value)?void 0:o.order_product_id)&&(e=h.value.findIndex((e=>{var t;return e.order_product_id==(null==(t=d.value)?void 0:t.order_product_id)}))),d.value=h.value[Math.max(e,0)],b.value=M()}else b.value=null,E()}catch(c){}finally{e&&(i.value=!1)}};return S(!0),l({getCartData:S}),(e,t)=>{var l,m;const N=y,K=a(s("ti-loading"),C),D=V,B=a(s("ti-empty-data"),$),O=x,T=F;return o(),g(w,null,[r(N,{class:"ti-cart-box"},{default:c((()=>[r(N,{class:"ti-cart-list"},{default:c((()=>[r(N,{class:"ti-cart-shop-head"},{default:c((()=>[r(N,{class:"ti-shop-head-title"},{default:c((()=>[v(_(e.$t("商品名稱")),1)])),_:1}),r(N,{class:"ti-shop-head-money"},{default:c((()=>[v(_(e.$t("金額")),1)])),_:1}),r(N,{class:"ti-shop-head-num"},{default:c((()=>[v(_(e.$t("數量")),1)])),_:1})])),_:1}),r(N,{class:"ti-shop-list"},{default:c((()=>[r(O,{"scroll-y":""},{default:c((()=>[i.value?(o(),n(K,{key:0})):h.value&&h.value.length>0?(o(),n(N,{key:1,class:"ti-shop-box"},{default:c((()=>[(o(!0),g(w,null,k(h.value,(e=>{var l;return o(),n(N,{key:e,class:I([{active:(null==(l=d.value)?void 0:l.order_product_id)==(null==e?void 0:e.order_product_id)},"ti-shop-item"]),onClick:t=>(e=>{var t;(null==(t=d.value)?void 0:t.order_product_id)!=(null==e?void 0:e.order_product_id)&&(d.value=e)})(e)},{default:c((()=>[r(N,{class:"ti-shop-item-box"},{default:c((()=>[r(N,{class:"ti-shop-box"},{default:c((()=>[r(N,{class:"ti-shop-body-top"},{default:c((()=>[r(N,{class:"ti-shop-title text-ellipsis"},{default:c((()=>[v(_(e.product_name_text),1)])),_:2},1024),e.product_attr?(o(),n(N,{key:0,class:"ti-shop-spec"},{default:c((()=>[v("( "+_(e.product_attr)+" )",1)])),_:2},1024)):j("",!0)])),_:2},1024),r(N,{class:"ti-shop-body-money"},{default:c((()=>[r(D,{class:"ti-shop-price"},{default:c((()=>[v(_(p(L)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(D,{class:"ti-shop-subPrice"},{default:c((()=>[v(_(p(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024),r(Pe,{productItem:e,onChange:t[0]||(t[0]=e=>S())},null,8,["productItem"])])),_:2},1024),e.remark?(o(),n(N,{key:0,class:"ti-shop-remark"},{default:c((()=>[v(_(e.remark),1)])),_:2},1024)):j("",!0)])),_:2},1024)])),_:2},1032,["class","onClick"])})),128))])),_:1})):(o(),n(B,{key:2}))])),_:1})])),_:1})])),_:1}),r(N,{class:"ti-cart-statistics"},{default:c((()=>[r(N,{class:"ti-cart-total"},{default:c((()=>[r(D,{class:"ti-total-text"},{default:c((()=>[v(_(e.$t("小計:")),1)])),_:1}),r(D,{class:"ti-total-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=f.value)?void 0:e.subtotal)||0)),1)]})),_:1}),r(D,{class:"ti-total-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=f.value)?void 0:e.subtotal)||0)),1)]})),_:1})])),_:1}),r(N,{class:"ti-cart-discount"},{default:c((()=>[r(N,{class:"ti-discount-item"},{default:c((()=>[r(N,null,{default:c((()=>[r(D,{class:"ti-discount-text"},{default:c((()=>[v(_(e.$t("服務費:")),1)])),_:1}),r(D,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=f.value)?void 0:e.service_money)||0)),1)]})),_:1}),r(D,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=f.value)?void 0:e.service_money)||0)),1)]})),_:1})])),_:1}),r(N,null,{default:c((()=>{var t;return[r(D,{class:"ti-discount-text"},{default:c((()=>[v(_(e.$t("優惠折扣:")),1)])),_:1}),r(D,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(`-${p(L)((null==(e=f.value)?void 0:e.special_discount)||0)}`),1)]})),_:1}),p(U)((null==(t=f.value)?void 0:t.special_discount)||0)?(o(),n(D,{key:0,class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(`-${p(U)((null==(e=f.value)?void 0:e.special_discount)||0)}`),1)]})),_:1})):j("",!0)]})),_:1})])),_:1}),r(N,{class:"ti-discount-item"},{default:c((()=>[r(N,null,{default:c((()=>[r(D,{class:"ti-discount-text"},{default:c((()=>[v(_(e.$t("消費稅:")),1)])),_:1}),r(D,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=f.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1}),r(D,{class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=f.value)?void 0:e.total_consumption_tax_money)||0)),1)]})),_:1})])),_:1}),r(N,null,{default:c((()=>{var t;return[r(D,{class:"ti-discount-text"},{default:c((()=>[v(_(e.$t("會員折扣:")),1)])),_:1}),r(D,{class:"ti-discount-price"},{default:c((()=>{var e;return[v(_(`-${p(L)((null==(e=f.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1}),p(U)((null==(t=f.value)?void 0:t.total_user_discount_money)||0)?(o(),n(D,{key:0,class:"ti-discount-subPrice"},{default:c((()=>{var e;return[v(_(`-${p(U)((null==(e=f.value)?void 0:e.total_user_discount_money)||0)}`),1)]})),_:1})):j("",!0)]})),_:1})])),_:1})])),_:1}),r(N,{class:"ti-cart-settlement"},{default:c((()=>[r(N,{class:"ti-settlement-total"},{default:c((()=>[r(D,{class:"ti-settlement-text"},{default:c((()=>[v(_(e.$t("應收：")),1)])),_:1}),r(D,{class:"ti-settlement-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=f.value)?void 0:e.total_pay_price)||0)),1)]})),_:1}),r(D,{class:"ti-settlement-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=f.value)?void 0:e.total_pay_price)||0)),1)]})),_:1})])),_:1}),r(T,{class:"ti-settlement-btn",disabled:h.value.length<=0,onClick:P},{default:c((()=>[r(D,null,{default:c((()=>[v(_(e.$t("結賬")),1)])),_:1}),h.value.length>0?(o(),n(D,{key:0,class:"ti-settlement-badge"},{default:c((()=>[v(_(h.value.length),1)])),_:1})):j("",!0)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),r($e,{productItem:d.value,orderId:b.value,totalPayPrice:null==(l=f.value)?void 0:l.total_pay_price,orderList:h.value,onSuccess:t[1]||(t[1]=e=>S())},null,8,["productItem","orderId","totalPayPrice","orderList"]),r(Ue,{show:u.value,"onUpdate:show":t[2]||(t[2]=e=>u.value=e),orderId:b.value,totalPayPrice:null==(m=f.value)?void 0:m.total_pay_price,onSuccess:t[3]||(t[3]=e=>S())},null,8,["show","orderId","totalPayPrice"])],64)}}},[["__scopeId","data-v-0fe8d4c7"]]),Ve=e({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null}},emits:["update:menuId"],setup(e,{emit:a}){const u=e,s=t(0),i=t(0),d=t([]);l((()=>u.list),(async e=>{if(await q(),!e||0==e.length)return;const t=G().in(this);if(e.map(((e,l)=>{t.select(`#scroll-item-${l}`).boundingClientRect((e=>{if(!e)return;const t=d.value;t[l]=e.width+10,d.value=t})).exec()})),u.menuId>0){const e=u.list.findIndex((e=>e.category_id==u.menuId));e>-1&&p(e)}}),{deep:!0,immediate:!0});const p=e=>{i.value=e,s.value=d.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(d.value[e]+100),a("update:menuId",u.list[e].category_id)};return(e,t)=>{const l=V,a=y,d=x;return o(),n(d,{class:"ti-dish-menu","scroll-left":s.value,"scroll-x":"","enable-flex":"","scroll-with-animation":""},{default:c((()=>[r(a,{class:"ti-menu-content"},{default:c((()=>[(o(!0),g(w,null,k(u.list,((e,t)=>(o(),n(a,{key:t,class:I(["ti-menu-item",{active:t==i.value}]),id:`scroll-item-${t}`,onClick:e=>p(t)},{default:c((()=>[r(l,{class:"ti-menu-title"},{default:c((()=>[v(_(e.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scroll-left"])}}},[["__scopeId","data-v-4f990a9b"]]),je=e({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId"],setup(e,{emit:a}){const u=t([]),s=t(0),i=t(0),d=B((()=>{let e=(u.value.find((e=>e.category_id==s.value))||{}).child||[];return e&&e.length>0&&(e=[{name_text:f("全部"),category_id:0}].concat(e)),e}));l((()=>s.value),(()=>{a("update:categoryId",s.value),d&&d.length>0&&(i.value=d.value[0].category_id)}));return(async()=>{try{const e=await ce();e.data.list&&(u.value=[{name_text:f("全部"),category_id:0}].concat(e.data.list),s.value=u.value[0].category_id)}catch(e){}})(),(e,t)=>{const l=y;return o(),n(l,{class:"ti-category-box"},{default:c((()=>[r(Ve,{list:u.value,menuId:s.value,"onUpdate:menuId":t[0]||(t[0]=e=>s.value=e)},null,8,["list","menuId"]),r(l,{class:"ti-dish-secondary"},{default:c((()=>[(o(!0),g(w,null,k(p(d),((e,t)=>(o(),n(l,{key:t,class:I([{active:e.category_id==i.value},"ti-secondary-item"]),onClick:t=>{return l=e.category_id,i.value=l,void a("update:categoryId",i.value>0?i.value:s.value);var l}},{default:c((()=>[v(_(e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-52ae0756"]]),Ne=e({__name:"goods-detail",props:{show:{type:Boolean,default:!1},productId:{type:Number,default:null}},emits:["update:show","success"],setup(e,{emit:u}){const i=e,h=t({}),b=t(!1),C=t(!1),$=t({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed:[],bag_price:0,delivery:O()?30:40,describe:null});l((()=>i.show),(()=>{i.show&&P()}));const P=async()=>{var e,t,l,a,u,s,d,o,n;if(!b.value||i.productId)try{b.value=!0;const c=await re(i.productId);h.value=c.data,$.value.product_id=null==(e=h.value)?void 0:e.product_id,$.value.price=null==(t=h.value)?void 0:t.product_price,$.value.product_price=null==(l=h.value)?void 0:l.product_price,(null==(a=h.value)?void 0:a.sku)&&(null==(u=h.value)?void 0:u.sku.length)>0&&($.value.product_sku_id=null==(s=h.value)?void 0:s.sku[0].product_sku_id),(null==(d=h.value)?void 0:d.product_attr)&&(null==(o=h.value)?void 0:o.product_attr.length)>0&&(null==(n=h.value)||n.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?$.value.attr[t]=0:$.value.attr[t]=null}))),$.value.feed&&$.value.feed.length>0&&($.value.feed=[])}catch(c){}finally{b.value=!1}},N=async()=>{var e,t,l,a,s,i,d,o,n;if(C.value)return;const c={...$.value};c.attr=c.attr.join(","),c.feed=c.feed.join(",");let r=[];(null==(e=h.value)?void 0:e.sku)&&(null==(t=h.value)?void 0:t.sku.length)>0&&r.push(null==(l=h.value)?void 0:l.sku.find((e=>e.product_sku_id==$.value.product_sku_id)).spec_name_text),(null==(a=h.value)?void 0:a.product_attr)&&(null==(s=h.value)?void 0:s.product_attr.length)&&(null==(i=h.value)||i.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0&&(null==e?void 0:e.attribute_value[$.value.attr[t]])&&r.push(null==e?void 0:e.attribute_value[$.value.attr[t]])}))),(null==(d=h.value)?void 0:d.product_feed)&&(null==(o=h.value)?void 0:o.product_feed.length)>0&&(null==(n=h.value)||n.product_feed.map(((e,t)=>{K(t)&&(r.push(e.feed_name_text),c.price=H(c.price,null==e?void 0:e.price))}))),c.describe=r.join(";"),c.delivery=O()?30:40,c.order_id=M();try{C.value=!0;const e=await ve(c);1==e.code&&(S(e.data.order_id),m({title:e.msg,icon:"none"}),u("update:show",!1),setTimeout((()=>{u("success")}),100))}catch(v){}finally{C.value=!1}},K=e=>$.value.feed.indexOf(e)>-1,D=(e,t)=>$.value.attr[e]==t;return(e,t)=>{const l=R,m=y,b=V,P=x,S=a(s("ti-modal"),d);return o(),n(S,{show:i.show,title:p(f)("商品详情"),confirmLoading:C.value,onCancel:t[0]||(t[0]=e=>u("update:show",!1)),onConfirm:N},{content:c((()=>[r(m,{class:"ti-dialog-content"},{default:c((()=>[r(m,{class:"ti-detail-box"},{default:c((()=>[r(m,{class:"ti-detail-image"},{default:c((()=>{var e,t,a,u;return[(null==(e=h.value)?void 0:e.image)&&(null==(t=h.value)?void 0:t.image[0])&&(null==(a=h.value)?void 0:a.image[0].file_path)?(o(),n(l,{key:0,src:null==(u=h.value)?void 0:u.image[0].file_path,mode:"widthFix"},null,8,["src"])):j("",!0)]})),_:1}),r(m,{class:"ti-detail-con"},{default:c((()=>[r(m,{class:"ti-detail-title text-ellipsis"},{default:c((()=>{var e;return[v(_(null==(e=h.value)?void 0:e.product_name_text),1)]})),_:1}),r(m,{class:"ti-price-box"},{default:c((()=>[r(b,{class:"ti-detail-unit"},{default:c((()=>[v(_(p(f)("單價：")),1)])),_:1}),r(b,{class:"ti-detail-price"},{default:c((()=>{var e;return[v(_(p(L)((null==(e=h.value)?void 0:e.product_price)||0)),1)]})),_:1}),r(b,{class:"ti-detail-subPrice"},{default:c((()=>{var e;return[v(_(p(U)((null==(e=h.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),r(m,{class:"ti-price-box"},{default:c((()=>[r(b,{class:"ti-detail-unit"},{default:c((()=>[v(_(p(f)("單位：")),1)])),_:1}),r(b,{class:"ti-detail-price"},{default:c((()=>{var e;return[v(_(null==(e=h.value)?void 0:e.product_unit_text),1)]})),_:1})])),_:1})])),_:1})])),_:1}),r(m,{class:"ti-detail-specs"},{default:c((()=>[r(P,{"scroll-y":""},{default:c((()=>[r(m,{class:"ti-specs-box"},{default:c((()=>{var e,t,l,a,u,s,i;return[(null==(e=h.value)?void 0:e.sku)&&(null==(t=h.value)?void 0:t.sku.length)>0?(o(),n(m,{key:0,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(_(p(f)("規格")),1)])),_:1}),r(m,{class:"ti-specs-child"},{default:c((()=>{var e;return[(o(!0),g(w,null,k(null==(e=h.value)?void 0:e.sku,(e=>(o(),n(m,{key:e.product_sku_id,class:I([{active:e.product_sku_id==$.value.product_sku_id},"ti-child-item"]),onClick:t=>{return l=e.product_sku_id,void($.value.product_sku_id!=l&&($.value.product_sku_id=l));var l}},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(_(e.spec_name_text),1)])),_:2},1024),r(b,{class:"ti-child-price"},{default:c((()=>[v(_(p(L)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(b,{class:"ti-child-subPrice"},{default:c((()=>[v(_(p(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):j("",!0),(null==(l=h.value)?void 0:l.product_attr)&&(null==(a=h.value)?void 0:a.product_attr.length)>0?(o(!0),g(w,{key:1},k(null==(u=h.value)?void 0:u.product_attr,((e,t)=>(o(),n(m,{key:t,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(_(e.attribute_name_text),1)])),_:2},1024),r(m,{class:"ti-specs-child"},{default:c((()=>[(o(!0),g(w,null,k(null==e?void 0:e.attribute_value,((e,l)=>(o(),n(m,{key:l,class:I([{active:D(t,l)},"ti-child-item"]),onClick:e=>((e,t)=>{$.value.attr[e]=t})(t,l)},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(_(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)):j("",!0),(null==(s=h.value)?void 0:s.product_feed)&&(null==(i=h.value)?void 0:i.product_feed.length)>0?(o(),n(m,{key:2,class:"ti-specs-item"},{default:c((()=>[r(m,{class:"ti-specs-title"},{default:c((()=>[v(_(p(f)("加料")),1)])),_:1}),r(m,{class:"ti-specs-child"},{default:c((()=>{var e;return[(o(!0),g(w,null,k(null==(e=h.value)?void 0:e.product_feed,((e,t)=>(o(),n(m,{key:t,class:I([{active:K(t)},"ti-child-item"]),onClick:e=>(e=>{const t=$.value.feed.indexOf(e);t>=0?$.value.feed.splice(t,1):$.value.feed.push(e)})(t)},{default:c((()=>[r(b,{class:"ti-child-name"},{default:c((()=>[v(_(e.feed_name_text),1)])),_:2},1024),r(b,{class:"ti-child-price"},{default:c((()=>[v(_(p(L)((null==e?void 0:e.price)||0)),1)])),_:2},1024),r(b,{class:"ti-child-subPrice"},{default:c((()=>[v(_(p(U)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):j("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmLoading"])}}},[["__scopeId","data-v-534e0da3"]]),Ke=e({__name:"dish-list",emits:["success"],setup(e,{emit:u}){const i=t(!1),d=t({category_id:null,page:1,list_rows:20}),h=t([]),b=t(!1),P=t(),S=t(!1);l((()=>d.value.category_id),(()=>{D()}));const N=()=>{u("success")},K=()=>{S.value&&(d.value.page+=1,B())},D=()=>{d.value.page=1,B(!0)},B=async e=>{var t,l,a,u,s,i;if(b.value)return;const o={...d.value};o.category_id||(o.category_id=null);try{e&&(b.value=!0);const n=await _e(o);1==d.value.page&&(h.value=[]),h.value=h.value.concat((null==(l=null==(t=n.data)?void 0:t.list)?void 0:l.data)||[]),S.value=(null==(u=null==(a=n.data)?void 0:a.list)?void 0:u.last_page)>(null==(i=null==(s=n.data)?void 0:s.list)?void 0:i.current_page)}catch(n){}finally{e&&(b.value=!1)}};return D(),(e,t)=>{const l=a(s("ti-loading"),C),u=R,D=V,B=y,O=a(s("ti-empty-data"),$),T=x;return o(),g(w,null,[r(B,{class:"ti-dish-box"},{default:c((()=>[r(je,{categoryId:d.value.category_id,"onUpdate:categoryId":t[0]||(t[0]=e=>d.value.category_id=e)},null,8,["categoryId"]),r(B,{class:"ti-dish-list"},{default:c((()=>[r(T,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:K},{default:c((()=>[b.value?(o(),n(l,{key:0})):h.value&&h.value.length>0?(o(),g(w,{key:1},[r(B,{class:"ti-dish-goods"},{default:c((()=>[(o(!0),g(w,null,k(h.value,((e,t)=>(o(),n(B,{key:t,class:I([{"sold-out":e.product_stock<=0},"ti-goods-item"]),onClick:t=>(e=>{if(e.product_stock<=0)return m({title:f("已售罄"),icon:"none"});i.value=!0,P.value=e.product_id})(e)},{default:c((()=>[r(B,{class:"ti-goods-image"},{default:c((()=>[e.image&&e.image[0]&&e.image[0].file_path?(o(),n(u,{key:0,src:e.image[0].file_path,mode:"widthFix"},null,8,["src"])):j("",!0),r(D,{class:"sold-out-text"},{default:c((()=>[v(_(p(f)("已售罄")),1)])),_:1})])),_:2},1024),r(B,{class:"ti-goods-content"},{default:c((()=>[r(B,{class:"ti-goods-title"},{default:c((()=>[v(_(e.product_name_text),1)])),_:2},1024),r(B,{class:"ti-price-box"},{default:c((()=>[r(D,{class:"ti-goods-price"},{default:c((()=>[v(_(p(L)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),r(D,{class:"ti-goods-subPrice"},{default:c((()=>[v(_(p(U)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r(l,{status:S.value?"loading":"no-more"},null,8,["status"])],64)):(o(),n(O,{key:2}))])),_:1})])),_:1})])),_:1}),r(Ne,{show:i.value,"onUpdate:show":t[1]||(t[1]=e=>i.value=e),productId:P.value,onSuccess:N},null,8,["show","productId"])],64)}}},[["__scopeId","data-v-b2466d7b"]]),De=e({__name:"index",setup(e){const l=t();J((()=>{Q()}));const a=()=>{var e;null==(e=l.value)||e.getCartData()};return(e,t)=>{const u=y,s=W("ti-layout");return o(),n(s,null,{default:c((()=>[r(u,{class:"ti-index"},{default:c((()=>[r(Se,{ref_key:"cartRef",ref:l},null,512),r(Ke,{onSuccess:a})])),_:1})])),_:1})}}},[["__scopeId","data-v-5474dea1"]]);export{De as default};
