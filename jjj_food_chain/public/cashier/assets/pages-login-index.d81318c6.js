var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,t=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,o=(e,a,l)=>new Promise(((s,t)=>{var o=e=>{try{u(l.next(e))}catch(a){t(a)}},i=e=>{try{u(l.throw(e))}catch(a){t(a)}},u=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,i);u((l=l.apply(e,a)).next())}));import{_ as i,u,c as n,r,a as d,b as c,o as p,d as v,w as f,e as m,f as _,t as g,g as h,h as y,l as b,i as w,j as x,k,m as V,n as C,p as I,q as j,s as U,v as O,x as P,y as F,$ as L,z as $,A as z,B as E,C as R,D as q,E as A,F as B,G as D,H as G,I as H,J,K,L as M,M as S}from"./index-d2b65eac.js";import{_ as T}from"./ti-select.9fd1a2a3.js";const N=""+new URL("bg-93598f2d.png",import.meta.url).href,Q=""+new URL("login_logo-83575c4a.svg",import.meta.url).href,W=i({__name:"set-language",setup(e){const{changeLocale:a}=u(),l=n((()=>w[y()])),s=e=>{e&&e!==y()&&a(e)};return(e,a)=>{const t=r(c("uni-icons"),d),o=x,i=k,u=r(c("ti-select"),T);return p(),v(u,{modelValue:h(y)(),clear:!1,placement:"top",localdata:h(b)()||[],onChange:s},{select:f((()=>[m(i,{class:"ti-language"},{default:f((()=>[m(t,{"custom-prefix":"iconfont",type:"icon-global",size:"16"}),m(o,{class:"ti-language-text"},{default:f((()=>[_(g(h(l)),1)])),_:1}),m(t,{type:"right",size:"16",style:{transform:"rotate(90deg)"}})])),_:1})])),_:1},8,["modelValue","localdata"])}}},[["__scopeId","data-v-44a2c9f4"]]),X=i({__name:"index",setup(e){var i;const u=V(),d=C(!0),y=C(!1),b=C(!1),w=C({user_name:"",password:""}),x=n((()=>!w.value.user_name||!w.value.password)),T=C(!1),X=C(!(null==(i=I())?void 0:i.api_url)),Y=C({ip:"",port:"",device_id:""});j((()=>X.value),(()=>{X.value&&Z()})),U((()=>{Z(),O({success:e=>{Y.value.device_id=e.deviceId}})}));const Z=()=>{const e=I();Y.value.ip=(null==e?void 0:e.ip)||P()||"127.0.0.1",Y.value.port=(null==e?void 0:e.port)||"8080"},ee=()=>o(this,null,(function*(){var e,o,i,u,n,r,d,c;const p=((e,o)=>{for(var i in o||(o={}))l.call(o,i)&&t(e,i,o[i]);if(a)for(var i of a(o))s.call(o,i)&&t(e,i,o[i]);return e})({},Y.value);if(!p.ip)return F({title:L("请输入地址"),icon:"none"});if(!p.port)return F({title:L("请输入端口"),icon:"none"});try{T.value=!0;const a=yield $(z(`${null==p?void 0:p.ip}:${p.port}`),{key:Y.value.device_id,address:Y.value.ip,port:Y.value.port});(null==(o=null==(e=a.data)?void 0:e.shop)?void 0:o.app_id)&&(null==(u=null==(i=a.data)?void 0:i.shop)?void 0:u.shop_supplier_id)?(X.value=!1,F({title:L("绑定成功"),icon:"none"}),E(null==(r=null==(n=a.data)?void 0:n.shop)?void 0:r.app_id),R(null==(c=null==(d=a.data)?void 0:d.shop)?void 0:c.shop_supplier_id),q(p),setTimeout((()=>{var e;I()&&A(`${null==(e=I())?void 0:e.api_url}/cashier-mini`)}),100)):F({title:L("绑定失败"),icon:"none"})}catch(v){F({title:L("绑定失败"),icon:"none"})}finally{T.value=!1}})),ae=()=>o(this,null,(function*(){if(!w.value.user_name)return F({title:L("請輸入賬號"),icon:"none"});if(!w.value.password)return F({title:L("输入登录密码"),icon:"none"});try{b.value=!0;const e=yield B(w.value);e.data.token&&(D(e.data.token),u.setUserInfo(!0),G({url:"/pages/index/index"}))}catch(e){}finally{b.value=!1}})),le=e=>{e&&(1==d.value&&(w.value.user_name+=e),1==y.value&&(w.value.password+=e))},se=e=>{d.value="username"===e,y.value="password"===e},te=()=>{1==d.value&&(w.value.user_name=""),1==y.value&&(w.value.password="")},oe=()=>{Y.value={ip:"",port:""}},ie=()=>{X.value=!X.value};return(e,a)=>{const l=H,s=k,t=J,o=r(c("ti-button"),K),i=r(c("ti-input"),M),u=r(c("ti-keyboard"),S);return p(),v(s,{class:"ti-login"},{default:f((()=>[m(s,{class:"ti-login-img"},{default:f((()=>[m(l,{src:N,mode:"widthFix"})])),_:1}),m(s,{class:"ti-login-box"},{default:f((()=>[X.value?(p(),v(s,{key:0,class:"ti-serve-box"},{default:f((()=>[m(s,{class:"ti-serve-head"},{default:f((()=>[m(s,{class:"ti-serve-logo"},{default:f((()=>[m(l,{src:Q,mode:"widthFix"})])),_:1}),m(s,{class:"ti-serve-title"},{default:f((()=>[_(g(h(L)("收银机")),1)])),_:1})])),_:1}),m(s,{class:"ti-serve-label"},{default:f((()=>[_(g(h(L)("服務器連接地址")),1)])),_:1}),m(s,{class:"ti-serve-input"},{default:f((()=>[m(s,{class:"ti-serve-ip"},{default:f((()=>[m(t,{modelValue:Y.value.ip,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value.ip=e),type:"text",placeholder:h(L)("请输入地址")},null,8,["modelValue","placeholder"])])),_:1}),m(s,{class:"ti-serve-colon"},{default:f((()=>[_(":")])),_:1}),m(s,{class:"ti-serve-port"},{default:f((()=>[m(t,{modelValue:Y.value.port,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value.port=e),type:"number",placeholder:h(L)("请输入端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),m(s,{class:"ti-serve-btn"},{default:f((()=>[m(o,{onClick:oe},{default:f((()=>[_(g(h(L)("重置")),1)])),_:1}),m(o,{loading:T.value,type:"primary",onClick:ee},{default:f((()=>[_(g(h(L)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(p(),v(s,{key:1,class:"ti-login-form"},{default:f((()=>[m(s,{class:"ti-form-box"},{default:f((()=>[m(s,{class:"ti-form-head"},{default:f((()=>[m(s,{class:"ti-login-logo"},{default:f((()=>[m(l,{src:Q,mode:"widthFix"})])),_:1}),m(s,{class:"ti-login-title"},{default:f((()=>[_(g(h(L)("收银机")),1)])),_:1})])),_:1}),m(s,{class:"ti-form-username"},{default:f((()=>[m(i,{modelValue:w.value.user_name,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value.user_name=e),prefixIcon:"icon-user",placeholder:h(L)("請輸入用戶名"),focus:d.value,onClick:a[3]||(a[3]=e=>se("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),m(s,{class:"ti-form-password"},{default:f((()=>[m(i,{modelValue:w.value.password,"onUpdate:modelValue":a[4]||(a[4]=e=>w.value.password=e),prefixIcon:"icon-lock",placeholder:h(L)("請輸入登錄密碼"),focus:y.value,password:!0,onClick:a[5]||(a[5]=e=>se("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),m(s,{class:"ti-form-btn"},{default:f((()=>[m(o,{type:"primary",loading:b.value,disabled:h(x),onClick:ae},{default:f((()=>[_(g(h(L)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),m(s,{class:"ti-form-link",onClick:ie},{default:f((()=>[_(g(h(L)("更换服务器")),1)])),_:1})])),_:1}),m(s,{class:"ti-form-keyboard"},{default:f((()=>[m(u,{isExit:!1,isPrimary:!1,onInput:le,onClear:te})])),_:1})])),_:1}))])),_:1}),m(s,{class:"ti-language-box"},{default:f((()=>[m(W)])),_:1})])),_:1})}}},[["__scopeId","data-v-f48e36f3"]]);export{X as default};
